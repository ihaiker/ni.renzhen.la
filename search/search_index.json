{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"","title":"\u4e3b\u9875"},{"location":"about/","text":"","title":"\u5173\u4e8e\u6211\u4eec"},{"location":"template/","text":"\u767b\u5f55 \u70ab\u9177\u767b\u5f55\u9875\u9762\u661f\u7a7a\u7c92\u5b50\u80cc\u666f\u5728\u7ebf\u9884\u89c8_\u524d\u7aef\u4ee3\u7801\u4e0b\u8f7d (bootstrapmb.com) \u540e\u53f0 \u76f8\u518c \u70ab\u9177\u9f20\u6807\u5212\u8fc7\u56fe\u7247\u6563\u5f00css\u7279\u6548 (bootstrapmb.com) html5 canvas\u70ab\u9177\u7c92\u5b50\u7279\u6548\u5728\u7ebf\u9884\u89c8_\u524d\u7aef\u4ee3\u7801\u4e0b\u8f7d (bootstrapmb.com)","title":"\u6548\u679c\u4e0d\u9519\u7684HTML"},{"location":"template/#_1","text":"\u70ab\u9177\u767b\u5f55\u9875\u9762\u661f\u7a7a\u7c92\u5b50\u80cc\u666f\u5728\u7ebf\u9884\u89c8_\u524d\u7aef\u4ee3\u7801\u4e0b\u8f7d (bootstrapmb.com)","title":"\u767b\u5f55"},{"location":"template/#_2","text":"","title":"\u540e\u53f0"},{"location":"template/#_3","text":"\u70ab\u9177\u9f20\u6807\u5212\u8fc7\u56fe\u7247\u6563\u5f00css\u7279\u6548 (bootstrapmb.com) html5 canvas\u70ab\u9177\u7c92\u5b50\u7279\u6548\u5728\u7ebf\u9884\u89c8_\u524d\u7aef\u4ee3\u7801\u4e0b\u8f7d (bootstrapmb.com)","title":"\u76f8\u518c"},{"location":"cloud/","text":"clusters ETCD\u96c6\u7fa4\u5b89\u88c5 docker Docker \u56fd\u5185\u955c\u50cf\u52a0\u901f kubernetes Kubernates HA\u96c6\u7fa4\u65b9\u5f0f openstack The Guide About OpenStack clusters ETCD\u96c6\u7fa4\u5b89\u88c5 docker Docker \u56fd\u5185\u955c\u50cf\u52a0\u901f kubernetes Kubernates HA\u96c6\u7fa4\u65b9\u5f0f openstack The Guide About OpenStack","title":"\u4e91\u670d\u52a1"},{"location":"cloud/clusters/","text":"ETCD\u96c6\u7fa4\u5b89\u88c5 ETCD\u96c6\u7fa4\u5b89\u88c5 ETCD\u96c6\u7fa4\u5b89\u88c5","title":"Index"},{"location":"cloud/clusters/etcd/","text":"ETCD\u96c6\u7fa4\u5b89\u88c5 etcd \u76ee\u524d\u9ed8\u8ba4\u4f7f\u7528 2379 \u7aef\u53e3\u63d0\u4f9b HTTP API \u670d\u52a1\uff0c2380 \u7aef\u53e3\u63d0\u4f9b Peer \u901a\u4fe1\uff08\u8fd9\u4e24\u4e2a\u7aef\u53e3\u5df2\u7ecf\u88ab IANA \u5b98\u65b9\u9884\u7559\u7ed9 etcd\uff09\uff0c\u5728\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5206\u522b\u4f7f\u7528 4001 \u548c 7001\uff0c\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u6ce8\u610f\u8fd9\u4e2a\u533a\u522b\u3002 \u867d\u7136 etcd \u4e5f\u652f\u6301\u5355\u70b9\u90e8\u7f72\uff0c\u4f46\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u63a8\u8350\u96c6\u7fa4\u65b9\u5f0f\u90e8\u7f72\uff0c\u4e00\u822c etcd \u8282\u70b9\u6570\u4f1a\u9009\u62e9 3\u30015\u30017\u3002etcd \u4f1a\u4fdd\u8bc1\u6240\u6709\u7684\u8282\u70b9\u90fd\u4f1a\u4fdd\u5b58\u6570\u636e\uff0c\u5e76\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u6b63\u786e\u6027\u3002 \u5b89\u88c5 \u7f16\u8bd1\u5b89\u88c5 \u56e0\u4e3a etcd \u662f Golang \u7f16\u5199\u7684\uff0c\u5b89\u88c5\u53ea\u9700\u8981\u4e0b\u8f7d\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u653e\u5230\u5408\u9002\u7684\u8def\u5f84\u5c31\u884c\u3002\u5982\u679c\u5728\u6d4b\u8bd5\u73af\u5883\uff0c\u542f\u52a8\u4e00\u4e2a\u5355\u70b9\u7684 etcd \u670d\u52a1\uff0c\u53ea\u9700\u8981\u8fd0\u884c etcd \u6267\u884c\u5373\u53ef\u3002 git clone https://github.com/etcd-io/etcd.git cd etcd ./build \u4f7f\u7528 build \u811a\u672c\u6784\u5efa\u4f1a\u5728\u5f53\u524d\u9879\u76ee\u7684 bin \u76ee\u5f55\u751f\u4ea7 etcd \u548c etcdctl \u53ef\u6267\u884c\u7a0b\u5e8f\u3002 etcd \u5c31\u662f etcd server\uff0c\u800c etcdctl \u4e3b\u8981\u4e3a etcd server \u63d0\u4f9b\u6307\u4ee4\u884c\u64cd\u4f5c\u3002 \u67e5\u770b\u7248\u672c\uff1a $ ./bin/etcd --version etcd Version: 3.5.0-pre Git SHA: ab4cc3cae Go Version: go1.14.4 Go OS/Arch: darwin/amd64 $ ./bin/etcdctl version etcdctl version: 3.5.0-pre API version: 3.5 \u76f4\u63a5\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6 \u4e3a\u4e86\u65b9\u4fbf\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u4f7f\u7528\u4e0b\u9762\u811a\u672c\u8fdb\u884c\u5b89\u88c5\uff1a $ download_url=`curl -q https://api.github.com/repos/etcd-io/etcd/releases | jq -r '.[0].assets[].browser_download_url' | grep $(uname -s) -i | head -n 1` $ wget $download_url \u6216\u8005\u60a8\u76f4\u63a5\u4e0b\u8f7d: https://github.com/etcd-io/etcd/releases Docker \u65b9\u5f0f\u5b89\u88c5 docker \u5b89\u88c5\u53ea\u9700\u8981pull\u4e0b\u8f7d\u76f8\u5e94\u7684\u7248\u672c\u5373\u53ef quay.io/coreos/etcd:v3.5.0 \u3002 \u56fd\u5185\u52a0\u901f\u53c2\u8003 \u5355\u70b9\u90e8\u7f72 \u76f4\u63a5\u542f\u52a8 ./bin/etcd -advertise-client-urls http://0.0.0.0:2379 -listen-client-urls http://0.0.0.0:2379 \u5bb9\u5668\u90e8\u7f72 $ docker run --rm --name etcd -p 2379:2379 -e ETCDCTL_API=3 quay.io/coreos/etcd:v3.5.0 /usr/local/bin/etcd \\ -advertise-client-urls http://0.0.0.0:2379 \\ -listen-client-urls http://0.0.0.0:2379 $ docker ps -f name=etcd $ docker exec -it etcd etcdctl version etcdctl version: 3.3.8 API version: 3.3 $ docker exec -it etcd etcdctl endpoint health 127.0.0.1:2379 is healthy: successfully committed proposal: took = 571.723\u00b5s \u5173\u952e\u542f\u52a8\u53c2\u6570\u6e05\u5355\u8bf4\u660e \u53c2\u6570\u540d \u8bf4\u660e -name \u6307\u5b9a etcd node \u540d\u79f0\uff0c\u53ef\u4ee5\u4f7f\u7528 hostname\u3002 \u2013data-dir \u6307\u5b9a etcd server \u6301\u4e45\u5316\u6570\u636e\u5b58\u50a8\u76ee\u5f55\u8def\u5f84\u3002 \u2013snapshot-count \u6307\u5b9a\u6709\u591a\u5c11\u4e8b\u52a1\uff08transaction\uff09\u88ab\u63d0\u4ea4\u540e\uff0c\u89e6\u53d1\u622a\u53d6\u5feb\u7167\u5e76\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u2013heartbeat-interval \u6307\u5b9a Leader \u591a\u4e45\u53d1\u9001\u4e00\u6b21\u5fc3\u8df3\u5230 Followers\u3002 \u2013eletion-timeout \u6307\u5b9a\u91cd\u65b0\u6295\u7968\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5982\u679c Follow \u5728\u8be5\u65f6\u95f4\u95f4\u9694\u6ca1\u6709\u6536\u5230 Leader \u53d1\u51fa\u7684\u5fc3\u8df3\u5305\uff0c\u5219\u4f1a\u89e6\u53d1\u91cd\u65b0\u6295\u7968\u3002 \u2013listen-peer-urls \u6307\u5b9a\u548c Cluster \u5176\u4ed6 Node \u901a\u4fe1\u7684\u5730\u5740\uff0c\u6bd4\u5982\uff1ahttp://IP:2380\uff0c\u5982\u679c\u6709\u591a\u4e2a\uff0c\u5219\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002\u9700\u8981\u6240\u6709\u8282\u70b9\u90fd\u80fd\u591f\u8bbf\u95ee\uff0c\u6240\u4ee5\u4e0d\u8981\u4f7f\u7528 localhost\u3002 \u2013listen-client-urls \u6307\u5b9a\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u5730\u5740\uff0c\u6bd4\u5982\uff1ahttp://IP:2379,http://127.0.0.1:2379\u3002 \u2013advertise-client-urls \u5bf9\u5916\u901a\u544a\u7684\u8be5\u8282\u70b9\u7684\u5ba2\u6237\u7aef\u76d1\u542c\u5730\u5740\uff0c\u4f1a\u544a\u8bc9\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\u3002 \u2013initial-advertise-peer-urls \u5bf9\u5916\u901a\u544a\u8be5\u8282\u70b9\u7684\u540c\u4f34\uff08Peer\uff09\u76d1\u542c\u5730\u5740\uff0c\u8fd9\u4e2a\u503c\u4f1a\u544a\u8bc9\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\u3002 \u2013initial-cluster \u6307\u5b9a\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u901a\u5e38\u4e3a IP:Port \u4fe1\u606f\uff0c\u683c\u5f0f\u4e3a\uff1anode1=http://ip1:2380,node2=http://ip2:2380,\u2026\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 node1 \u5c31\u662f --name \u6307\u5b9a\u7684\u540d\u5b57\uff0cip1:2380 \u5c31\u662f --initial-advertise-peer-urls \u6307\u5b9a\u7684\u503c\u3002 \u2013initial-cluster-state \u65b0\u5efa\u96c6\u7fa4\u65f6\uff0c\u8fd9\u4e2a\u503c\u4e3a new\uff1b\u5047\u5982\u5df2\u7ecf\u5b58\u5728\u4e86\u96c6\u7fa4\uff0c\u8fd9\u4e2a\u503c\u4e3a existing\u3002 \u2013initial-cluster-token \u521b\u5efa\u96c6\u7fa4\u7684 token\uff0c\u8fd9\u4e2a\u503c\u6bcf\u4e2a\u96c6\u7fa4\u4fdd\u6301\u552f\u4e00\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5982\u679c\u4f60\u8981\u91cd\u65b0\u521b\u5efa\u96c6\u7fa4\uff0c\u5373\u4f7f\u914d\u7f6e\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u4e5f\u4f1a\u518d\u6b21\u751f\u6210\u65b0\u7684\u96c6\u7fa4\u548c\u8282\u70b9 UUID\uff1b\u5426\u5219\u4f1a\u5bfc\u81f4\u591a\u4e2a\u96c6\u7fa4\u4e4b\u95f4\u7684\u51b2\u7a81\uff0c\u9020\u6210\u672a\u77e5\u7684\u9519\u8bef\u3002 \u96c6\u7fa4\u90e8\u7f72 etcd cluster \u7684\u90e8\u7f72\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u591a\u4e2a\u4e3b\u673a\u4e0a\u90fd\u90e8\u7f72 etcd server\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u52a0\u5165\u5230\u4e00\u4e2a cluster \u4e2d\u3002 \u6ce8\u610f\uff1aetcd cluster \u5fc5\u987b\u5177\u6709\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u5668\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4 Cluster \u9891\u7e41\u8fdb\u884c Leader Change\u3002\u5728 OpenShift \u7684 etcd cluster \u4e2d\uff0c\u4f1a\u6bcf\u9694 100ms \u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b\u3002 \u5728\u5b89\u88c5\u548c\u542f\u52a8 etcd \u670d\u52a1\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u5404\u4e2a Node \u90fd\u9700\u8981\u77e5\u9053 Cluster \u4e2d\u5176\u4ed6 Nodes \u7684\u4fe1\u606f\uff0c\u4e00\u822c\u662f IP:Port \u4fe1\u606f\u3002 \u6839\u636e\u7528\u6237\u662f\u5426\u63d0\u524d\u77e5\u6653\uff08\u89c4\u5212\uff09\u4e86\u6bcf\u4e2a Node \u7684 IP \u5730\u5740\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\u4e0d\u540c\u7684\u96c6\u7fa4\u90e8\u7f72\u65b9\u6848\uff1a 1\u3001\u9759\u6001\u914d\u7f6e \u5728\u542f\u52a8 etcd server \u7684\u65f6\u5019\uff0c\u901a\u8fc7 --initial-cluster \u53c2\u6570\u914d\u7f6e\u597d\u6240\u6709\u7684\u8282\u70b9\u4fe1\u606f\u3002 2\u3001\u516c\u5f00\u7684\u53d1\u73b0\u670d\u52a1 \u6ce8\u518c\u5230\u5df2\u6709\u7684 etcd cluster\uff1a\u6bd4\u5982\u5b98\u65b9\u63d0\u4f9b\u7684 discovery.etcd.io 1\u3001\u9759\u6001\u914d\u7f6e\u96c6\u7fa4 \u5982\u679c etcd cluster \u4e2d\u7684\u6210\u5458\u662f\u5df2\u77e5\u7684\uff0c\u4e14\u5177\u6709\u56fa\u5b9a\u7684 IP \u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u9759\u6001\u7684\u521d\u59cb\u5316\u4e00\u4e2a\u96c6\u7fa4\u3002 \u73af\u5883\u51c6\u5907\uff1a\u4e09\u53f0\u4e3b\u673a\uff0810.0.2.1\\10.0.2.2\\10.0.2.3\uff09 \u6bcf\u4e2a Node \u90fd\u4f7f\u7528\u5982\u4e0b\u73af\u5883\u53d8\u91cf\uff1a ETCD_INITIAL_CLUSTER=\"node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380\" ETCD_INITIAL_CLUSTER_STATE=new \u6216\u8005\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4\u884c\u53c2\u6570\u6765\u6307\u5b9a\u96c6\u7fa4\u6210\u5458\uff1a --initial-cluster node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380 --initial-cluster-state new \u521d\u59cb\u5316\u96c6\u7fa4\uff1a \u751f\u6210TOKEN\uff1a ETCD_TOKEN=${uuidgen} \u5728\u6bcf\u4e00\u4e2anode\u4e0a\u6267\u884c\uff1a $ HOST_IP=`hostname -i` $ etcd --name <NodeID> --initial-advertise-peer-urls http://$HOST_IP:2380 \\ --listen-peer-urls http://$HOST_IP:2380 \\ --listen-client-urls http://$HOST_IP:2379,http://127.0.0.1:2379 \\ --advertise-client-urls http://$HOST_IP:2380 \\ --initial-cluster-token $ETCD_TOKEN \\ --initial-cluster node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380 \\ --initial-cluster-state new \u6ce8\uff1a\u6240\u6709\u4ee5 --initial-cluster* \u5f00\u5934\u7684\u9009\u9879\uff0c\u5728\u7b2c\u4e00\u6b21\u8fd0\u884c\uff08Bootstrap\uff09\u540e\u90fd\u88ab\u5ffd\u7565\u3002 2\u3001\u516c\u5f00\u7684\u53d1\u73b0\u670d\u52a1\u521b\u5efa\u96c6\u7fa4 \u9996\u5148\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u6ce8\u518ctoken $ curl https://discovery.etcd.io/new?size=3 https://discovery.etcd.io/a81b5818e67a6ea83e9d4daea5ecbc92 \u521d\u59cb\u5316\u96c6\u7fa4\uff1a\u5728\u6bcf\u4e00\u4e2anode\u4e0a\u6267\u884c $ DISCOVERY=`curl https://discovery.etcd.io/new?size=3` $ HOST_IP=`hostname -i` $ etcd --name <NodeID> --initial-advertise-peer-urls http://$HOST_IP:2380 \\ --listen-peer-urls http://$HOST_IP:2380 \\ --listen-client-urls http://$HOST_IP:2379,http://127.0.0.1:2379 \\ --advertise-client-urls http://$HOST_IP:2380 \\ --discovery ${DISCOVERY} \\ --initial-cluster-token $ETCD_TOKEN \\ --initial-cluster-state new \u4f7f\u7528TLS\u52a0\u5bc6\u901a\u4fe1 etcd \u652f\u6301\u57fa\u4e8e TLS \u52a0\u5bc6\u7684\u96c6\u7fa4\u5185\u90e8\u3001\u96c6\u7fa4\u5916\u90e8\uff08\u5ba2\u6237\u7aef\u4e0e\u96c6\u7fa4\u4e4b\u95f4\uff09\u7684\u5b89\u5168\u901a\u4fe1\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u8282\u70b9\u90fd\u5e94\u8be5\u62e5\u6709\u88ab\u5171\u4eab CA \u7b7e\u540d\u7684\u8bc1\u4e66\uff1a \u751f\u6210\u5bc6\u94a5\u5bf9\u3001\u8bc1\u4e66\u7b7e\u540d openssl genrsa -out radon.key 2048 export SAN_CFG=$(printf \"\\n[SAN]\\nsubjectAltName=IP:127.0.0.1,IP:10.0.2.1,DNS:radon.gmem.cc\") openssl req -new -sha256 -key radon.key -out radon.csr \\ -subj \"/C=CN/ST=BeiJing/O=Gmem Studio/CN=Server Radon\" \\ -reqexts SAN -config <(cat /etc/ssl/openssl.cnf <(echo $SAN_CFG)) \u6267\u884c\u7b7e\u540d openssl x509 -req -sha256 -in radon.csr -out radon.crt -CA ../ca.crt -CAkey ../ca.key -CAcreateserial -days 3650 \\ -extensions SAN -extfile <(echo \"${SAN_CFG}\") \u521d\u59cb\u5316\u96c6\u7fa4\u547d\u4ee4\u9700\u8981\u4fee\u6539\u4e3a\uff1a etcd --name radon --initial-advertise-peer-urls https://10.0.2.1:2380 --listen-peer-urls https://10.0.2.1:2380 --listen-client-urls https://10.0.2.1:2379,https://127.0.0.1:2379 --advertise-client-urls https://10.0.2.1:2380 --initial-cluster-token etcd.gmem.cc --initial-cluster node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380 # \u6307\u5b9a\u96c6\u7fa4\u6210\u5458\u5217\u8868 --initial-cluster-state new # \u521d\u59cb\u5316\u65b0\u96c6\u7fa4\u65f6\u4f7f\u7528 --initial-cluster-state existing # \u52a0\u5165\u5df2\u6709\u96c6\u7fa4\u65f6\u4f7f\u7528 --client-cert-auth # \u5ba2\u6237\u7aef TLS \u76f8\u5173\u53c2\u6570 --trusted-ca-file=/usr/share/ca-certificates/GmemCA.crt --cert-file=/opt/etcd/cert/radon.crt --key-file=/opt/etcd/cert/radon.key --peer-client-cert-auth # \u96c6\u7fa4\u5185\u90e8 TLS \u76f8\u5173\u53c2\u6570 --peer-trusted-ca-file=/usr/share/ca-certificates/GmemCA.crt --peer-cert-file=/opt/etcd/cert/radon.crt --peer-key-file=/opt/etcd/cert/radon.key \u96c6\u7fa4\u5065\u5eb7\u68c0\u6d4b ETCDCTL_API=3 /k8s/etcd/bin/etcdctl endpoint health \\ --write-out=table \\ --cacert=/k8s/kubernetes/ssl/ca.pem \\ --cert=/k8s/kubernetes/ssl/server.pem \\ --key=/k8s/kubernetes/ssl/server-key.pem \\ --endpoints=https://192.168.0.108:2379,https://192.168.0.109:2379,https://192.168.0.110:2379 \u53c2\u8003\u8d44\u6599 \u5feb\u901f\u5b89\u88c5\u6307\u5bfc\uff1a http://play.etcd.io/install#top-top \u57fa\u672c\u64cd\u4f5capi: https://github.com/coreos/etcd/blob/master/Documentation/v2/api.md \u96c6\u7fa4\u914d\u7f6eapi: https://github.com/coreos/etcd/blob/master/Documentation/v2/members_api.md \u9274\u6743\u8ba4\u8bc1api: https://github.com/coreos/etcd/blob/master/Documentation/v2/auth_api.md \u914d\u7f6e\u9879\uff1ahttps://github.com/coreos/etcd/blob/master/Documentation/op-guide/configuration.md https://coreos.com/etcd/docs/latest/runtime-configuration.html https://coreos.com/etcd/docs/latest/clustering.html https://coreos.com/etcd/docs/latest/runtime-configuration.html https://coreos.com/etcd/docs/latest/ https://coreos.com/etcd/docs/latest/admin_guide.html#disaster-recovery","title":"ETCD\u96c6\u7fa4\u5b89\u88c5"},{"location":"cloud/clusters/etcd/#etcd","text":"etcd \u76ee\u524d\u9ed8\u8ba4\u4f7f\u7528 2379 \u7aef\u53e3\u63d0\u4f9b HTTP API \u670d\u52a1\uff0c2380 \u7aef\u53e3\u63d0\u4f9b Peer \u901a\u4fe1\uff08\u8fd9\u4e24\u4e2a\u7aef\u53e3\u5df2\u7ecf\u88ab IANA \u5b98\u65b9\u9884\u7559\u7ed9 etcd\uff09\uff0c\u5728\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5206\u522b\u4f7f\u7528 4001 \u548c 7001\uff0c\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u6ce8\u610f\u8fd9\u4e2a\u533a\u522b\u3002 \u867d\u7136 etcd \u4e5f\u652f\u6301\u5355\u70b9\u90e8\u7f72\uff0c\u4f46\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u63a8\u8350\u96c6\u7fa4\u65b9\u5f0f\u90e8\u7f72\uff0c\u4e00\u822c etcd \u8282\u70b9\u6570\u4f1a\u9009\u62e9 3\u30015\u30017\u3002etcd \u4f1a\u4fdd\u8bc1\u6240\u6709\u7684\u8282\u70b9\u90fd\u4f1a\u4fdd\u5b58\u6570\u636e\uff0c\u5e76\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u6b63\u786e\u6027\u3002","title":"ETCD\u96c6\u7fa4\u5b89\u88c5"},{"location":"cloud/clusters/etcd/#_1","text":"","title":"\u5b89\u88c5"},{"location":"cloud/clusters/etcd/#_2","text":"\u56e0\u4e3a etcd \u662f Golang \u7f16\u5199\u7684\uff0c\u5b89\u88c5\u53ea\u9700\u8981\u4e0b\u8f7d\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u653e\u5230\u5408\u9002\u7684\u8def\u5f84\u5c31\u884c\u3002\u5982\u679c\u5728\u6d4b\u8bd5\u73af\u5883\uff0c\u542f\u52a8\u4e00\u4e2a\u5355\u70b9\u7684 etcd \u670d\u52a1\uff0c\u53ea\u9700\u8981\u8fd0\u884c etcd \u6267\u884c\u5373\u53ef\u3002 git clone https://github.com/etcd-io/etcd.git cd etcd ./build \u4f7f\u7528 build \u811a\u672c\u6784\u5efa\u4f1a\u5728\u5f53\u524d\u9879\u76ee\u7684 bin \u76ee\u5f55\u751f\u4ea7 etcd \u548c etcdctl \u53ef\u6267\u884c\u7a0b\u5e8f\u3002 etcd \u5c31\u662f etcd server\uff0c\u800c etcdctl \u4e3b\u8981\u4e3a etcd server \u63d0\u4f9b\u6307\u4ee4\u884c\u64cd\u4f5c\u3002 \u67e5\u770b\u7248\u672c\uff1a $ ./bin/etcd --version etcd Version: 3.5.0-pre Git SHA: ab4cc3cae Go Version: go1.14.4 Go OS/Arch: darwin/amd64 $ ./bin/etcdctl version etcdctl version: 3.5.0-pre API version: 3.5","title":"\u7f16\u8bd1\u5b89\u88c5"},{"location":"cloud/clusters/etcd/#_3","text":"\u4e3a\u4e86\u65b9\u4fbf\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u4f7f\u7528\u4e0b\u9762\u811a\u672c\u8fdb\u884c\u5b89\u88c5\uff1a $ download_url=`curl -q https://api.github.com/repos/etcd-io/etcd/releases | jq -r '.[0].assets[].browser_download_url' | grep $(uname -s) -i | head -n 1` $ wget $download_url \u6216\u8005\u60a8\u76f4\u63a5\u4e0b\u8f7d: https://github.com/etcd-io/etcd/releases","title":"\u76f4\u63a5\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6"},{"location":"cloud/clusters/etcd/#docker","text":"docker \u5b89\u88c5\u53ea\u9700\u8981pull\u4e0b\u8f7d\u76f8\u5e94\u7684\u7248\u672c\u5373\u53ef quay.io/coreos/etcd:v3.5.0 \u3002 \u56fd\u5185\u52a0\u901f\u53c2\u8003","title":"Docker \u65b9\u5f0f\u5b89\u88c5"},{"location":"cloud/clusters/etcd/#_4","text":"","title":"\u5355\u70b9\u90e8\u7f72"},{"location":"cloud/clusters/etcd/#_5","text":"./bin/etcd -advertise-client-urls http://0.0.0.0:2379 -listen-client-urls http://0.0.0.0:2379","title":"\u76f4\u63a5\u542f\u52a8"},{"location":"cloud/clusters/etcd/#_6","text":"$ docker run --rm --name etcd -p 2379:2379 -e ETCDCTL_API=3 quay.io/coreos/etcd:v3.5.0 /usr/local/bin/etcd \\ -advertise-client-urls http://0.0.0.0:2379 \\ -listen-client-urls http://0.0.0.0:2379 $ docker ps -f name=etcd $ docker exec -it etcd etcdctl version etcdctl version: 3.3.8 API version: 3.3 $ docker exec -it etcd etcdctl endpoint health 127.0.0.1:2379 is healthy: successfully committed proposal: took = 571.723\u00b5s","title":"\u5bb9\u5668\u90e8\u7f72"},{"location":"cloud/clusters/etcd/#_7","text":"\u53c2\u6570\u540d \u8bf4\u660e -name \u6307\u5b9a etcd node \u540d\u79f0\uff0c\u53ef\u4ee5\u4f7f\u7528 hostname\u3002 \u2013data-dir \u6307\u5b9a etcd server \u6301\u4e45\u5316\u6570\u636e\u5b58\u50a8\u76ee\u5f55\u8def\u5f84\u3002 \u2013snapshot-count \u6307\u5b9a\u6709\u591a\u5c11\u4e8b\u52a1\uff08transaction\uff09\u88ab\u63d0\u4ea4\u540e\uff0c\u89e6\u53d1\u622a\u53d6\u5feb\u7167\u5e76\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 \u2013heartbeat-interval \u6307\u5b9a Leader \u591a\u4e45\u53d1\u9001\u4e00\u6b21\u5fc3\u8df3\u5230 Followers\u3002 \u2013eletion-timeout \u6307\u5b9a\u91cd\u65b0\u6295\u7968\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5982\u679c Follow \u5728\u8be5\u65f6\u95f4\u95f4\u9694\u6ca1\u6709\u6536\u5230 Leader \u53d1\u51fa\u7684\u5fc3\u8df3\u5305\uff0c\u5219\u4f1a\u89e6\u53d1\u91cd\u65b0\u6295\u7968\u3002 \u2013listen-peer-urls \u6307\u5b9a\u548c Cluster \u5176\u4ed6 Node \u901a\u4fe1\u7684\u5730\u5740\uff0c\u6bd4\u5982\uff1ahttp://IP:2380\uff0c\u5982\u679c\u6709\u591a\u4e2a\uff0c\u5219\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002\u9700\u8981\u6240\u6709\u8282\u70b9\u90fd\u80fd\u591f\u8bbf\u95ee\uff0c\u6240\u4ee5\u4e0d\u8981\u4f7f\u7528 localhost\u3002 \u2013listen-client-urls \u6307\u5b9a\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u5730\u5740\uff0c\u6bd4\u5982\uff1ahttp://IP:2379,http://127.0.0.1:2379\u3002 \u2013advertise-client-urls \u5bf9\u5916\u901a\u544a\u7684\u8be5\u8282\u70b9\u7684\u5ba2\u6237\u7aef\u76d1\u542c\u5730\u5740\uff0c\u4f1a\u544a\u8bc9\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\u3002 \u2013initial-advertise-peer-urls \u5bf9\u5916\u901a\u544a\u8be5\u8282\u70b9\u7684\u540c\u4f34\uff08Peer\uff09\u76d1\u542c\u5730\u5740\uff0c\u8fd9\u4e2a\u503c\u4f1a\u544a\u8bc9\u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\u3002 \u2013initial-cluster \u6307\u5b9a\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u901a\u5e38\u4e3a IP:Port \u4fe1\u606f\uff0c\u683c\u5f0f\u4e3a\uff1anode1=http://ip1:2380,node2=http://ip2:2380,\u2026\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 node1 \u5c31\u662f --name \u6307\u5b9a\u7684\u540d\u5b57\uff0cip1:2380 \u5c31\u662f --initial-advertise-peer-urls \u6307\u5b9a\u7684\u503c\u3002 \u2013initial-cluster-state \u65b0\u5efa\u96c6\u7fa4\u65f6\uff0c\u8fd9\u4e2a\u503c\u4e3a new\uff1b\u5047\u5982\u5df2\u7ecf\u5b58\u5728\u4e86\u96c6\u7fa4\uff0c\u8fd9\u4e2a\u503c\u4e3a existing\u3002 \u2013initial-cluster-token \u521b\u5efa\u96c6\u7fa4\u7684 token\uff0c\u8fd9\u4e2a\u503c\u6bcf\u4e2a\u96c6\u7fa4\u4fdd\u6301\u552f\u4e00\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5982\u679c\u4f60\u8981\u91cd\u65b0\u521b\u5efa\u96c6\u7fa4\uff0c\u5373\u4f7f\u914d\u7f6e\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u4e5f\u4f1a\u518d\u6b21\u751f\u6210\u65b0\u7684\u96c6\u7fa4\u548c\u8282\u70b9 UUID\uff1b\u5426\u5219\u4f1a\u5bfc\u81f4\u591a\u4e2a\u96c6\u7fa4\u4e4b\u95f4\u7684\u51b2\u7a81\uff0c\u9020\u6210\u672a\u77e5\u7684\u9519\u8bef\u3002","title":"\u5173\u952e\u542f\u52a8\u53c2\u6570\u6e05\u5355\u8bf4\u660e"},{"location":"cloud/clusters/etcd/#_8","text":"etcd cluster \u7684\u90e8\u7f72\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u591a\u4e2a\u4e3b\u673a\u4e0a\u90fd\u90e8\u7f72 etcd server\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u52a0\u5165\u5230\u4e00\u4e2a cluster \u4e2d\u3002 \u6ce8\u610f\uff1aetcd cluster \u5fc5\u987b\u5177\u6709\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u5668\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4 Cluster \u9891\u7e41\u8fdb\u884c Leader Change\u3002\u5728 OpenShift \u7684 etcd cluster \u4e2d\uff0c\u4f1a\u6bcf\u9694 100ms \u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b\u3002 \u5728\u5b89\u88c5\u548c\u542f\u52a8 etcd \u670d\u52a1\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u5404\u4e2a Node \u90fd\u9700\u8981\u77e5\u9053 Cluster \u4e2d\u5176\u4ed6 Nodes \u7684\u4fe1\u606f\uff0c\u4e00\u822c\u662f IP:Port \u4fe1\u606f\u3002 \u6839\u636e\u7528\u6237\u662f\u5426\u63d0\u524d\u77e5\u6653\uff08\u89c4\u5212\uff09\u4e86\u6bcf\u4e2a Node \u7684 IP \u5730\u5740\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\u4e0d\u540c\u7684\u96c6\u7fa4\u90e8\u7f72\u65b9\u6848\uff1a 1\u3001\u9759\u6001\u914d\u7f6e \u5728\u542f\u52a8 etcd server \u7684\u65f6\u5019\uff0c\u901a\u8fc7 --initial-cluster \u53c2\u6570\u914d\u7f6e\u597d\u6240\u6709\u7684\u8282\u70b9\u4fe1\u606f\u3002 2\u3001\u516c\u5f00\u7684\u53d1\u73b0\u670d\u52a1 \u6ce8\u518c\u5230\u5df2\u6709\u7684 etcd cluster\uff1a\u6bd4\u5982\u5b98\u65b9\u63d0\u4f9b\u7684 discovery.etcd.io","title":"\u96c6\u7fa4\u90e8\u7f72"},{"location":"cloud/clusters/etcd/#1","text":"\u5982\u679c etcd cluster \u4e2d\u7684\u6210\u5458\u662f\u5df2\u77e5\u7684\uff0c\u4e14\u5177\u6709\u56fa\u5b9a\u7684 IP \u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u9759\u6001\u7684\u521d\u59cb\u5316\u4e00\u4e2a\u96c6\u7fa4\u3002 \u73af\u5883\u51c6\u5907\uff1a\u4e09\u53f0\u4e3b\u673a\uff0810.0.2.1\\10.0.2.2\\10.0.2.3\uff09 \u6bcf\u4e2a Node \u90fd\u4f7f\u7528\u5982\u4e0b\u73af\u5883\u53d8\u91cf\uff1a ETCD_INITIAL_CLUSTER=\"node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380\" ETCD_INITIAL_CLUSTER_STATE=new \u6216\u8005\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4\u884c\u53c2\u6570\u6765\u6307\u5b9a\u96c6\u7fa4\u6210\u5458\uff1a --initial-cluster node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380 --initial-cluster-state new \u521d\u59cb\u5316\u96c6\u7fa4\uff1a \u751f\u6210TOKEN\uff1a ETCD_TOKEN=${uuidgen} \u5728\u6bcf\u4e00\u4e2anode\u4e0a\u6267\u884c\uff1a $ HOST_IP=`hostname -i` $ etcd --name <NodeID> --initial-advertise-peer-urls http://$HOST_IP:2380 \\ --listen-peer-urls http://$HOST_IP:2380 \\ --listen-client-urls http://$HOST_IP:2379,http://127.0.0.1:2379 \\ --advertise-client-urls http://$HOST_IP:2380 \\ --initial-cluster-token $ETCD_TOKEN \\ --initial-cluster node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380 \\ --initial-cluster-state new \u6ce8\uff1a\u6240\u6709\u4ee5 --initial-cluster* \u5f00\u5934\u7684\u9009\u9879\uff0c\u5728\u7b2c\u4e00\u6b21\u8fd0\u884c\uff08Bootstrap\uff09\u540e\u90fd\u88ab\u5ffd\u7565\u3002","title":"1\u3001\u9759\u6001\u914d\u7f6e\u96c6\u7fa4"},{"location":"cloud/clusters/etcd/#2","text":"\u9996\u5148\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u6ce8\u518ctoken $ curl https://discovery.etcd.io/new?size=3 https://discovery.etcd.io/a81b5818e67a6ea83e9d4daea5ecbc92 \u521d\u59cb\u5316\u96c6\u7fa4\uff1a\u5728\u6bcf\u4e00\u4e2anode\u4e0a\u6267\u884c $ DISCOVERY=`curl https://discovery.etcd.io/new?size=3` $ HOST_IP=`hostname -i` $ etcd --name <NodeID> --initial-advertise-peer-urls http://$HOST_IP:2380 \\ --listen-peer-urls http://$HOST_IP:2380 \\ --listen-client-urls http://$HOST_IP:2379,http://127.0.0.1:2379 \\ --advertise-client-urls http://$HOST_IP:2380 \\ --discovery ${DISCOVERY} \\ --initial-cluster-token $ETCD_TOKEN \\ --initial-cluster-state new","title":"2\u3001\u516c\u5f00\u7684\u53d1\u73b0\u670d\u52a1\u521b\u5efa\u96c6\u7fa4"},{"location":"cloud/clusters/etcd/#tls","text":"etcd \u652f\u6301\u57fa\u4e8e TLS \u52a0\u5bc6\u7684\u96c6\u7fa4\u5185\u90e8\u3001\u96c6\u7fa4\u5916\u90e8\uff08\u5ba2\u6237\u7aef\u4e0e\u96c6\u7fa4\u4e4b\u95f4\uff09\u7684\u5b89\u5168\u901a\u4fe1\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u8282\u70b9\u90fd\u5e94\u8be5\u62e5\u6709\u88ab\u5171\u4eab CA \u7b7e\u540d\u7684\u8bc1\u4e66\uff1a \u751f\u6210\u5bc6\u94a5\u5bf9\u3001\u8bc1\u4e66\u7b7e\u540d openssl genrsa -out radon.key 2048 export SAN_CFG=$(printf \"\\n[SAN]\\nsubjectAltName=IP:127.0.0.1,IP:10.0.2.1,DNS:radon.gmem.cc\") openssl req -new -sha256 -key radon.key -out radon.csr \\ -subj \"/C=CN/ST=BeiJing/O=Gmem Studio/CN=Server Radon\" \\ -reqexts SAN -config <(cat /etc/ssl/openssl.cnf <(echo $SAN_CFG)) \u6267\u884c\u7b7e\u540d openssl x509 -req -sha256 -in radon.csr -out radon.crt -CA ../ca.crt -CAkey ../ca.key -CAcreateserial -days 3650 \\ -extensions SAN -extfile <(echo \"${SAN_CFG}\") \u521d\u59cb\u5316\u96c6\u7fa4\u547d\u4ee4\u9700\u8981\u4fee\u6539\u4e3a\uff1a etcd --name radon --initial-advertise-peer-urls https://10.0.2.1:2380 --listen-peer-urls https://10.0.2.1:2380 --listen-client-urls https://10.0.2.1:2379,https://127.0.0.1:2379 --advertise-client-urls https://10.0.2.1:2380 --initial-cluster-token etcd.gmem.cc --initial-cluster node1=http://10.0.2.1:2380,node2=http://10.0.2.2:2380,node3=http://10.0.2.3:2380 # \u6307\u5b9a\u96c6\u7fa4\u6210\u5458\u5217\u8868 --initial-cluster-state new # \u521d\u59cb\u5316\u65b0\u96c6\u7fa4\u65f6\u4f7f\u7528 --initial-cluster-state existing # \u52a0\u5165\u5df2\u6709\u96c6\u7fa4\u65f6\u4f7f\u7528 --client-cert-auth # \u5ba2\u6237\u7aef TLS \u76f8\u5173\u53c2\u6570 --trusted-ca-file=/usr/share/ca-certificates/GmemCA.crt --cert-file=/opt/etcd/cert/radon.crt --key-file=/opt/etcd/cert/radon.key --peer-client-cert-auth # \u96c6\u7fa4\u5185\u90e8 TLS \u76f8\u5173\u53c2\u6570 --peer-trusted-ca-file=/usr/share/ca-certificates/GmemCA.crt --peer-cert-file=/opt/etcd/cert/radon.crt --peer-key-file=/opt/etcd/cert/radon.key \u96c6\u7fa4\u5065\u5eb7\u68c0\u6d4b ETCDCTL_API=3 /k8s/etcd/bin/etcdctl endpoint health \\ --write-out=table \\ --cacert=/k8s/kubernetes/ssl/ca.pem \\ --cert=/k8s/kubernetes/ssl/server.pem \\ --key=/k8s/kubernetes/ssl/server-key.pem \\ --endpoints=https://192.168.0.108:2379,https://192.168.0.109:2379,https://192.168.0.110:2379","title":"\u4f7f\u7528TLS\u52a0\u5bc6\u901a\u4fe1"},{"location":"cloud/clusters/etcd/#_9","text":"\u5feb\u901f\u5b89\u88c5\u6307\u5bfc\uff1a http://play.etcd.io/install#top-top \u57fa\u672c\u64cd\u4f5capi: https://github.com/coreos/etcd/blob/master/Documentation/v2/api.md \u96c6\u7fa4\u914d\u7f6eapi: https://github.com/coreos/etcd/blob/master/Documentation/v2/members_api.md \u9274\u6743\u8ba4\u8bc1api: https://github.com/coreos/etcd/blob/master/Documentation/v2/auth_api.md \u914d\u7f6e\u9879\uff1ahttps://github.com/coreos/etcd/blob/master/Documentation/op-guide/configuration.md https://coreos.com/etcd/docs/latest/runtime-configuration.html https://coreos.com/etcd/docs/latest/clustering.html https://coreos.com/etcd/docs/latest/runtime-configuration.html https://coreos.com/etcd/docs/latest/ https://coreos.com/etcd/docs/latest/admin_guide.html#disaster-recovery","title":"\u53c2\u8003\u8d44\u6599"},{"location":"cloud/docker/","text":"Docker \u56fd\u5185\u955c\u50cf\u52a0\u901f Docker \u56fd\u5185\u955c\u50cf\u52a0\u901f Docker \u56fd\u5185\u955c\u50cf\u52a0\u901f Docker \u56fd\u5185\u955c\u50cf\u52a0\u901f","title":"Index"},{"location":"cloud/docker/docker/","text":"\u5b66\u4e60 https://katacoda.com/courses/container-runtimes \u8fd9\u91cc\u6709\u597d\u591a\u4e1c\u4e1c\u53ef\u4ee5\u5b66\u4e60\u54e6","title":"Docker"},{"location":"cloud/docker/docker/#httpskatacodacomcoursescontainer-runtimes","text":"","title":"\u5b66\u4e60 https://katacoda.com/courses/container-runtimes \u8fd9\u91cc\u6709\u597d\u591a\u4e1c\u4e1c\u53ef\u4ee5\u5b66\u4e60\u54e6"},{"location":"cloud/docker/image_pull/","text":"\u5b89\u88c5Kubernetes\u9ed8\u8ba4\u7684image\u6e90\u662f\uff1ak8s.gcr.io\uff0c\u4e2d\u56fd\u533a\u5b89\u88c5\u6781\u4e3a\u75db\u82e6\uff0c\u4e0dFQ\u5c31\u62c9\u53d6\u4e0d\u4e0b\u6765\uff0c\u7c7b\u4f3c\u7684\u8fd8\u6709Red Head\u7684quay.io\uff0c\u867d\u7136\u80fd\u4e0b\u8f7d\uff0c\u4f46\u662f\u901f\u5ea6\u975e\u5e38\u7684\u6162\u3002 \u89e3\u51b3\u529e\u6cd5\u6765\u4e86\uff1a \u4e2d\u56fd\u533a\u6709\u4e86\u4ee5\u4e0a\u7684docker registry\u955c\u50cf\u6e90\u4e86\uff1a \u4e2d\u79d1\u5927\u955c\u50cf https://github.com/ustclug/mirrorrequest Azure\u4e2d\u56fd\u955c\u50cf https://github.com/Azure/container-service-for-azure-china \u5148\u4e0a\u603b\u7ed3\uff0c\u65b9\u4fbf\u76f4\u63a5\u67e5\u9605\uff1a \u603b\u7ed3 \u9274\u4e8e\u4e2d\u79d1\u5927\u7684\u6e90\u7ecf\u5e38\u7684\u51fa\u73b0not fount\u7684\u9519\u8bef\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528Azure\u7684\u955c\u50cf\u6e90\u3002 docker.io docker\u5b98\u65b9\u7ef4\u62a4 $ docker pull dockerhub.azk8s.cn/library/xxx:yyy \u975e\u5b98\u65b9\u7ef4\u62a4 $ docker pull dockerhub.azk8s.cn/uuu/xxx:yyy gcr.io \u548c k8s.gcr.io gcr.io $ docker pull gcr.azk8s.cn/xxx/yyy:zzz k8s.gcr.io $ docker pull gcr.azk8s.cn/google-containers/xxx:yyy quay.io $ docker pull quay.azk8s.cn/xxx/yyy:zzz \u4e0b\u9762\u8be6\u7ec6\u8bb2\u89e3\uff1a docker.io \u955c\u50cf\u52a0\u901f \u9ed8\u8ba4\u7684docker registry\u662f\uff1a https://hub.docker.com \u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf docker.mirrors.ustc.edu.cn \u9ed8\u8ba4\u7684\u4e00\u79cd\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull xxx:yyy \u8fd9\u91cc\u6ca1\u6709\u6307\u5b9a\u7528\u6237\uff0c\u9ed8\u8ba4\u662fdocker\u5b98\u65b9\u7ef4\u62a4\u7684\u955c\u50cf xxx\u4e3a\u955c\u50cf\u7684\u540d\u79f0 yyy\u4e3a\u955c\u50cf\u7684tag\u7248\u672c \u90a3\u4e48\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf\u7684\u65b9\u5f0f\uff1a $ docker pull docker.mirrors.ustc.edu.cn/library/xxx:yyy \u4f8b\u5982\uff1anginx:1.16-alpine $ docker pull docker.mirrors.ustc.edu.cn/library/nginx:1.16-alpine \u9ed8\u8ba4\u7684\u53e6\u4e00\u79cd\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull uuu/xxx:yyy uuu\u4e3a\u5177\u4f53\u7684\u7528\u6237\uff0c\u6709\u5176\u8d1f\u8d23\u7ef4\u62a4\u8be5\u955c\u50cf xxx\u4e3a\u955c\u50cf\u7684\u540d\u79f0 yyy\u4e3a\u955c\u50cf\u7684tag\u7248\u672c \u90a3\u4e48\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf\u7684\u65b9\u5f0f\uff1a $ docker pull docker.mirrors.ustc.edu.cn/uuu/xxx:yyy \u4f8b\u5982\uff1awanghkkk/busyboxplus:latest $ docker pull docker.mirrors.ustc.edu.cn/wanghkkk/busyboxplus \u9ed8\u8ba4\u4e2d\u79d1\u5927\u4f1a\u63d0\u793a\uff1aError response from daemon: manifest for docker.mirrors.ustc.edu.cn/wanghkkk/busyboxplus:latest not found \u56e0\u4e3a\u9ed8\u8ba4\u4e2d\u79d1\u5927\u4e0d\u4f1a\u6362\u6210\u955c\u50cf\u7684\uff0c\u9700\u8981\u591a\u8bd5\u51e0\u6b21\uff0c\u7b49\u4e2d\u79d1\u5927\u7f13\u5b58\u5b8c\u6210\u540e\u624d\u80fd\u4e0b\u8f7d\u7684\u3002 \u6240\u4ee5\u8fd9\u91cc\u4e0d\u63a8\u8350\u7528\u4e2d\u79d1\u5927\u7684 \u3002 \u4f7f\u7528Azure\u4e2d\u56fd\u955c\u50cf dockerhub.azk8s.cn \u8fd8\u662f\u4f7f\u7528\u4e0a\u9762\u7684\u4e24\u4e2a\u4f8b\u5b50\uff1a nginx:1.16-alpine wanghkkk/busyboxplus \u5bf9\u5e94\u7684Azure\u4e2d\u56fd\u955c\u50cf\u662f\uff1a $ docker pull dockerhub.azk8s.cn/library/nginx:1.16-alpine $ docker pull dockerhub.azk8s.cn/wanghkkk/busyboxplus \u8fd9\u91cc\u63a8\u8350\u4f7f\u7528Azure\uff0c\u76f4\u63a5\u5c31\u62c9\u53d6\u4e0b\u6765\u4e86\uff0c\u4e0d\u50cf\u4e2d\u79d1\u5927\u9700\u8981\u4ed6\u81ea\u5df1\u5148\u4e0b\u8f7d\u7f13\u5b58\uff0c\u7136\u540e\u624d\u80fd\u4e0b\u8f7d\uff0c\u81f3\u5c11\u6211\u8bd5\u4e86\u597d\u51e0\u6b21\u4e5f\u6ca1\u62c9\u53d6\u4e0b\u6765\u3002 gcr.io \u548c k8s.gcr.io \u955c\u50cf\u52a0\u901f gcr.io \u548c k8s.gcr.io \u5b9e\u9645\u4e0a\u90fd\u662fGoogle\u7684\u955c\u50cf\uff0c\u9ed8\u8ba4\u4e2d\u56fd\u533a\u662f\u6839\u672c\u8bbf\u95ee\u4e0d\u5230\u7684\u3002 gcr.io \u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf gcr.mirrors.ustc.edu.cn \u9ed8\u8ba4gcr.io\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull gcr.io/xxx/yyy:zzz \u90a3\u4e48\u66f4\u6362\u6210\u4e2d\u79d1\u5927\u7684\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull gcr.mirrors.ustc.edu.cn/xxx/yyy:zzz \u4f8b\u5982\uff1a \u8fd9\u91cc\u4f7f\u7528gcr.io/kubernetes-helm/tiller:v2.16.1\u4e3a\u4f8b\uff1a $ docker pull gcr.mirrors.ustc.edu.cn/kubernetes-helm/tiller:v2.16.1 \u4f7f\u7528Azure\u4e2d\u56fd\u955c\u50cf gcr.azk8s.cn \u66f4\u6362\u6210Azure\u7684\u62c9\u53d6\u65b9\u5f0f\u4e3a\uff1a $ docker pull gcr.azk8s.cn/kubernetes-helm/tiller:v2.16.1 k8s.gcr.io \u5bf9\u4e8e\u6309\u7167kubernetes\u65f6\u5019\uff0c\u7528\u5230\u7684\u5c31\u662fk8s.gcr.io\u5f00\u5934\u7684\u955c\u50cf\uff0c\u5176\u5b9ek8s.gcr.io\u5c31\u662f\u7b49\u4ef7\u4e8egcr.io/google-containers \u4f8b\u5982\uff1ak8s.gcr.io/kube-proxy:v1.15.5 \u6240\u4ee5\u5462\uff0c\u5bf9\u4e8e\u4e2d\u79d1\u5927\u7684\u62c9\u53d6\u65b9\u5f0f\u4e3a\uff1a $ docker pull gcr.mirrors.ustc.edu.cn/google-containers/kube-proxy:v1.15.5 \u5bf9\u4e8eAzure\u7684\u62c9\u53d6\u65b9\u5f0f\u4e3a\uff1a $ docker pull gcr.azk8s.cn/google-containers/kube-proxy:v1.15.5 \u5bf9\u4e8e\u4e2d\u79d1\u5927\u7684\u62c9\u53d6\uff0c\u7ecf\u5e38\u7684\u51fa\u73b0not found\uff0c\u800c\u5bf9\u4e8eAzure\u6765\u8bf4\u975e\u5e38\u7684\u987a\u7545\uff0c\u5f88\u5feb\u7684\u62c9\u53d6\u4e0b\u6765\u4e86\uff0c\u6240\u4ee5\u975e\u5e38\u7684\u63a8\u8350\u4f7f\u7528Azure\u7684\u955c\u50cf\u6e90\u3002 quay.io \u955c\u50cf\u52a0\u901f \u4f8b\u5982\u62c9\u53d6\u955c\u50cf\uff1a quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1 \u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf quay.mirrors.ustc.edu.cn $ docker pull quay.mirrors.ustc.edu.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1 \u4f7f\u7528Azure\u4e2d\u56fd\u955c\u50cf quay.azk8s.cn $ docker pull quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1 \u4e00\u4e2apython\u811a\u672c\u5168\u641e\u5b9a docker-wrapper.py #!/usr/bin/python # coding=utf8 import os import sys # azure mirrors for gcr.io,k8s.gcr.io,quay.io in china gcr_mirror = \"gcr.azk8s.cn\" docker_mirror = \"dockerhub.azk8s.cn\" quay_mirror = \"quay.azk8s.cn\" k8s_namespace = \"google_containers\" gcr_prefix = \"gcr.io\" special_gcr_prefix = \"k8s.gcr.io\" quay_prefix = \"quay.io\" def execute_sys_cmd(cmd): result = os.system(cmd) if result != 0: print(cmd + \" failed.\") sys.exit(-1) def usage(): print(\"Usage: \" + sys.argv[0] + \" pull \") print(\"Examples:\") print(sys.argv[0] + \" pull k8s.gcr.io/kube-apiserver:v1.14.1\") print(sys.argv[0] + \" pull gcr.io/google_containers/kube-apiserver:v1.14.1\") print(sys.argv[0] + \" pull quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1\") if __name__ == \"__main__\": if len(sys.argv) != 3: usage() sys.exit(-1) elif sys.argv[1] != 'pull': usage() sys.exit(-1) # image name like k8s.gcr.io/kube-apiserver:v1.14.1 or gcr.io/google_containers/kube-apiserver:v1.14.1 image = sys.argv[2] imageArray = image.split(\"/\") if imageArray[0] == gcr_prefix: imageArray[0] = gcr_mirror elif imageArray[0] == special_gcr_prefix: imageArray[0] = gcr_mirror imageArray.insert(1, k8s_namespace) elif imageArray[0] == quay_prefix: imageArray[0] = quay_mirror elif len(imageArray) == 1: imageArray.insert(0, docker_mirror) imageArray.insert(1, \"library\") elif len(imageArray) == 2: imageArray.insert(0, docker_mirror) temp_image = \"/\".join(imageArray) cmd = \"docker pull {image}\".format(image=temp_image) print(\"------Execute_cmd: %s\" % cmd) execute_sys_cmd(cmd) cmd = \"docker tag {newImage} {image}\".format(newImage=temp_image, image=image) print(\"------Execute_cmd: %s\" % cmd) execute_sys_cmd(cmd) cmd = \"docker rmi {newImage}\".format(newImage=temp_image) print(\"------Execute_cmd: %s\" % cmd) execute_sys_cmd(cmd) print(\"------Pull %s done\" % image) sys.exit(0) \u4f7f\u7528\u65b9\u5f0f\uff1a $ chmod +x docker-wrapper.py $ sudo mv docker-wrapper.py /usr/local/bin/ $ docker-wrapper.py pull xxx/yyy:zzz Docker Hub \u955c\u50cf\u52a0\u901f\u5668\u5217\u8868 \u955c\u50cf\u52a0\u901f\u5668 \u955c\u50cf\u52a0\u901f\u5668\u5730\u5740 \u4e13\u5c5e\u52a0\u901f\u5668\uff1f \u5176\u5b83\u52a0\u901f\uff1f Docker \u4e2d\u56fd\u5b98\u65b9\u955c\u50cf https://registry.docker-cn.com Docker Hub DaoCloud \u955c\u50cf\u7ad9 http://f1361db2.m.daocloud.io \u53ef\u767b\u5f55\uff0c\u7cfb\u7edf\u5206\u914d Docker Hub Azure \u4e2d\u56fd\u955c\u50cf https://dockerhub.azk8s.cn Docker Hub\u3001GCR\u3001Quay \u79d1\u5927\u955c\u50cf\u7ad9 https://docker.mirrors.ustc.edu.cn Docker Hub\u3001GCR\u3001Quay \u963f\u91cc\u4e91 https:// .mirror.aliyuncs.com \u9700\u767b\u5f55\uff0c\u7cfb\u7edf\u5206\u914d Docker Hub \u4e03\u725b\u4e91 https://reg-mirror.qiniu.com Docker Hub\u3001GCR\u3001Quay \u7f51\u6613\u4e91 https://hub-mirror.c.163.com Docker Hub \u817e\u8baf\u4e91 https://mirror.ccs.tencentyun.com Docker Hub","title":"\u56fd\u5185\u955c\u50cf\u52a0\u901f"},{"location":"cloud/docker/image_pull/#_1","text":"\u9274\u4e8e\u4e2d\u79d1\u5927\u7684\u6e90\u7ecf\u5e38\u7684\u51fa\u73b0not fount\u7684\u9519\u8bef\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528Azure\u7684\u955c\u50cf\u6e90\u3002","title":"\u603b\u7ed3"},{"location":"cloud/docker/image_pull/#dockerio","text":"","title":"docker.io"},{"location":"cloud/docker/image_pull/#docker","text":"$ docker pull dockerhub.azk8s.cn/library/xxx:yyy","title":"docker\u5b98\u65b9\u7ef4\u62a4"},{"location":"cloud/docker/image_pull/#_2","text":"$ docker pull dockerhub.azk8s.cn/uuu/xxx:yyy","title":"\u975e\u5b98\u65b9\u7ef4\u62a4"},{"location":"cloud/docker/image_pull/#gcrio-k8sgcrio","text":"","title":"gcr.io \u548c k8s.gcr.io"},{"location":"cloud/docker/image_pull/#gcrio","text":"$ docker pull gcr.azk8s.cn/xxx/yyy:zzz","title":"gcr.io"},{"location":"cloud/docker/image_pull/#k8sgcrio","text":"$ docker pull gcr.azk8s.cn/google-containers/xxx:yyy","title":"k8s.gcr.io"},{"location":"cloud/docker/image_pull/#quayio","text":"$ docker pull quay.azk8s.cn/xxx/yyy:zzz \u4e0b\u9762\u8be6\u7ec6\u8bb2\u89e3\uff1a","title":"quay.io"},{"location":"cloud/docker/image_pull/#dockerio_1","text":"\u9ed8\u8ba4\u7684docker registry\u662f\uff1a https://hub.docker.com","title":"docker.io \u955c\u50cf\u52a0\u901f"},{"location":"cloud/docker/image_pull/#dockermirrorsustceducn","text":"\u9ed8\u8ba4\u7684\u4e00\u79cd\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull xxx:yyy \u8fd9\u91cc\u6ca1\u6709\u6307\u5b9a\u7528\u6237\uff0c\u9ed8\u8ba4\u662fdocker\u5b98\u65b9\u7ef4\u62a4\u7684\u955c\u50cf xxx\u4e3a\u955c\u50cf\u7684\u540d\u79f0 yyy\u4e3a\u955c\u50cf\u7684tag\u7248\u672c \u90a3\u4e48\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf\u7684\u65b9\u5f0f\uff1a $ docker pull docker.mirrors.ustc.edu.cn/library/xxx:yyy \u4f8b\u5982\uff1anginx:1.16-alpine $ docker pull docker.mirrors.ustc.edu.cn/library/nginx:1.16-alpine \u9ed8\u8ba4\u7684\u53e6\u4e00\u79cd\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull uuu/xxx:yyy uuu\u4e3a\u5177\u4f53\u7684\u7528\u6237\uff0c\u6709\u5176\u8d1f\u8d23\u7ef4\u62a4\u8be5\u955c\u50cf xxx\u4e3a\u955c\u50cf\u7684\u540d\u79f0 yyy\u4e3a\u955c\u50cf\u7684tag\u7248\u672c \u90a3\u4e48\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf\u7684\u65b9\u5f0f\uff1a $ docker pull docker.mirrors.ustc.edu.cn/uuu/xxx:yyy \u4f8b\u5982\uff1awanghkkk/busyboxplus:latest $ docker pull docker.mirrors.ustc.edu.cn/wanghkkk/busyboxplus \u9ed8\u8ba4\u4e2d\u79d1\u5927\u4f1a\u63d0\u793a\uff1aError response from daemon: manifest for docker.mirrors.ustc.edu.cn/wanghkkk/busyboxplus:latest not found \u56e0\u4e3a\u9ed8\u8ba4\u4e2d\u79d1\u5927\u4e0d\u4f1a\u6362\u6210\u955c\u50cf\u7684\uff0c\u9700\u8981\u591a\u8bd5\u51e0\u6b21\uff0c\u7b49\u4e2d\u79d1\u5927\u7f13\u5b58\u5b8c\u6210\u540e\u624d\u80fd\u4e0b\u8f7d\u7684\u3002 \u6240\u4ee5\u8fd9\u91cc\u4e0d\u63a8\u8350\u7528\u4e2d\u79d1\u5927\u7684 \u3002","title":"\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf docker.mirrors.ustc.edu.cn"},{"location":"cloud/docker/image_pull/#azure-dockerhubazk8scn","text":"\u8fd8\u662f\u4f7f\u7528\u4e0a\u9762\u7684\u4e24\u4e2a\u4f8b\u5b50\uff1a nginx:1.16-alpine wanghkkk/busyboxplus \u5bf9\u5e94\u7684Azure\u4e2d\u56fd\u955c\u50cf\u662f\uff1a $ docker pull dockerhub.azk8s.cn/library/nginx:1.16-alpine $ docker pull dockerhub.azk8s.cn/wanghkkk/busyboxplus \u8fd9\u91cc\u63a8\u8350\u4f7f\u7528Azure\uff0c\u76f4\u63a5\u5c31\u62c9\u53d6\u4e0b\u6765\u4e86\uff0c\u4e0d\u50cf\u4e2d\u79d1\u5927\u9700\u8981\u4ed6\u81ea\u5df1\u5148\u4e0b\u8f7d\u7f13\u5b58\uff0c\u7136\u540e\u624d\u80fd\u4e0b\u8f7d\uff0c\u81f3\u5c11\u6211\u8bd5\u4e86\u597d\u51e0\u6b21\u4e5f\u6ca1\u62c9\u53d6\u4e0b\u6765\u3002","title":"\u4f7f\u7528Azure\u4e2d\u56fd\u955c\u50cf dockerhub.azk8s.cn"},{"location":"cloud/docker/image_pull/#gcrio-k8sgcrio_1","text":"gcr.io \u548c k8s.gcr.io \u5b9e\u9645\u4e0a\u90fd\u662fGoogle\u7684\u955c\u50cf\uff0c\u9ed8\u8ba4\u4e2d\u56fd\u533a\u662f\u6839\u672c\u8bbf\u95ee\u4e0d\u5230\u7684\u3002","title":"gcr.io \u548c k8s.gcr.io \u955c\u50cf\u52a0\u901f"},{"location":"cloud/docker/image_pull/#gcrio_1","text":"","title":"gcr.io"},{"location":"cloud/docker/image_pull/#gcrmirrorsustceducn","text":"\u9ed8\u8ba4gcr.io\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull gcr.io/xxx/yyy:zzz \u90a3\u4e48\u66f4\u6362\u6210\u4e2d\u79d1\u5927\u7684\u62c9\u53d6\u65b9\u5f0f\uff1a $ docker pull gcr.mirrors.ustc.edu.cn/xxx/yyy:zzz \u4f8b\u5982\uff1a \u8fd9\u91cc\u4f7f\u7528gcr.io/kubernetes-helm/tiller:v2.16.1\u4e3a\u4f8b\uff1a $ docker pull gcr.mirrors.ustc.edu.cn/kubernetes-helm/tiller:v2.16.1","title":"\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf gcr.mirrors.ustc.edu.cn"},{"location":"cloud/docker/image_pull/#azure-gcrazk8scn","text":"\u66f4\u6362\u6210Azure\u7684\u62c9\u53d6\u65b9\u5f0f\u4e3a\uff1a $ docker pull gcr.azk8s.cn/kubernetes-helm/tiller:v2.16.1","title":"\u4f7f\u7528Azure\u4e2d\u56fd\u955c\u50cf gcr.azk8s.cn"},{"location":"cloud/docker/image_pull/#k8sgcrio_1","text":"\u5bf9\u4e8e\u6309\u7167kubernetes\u65f6\u5019\uff0c\u7528\u5230\u7684\u5c31\u662fk8s.gcr.io\u5f00\u5934\u7684\u955c\u50cf\uff0c\u5176\u5b9ek8s.gcr.io\u5c31\u662f\u7b49\u4ef7\u4e8egcr.io/google-containers \u4f8b\u5982\uff1ak8s.gcr.io/kube-proxy:v1.15.5 \u6240\u4ee5\u5462\uff0c\u5bf9\u4e8e\u4e2d\u79d1\u5927\u7684\u62c9\u53d6\u65b9\u5f0f\u4e3a\uff1a $ docker pull gcr.mirrors.ustc.edu.cn/google-containers/kube-proxy:v1.15.5 \u5bf9\u4e8eAzure\u7684\u62c9\u53d6\u65b9\u5f0f\u4e3a\uff1a $ docker pull gcr.azk8s.cn/google-containers/kube-proxy:v1.15.5 \u5bf9\u4e8e\u4e2d\u79d1\u5927\u7684\u62c9\u53d6\uff0c\u7ecf\u5e38\u7684\u51fa\u73b0not found\uff0c\u800c\u5bf9\u4e8eAzure\u6765\u8bf4\u975e\u5e38\u7684\u987a\u7545\uff0c\u5f88\u5feb\u7684\u62c9\u53d6\u4e0b\u6765\u4e86\uff0c\u6240\u4ee5\u975e\u5e38\u7684\u63a8\u8350\u4f7f\u7528Azure\u7684\u955c\u50cf\u6e90\u3002","title":"k8s.gcr.io"},{"location":"cloud/docker/image_pull/#quayio_1","text":"\u4f8b\u5982\u62c9\u53d6\u955c\u50cf\uff1a quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1","title":"quay.io \u955c\u50cf\u52a0\u901f"},{"location":"cloud/docker/image_pull/#quaymirrorsustceducn","text":"$ docker pull quay.mirrors.ustc.edu.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1","title":"\u4f7f\u7528\u4e2d\u79d1\u5927\u955c\u50cf quay.mirrors.ustc.edu.cn"},{"location":"cloud/docker/image_pull/#azure-quayazk8scn","text":"$ docker pull quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1","title":"\u4f7f\u7528Azure\u4e2d\u56fd\u955c\u50cf quay.azk8s.cn"},{"location":"cloud/docker/image_pull/#python","text":"docker-wrapper.py #!/usr/bin/python # coding=utf8 import os import sys # azure mirrors for gcr.io,k8s.gcr.io,quay.io in china gcr_mirror = \"gcr.azk8s.cn\" docker_mirror = \"dockerhub.azk8s.cn\" quay_mirror = \"quay.azk8s.cn\" k8s_namespace = \"google_containers\" gcr_prefix = \"gcr.io\" special_gcr_prefix = \"k8s.gcr.io\" quay_prefix = \"quay.io\" def execute_sys_cmd(cmd): result = os.system(cmd) if result != 0: print(cmd + \" failed.\") sys.exit(-1) def usage(): print(\"Usage: \" + sys.argv[0] + \" pull \") print(\"Examples:\") print(sys.argv[0] + \" pull k8s.gcr.io/kube-apiserver:v1.14.1\") print(sys.argv[0] + \" pull gcr.io/google_containers/kube-apiserver:v1.14.1\") print(sys.argv[0] + \" pull quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1\") if __name__ == \"__main__\": if len(sys.argv) != 3: usage() sys.exit(-1) elif sys.argv[1] != 'pull': usage() sys.exit(-1) # image name like k8s.gcr.io/kube-apiserver:v1.14.1 or gcr.io/google_containers/kube-apiserver:v1.14.1 image = sys.argv[2] imageArray = image.split(\"/\") if imageArray[0] == gcr_prefix: imageArray[0] = gcr_mirror elif imageArray[0] == special_gcr_prefix: imageArray[0] = gcr_mirror imageArray.insert(1, k8s_namespace) elif imageArray[0] == quay_prefix: imageArray[0] = quay_mirror elif len(imageArray) == 1: imageArray.insert(0, docker_mirror) imageArray.insert(1, \"library\") elif len(imageArray) == 2: imageArray.insert(0, docker_mirror) temp_image = \"/\".join(imageArray) cmd = \"docker pull {image}\".format(image=temp_image) print(\"------Execute_cmd: %s\" % cmd) execute_sys_cmd(cmd) cmd = \"docker tag {newImage} {image}\".format(newImage=temp_image, image=image) print(\"------Execute_cmd: %s\" % cmd) execute_sys_cmd(cmd) cmd = \"docker rmi {newImage}\".format(newImage=temp_image) print(\"------Execute_cmd: %s\" % cmd) execute_sys_cmd(cmd) print(\"------Pull %s done\" % image) sys.exit(0) \u4f7f\u7528\u65b9\u5f0f\uff1a $ chmod +x docker-wrapper.py $ sudo mv docker-wrapper.py /usr/local/bin/ $ docker-wrapper.py pull xxx/yyy:zzz","title":"\u4e00\u4e2apython\u811a\u672c\u5168\u641e\u5b9a"},{"location":"cloud/docker/image_pull/#docker-hub","text":"\u955c\u50cf\u52a0\u901f\u5668 \u955c\u50cf\u52a0\u901f\u5668\u5730\u5740 \u4e13\u5c5e\u52a0\u901f\u5668\uff1f \u5176\u5b83\u52a0\u901f\uff1f Docker \u4e2d\u56fd\u5b98\u65b9\u955c\u50cf https://registry.docker-cn.com Docker Hub DaoCloud \u955c\u50cf\u7ad9 http://f1361db2.m.daocloud.io \u53ef\u767b\u5f55\uff0c\u7cfb\u7edf\u5206\u914d Docker Hub Azure \u4e2d\u56fd\u955c\u50cf https://dockerhub.azk8s.cn Docker Hub\u3001GCR\u3001Quay \u79d1\u5927\u955c\u50cf\u7ad9 https://docker.mirrors.ustc.edu.cn Docker Hub\u3001GCR\u3001Quay \u963f\u91cc\u4e91 https:// .mirror.aliyuncs.com \u9700\u767b\u5f55\uff0c\u7cfb\u7edf\u5206\u914d Docker Hub \u4e03\u725b\u4e91 https://reg-mirror.qiniu.com Docker Hub\u3001GCR\u3001Quay \u7f51\u6613\u4e91 https://hub-mirror.c.163.com Docker Hub \u817e\u8baf\u4e91 https://mirror.ccs.tencentyun.com Docker Hub","title":"Docker Hub \u955c\u50cf\u52a0\u901f\u5668\u5217\u8868"},{"location":"cloud/kubernetes/","text":"Kubernates HA\u96c6\u7fa4\u65b9\u5f0f Kubernates HA\u96c6\u7fa4\u65b9\u5f0f Kubernates HA\u96c6\u7fa4\u65b9\u5f0f","title":"Index"},{"location":"cloud/kubernetes/ha/","text":"Kubernates HA\u96c6\u7fa4\u65b9\u5f0f https://my.oschina.net/u/4526289/blog/5139969 \u770b\u4e00\u4e0b\u8fd9\u672c\u4e66\uff1a https://feisky.gitbooks.io/kubernetes/content/apps/istio-deploy.html","title":"Kubernates HA\u96c6\u7fa4\u65b9\u5f0f"},{"location":"cloud/kubernetes/ha/#kubernates-ha","text":"https://my.oschina.net/u/4526289/blog/5139969 \u770b\u4e00\u4e0b\u8fd9\u672c\u4e66\uff1a https://feisky.gitbooks.io/kubernetes/content/apps/istio-deploy.html","title":"Kubernates HA\u96c6\u7fa4\u65b9\u5f0f"},{"location":"cloud/openstack/","text":"The Guide About OpenStack The Guide About OpenStack The Guide About OpenStack The Guide About OpenStack","title":"Index"},{"location":"cloud/openstack/guide/","text":"The Guide About OpenStack 2 PREFACE \u524d\u8a00 2.1 Abstract \u6458\u8981 The OpenStack system consists of several key services that are separately installed. These services work together depending on your cloud needs and include the Compute, Identity, Networking, Image, Block Storage, Object Storage, Telemetry, Orchestration, and Database services. You can install any of these projects separately and configure them stand-alone or as connected entities. OpenStack\u7cfb\u7edf\u7531\u591a\u4e2a\u72ec\u7acb\u5b89\u88c5\u7684\u5173\u952e\u670d\u52a1\u7ec4\u6210\u3002\u8fd9\u4e9b\u670d\u52a1\u6839\u636e\u60a8\u7684\u4e91\u9700\u6c42\u4e00\u8d77\u5de5\u4f5c\uff0c\u5305\u62ec\u8ba1\u7b97\u3001\u8eab\u4efd\u3001\u7f51\u7edc\u3001\u56fe\u50cf\u3001\u5757\u5b58\u50a8\u3001\u5bf9\u8c61\u5b58\u50a8\u3001\u9065\u6d4b\u3001\u7f16\u6392\u548c\u6570\u636e\u5e93\u670d\u52a1\u3002\u60a8\u53ef\u4ee5\u5355\u72ec\u5b89\u88c5\u8fd9\u4e9b\u9879\u76ee\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\uff0c\u5e76\u5c06\u5b83\u4eec\u5355\u72ec\u914d\u7f6e\u6216\u4f5c\u4e3a\u8fde\u63a5\u5b9e\u4f53\u914d\u7f6e\u3002 Explanations of configuration options and sample configuration files are included. \u5305\u62ec\u914d\u7f6e\u9009\u9879\u548c\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u7684\u8bf4\u660e\u3002 Note: The Training Labs scripts provide an automated way of deploying the cluster described in this Installation Guide into VirtualBox or KVM VMs. You will need a desktop computer or a laptop with at least 8 GB memory and 20 GB free storage running Linux, MacOS, or Windows. Please see the OpenStack Training Labs. \u6ce8\u610f\uff1aTrainingLabs \u9879\u76ee\u4e2d\u4f53\u7528\u4e86\u4e00\u4e2aVirutalBox\u6216KVM\u81ea\u52a8\u5316\u5b89\u88c5\u548c\u90e8\u7f72\u811a\u672c\uff0c\u4f60\u9700\u8981\u4e00\u53f0\u53f0\u5f0f\u673a\u6216\u7b14\u8bb0\u672c\u7535\u8111\uff0c\u81f3\u5c11\u67098gb\u5185\u5b58\u548c20gb\u7a7a\u95f2\u5b58\u50a8\u7a7a\u95f4\uff0c\u8fd0\u884cLinux\u3001MacOS\u6216Windows\u3002 \u8bf7\u67e5\u770bOpenStack\u57f9\u8bad\u5b9e\u9a8c This guide documents the installation of OpenStack starting with the Pike release. It covers multiple releases. \u672c\u6307\u5357\u8bb0\u5f55\u4e86\u4ecePike\u7248\u672c\u5f00\u59cb\u7684OpenStack\u5b89\u88c5\u8fc7\u7a0b\u3002 \u5b83\u6db5\u76d6\u4e86\u591a\u4e2a\u7248\u672c\u3002 Warning: This guide is a work-in-progress and is subject to updates frequently. Pre-release pack- ages have been used for testing, and some instructions may not work with final versions. Please help us make this guide better by reporting any errors you encounter. \u8b66\u544a:\u672c\u6307\u5357\u8fd8\u672a\u5b8c\u6210\uff0c\u7ecf\u5e38\u4f1a\u66f4\u65b0\u3002\u9884\u53d1\u5e03\u5305\u5df2\u7ecf\u7528\u4e8e\u6d4b\u8bd5\uff0c\u4e00\u4e9b\u8bf4\u660e\u53ef\u80fd\u4e0d\u9002\u7528\u4e8e\u6700\u7ec8\u7248\u672c\u3002\u8bf7\u901a\u8fc7\u62a5\u544a\u60a8\u9047\u5230\u7684\u4efb\u4f55\u9519\u8bef\u6765\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u5730\u5b8c\u6210\u672c\u6307\u5357\u3002 2.2 Operatting Systems \u64cd\u4f5c\u7cfb\u7edf Currently, this guide describes OpenStack installation for the following Linux distributions: \u76ee\u524d\u672c\u6307\u5357\u4ecb\u7ecd\u4e86\u4ee5\u4e0bLinux\u53d1\u884c\u7248\u7684OpenStack\u5b89\u88c5\u573a\u666f: openSUSE and SUSE Linux Enterprise Server : You can install OpenStack by using packages on openSUSE Leap 42.3, openSUSE Leap 15, SUSE Linux Enterprise Server 12 SP4, SUSE Linux Enterprise Server 15 through the Open Build Service Cloud repository. Red Hat Enterprise Linux and CentOS \uff1a You can install OpenStack by using packages available on both Red Hat Enterprise Linux 7 and 8 and their derivatives through the RDO repository. note: OpenStack Wallaby is available for CentOS Stream 8. OpenStack Ussuri and Victoria are available for both CentOS 8 and RHEL 8. OpenStack Train and earlier are available on both CentOS 7 and RHEL 7. Wallaby \u652f\u6301 Centos Stream 8\uff0c Ussuri \u548cVictoria \u652f\u6301 CentOS8\u548cRHEL 8\uff0cTrain\u548c\u66f4\u65e9\u7248\u672c\u652f\u6301Centos7\u548c RHEL 7. OpenStack Wallaby is available for CentOS Stream 8. OpenStack Ussuri and Victoria are available for both CentOS 8 and RHEL 8. OpenStack Train and earlier are available on both CentOS 7 and RHEL 7. Ubuntu : You can walk through an installation by using packages available through Canonicals Ubuntu Cloud archive repository for Ubuntu 16.04+ (LTS). Note: The Ubuntu Cloud Archive pockets for Pike and Queens provide OpenStack packages for Ubuntu 16.04 LTS; OpenStack Queens is installable direct using Ubuntu 18.04 LTS; the Ubuntu Cloud Archive pockets for Rocky and Stein provide OpenStack packages for Ubuntu 18.04 LTS; the Ubuntu Cloud Archive pocket for Victoria provides OpenStack packages for Ubuntu 20.04 LTS. 3. Get Start With OpenStack The OpenStack project is an open source cloud computing platform for all types of clouds, which aims to be simple to implement, massively scalable, and feature rich. Developers and cloud computing tech- nologists from around the world create the OpenStack project. OpenStack\u9879\u76ee\u662f\u4e00\u4e2a\u9762\u5411\u5404\u7c7b\u4e91\u7684\u5f00\u6e90\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u5176\u76ee\u6807\u662f\u5b9e\u73b0\u7b80\u5355\u3001\u53ef\u5927\u89c4\u6a21\u6269\u5c55\u3001\u7279\u6027\u4e30\u5bcc\u3002\u6765\u81ea\u4e16\u754c\u5404\u5730\u7684\u5f00\u53d1\u4eba\u5458\u548c\u4e91\u8ba1\u7b97\u6280\u672f\u4e13\u5bb6\u521b\u5efa\u4e86OpenStack\u9879\u76ee\u3002 OpenStack provides an Infrastructure-as-a-Service (IaaS) solution through a set of interrelated services. Each service offers an Application Programming Interface (API) that facilitates this integration. De- pending on your needs, you can install some or all services. OpenStack\u901a\u8fc7\u4e00\u7ec4\u76f8\u4e92\u5173\u8054\u7684\u670d\u52a1\u63d0\u4f9b\u4e86IaaS *\u89e3\u51b3\u65b9\u6848\u3002\u6bcf\u4e2a\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2aAPI \u6765\u4fc3\u8fdb\u8fd9\u79cd\u96c6\u6210\u3002\u6839\u636e\u60a8\u7684\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u5b89\u88c5\u90e8\u5206\u6216\u5168\u90e8\u670d\u52a1\u3002 3.1 the openstack service \u670d\u52a1 The OpenStack project navigator lets you browse the OpenStack services that make up the OpenStack architecture. The services are categorized per the service type and release series. \u901a\u8fc7 OpenStack\u9879\u76ee\u5bfc\u822a\u5668 \uff0c\u60a8\u53ef\u4ee5\u6d4f\u89c8\u7ec4\u6210OpenStack\u67b6\u6784\u7684OpenStack\u670d\u52a1\u3002\u670d\u52a1\u6309\u7167\u670d\u52a1\u7c7b\u578b\u548c\u53d1\u5e03\u7cfb\u5217\u8fdb\u884c\u5206\u7c7b\u3002 OpenStack Services An OpenStack deployment contains a number of components providing APIs to access infrastructure resources. This page lists the various services that can be deployed to provide such resources to cloud end users. OpenStack\u90e8\u7f72\u4e2d\u5305\u542b\u5927\u91cf\u7ec4\u4ef6\uff0c\u63d0\u4f9bapi\u8bbf\u95ee\u57fa\u7840\u8bbe\u65bd\u8d44\u6e90\u3002\u6b64\u9875\u9762\u5217\u51fa\u4e86\u53ef\u4ee5\u90e8\u7f72\u4e3a\u4e91\u7ec8\u7aef\u7528\u6237\u63d0\u4f9b\u6b64\u7c7b\u8d44\u6e90\u7684\u5404\u79cd\u670d\u52a1\u3002 Compute \u8ba1\u7b97\u670d\u52a1 Service description NOVA Compute Service \u8ba1\u7b97\u670d\u52a1 ZUN Container Service \u5bb9\u5668\u670d\u52a1 Hardware Lifecycle \u786c\u4ef6\u751f\u547d\u5468\u671f Service Description IRONIC Bare Metal Provisioning Service CYBORG Lifecycle management of accelerators Storage \u5b58\u50a8 Service Description SWIFT Object store \u5bf9\u8c61\u5b58\u50a8\uff0c\u7c7b\u4f3c\u4e8e\u963f\u91cc\u4e91OSS\uff0cAWS S3 CINDER Block Storage \u5757\u5b58\u50a8 MANILA Shared filesystems Networking \u7f51\u7edc Service Description NEUTRON Networking \u7f51\u7edc\u7ec4\u4ef6 OCTAVIA Load balancer \u8d1f\u8f7d\u5747\u8861 DESIGNATE DNS service Shared Services \u57fa\u7840\u5171\u4eab\u670d\u52a1 Service Description KEYSTONE Identity service PLACEMENT Placement service GLANCE Image service BARBICAN Key management Orchestration \u670d\u52a1\u7f16\u6392 Service Description HEAT Orchestration SENLIN Clustering service MISTRAL Workflow service ZAQAR Messaging Service BLAZAR Resource reservation service AODH Alarming Service Workload Provisioning \u5de5\u4f5c\u8d1f\u8f7d\u914d\u7f6e Service Description MAGNUM Container Orchestration Engine Provisioning SAHARA Big Data Processing Framework Provisioning TROVE Database as a Service ##### Application Lifecycle \u5e94\u7528\u751f\u547d\u5468\u671f Service Description MASAKARI Instances High Availability Service MURANO Application Catalog SOLUM Software Development Lifecycle Automation FREEZER Backup, Restore, and Disaster Recovery API Proxies Service Description EC2API EC2 API proxy Web Frontend Service Description HORIZON Dashboard 3.2 The Openstack architecture The following sections describe the OpenStack architecuture int more detail: \u4ee5\u4e0b\u7684\u7ae0\u8282\u5c06\u4ece\u66f4\u591a\u7ec6\u8282\u4e0a\u8bb2\u8ff0OpenStack\u67b6\u6784 3.2.1 Conceptual architecture \u6982\u5ff5\u8bbe\u8ba1 The following diagram shows the relationships among the OpenStack services: \u4e0b\u9762\u7684\u6d41\u7a0b\u8bb2\u8ff0\u4e86Openstack\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 3.2.2 Logical architecture \u903b\u8f91\u67b6\u6784 To design, deploy, and configure OpenStack, administrators must understand the logical architecture. \u8bbe\u8ba1\u3001\u90e8\u7f72\u6216\u8005\u914d\u7f6eOpenstack\u7ba1\u7406\u8865\u4e60\u7406\u89e3\u903b\u8f91\u67b6\u6784\u3002 As shown in Conceptual architecture , OpenStack consists of several independent parts, named the OpenStack services. All services authenticate through a common Identity service. Individual services interact with each other through public APIs, except where privileged administrator commands are necessary. \u6b63\u5982\u903b\u8f91\u67b6\u6784\u56fe\u9501\u5c55\u793a\u7684\uff0cOpenStack\u662f\u7531\u51e0\u4e2a\u72ec\u7acb\u90e8\u5206\u7ec4\u6210\u7684\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3aOpenStack\u670d\u52a1\u3002\u6240\u6709\u670d\u52a1\u7684\u8ba4\u8bc1\u90fd\u662f\u516c\u7528\u6a21\u5757ID\u8ba4\u8bc1\u670d\u52a1\u5b8c\u6210\uff08keystore\uff09\u3002 \u5404\u4e2a\u670d\u52a1\u901a\u8fc7\u516c\u5171api\u76f8\u4e92\u4ea4\u4e92\uff0c\u9664\u975e\u9700\u8981\u7279\u6743\u7ba1\u7406\u5458\u547d\u4ee4\u3002 Internally, OpenStack services are composed of several processes. All services have at least one API process, which listens for API requests, preprocesses them and passes them on to other parts of the service. With the exception of the Identity service, the actual work is done by distinct processes. OpenStack\u670d\u52a1\u5185\u90e8\u7531\u591a\u4e2a\u8fdb\u7a0b\u7ec4\u6210\u3002\u6240\u6709\u670d\u52a1\u90fd\u81f3\u5c11\u6709\u4e00\u4e2aAPI\u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u4fa6\u542cAPI\u8bf7\u6c42\uff0c\u5bf9\u5b83\u4eec\u8fdb\u884c\u9884\u5904\u7406\uff0c\u5e76\u5c06\u5b83\u4eec\u4f20\u9012\u7ed9\u670d\u52a1\u7684\u5176\u4ed6\u90e8\u5206\u3002\u9664\u4e86Identity\u670d\u52a1\u4e4b\u5916\uff0c\u5b9e\u9645\u5de5\u4f5c\u662f\u7531\u4e0d\u540c\u7684\u6d41\u7a0b\u5b8c\u6210\u7684\u3002 For communication between the processes of one service, an AMQP message broker is used. The service\u2019s state is stored in a database. When deploying and configuring your OpenStack cloud, you can choose among several message broker and database solutions, such as RabbitMQ, MySQL, MariaDB, and SQLite. \u5bf9\u4e8e\u4e00\u4e2a\u670d\u52a1\u7684\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4f7f\u7528AMQP\u6d88\u606f\u4ee3\u7406\u3002\u670d\u52a1\u7684\u72b6\u6001\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u3002\u5728\u90e8\u7f72\u548c\u914d\u7f6eOpenStack\u4e91\u65f6\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u591a\u79cd\u6d88\u606f\u4ee3\u7406\u548c\u6570\u636e\u5e93\u89e3\u51b3\u65b9\u6848\uff0c\u5982RabbitMQ\u3001MySQL\u3001MariaDB\u548cSQLite\u3002 Users can access OpenStack via the web-based user interface implemented by the Horizon Dashboard, via command-line clients and by issuing API requests through tools like browser plug-ins or curl . For applications, several SDKs are available. Ultimately, all these access methods issue REST API calls to the various OpenStack services. \u7528\u6237\u53ef\u4ee5\u901a\u8fc7Horizon Dashboard\u5b9e\u73b0\u7684\u57fa\u4e8eweb\u7684\u7528\u6237\u754c\u9762\uff0c\u901a\u8fc7 \u547d\u4ee4\u884c\u5ba2\u6237\u7aef and\uff0c\u901a\u8fc7\u6d4f\u89c8\u5668\u63d2\u4ef6\u6216 curl \u7b49\u5de5\u5177\u53d1\u51faAPI\u8bf7\u6c42)\u8bbf\u95eeOpenStack\u3002\u5bf9\u4e8e\u5e94\u7528\u7a0b\u5e8f\uff0c \u51e0\u4e2asdk \u53ef\u7528\u3002\u6700\u7ec8\uff0c\u6240\u6709\u8fd9\u4e9b\u8bbf\u95ee\u65b9\u6cd5\u90fd\u4f1a\u5411\u5404\u79cd The following diagram shows the most common, but not the only possible, architecture for an OpenStack cloud: \u4e0b\u56fe\u5c55\u793a\u4e86OpenStack\u4e91\u6700\u5e38\u89c1\u7684\uff0c\u4f46\u4e0d\u662f\u552f\u4e00\u53ef\u80fd\u7684\u67b6\u6784: 4. Overview The OpenStack project is an open source cloud computing platform that supports all types of cloud environments. The project aims for simple implementation, massive scalability, and a rich set of features. Cloud computing experts from around the world contribute to the project. OpenStack \u9879\u76ee\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u652f\u6301\u6240\u6709\u7c7b\u578b\u7684\u4e91\u73af\u5883\u3002\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u7b80\u5355\u7684\u5b9e\u73b0\u3001\u5927\u89c4\u6a21\u7684\u53ef\u4f38\u7f29\u6027\u548c\u4e00\u7ec4\u4e30\u5bcc\u7684\u7279\u6027\u3002\u6765\u81ea\u4e16\u754c\u5404\u5730\u7684\u4e91\u8ba1\u7b97\u4e13\u5bb6\u4e3a\u8be5\u9879\u76ee\u505a\u51fa\u4e86\u8d21\u732e\u3002 OpenStack provides an Infrastructure-as-a-Service (IaaS) solution through a variety of complementary services. Each service offers an Application Programming Interface (API) that facilitates this integration. OpenStack\u901a\u8fc7\u591a\u79cd\u8865\u5145\u670d\u52a1\u63d0\u4f9b\u4e86 IaaS \u89e3\u51b3\u65b9\u6848\u3002\u6bcf\u4e2a\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2a \u5e94\u7528\u7a0b\u5e8f\u7f16\u7a0b\u63a5\u53e3(API) \u6765\u4fc3\u8fdb\u8fd9\u79cd\u96c6\u6210\u3002 This guide covers step-by-step deployment of the major OpenStack services using a functional example architecture suitable for new users of OpenStack with sufficient Linux experience. This guide is not intended to be used for production system installations, but to create a minimum proof-of-concept for the purpose of learning about OpenStack. \u672c\u6307\u5357\u91c7\u7528\u529f\u80fd\u6837\u4f8b\u67b6\u6784\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u4e3b\u8981OpenStack\u670d\u52a1\u7684\u9010\u6b65\u90e8\u7f72\uff0c\u9002\u5408\u5177\u6709Linux\u7ecf\u9a8c\u7684OpenStack\u65b0\u7528\u6237\u4f7f\u7528\u3002\u672c\u6307\u5357\u4e0d\u6253\u7b97\u7528\u4e8e\u751f\u4ea7\u7cfb\u7edf\u5b89\u88c5\uff0c\u800c\u662f\u4e3a\u4e86\u89e3OpenStack\u63d0\u4f9b\u4e00\u4e2a\u6700\u5c0f\u7684\u6982\u5ff5\u9a8c\u8bc1\u3002 After becoming familiar with basic installation, configuration, operation, and troubleshooting of these OpenStack services, you should consider the following steps toward deployment using a production architecture: \u5728\u719f\u6089\u8fd9\u4e9bOpenStack\u670d\u52a1\u7684\u57fa\u672c\u5b89\u88c5\u3001\u914d\u7f6e\u3001\u64cd\u4f5c\u548c\u6545\u969c\u5904\u7406\u540e\uff0c\u5728\u4f7f\u7528\u751f\u4ea7\u67b6\u6784\u90e8\u7f72\u65f6\uff0c\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u6b65\u9aa4: Determine and implement the necessary core and optional services to meet performance and re- dundancy requirements. \u786e\u5b9a\u5e76\u5b9e\u73b0\u5fc5\u8981\u7684\u6838\u5fc3\u548c\u53ef\u9009\u670d\u52a1\uff0c\u4ee5\u6ee1\u8db3\u6027\u80fd\u548c\u5197\u4f59\u9700\u6c42\u3002 Increase security using methods such as firewalls, encryption, and service policies. \u4f7f\u7528\u9632\u706b\u5899\u3001\u52a0\u5bc6\u548c\u670d\u52a1\u7b56\u7565\u7b49\u65b9\u6cd5\u63d0\u9ad8\u5b89\u5168\u6027\u3002 Use a deployment tool such as Ansible, Chef, Puppet, or Salt to automate deployment and management of the production environment. The OpenStack project has a couple of deployment projects with specific guides per version: \u4f7f\u7528\u90e8\u7f72\u5de5\u5177(\u5982Ansible\u3001Chef\u3001Puppet\u6216Salt)\u6765\u81ea\u52a8\u5316\u751f\u4ea7\u73af\u5883\u7684\u90e8\u7f72\u548c\u7ba1\u7406\u3002OpenStack\u9879\u76ee\u6709\u4e24\u4e2a\u90e8\u7f72\u9879\u76ee\uff0c\u6bcf\u4e2a\u7248\u672c\u90fd\u6709\u7279\u5b9a\u7684\u6307\u5357: 4.1 Example architecture \u67b6\u6784\u7b80\u5355\u5b9e\u4f8b The example architecture requires at least two nodes (hosts) to launch a basic virtual machine or instance. Optional services such as Block Storage and Object Storage require additional nodes. \u8bd1\u6587: \u67b6\u6784\u793a\u4f8b\u9700\u8981\u81f3\u5c11\u4e24\u4e2a\u8282\u70b9(\u4e3b\u673a)\u6765\u542f\u52a8\u57fa\u672c\u7684 \u865a\u62df\u673a \u6216\u5b9e\u4f8b\u3002\u5757\u5b58\u50a8(Block Storage)\u3001\u5bf9\u8c61\u5b58\u50a8(Object Storage)\u7b49\u53ef\u9009\u4e1a\u52a1\u9700\u8981\u589e\u52a0\u8282\u70b9\u3002 Important: The example architecture used in this guide is a minimum configuration, and is not in- tended for production system installations. It is designed to provide a minimum proof-of-concept for the purpose of learning about OpenStack. For information on creating architectures for specific use cases, or how to determine which architecture is required, see the Architecture Design Guide. \u8bd1\u6587: \u91cd\u8981\u63d0\u793a:\u672c\u6307\u5357\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u4f53\u7cfb\u7ed3\u6784\u662f\u6700\u4f4e\u914d\u7f6e\uff0c\u4e0d\u9002\u7528\u4e8e\u751f\u4ea7\u7cfb\u7edf\u5b89\u88c5\u3002\u5b83\u7684\u76ee\u7684\u662f\u4e3a\u5b66\u4e60OpenStack\u63d0\u4f9b\u4e00\u4e2a\u6700\u5c0f\u7684\u6982\u5ff5\u9a8c\u8bc1\u3002\u6709\u5173\u4e3a\u7279\u5b9a\u7528\u4f8b\u521b\u5efa\u4f53\u7cfb\u7ed3\u6784\u7684\u4fe1\u606f\uff0c\u6216\u5982\u4f55\u786e\u5b9a\u9700\u8981\u54ea\u4e2a\u4f53\u7cfb\u7ed3\u6784\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u4f53 \u7cfb\u7ed3\u6784\u8bbe\u8ba1\u6307\u5357 \u3002 This example architecture differs from a minimal production architecture as follows: \u8bd1\u6587: \u8fd9\u4e2a\u793a\u4f8b\u67b6\u6784\u4e0d\u540c\u4e8e\u6700\u5c0f\u751f\u4ea7\u67b6\u6784\uff0c\u5982\u4e0b\u6240\u793a: Networking agents reside on the controller node instead of one or more dedicated network nodes. \u8bd1\u6587\uff1a\u7f51\u7edc\u4ee3\u7406\u9a7b\u7559\u5728\u63a7\u5236\u8282\u70b9\u4e0a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u4e13\u7528\u7f51\u7edc\u8282\u70b9\u4e0a\u3002 Overlay (tunnel) traffic for self-service networks traverses the management network instead of a dedicated network. \u8bd1\u6587\uff1a\u81ea\u670d\u52a1\u7f51\u7edc\u7684\u8986\u76d6(\u96a7\u9053)\u6d41\u91cf\u7a7f\u8fc7\u7ba1\u7406\u7f51\u7edc\uff0c\u800c\u4e0d\u662f\u4e13\u7528\u7f51\u7edc\u3002 4.1.1 Controller \u63a7\u5236\u8282\u70b9 The controller node runs the Identity service, Image service, Placement service, management portions of Compute, management portion of Networking, various Networking agents, and the Dashboard. It also includes supporting services such as an SQL database, message queue , and NTP . \u8bd1\u6587: \u63a7\u5236\u8282\u70b9\u8fd0\u884c\u6807\u8bc6\u670d\u52a1\u3001\u6620\u50cf\u670d\u52a1\u3001\u7f16\u6392\u670d\u52a1\u3001\u8ba1\u7b97\u7684\u7ba1\u7406\u90e8\u5206\u3001\u7f51\u7edc\u7684\u7ba1\u7406\u90e8\u5206\u3001\u5404\u79cd\u7f51\u7edc\u4ee3\u7406\u548c\u4eea\u8868\u677f\u3002\u5b83\u8fd8\u5305\u62ec\u652f\u6301\u7684\u670d\u52a1\uff0c\u5982SQL\u6570\u636e\u5e93\u3001 \u6d88\u606f\u961f\u5217 \u548c NTP \u7f51\u7edc\u65f6\u95f4\u534f\u8bae\uff08\u65f6\u95f4\u540c\u6b65\uff09\u3002 Optionally, the controller node runs portions of the Block Storage, Object Storage, Orchestration, and Telemetry services. \u8bd1\u6587: \u53ef\u9009\u5730\uff0c\u63a7\u5236\u8282\u70b9\u8fd0\u884c\u90e8\u5206\u5757\u5b58\u50a8\u3001\u5bf9\u8c61\u5b58\u50a8\u3001\u7f16\u6392\u548c\u9065\u6d4b\u670d\u52a1\u3002 The controller node requires a minimum of two network interfaces. \u8bd1\u6587: \u63a7\u5236\u8282\u70b9\u81f3\u5c11\u9700\u89812\u4e2a\u7f51\u53e3\u3002 4.1.2 Compute \u8ba1\u7b97\u8282\u70b9 The compute node runs the hypervisor portion of Compute that operates instances. By default, Com- pute uses the KVM hypervisor. The compute node also runs a Networking service agent that connects instances to virtual networks and provides firewalling services to instances via security groups . \u8bd1\u6587: \u8ba1\u7b97\u8282\u70b9\u8fd0\u884ccompute\u7684 hypervisor \u90e8\u5206\uff0c\u8be5\u90e8\u5206\u64cd\u4f5c\u5b9e\u4f8b\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccompute\u4f7f\u7528 KVM \u865a\u62df\u5316\u73af\u5883\u3002\u8ba1\u7b97\u8282\u70b9\u8fd8\u8fd0\u884c\u4e00\u4e2a\u7f51\u7edc\u670d\u52a1\u4ee3\u7406\uff0c\u8be5\u4ee3\u7406\u5c06\u5b9e\u4f8b\u8fde\u63a5\u5230\u865a\u62df\u7f51\u7edc\uff0c\u5e76\u901a\u8fc7 \u5b89\u5168\u7ec4 \u5411\u5b9e\u4f8b\u63d0\u4f9b\u9632\u706b\u5899\u670d\u52a1\u3002 You can deploy more than one compute node. Each node requires a minimum of two network interfaces. \u8bd1\u6587: \u53ef\u4ee5\u90e8\u7f72\u591a\u4e2a\u8ba1\u7b97\u8282\u70b9\u3002\u6bcf\u4e2a\u8282\u70b9\u81f3\u5c11\u9700\u89812\u4e2a\u7f51\u7edc\u63a5\u53e3\u3002 4.1.3 Block Storage \u5757\u5b58\u50a8 The optional Block Storage node contains the disks that the Block Storage and Shared File System services provision for instances. \u8bd1\u6587: \u53ef\u9009\u7684\u201c\u5757\u5b58\u50a8\u201d\u8282\u70b9\u5305\u542b\u5757\u5b58\u50a8\u548c\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u670d\u52a1\u4e3a\u5b9e\u4f8b\u63d0\u4f9b\u7684\u78c1\u76d8\u3002 For simplicity, service traffic between compute nodes and this node uses the management network. Production environments should implement a separate storage network to increase performance and security. \u8bd1\u6587: \u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u8ba1\u7b97\u8282\u70b9\u4e0e\u8be5\u8282\u70b9\u4e4b\u95f4\u7684\u4e1a\u52a1\u901a\u4fe1\u4f7f\u7528\u7ba1\u7406\u7f51\u7edc\u3002\u751f\u4ea7\u73af\u5883\u5e94\u8be5\u5b9e\u73b0\u5355\u72ec\u7684\u5b58\u50a8\u7f51\u7edc\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u548c\u5b89\u5168\u6027\u3002 You can deploy more than one block storage node. Each node requires a minimum of one network interface. 4.1.4 Object Storage The optional Object Storage node contain the disks that the Object Storage service uses for storing accounts, containers, and objects. \u8bd1\u6587: \u53ef\u9009\u8282\u70b9\u5bf9\u8c61\u5b58\u50a8(Object Storage)\u5305\u542b\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1(Object Storage service)\u7528\u4e8e\u5b58\u50a8\u5e10\u6237\u3001\u5bb9\u5668\u548c\u5bf9\u8c61\u7684\u786c\u76d8\u3002 For simplicity, service traffic between compute nodes and this node uses the management network. Production environments should implement a separate storage network to increase performance and security. This service requires two nodes. Each node requires a minimum of one network interface. You can deploy more than two object storage nodes. \u8bd1\u6587: \u8be5\u670d\u52a1\u9700\u8981\u4e24\u4e2a\u8282\u70b9\u3002\u6bcf\u4e2a\u8282\u70b9\u81f3\u5c11\u9700\u8981\u4e00\u4e2a\u7f51\u7edc\u63a5\u53e3\u3002\u53ef\u90e8\u7f722\u4e2a\u4ee5\u4e0a\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\u8282\u70b9 4.2 Networking \u7f51\u7edc Choose one of the following virtual networking options. \u9009\u62e9\u4ee5\u4e0b\u865a\u62df\u7f51\u7edc\u9009\u9879\u4e4b\u4e00\u3002 4.2.1 Networking Option 1: Provider networks The provider networks option deploys the OpenStack Networking service in the simplest way possible with primarily layer-2 (bridging/switching) services and VLAN segmentation of networks. Essentially, it bridges virtual networks to physical networks and relies on physical network infrastructure for layer-3 (routing) services. Additionally, a DHCP service provides IP address information to instances. provider network\u9009\u9879\u4ee5\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u90e8\u7f72OpenStack Networking\u670d\u52a1\uff0c\u4e3b\u8981\u91c7\u7528\u4e8c\u5c42(\u6865\u63a5/\u4ea4\u6362)\u670d\u52a1\u548c\u7f51\u7edc\u7684VLAN\u5206\u6bb5\u3002\u672c\u8d28\u4e0a\uff0c\u5b83\u8fde\u63a5\u4e86\u865a\u62df\u7f51\u7edc\u548c\u7269\u7406\u7f51\u7edc\uff0c\u5e76\u4f9d\u8d56\u4e8e\u7269\u7406\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u6765\u63d0\u4f9b\u7b2c\u4e09\u5c42(\u8def\u7531)\u670d\u52a1\u3002\u53e6\u5916\uff0c DHCP \u670d\u52a1\u4e3a\u5b9e\u4f8b\u63d0\u4f9bIP\u5730\u5740\u4fe1\u606f\u3002 The OpenStack user requires more information about the underlying network infrastructure to create a virtual network to exactly match the infrastructure. \u8bd1\u6587: OpenStack\u7528\u6237\u9700\u8981\u66f4\u591a\u5e95\u5c42\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u7684\u4fe1\u606f\uff0c\u624d\u80fd\u521b\u5efa\u4e0e\u5e95\u5c42\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u5b8c\u5168\u5339\u914d\u7684\u865a\u62df\u7f51\u7edc\u3002 Warning: This option lacks support for self-service (private) networks, layer-3 (routing) services, and advanced services such as LBaaS and FWaaS . Consider the self-service networks option below if you desire these features. \u8bd1\u6587: \u8b66\u544a:\u6b64\u9009\u9879\u4e0d\u652f\u6301\u81ea\u52a9\u670d\u52a1(\u4e13\u7528)\u7f51\u7edc\u3001\u4e09\u5c42(\u8def\u7531)\u670d\u52a1\u548c\u9ad8\u7ea7\u670d\u52a1\uff0c\u5982 LBaaS \u548c FWaaS \u3002\u5982\u679c\u9700\u8981\u8fd9\u4e9b\u529f\u80fd\uff0c\u8bf7\u8003\u8651\u4e0b\u9762\u7684\u81ea\u52a9\u7f51\u7edc\u9009\u9879\u3002 4.2.2 Networking Option 2: Self-service networks The self-service networks option augments the provider networks option with layer-3 (routing) services that enable self-service networks using overlay segmentation methods such as VXLAN . Essentially, it routes virtual networks to physical networks using NAT . Additionally, this option provides the founda- tion for advanced services such as LBaaS and FWaaS. \u8bd1\u6587: \u81ea\u52a9\u670d\u52a1\u7f51\u7edc\u9009\u9879\u4e3a\u63d0\u4f9b\u5546\u7f51\u7edc\u9009\u9879\u589e\u52a0\u4e86\u4e09\u5c42(\u8def\u7531)\u670d\u52a1\uff0c\u8fd9\u4e9b\u670d\u52a1\u4f7f\u7528\u8986\u76d6\u6027\u5206\u5272\u65b9\u6cd5(\u5982VXLAN )\u5b9e\u73b0\u81ea\u52a9\u670d\u52a1\u7f51\u7edc\u3002\u672c\u8d28\u4e0a\uff0c\u5b83\u4f7f\u7528 NAT*\u5c06\u865a\u62df\u7f51\u7edc\u8def\u7531\u5230\u7269\u7406\u7f51\u7edc\u3002\u6b64\u5916\uff0c\u8be5\u9009\u9879\u4e3aLBaaS\u548cFWaaS\u7b49\u9ad8\u7ea7\u670d\u52a1\u63d0\u4f9b\u4e86\u57fa\u7840\u3002 The OpenStack user can create virtual networks without the knowledge of underlying infrastructure on the data network. This can also include VLAN networks if the layer-2 plug-in is configured accordingly. \u8bd1\u6587: OpenStack\u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4e86\u89e3\u6570\u636e\u7f51\u7edc\u5e95\u5c42\u57fa\u7840\u8bbe\u65bd\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u865a\u62df\u7f51\u7edc\u3002\u5982\u679c\u914d\u7f6e\u4e86\u76f8\u5e94\u7684\u4e8c\u5c42\u63d2\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u5305\u62ecVLAN\u7f51\u7edc\u3002 5 ENVIRONMENT This section explains how to configure the controller node and one compute node using the example architecture. \u8bd1\u6587: \u672c\u8282\u4ee5\u914d\u7f6e\u63a7\u5236\u8282\u70b9\u548c1\u4e2a\u8ba1\u7b97\u8282\u70b9\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002","title":"The Guide About OpenStack"},{"location":"cloud/openstack/guide/#the-guide-about-openstack","text":"","title":"The Guide About OpenStack"},{"location":"cloud/openstack/guide/#2-preface","text":"","title":"2 PREFACE \u524d\u8a00"},{"location":"cloud/openstack/guide/#21-abstract","text":"The OpenStack system consists of several key services that are separately installed. These services work together depending on your cloud needs and include the Compute, Identity, Networking, Image, Block Storage, Object Storage, Telemetry, Orchestration, and Database services. You can install any of these projects separately and configure them stand-alone or as connected entities. OpenStack\u7cfb\u7edf\u7531\u591a\u4e2a\u72ec\u7acb\u5b89\u88c5\u7684\u5173\u952e\u670d\u52a1\u7ec4\u6210\u3002\u8fd9\u4e9b\u670d\u52a1\u6839\u636e\u60a8\u7684\u4e91\u9700\u6c42\u4e00\u8d77\u5de5\u4f5c\uff0c\u5305\u62ec\u8ba1\u7b97\u3001\u8eab\u4efd\u3001\u7f51\u7edc\u3001\u56fe\u50cf\u3001\u5757\u5b58\u50a8\u3001\u5bf9\u8c61\u5b58\u50a8\u3001\u9065\u6d4b\u3001\u7f16\u6392\u548c\u6570\u636e\u5e93\u670d\u52a1\u3002\u60a8\u53ef\u4ee5\u5355\u72ec\u5b89\u88c5\u8fd9\u4e9b\u9879\u76ee\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\uff0c\u5e76\u5c06\u5b83\u4eec\u5355\u72ec\u914d\u7f6e\u6216\u4f5c\u4e3a\u8fde\u63a5\u5b9e\u4f53\u914d\u7f6e\u3002 Explanations of configuration options and sample configuration files are included. \u5305\u62ec\u914d\u7f6e\u9009\u9879\u548c\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u7684\u8bf4\u660e\u3002 Note: The Training Labs scripts provide an automated way of deploying the cluster described in this Installation Guide into VirtualBox or KVM VMs. You will need a desktop computer or a laptop with at least 8 GB memory and 20 GB free storage running Linux, MacOS, or Windows. Please see the OpenStack Training Labs. \u6ce8\u610f\uff1aTrainingLabs \u9879\u76ee\u4e2d\u4f53\u7528\u4e86\u4e00\u4e2aVirutalBox\u6216KVM\u81ea\u52a8\u5316\u5b89\u88c5\u548c\u90e8\u7f72\u811a\u672c\uff0c\u4f60\u9700\u8981\u4e00\u53f0\u53f0\u5f0f\u673a\u6216\u7b14\u8bb0\u672c\u7535\u8111\uff0c\u81f3\u5c11\u67098gb\u5185\u5b58\u548c20gb\u7a7a\u95f2\u5b58\u50a8\u7a7a\u95f4\uff0c\u8fd0\u884cLinux\u3001MacOS\u6216Windows\u3002 \u8bf7\u67e5\u770bOpenStack\u57f9\u8bad\u5b9e\u9a8c This guide documents the installation of OpenStack starting with the Pike release. It covers multiple releases. \u672c\u6307\u5357\u8bb0\u5f55\u4e86\u4ecePike\u7248\u672c\u5f00\u59cb\u7684OpenStack\u5b89\u88c5\u8fc7\u7a0b\u3002 \u5b83\u6db5\u76d6\u4e86\u591a\u4e2a\u7248\u672c\u3002 Warning: This guide is a work-in-progress and is subject to updates frequently. Pre-release pack- ages have been used for testing, and some instructions may not work with final versions. Please help us make this guide better by reporting any errors you encounter. \u8b66\u544a:\u672c\u6307\u5357\u8fd8\u672a\u5b8c\u6210\uff0c\u7ecf\u5e38\u4f1a\u66f4\u65b0\u3002\u9884\u53d1\u5e03\u5305\u5df2\u7ecf\u7528\u4e8e\u6d4b\u8bd5\uff0c\u4e00\u4e9b\u8bf4\u660e\u53ef\u80fd\u4e0d\u9002\u7528\u4e8e\u6700\u7ec8\u7248\u672c\u3002\u8bf7\u901a\u8fc7\u62a5\u544a\u60a8\u9047\u5230\u7684\u4efb\u4f55\u9519\u8bef\u6765\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u5730\u5b8c\u6210\u672c\u6307\u5357\u3002","title":"2.1 Abstract \u6458\u8981"},{"location":"cloud/openstack/guide/#22-operatting-systems","text":"Currently, this guide describes OpenStack installation for the following Linux distributions: \u76ee\u524d\u672c\u6307\u5357\u4ecb\u7ecd\u4e86\u4ee5\u4e0bLinux\u53d1\u884c\u7248\u7684OpenStack\u5b89\u88c5\u573a\u666f: openSUSE and SUSE Linux Enterprise Server : You can install OpenStack by using packages on openSUSE Leap 42.3, openSUSE Leap 15, SUSE Linux Enterprise Server 12 SP4, SUSE Linux Enterprise Server 15 through the Open Build Service Cloud repository. Red Hat Enterprise Linux and CentOS \uff1a You can install OpenStack by using packages available on both Red Hat Enterprise Linux 7 and 8 and their derivatives through the RDO repository. note: OpenStack Wallaby is available for CentOS Stream 8. OpenStack Ussuri and Victoria are available for both CentOS 8 and RHEL 8. OpenStack Train and earlier are available on both CentOS 7 and RHEL 7. Wallaby \u652f\u6301 Centos Stream 8\uff0c Ussuri \u548cVictoria \u652f\u6301 CentOS8\u548cRHEL 8\uff0cTrain\u548c\u66f4\u65e9\u7248\u672c\u652f\u6301Centos7\u548c RHEL 7. OpenStack Wallaby is available for CentOS Stream 8. OpenStack Ussuri and Victoria are available for both CentOS 8 and RHEL 8. OpenStack Train and earlier are available on both CentOS 7 and RHEL 7. Ubuntu : You can walk through an installation by using packages available through Canonicals Ubuntu Cloud archive repository for Ubuntu 16.04+ (LTS). Note: The Ubuntu Cloud Archive pockets for Pike and Queens provide OpenStack packages for Ubuntu 16.04 LTS; OpenStack Queens is installable direct using Ubuntu 18.04 LTS; the Ubuntu Cloud Archive pockets for Rocky and Stein provide OpenStack packages for Ubuntu 18.04 LTS; the Ubuntu Cloud Archive pocket for Victoria provides OpenStack packages for Ubuntu 20.04 LTS.","title":"2.2 Operatting Systems \u64cd\u4f5c\u7cfb\u7edf"},{"location":"cloud/openstack/guide/#3-get-start-with-openstack","text":"The OpenStack project is an open source cloud computing platform for all types of clouds, which aims to be simple to implement, massively scalable, and feature rich. Developers and cloud computing tech- nologists from around the world create the OpenStack project. OpenStack\u9879\u76ee\u662f\u4e00\u4e2a\u9762\u5411\u5404\u7c7b\u4e91\u7684\u5f00\u6e90\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u5176\u76ee\u6807\u662f\u5b9e\u73b0\u7b80\u5355\u3001\u53ef\u5927\u89c4\u6a21\u6269\u5c55\u3001\u7279\u6027\u4e30\u5bcc\u3002\u6765\u81ea\u4e16\u754c\u5404\u5730\u7684\u5f00\u53d1\u4eba\u5458\u548c\u4e91\u8ba1\u7b97\u6280\u672f\u4e13\u5bb6\u521b\u5efa\u4e86OpenStack\u9879\u76ee\u3002 OpenStack provides an Infrastructure-as-a-Service (IaaS) solution through a set of interrelated services. Each service offers an Application Programming Interface (API) that facilitates this integration. De- pending on your needs, you can install some or all services. OpenStack\u901a\u8fc7\u4e00\u7ec4\u76f8\u4e92\u5173\u8054\u7684\u670d\u52a1\u63d0\u4f9b\u4e86IaaS *\u89e3\u51b3\u65b9\u6848\u3002\u6bcf\u4e2a\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2aAPI \u6765\u4fc3\u8fdb\u8fd9\u79cd\u96c6\u6210\u3002\u6839\u636e\u60a8\u7684\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u5b89\u88c5\u90e8\u5206\u6216\u5168\u90e8\u670d\u52a1\u3002","title":"3. Get Start With OpenStack"},{"location":"cloud/openstack/guide/#31-the-openstack-service","text":"The OpenStack project navigator lets you browse the OpenStack services that make up the OpenStack architecture. The services are categorized per the service type and release series. \u901a\u8fc7 OpenStack\u9879\u76ee\u5bfc\u822a\u5668 \uff0c\u60a8\u53ef\u4ee5\u6d4f\u89c8\u7ec4\u6210OpenStack\u67b6\u6784\u7684OpenStack\u670d\u52a1\u3002\u670d\u52a1\u6309\u7167\u670d\u52a1\u7c7b\u578b\u548c\u53d1\u5e03\u7cfb\u5217\u8fdb\u884c\u5206\u7c7b\u3002","title":"3.1 the openstack service \u670d\u52a1"},{"location":"cloud/openstack/guide/#openstack-services","text":"An OpenStack deployment contains a number of components providing APIs to access infrastructure resources. This page lists the various services that can be deployed to provide such resources to cloud end users. OpenStack\u90e8\u7f72\u4e2d\u5305\u542b\u5927\u91cf\u7ec4\u4ef6\uff0c\u63d0\u4f9bapi\u8bbf\u95ee\u57fa\u7840\u8bbe\u65bd\u8d44\u6e90\u3002\u6b64\u9875\u9762\u5217\u51fa\u4e86\u53ef\u4ee5\u90e8\u7f72\u4e3a\u4e91\u7ec8\u7aef\u7528\u6237\u63d0\u4f9b\u6b64\u7c7b\u8d44\u6e90\u7684\u5404\u79cd\u670d\u52a1\u3002","title":"OpenStack Services"},{"location":"cloud/openstack/guide/#compute","text":"Service description NOVA Compute Service \u8ba1\u7b97\u670d\u52a1 ZUN Container Service \u5bb9\u5668\u670d\u52a1","title":"Compute \u8ba1\u7b97\u670d\u52a1"},{"location":"cloud/openstack/guide/#hardware-lifecycle","text":"Service Description IRONIC Bare Metal Provisioning Service CYBORG Lifecycle management of accelerators","title":"Hardware Lifecycle \u786c\u4ef6\u751f\u547d\u5468\u671f"},{"location":"cloud/openstack/guide/#storage","text":"Service Description SWIFT Object store \u5bf9\u8c61\u5b58\u50a8\uff0c\u7c7b\u4f3c\u4e8e\u963f\u91cc\u4e91OSS\uff0cAWS S3 CINDER Block Storage \u5757\u5b58\u50a8 MANILA Shared filesystems","title":"Storage \u5b58\u50a8"},{"location":"cloud/openstack/guide/#networking","text":"Service Description NEUTRON Networking \u7f51\u7edc\u7ec4\u4ef6 OCTAVIA Load balancer \u8d1f\u8f7d\u5747\u8861 DESIGNATE DNS service","title":"Networking \u7f51\u7edc"},{"location":"cloud/openstack/guide/#shared-services","text":"Service Description KEYSTONE Identity service PLACEMENT Placement service GLANCE Image service BARBICAN Key management","title":"Shared Services \u57fa\u7840\u5171\u4eab\u670d\u52a1"},{"location":"cloud/openstack/guide/#orchestration","text":"Service Description HEAT Orchestration SENLIN Clustering service MISTRAL Workflow service ZAQAR Messaging Service BLAZAR Resource reservation service AODH Alarming Service","title":"Orchestration \u670d\u52a1\u7f16\u6392"},{"location":"cloud/openstack/guide/#workload-provisioning","text":"Service Description MAGNUM Container Orchestration Engine Provisioning SAHARA Big Data Processing Framework Provisioning TROVE Database as a Service ##### Application Lifecycle \u5e94\u7528\u751f\u547d\u5468\u671f Service Description MASAKARI Instances High Availability Service MURANO Application Catalog SOLUM Software Development Lifecycle Automation FREEZER Backup, Restore, and Disaster Recovery","title":"Workload Provisioning \u5de5\u4f5c\u8d1f\u8f7d\u914d\u7f6e"},{"location":"cloud/openstack/guide/#api-proxies","text":"Service Description EC2API EC2 API proxy","title":"API Proxies"},{"location":"cloud/openstack/guide/#web-frontend","text":"Service Description HORIZON Dashboard","title":"Web Frontend"},{"location":"cloud/openstack/guide/#32-the-openstack-architecture","text":"The following sections describe the OpenStack architecuture int more detail: \u4ee5\u4e0b\u7684\u7ae0\u8282\u5c06\u4ece\u66f4\u591a\u7ec6\u8282\u4e0a\u8bb2\u8ff0OpenStack\u67b6\u6784","title":"3.2 The Openstack architecture"},{"location":"cloud/openstack/guide/#321-conceptual-architecture","text":"The following diagram shows the relationships among the OpenStack services: \u4e0b\u9762\u7684\u6d41\u7a0b\u8bb2\u8ff0\u4e86Openstack\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u7684\u5173\u7cfb\u3002","title":"3.2.1 Conceptual architecture \u6982\u5ff5\u8bbe\u8ba1"},{"location":"cloud/openstack/guide/#322-logical-architecture","text":"To design, deploy, and configure OpenStack, administrators must understand the logical architecture. \u8bbe\u8ba1\u3001\u90e8\u7f72\u6216\u8005\u914d\u7f6eOpenstack\u7ba1\u7406\u8865\u4e60\u7406\u89e3\u903b\u8f91\u67b6\u6784\u3002 As shown in Conceptual architecture , OpenStack consists of several independent parts, named the OpenStack services. All services authenticate through a common Identity service. Individual services interact with each other through public APIs, except where privileged administrator commands are necessary. \u6b63\u5982\u903b\u8f91\u67b6\u6784\u56fe\u9501\u5c55\u793a\u7684\uff0cOpenStack\u662f\u7531\u51e0\u4e2a\u72ec\u7acb\u90e8\u5206\u7ec4\u6210\u7684\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3aOpenStack\u670d\u52a1\u3002\u6240\u6709\u670d\u52a1\u7684\u8ba4\u8bc1\u90fd\u662f\u516c\u7528\u6a21\u5757ID\u8ba4\u8bc1\u670d\u52a1\u5b8c\u6210\uff08keystore\uff09\u3002 \u5404\u4e2a\u670d\u52a1\u901a\u8fc7\u516c\u5171api\u76f8\u4e92\u4ea4\u4e92\uff0c\u9664\u975e\u9700\u8981\u7279\u6743\u7ba1\u7406\u5458\u547d\u4ee4\u3002 Internally, OpenStack services are composed of several processes. All services have at least one API process, which listens for API requests, preprocesses them and passes them on to other parts of the service. With the exception of the Identity service, the actual work is done by distinct processes. OpenStack\u670d\u52a1\u5185\u90e8\u7531\u591a\u4e2a\u8fdb\u7a0b\u7ec4\u6210\u3002\u6240\u6709\u670d\u52a1\u90fd\u81f3\u5c11\u6709\u4e00\u4e2aAPI\u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u4fa6\u542cAPI\u8bf7\u6c42\uff0c\u5bf9\u5b83\u4eec\u8fdb\u884c\u9884\u5904\u7406\uff0c\u5e76\u5c06\u5b83\u4eec\u4f20\u9012\u7ed9\u670d\u52a1\u7684\u5176\u4ed6\u90e8\u5206\u3002\u9664\u4e86Identity\u670d\u52a1\u4e4b\u5916\uff0c\u5b9e\u9645\u5de5\u4f5c\u662f\u7531\u4e0d\u540c\u7684\u6d41\u7a0b\u5b8c\u6210\u7684\u3002 For communication between the processes of one service, an AMQP message broker is used. The service\u2019s state is stored in a database. When deploying and configuring your OpenStack cloud, you can choose among several message broker and database solutions, such as RabbitMQ, MySQL, MariaDB, and SQLite. \u5bf9\u4e8e\u4e00\u4e2a\u670d\u52a1\u7684\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4f7f\u7528AMQP\u6d88\u606f\u4ee3\u7406\u3002\u670d\u52a1\u7684\u72b6\u6001\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u3002\u5728\u90e8\u7f72\u548c\u914d\u7f6eOpenStack\u4e91\u65f6\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u591a\u79cd\u6d88\u606f\u4ee3\u7406\u548c\u6570\u636e\u5e93\u89e3\u51b3\u65b9\u6848\uff0c\u5982RabbitMQ\u3001MySQL\u3001MariaDB\u548cSQLite\u3002 Users can access OpenStack via the web-based user interface implemented by the Horizon Dashboard, via command-line clients and by issuing API requests through tools like browser plug-ins or curl . For applications, several SDKs are available. Ultimately, all these access methods issue REST API calls to the various OpenStack services. \u7528\u6237\u53ef\u4ee5\u901a\u8fc7Horizon Dashboard\u5b9e\u73b0\u7684\u57fa\u4e8eweb\u7684\u7528\u6237\u754c\u9762\uff0c\u901a\u8fc7 \u547d\u4ee4\u884c\u5ba2\u6237\u7aef and\uff0c\u901a\u8fc7\u6d4f\u89c8\u5668\u63d2\u4ef6\u6216 curl \u7b49\u5de5\u5177\u53d1\u51faAPI\u8bf7\u6c42)\u8bbf\u95eeOpenStack\u3002\u5bf9\u4e8e\u5e94\u7528\u7a0b\u5e8f\uff0c \u51e0\u4e2asdk \u53ef\u7528\u3002\u6700\u7ec8\uff0c\u6240\u6709\u8fd9\u4e9b\u8bbf\u95ee\u65b9\u6cd5\u90fd\u4f1a\u5411\u5404\u79cd The following diagram shows the most common, but not the only possible, architecture for an OpenStack cloud: \u4e0b\u56fe\u5c55\u793a\u4e86OpenStack\u4e91\u6700\u5e38\u89c1\u7684\uff0c\u4f46\u4e0d\u662f\u552f\u4e00\u53ef\u80fd\u7684\u67b6\u6784:","title":"3.2.2 Logical architecture  \u903b\u8f91\u67b6\u6784"},{"location":"cloud/openstack/guide/#4-overview","text":"The OpenStack project is an open source cloud computing platform that supports all types of cloud environments. The project aims for simple implementation, massive scalability, and a rich set of features. Cloud computing experts from around the world contribute to the project. OpenStack \u9879\u76ee\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u652f\u6301\u6240\u6709\u7c7b\u578b\u7684\u4e91\u73af\u5883\u3002\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u7b80\u5355\u7684\u5b9e\u73b0\u3001\u5927\u89c4\u6a21\u7684\u53ef\u4f38\u7f29\u6027\u548c\u4e00\u7ec4\u4e30\u5bcc\u7684\u7279\u6027\u3002\u6765\u81ea\u4e16\u754c\u5404\u5730\u7684\u4e91\u8ba1\u7b97\u4e13\u5bb6\u4e3a\u8be5\u9879\u76ee\u505a\u51fa\u4e86\u8d21\u732e\u3002 OpenStack provides an Infrastructure-as-a-Service (IaaS) solution through a variety of complementary services. Each service offers an Application Programming Interface (API) that facilitates this integration. OpenStack\u901a\u8fc7\u591a\u79cd\u8865\u5145\u670d\u52a1\u63d0\u4f9b\u4e86 IaaS \u89e3\u51b3\u65b9\u6848\u3002\u6bcf\u4e2a\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2a \u5e94\u7528\u7a0b\u5e8f\u7f16\u7a0b\u63a5\u53e3(API) \u6765\u4fc3\u8fdb\u8fd9\u79cd\u96c6\u6210\u3002 This guide covers step-by-step deployment of the major OpenStack services using a functional example architecture suitable for new users of OpenStack with sufficient Linux experience. This guide is not intended to be used for production system installations, but to create a minimum proof-of-concept for the purpose of learning about OpenStack. \u672c\u6307\u5357\u91c7\u7528\u529f\u80fd\u6837\u4f8b\u67b6\u6784\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u4e3b\u8981OpenStack\u670d\u52a1\u7684\u9010\u6b65\u90e8\u7f72\uff0c\u9002\u5408\u5177\u6709Linux\u7ecf\u9a8c\u7684OpenStack\u65b0\u7528\u6237\u4f7f\u7528\u3002\u672c\u6307\u5357\u4e0d\u6253\u7b97\u7528\u4e8e\u751f\u4ea7\u7cfb\u7edf\u5b89\u88c5\uff0c\u800c\u662f\u4e3a\u4e86\u89e3OpenStack\u63d0\u4f9b\u4e00\u4e2a\u6700\u5c0f\u7684\u6982\u5ff5\u9a8c\u8bc1\u3002 After becoming familiar with basic installation, configuration, operation, and troubleshooting of these OpenStack services, you should consider the following steps toward deployment using a production architecture: \u5728\u719f\u6089\u8fd9\u4e9bOpenStack\u670d\u52a1\u7684\u57fa\u672c\u5b89\u88c5\u3001\u914d\u7f6e\u3001\u64cd\u4f5c\u548c\u6545\u969c\u5904\u7406\u540e\uff0c\u5728\u4f7f\u7528\u751f\u4ea7\u67b6\u6784\u90e8\u7f72\u65f6\uff0c\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u6b65\u9aa4: Determine and implement the necessary core and optional services to meet performance and re- dundancy requirements. \u786e\u5b9a\u5e76\u5b9e\u73b0\u5fc5\u8981\u7684\u6838\u5fc3\u548c\u53ef\u9009\u670d\u52a1\uff0c\u4ee5\u6ee1\u8db3\u6027\u80fd\u548c\u5197\u4f59\u9700\u6c42\u3002 Increase security using methods such as firewalls, encryption, and service policies. \u4f7f\u7528\u9632\u706b\u5899\u3001\u52a0\u5bc6\u548c\u670d\u52a1\u7b56\u7565\u7b49\u65b9\u6cd5\u63d0\u9ad8\u5b89\u5168\u6027\u3002 Use a deployment tool such as Ansible, Chef, Puppet, or Salt to automate deployment and management of the production environment. The OpenStack project has a couple of deployment projects with specific guides per version: \u4f7f\u7528\u90e8\u7f72\u5de5\u5177(\u5982Ansible\u3001Chef\u3001Puppet\u6216Salt)\u6765\u81ea\u52a8\u5316\u751f\u4ea7\u73af\u5883\u7684\u90e8\u7f72\u548c\u7ba1\u7406\u3002OpenStack\u9879\u76ee\u6709\u4e24\u4e2a\u90e8\u7f72\u9879\u76ee\uff0c\u6bcf\u4e2a\u7248\u672c\u90fd\u6709\u7279\u5b9a\u7684\u6307\u5357:","title":"4. Overview"},{"location":"cloud/openstack/guide/#41-example-architecture","text":"The example architecture requires at least two nodes (hosts) to launch a basic virtual machine or instance. Optional services such as Block Storage and Object Storage require additional nodes. \u8bd1\u6587: \u67b6\u6784\u793a\u4f8b\u9700\u8981\u81f3\u5c11\u4e24\u4e2a\u8282\u70b9(\u4e3b\u673a)\u6765\u542f\u52a8\u57fa\u672c\u7684 \u865a\u62df\u673a \u6216\u5b9e\u4f8b\u3002\u5757\u5b58\u50a8(Block Storage)\u3001\u5bf9\u8c61\u5b58\u50a8(Object Storage)\u7b49\u53ef\u9009\u4e1a\u52a1\u9700\u8981\u589e\u52a0\u8282\u70b9\u3002 Important: The example architecture used in this guide is a minimum configuration, and is not in- tended for production system installations. It is designed to provide a minimum proof-of-concept for the purpose of learning about OpenStack. For information on creating architectures for specific use cases, or how to determine which architecture is required, see the Architecture Design Guide. \u8bd1\u6587: \u91cd\u8981\u63d0\u793a:\u672c\u6307\u5357\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u4f53\u7cfb\u7ed3\u6784\u662f\u6700\u4f4e\u914d\u7f6e\uff0c\u4e0d\u9002\u7528\u4e8e\u751f\u4ea7\u7cfb\u7edf\u5b89\u88c5\u3002\u5b83\u7684\u76ee\u7684\u662f\u4e3a\u5b66\u4e60OpenStack\u63d0\u4f9b\u4e00\u4e2a\u6700\u5c0f\u7684\u6982\u5ff5\u9a8c\u8bc1\u3002\u6709\u5173\u4e3a\u7279\u5b9a\u7528\u4f8b\u521b\u5efa\u4f53\u7cfb\u7ed3\u6784\u7684\u4fe1\u606f\uff0c\u6216\u5982\u4f55\u786e\u5b9a\u9700\u8981\u54ea\u4e2a\u4f53\u7cfb\u7ed3\u6784\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u4f53 \u7cfb\u7ed3\u6784\u8bbe\u8ba1\u6307\u5357 \u3002 This example architecture differs from a minimal production architecture as follows: \u8bd1\u6587: \u8fd9\u4e2a\u793a\u4f8b\u67b6\u6784\u4e0d\u540c\u4e8e\u6700\u5c0f\u751f\u4ea7\u67b6\u6784\uff0c\u5982\u4e0b\u6240\u793a: Networking agents reside on the controller node instead of one or more dedicated network nodes. \u8bd1\u6587\uff1a\u7f51\u7edc\u4ee3\u7406\u9a7b\u7559\u5728\u63a7\u5236\u8282\u70b9\u4e0a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u4e13\u7528\u7f51\u7edc\u8282\u70b9\u4e0a\u3002 Overlay (tunnel) traffic for self-service networks traverses the management network instead of a dedicated network. \u8bd1\u6587\uff1a\u81ea\u670d\u52a1\u7f51\u7edc\u7684\u8986\u76d6(\u96a7\u9053)\u6d41\u91cf\u7a7f\u8fc7\u7ba1\u7406\u7f51\u7edc\uff0c\u800c\u4e0d\u662f\u4e13\u7528\u7f51\u7edc\u3002","title":"4.1 Example architecture \u67b6\u6784\u7b80\u5355\u5b9e\u4f8b"},{"location":"cloud/openstack/guide/#411-controller","text":"The controller node runs the Identity service, Image service, Placement service, management portions of Compute, management portion of Networking, various Networking agents, and the Dashboard. It also includes supporting services such as an SQL database, message queue , and NTP . \u8bd1\u6587: \u63a7\u5236\u8282\u70b9\u8fd0\u884c\u6807\u8bc6\u670d\u52a1\u3001\u6620\u50cf\u670d\u52a1\u3001\u7f16\u6392\u670d\u52a1\u3001\u8ba1\u7b97\u7684\u7ba1\u7406\u90e8\u5206\u3001\u7f51\u7edc\u7684\u7ba1\u7406\u90e8\u5206\u3001\u5404\u79cd\u7f51\u7edc\u4ee3\u7406\u548c\u4eea\u8868\u677f\u3002\u5b83\u8fd8\u5305\u62ec\u652f\u6301\u7684\u670d\u52a1\uff0c\u5982SQL\u6570\u636e\u5e93\u3001 \u6d88\u606f\u961f\u5217 \u548c NTP \u7f51\u7edc\u65f6\u95f4\u534f\u8bae\uff08\u65f6\u95f4\u540c\u6b65\uff09\u3002 Optionally, the controller node runs portions of the Block Storage, Object Storage, Orchestration, and Telemetry services. \u8bd1\u6587: \u53ef\u9009\u5730\uff0c\u63a7\u5236\u8282\u70b9\u8fd0\u884c\u90e8\u5206\u5757\u5b58\u50a8\u3001\u5bf9\u8c61\u5b58\u50a8\u3001\u7f16\u6392\u548c\u9065\u6d4b\u670d\u52a1\u3002 The controller node requires a minimum of two network interfaces. \u8bd1\u6587: \u63a7\u5236\u8282\u70b9\u81f3\u5c11\u9700\u89812\u4e2a\u7f51\u53e3\u3002","title":"4.1.1 Controller \u63a7\u5236\u8282\u70b9"},{"location":"cloud/openstack/guide/#412-compute","text":"The compute node runs the hypervisor portion of Compute that operates instances. By default, Com- pute uses the KVM hypervisor. The compute node also runs a Networking service agent that connects instances to virtual networks and provides firewalling services to instances via security groups . \u8bd1\u6587: \u8ba1\u7b97\u8282\u70b9\u8fd0\u884ccompute\u7684 hypervisor \u90e8\u5206\uff0c\u8be5\u90e8\u5206\u64cd\u4f5c\u5b9e\u4f8b\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccompute\u4f7f\u7528 KVM \u865a\u62df\u5316\u73af\u5883\u3002\u8ba1\u7b97\u8282\u70b9\u8fd8\u8fd0\u884c\u4e00\u4e2a\u7f51\u7edc\u670d\u52a1\u4ee3\u7406\uff0c\u8be5\u4ee3\u7406\u5c06\u5b9e\u4f8b\u8fde\u63a5\u5230\u865a\u62df\u7f51\u7edc\uff0c\u5e76\u901a\u8fc7 \u5b89\u5168\u7ec4 \u5411\u5b9e\u4f8b\u63d0\u4f9b\u9632\u706b\u5899\u670d\u52a1\u3002 You can deploy more than one compute node. Each node requires a minimum of two network interfaces. \u8bd1\u6587: \u53ef\u4ee5\u90e8\u7f72\u591a\u4e2a\u8ba1\u7b97\u8282\u70b9\u3002\u6bcf\u4e2a\u8282\u70b9\u81f3\u5c11\u9700\u89812\u4e2a\u7f51\u7edc\u63a5\u53e3\u3002","title":"4.1.2 Compute \u8ba1\u7b97\u8282\u70b9"},{"location":"cloud/openstack/guide/#413-block-storage","text":"The optional Block Storage node contains the disks that the Block Storage and Shared File System services provision for instances. \u8bd1\u6587: \u53ef\u9009\u7684\u201c\u5757\u5b58\u50a8\u201d\u8282\u70b9\u5305\u542b\u5757\u5b58\u50a8\u548c\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u670d\u52a1\u4e3a\u5b9e\u4f8b\u63d0\u4f9b\u7684\u78c1\u76d8\u3002 For simplicity, service traffic between compute nodes and this node uses the management network. Production environments should implement a separate storage network to increase performance and security. \u8bd1\u6587: \u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u8ba1\u7b97\u8282\u70b9\u4e0e\u8be5\u8282\u70b9\u4e4b\u95f4\u7684\u4e1a\u52a1\u901a\u4fe1\u4f7f\u7528\u7ba1\u7406\u7f51\u7edc\u3002\u751f\u4ea7\u73af\u5883\u5e94\u8be5\u5b9e\u73b0\u5355\u72ec\u7684\u5b58\u50a8\u7f51\u7edc\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u548c\u5b89\u5168\u6027\u3002 You can deploy more than one block storage node. Each node requires a minimum of one network interface.","title":"4.1.3 Block Storage \u5757\u5b58\u50a8"},{"location":"cloud/openstack/guide/#414-object-storage","text":"The optional Object Storage node contain the disks that the Object Storage service uses for storing accounts, containers, and objects. \u8bd1\u6587: \u53ef\u9009\u8282\u70b9\u5bf9\u8c61\u5b58\u50a8(Object Storage)\u5305\u542b\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1(Object Storage service)\u7528\u4e8e\u5b58\u50a8\u5e10\u6237\u3001\u5bb9\u5668\u548c\u5bf9\u8c61\u7684\u786c\u76d8\u3002 For simplicity, service traffic between compute nodes and this node uses the management network. Production environments should implement a separate storage network to increase performance and security. This service requires two nodes. Each node requires a minimum of one network interface. You can deploy more than two object storage nodes. \u8bd1\u6587: \u8be5\u670d\u52a1\u9700\u8981\u4e24\u4e2a\u8282\u70b9\u3002\u6bcf\u4e2a\u8282\u70b9\u81f3\u5c11\u9700\u8981\u4e00\u4e2a\u7f51\u7edc\u63a5\u53e3\u3002\u53ef\u90e8\u7f722\u4e2a\u4ee5\u4e0a\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\u8282\u70b9","title":"4.1.4 Object Storage"},{"location":"cloud/openstack/guide/#42-networking","text":"Choose one of the following virtual networking options. \u9009\u62e9\u4ee5\u4e0b\u865a\u62df\u7f51\u7edc\u9009\u9879\u4e4b\u4e00\u3002","title":"4.2 Networking \u7f51\u7edc"},{"location":"cloud/openstack/guide/#421-networking-option-1-provider-networks","text":"The provider networks option deploys the OpenStack Networking service in the simplest way possible with primarily layer-2 (bridging/switching) services and VLAN segmentation of networks. Essentially, it bridges virtual networks to physical networks and relies on physical network infrastructure for layer-3 (routing) services. Additionally, a DHCP service provides IP address information to instances. provider network\u9009\u9879\u4ee5\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u90e8\u7f72OpenStack Networking\u670d\u52a1\uff0c\u4e3b\u8981\u91c7\u7528\u4e8c\u5c42(\u6865\u63a5/\u4ea4\u6362)\u670d\u52a1\u548c\u7f51\u7edc\u7684VLAN\u5206\u6bb5\u3002\u672c\u8d28\u4e0a\uff0c\u5b83\u8fde\u63a5\u4e86\u865a\u62df\u7f51\u7edc\u548c\u7269\u7406\u7f51\u7edc\uff0c\u5e76\u4f9d\u8d56\u4e8e\u7269\u7406\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u6765\u63d0\u4f9b\u7b2c\u4e09\u5c42(\u8def\u7531)\u670d\u52a1\u3002\u53e6\u5916\uff0c DHCP \u670d\u52a1\u4e3a\u5b9e\u4f8b\u63d0\u4f9bIP\u5730\u5740\u4fe1\u606f\u3002 The OpenStack user requires more information about the underlying network infrastructure to create a virtual network to exactly match the infrastructure. \u8bd1\u6587: OpenStack\u7528\u6237\u9700\u8981\u66f4\u591a\u5e95\u5c42\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u7684\u4fe1\u606f\uff0c\u624d\u80fd\u521b\u5efa\u4e0e\u5e95\u5c42\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u5b8c\u5168\u5339\u914d\u7684\u865a\u62df\u7f51\u7edc\u3002 Warning: This option lacks support for self-service (private) networks, layer-3 (routing) services, and advanced services such as LBaaS and FWaaS . Consider the self-service networks option below if you desire these features. \u8bd1\u6587: \u8b66\u544a:\u6b64\u9009\u9879\u4e0d\u652f\u6301\u81ea\u52a9\u670d\u52a1(\u4e13\u7528)\u7f51\u7edc\u3001\u4e09\u5c42(\u8def\u7531)\u670d\u52a1\u548c\u9ad8\u7ea7\u670d\u52a1\uff0c\u5982 LBaaS \u548c FWaaS \u3002\u5982\u679c\u9700\u8981\u8fd9\u4e9b\u529f\u80fd\uff0c\u8bf7\u8003\u8651\u4e0b\u9762\u7684\u81ea\u52a9\u7f51\u7edc\u9009\u9879\u3002","title":"4.2.1 Networking Option 1: Provider networks"},{"location":"cloud/openstack/guide/#422-networking-option-2-self-service-networks","text":"The self-service networks option augments the provider networks option with layer-3 (routing) services that enable self-service networks using overlay segmentation methods such as VXLAN . Essentially, it routes virtual networks to physical networks using NAT . Additionally, this option provides the founda- tion for advanced services such as LBaaS and FWaaS. \u8bd1\u6587: \u81ea\u52a9\u670d\u52a1\u7f51\u7edc\u9009\u9879\u4e3a\u63d0\u4f9b\u5546\u7f51\u7edc\u9009\u9879\u589e\u52a0\u4e86\u4e09\u5c42(\u8def\u7531)\u670d\u52a1\uff0c\u8fd9\u4e9b\u670d\u52a1\u4f7f\u7528\u8986\u76d6\u6027\u5206\u5272\u65b9\u6cd5(\u5982VXLAN )\u5b9e\u73b0\u81ea\u52a9\u670d\u52a1\u7f51\u7edc\u3002\u672c\u8d28\u4e0a\uff0c\u5b83\u4f7f\u7528 NAT*\u5c06\u865a\u62df\u7f51\u7edc\u8def\u7531\u5230\u7269\u7406\u7f51\u7edc\u3002\u6b64\u5916\uff0c\u8be5\u9009\u9879\u4e3aLBaaS\u548cFWaaS\u7b49\u9ad8\u7ea7\u670d\u52a1\u63d0\u4f9b\u4e86\u57fa\u7840\u3002 The OpenStack user can create virtual networks without the knowledge of underlying infrastructure on the data network. This can also include VLAN networks if the layer-2 plug-in is configured accordingly. \u8bd1\u6587: OpenStack\u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4e86\u89e3\u6570\u636e\u7f51\u7edc\u5e95\u5c42\u57fa\u7840\u8bbe\u65bd\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u865a\u62df\u7f51\u7edc\u3002\u5982\u679c\u914d\u7f6e\u4e86\u76f8\u5e94\u7684\u4e8c\u5c42\u63d2\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u5305\u62ecVLAN\u7f51\u7edc\u3002","title":"4.2.2 Networking Option 2: Self-service networks"},{"location":"cloud/openstack/guide/#5-environment","text":"This section explains how to configure the controller node and one compute node using the example architecture. \u8bd1\u6587: \u672c\u8282\u4ee5\u914d\u7f6e\u63a7\u5236\u8282\u70b9\u548c1\u4e2a\u8ba1\u7b97\u8282\u70b9\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002","title":"5 ENVIRONMENT"},{"location":"database/","text":"mysql B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02 mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4 SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f mysql varchar length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790 mysql B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02 mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4 SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f mysql varchar length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790","title":"\u6570\u636e\u5e93"},{"location":"database/mysql/","text":"B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02 mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4 SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f mysql varchar length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790 B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02 mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4 SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f mysql varchar length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790 B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02 mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4 SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f mysql varchar length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790 B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02 mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4 SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f mysql varchar length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790","title":"Index"},{"location":"database/mysql/btree_hash_index/","text":"Hash \u7d22\u5f15\u7ed3\u6784\u7684\u7279\u6b8a\u6027\uff0c\u5176\u68c0\u7d22\u6548\u7387\u975e\u5e38\u9ad8\uff0c\u7d22\u5f15\u7684\u68c0\u7d22\u53ef\u4ee5\u4e00\u6b21\u5b9a\u4f4d\uff0c\u4e0d\u50cfB-Tree \u7d22\u5f15\u9700\u8981\u4ece\u6839\u8282\u70b9\u5230\u679d\u8282\u70b9\uff0c\u6700\u540e\u624d\u80fd\u8bbf\u95ee\u5230\u9875\u8282\u70b9\u8fd9\u6837\u591a\u6b21\u7684IO\u8bbf\u95ee\uff0c\u6240\u4ee5 Hash \u7d22\u5f15\u7684\u67e5\u8be2\u6548\u7387\u8981\u8fdc\u9ad8\u4e8e B-Tree \u7d22\u5f15\u3002 \u53ef\u80fd\u5f88\u591a\u4eba\u53c8\u6709\u7591\u95ee\u4e86\uff0c\u65e2\u7136 Hash \u7d22\u5f15\u7684\u6548\u7387\u8981\u6bd4 B-Tree \u9ad8\u5f88\u591a\uff0c\u4e3a\u4ec0\u4e48\u5927\u5bb6\u4e0d\u90fd\u7528 Hash \u7d22\u5f15\u800c\u8fd8\u8981\u4f7f\u7528 B-Tree \u7d22\u5f15\u5462\uff1f\u4efb\u4f55\u4e8b\u7269\u90fd\u662f\u6709\u4e24\u9762\u6027\u7684\uff0cHash \u7d22\u5f15\u4e5f\u4e00\u6837\uff0c\u867d\u7136 Hash \u7d22\u5f15\u6548\u7387\u9ad8\uff0c\u4f46\u662f Hash \u7d22\u5f15\u672c\u8eab\u7531\u4e8e\u5176\u7279\u6b8a\u6027\u4e5f\u5e26\u6765\u4e86\u5f88\u591a \u9650\u5236\u548c\u5f0a\u7aef \uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u8fd9\u4e9b\u3002 \uff081\uff09Hash \u7d22\u5f15\u4ec5\u4ec5\u80fd\u6ee1\u8db3\"=\", \"IN\"\u548c \"<>\" \u67e5\u8be2\uff0c\u4e0d\u80fd\u4f7f\u7528\u8303\u56f4\u67e5\u8be2\u3002 \u200b \u7531\u4e8e Hash \u7d22\u5f15\u6bd4\u8f83\u7684\u662f\u8fdb\u884c Hash \u8fd0\u7b97\u4e4b\u540e\u7684 Hash \u503c\uff0c\u6240\u4ee5\u5b83\u53ea\u80fd\u7528\u4e8e\u7b49\u503c\u7684\u8fc7\u6ee4\uff0c\u4e0d\u80fd\u7528\u4e8e\u57fa\u4e8e\u8303\u56f4\u7684\u8fc7\u6ee4\uff0c\u56e0\u4e3a\u7ecf\u8fc7\u76f8\u5e94\u7684 Hash \u7b97\u6cd5\u5904\u7406\u4e4b\u540e\u7684 Hash \u503c\u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u548cHash\u8fd0\u7b97\u524d\u5b8c\u5168\u4e00\u6837\u3002 \uff082\uff09Hash \u7d22\u5f15\u65e0\u6cd5\u88ab\u7528\u6765\u907f\u514d\u6570\u636e\u7684\u6392\u5e8f\u64cd\u4f5c\u3002 \u200b \u7531\u4e8e Hash \u7d22\u5f15\u4e2d\u5b58\u653e\u7684\u662f\u7ecf\u8fc7 Hash \u8ba1\u7b97\u4e4b\u540e\u7684 Hash \u503c\uff0c\u800c\u4e14Hash\u503c\u7684\u5927\u5c0f\u5173\u7cfb\u5e76\u4e0d\u4e00\u5b9a\u548c Hash \u8fd0\u7b97\u524d\u7684\u952e\u503c\u5b8c\u5168\u4e00\u6837\uff0c\u6240\u4ee5\u6570\u636e\u5e93\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u7684\u6570\u636e\u6765\u907f\u514d\u4efb\u4f55\u6392\u5e8f\u8fd0\u7b97\uff1b \uff083\uff09Hash \u7d22\u5f15\u4e0d\u80fd\u5229\u7528\u90e8\u5206\u7d22\u5f15\u952e\u67e5\u8be2\u3002 \u200b \u5bf9\u4e8e\u7ec4\u5408\u7d22\u5f15\uff0cHash \u7d22\u5f15\u5728\u8ba1\u7b97 Hash \u503c\u7684\u65f6\u5019\u662f\u7ec4\u5408\u7d22\u5f15\u952e\u5408\u5e76\u540e\u518d\u4e00\u8d77\u8ba1\u7b97 Hash \u503c\uff0c\u800c\u4e0d\u662f\u5355\u72ec\u8ba1\u7b97 Hash \u503c\uff0c\u6240\u4ee5\u901a\u8fc7\u7ec4\u5408\u7d22\u5f15\u7684\u524d\u9762\u4e00\u4e2a\u6216\u51e0\u4e2a\u7d22\u5f15\u952e\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0cHash \u7d22\u5f15\u4e5f\u65e0\u6cd5\u88ab\u5229\u7528\u3002 \uff084\uff09Hash \u7d22\u5f15\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u4e0d\u80fd\u907f\u514d\u8868\u626b\u63cf\u3002 \u200b \u524d\u9762\u5df2\u7ecf\u77e5\u9053\uff0c Hash \u7d22\u5f15 \u662f\u5c06\u7d22\u5f15\u952e\u901a\u8fc7 Hash \u8fd0\u7b97\u4e4b\u540e\uff0c\u5c06 Hash\u8fd0\u7b97\u7ed3\u679c\u7684 Hash \u503c\u548c\u6240\u5bf9\u5e94\u7684\u884c\u6307\u9488\u4fe1\u606f\u5b58\u653e\u4e8e\u4e00\u4e2a Hash \u8868\u4e2d\uff0c\u7531\u4e8e\u4e0d\u540c\u7d22\u5f15\u952e\u5b58\u5728\u76f8\u540c Hash \u503c\uff0c\u6240\u4ee5\u5373\u4f7f\u53d6\u6ee1\u8db3\u67d0\u4e2a Hash \u952e\u503c\u7684\u6570\u636e\u7684\u8bb0\u5f55\u6761\u6570\uff0c\u4e5f\u65e0\u6cd5\u4ece Hash \u7d22\u5f15\u4e2d\u76f4\u63a5\u5b8c\u6210\u67e5\u8be2\uff0c\u8fd8\u662f\u8981\u901a\u8fc7\u8bbf\u95ee\u8868\u4e2d\u7684\u5b9e\u9645\u6570\u636e\u8fdb\u884c\u76f8\u5e94\u7684\u6bd4\u8f83\uff0c\u5e76\u5f97\u5230\u76f8\u5e94\u7684\u7ed3\u679c\u3002 \uff085\uff09Hash \u7d22\u5f15\u9047\u5230\u5927\u91cfHash\u503c\u76f8\u7b49\u7684\u60c5\u51b5\u540e\u6027\u80fd\u5e76\u4e0d\u4e00\u5b9a\u5c31\u4f1a\u6bd4B-Tree\u7d22\u5f15\u9ad8\u3002 \u5bf9\u4e8e *\u9009\u62e9\u6027* \u6bd4\u8f83\u4f4e\u7684\u7d22\u5f15\u952e\uff0c\u5982\u679c\u521b\u5efa Hash \u7d22\u5f15\uff0c\u90a3\u4e48\u5c06\u4f1a\u5b58\u5728\u5927\u91cf\u8bb0\u5f55\u6307\u9488\u4fe1\u606f\u5b58\u4e8e\u540c\u4e00\u4e2a Hash \u503c\u76f8\u5173\u8054\u3002\u8fd9\u6837\u8981\u5b9a\u4f4d\u67d0\u4e00\u6761\u8bb0\u5f55\u65f6\u5c31\u4f1a\u975e\u5e38\u9ebb\u70e6\uff0c\u4f1a\u6d6a\u8d39\u591a\u6b21\u8868\u6570\u636e\u7684\u8bbf\u95ee\uff0c\u800c\u9020\u6210\u6574\u4f53\u6027\u80fd\u4f4e\u4e0b B-Tree\u7d22\u5f15 B-Tree \u7d22\u5f15\u662f MySQL \u6570\u636e\u5e93\u4e2d\u4f7f\u7528\u6700\u4e3a\u9891\u7e41\u7684\u7d22\u5f15\u7c7b\u578b\uff0c\u9664\u4e86 Archive \u5b58\u50a8\u5f15\u64ce\u4e4b\u5916\u7684\u5176\u4ed6\u6240\u6709\u7684\u5b58\u50a8\u5f15\u64ce\u90fd\u652f\u6301 B-Tree \u7d22\u5f15\u3002\u4e0d\u4ec5\u4ec5\u5728 MySQL \u4e2d\u662f\u5982\u6b64\uff0c\u5b9e\u9645\u4e0a\u5728\u5176\u4ed6\u7684\u5f88\u591a\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e2dB-Tree \u7d22\u5f15\u4e5f\u540c\u6837\u662f\u4f5c\u4e3a\u6700\u4e3b\u8981\u7684\u7d22\u5f15\u7c7b\u578b\uff0c\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a B-Tree \u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u5728\u6570\u636e\u5e93\u7684\u6570\u636e\u68c0 \u7d22\u4e2d\u6709\u975e\u5e38\u4f18\u5f02\u7684\u8868\u73b0\u3002 \u4e00\u822c\u6765\u8bf4\uff0c MySQL \u4e2d\u7684 B-Tree \u7d22\u5f15\u7684\u7269\u7406\u6587\u4ef6\u5927\u591a\u90fd\u662f\u4ee5 Balance Tree \u7684\u7ed3\u6784\u6765\u5b58\u50a8\u7684\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u5b9e\u9645\u9700\u8981\u7684\u6570\u636e\u90fd\u5b58\u653e\u4e8e Tree \u7684 Leaf Node \uff0c\u800c\u4e14\u5230\u4efb\u4f55\u4e00\u4e2a Leaf Node \u7684\u6700\u77ed\u8def\u5f84\u7684\u957f\u5ea6\u90fd\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5927\u5bb6\u90fd\u79f0\u4e4b\u4e3a B-Tree \u7d22\u5f15\u5f53\u7136\uff0c\u53ef\u80fd\u5404\u79cd\u6570\u636e\u5e93\uff08\u6216 MySQL \u7684\u5404\u79cd\u5b58\u50a8\u5f15\u64ce\uff09\u5728\u5b58\u653e\u81ea\u5df1\u7684 B-Tree \u7d22\u5f15\u7684\u65f6\u5019\u4f1a\u5bf9\u5b58\u50a8\u7ed3\u6784\u7a0d\u4f5c\u6539\u9020\u3002\u5982 Innodb \u5b58\u50a8\u5f15\u64ce\u7684 B-Tree \u7d22\u5f15\u5b9e\u9645\u4f7f\u7528\u7684\u5b58\u50a8\u7ed3\u6784\u5b9e\u9645\u4e0a\u662f B+Tree \uff0c\u4e5f\u5c31\u662f\u5728 B-Tree \u6570\u636e\u7ed3\u6784\u7684\u57fa\u7840\u4e0a\u505a\u4e86\u5f88\u5c0f\u7684\u6539\u9020\uff0c\u5728\u6bcf\u4e00\u4e2a Leaf Node \u4e0a\u9762\u51fa\u4e86\u5b58\u653e\u7d22\u5f15\u952e\u7684\u76f8\u5173\u4fe1\u606f\u4e4b\u5916\uff0c\u8fd8\u5b58\u50a8\u4e86\u6307\u5411\u4e0e\u8be5 Leaf Node \u76f8\u90bb\u7684\u540e\u4e00\u4e2a LeafNode \u7684\u6307\u9488\u4fe1\u606f\uff0c\u8fd9\u4e3b\u8981\u662f\u4e3a\u4e86\u52a0\u5feb\u68c0\u7d22\u591a\u4e2a\u76f8\u90bb Leaf Node \u7684\u6548\u7387\u8003\u8651\u3002 \u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u5b58\u5728\u4e24\u79cd\u4e0d\u540c\u5f62\u5f0f\u7684\u7d22\u5f15\uff0c\u4e00\u79cd\u662f Cluster \u5f62\u5f0f\u7684\u4e3b\u952e\u7d22\u5f15\uff08 Primary Key \uff09\uff0c\u53e6\u5916\u4e00\u79cd\u5219\u662f\u548c\u5176\u4ed6\u5b58\u50a8\u5f15\u64ce\uff08\u5982 MyISAM \u5b58\u50a8\u5f15\u64ce\uff09\u5b58\u653e\u5f62\u5f0f\u57fa\u672c\u76f8\u540c\u7684\u666e\u901a B-Tree \u7d22\u5f15\uff0c\u8fd9\u79cd\u7d22\u5f15\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\u88ab\u79f0\u4e3a Secondary Index \u3002\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u56fe\u793a\u6765\u9488\u5bf9\u8fd9\u4e24\u79cd\u7d22\u5f15\u7684\u5b58\u653e \u5f62\u5f0f\u505a\u4e00\u4e2a\u6bd4\u8f83\u3002 \u56fe\u793a\u4e2d\u5de6\u8fb9\u4e3a Clustered \u5f62\u5f0f\u5b58\u653e\u7684 Primary Key \uff0c\u53f3\u4fa7\u5219\u4e3a\u666e\u901a\u7684 B-Tree \u7d22\u5f15\u3002\u4e24\u79cd Root Node \u548c Branch Nodes \u65b9\u9762\u90fd\u8fd8\u662f\u5b8c\u5168\u4e00\u6837\u7684\u3002\u800c Leaf Nodes \u5c31\u51fa\u73b0\u5dee\u5f02\u4e86\u3002\u5728 Prim\u4e2d\uff0c Leaf Nodes \u5b58\u653e\u7684\u662f\u8868\u7684\u5b9e\u9645\u6570\u636e\uff0c\u4e0d\u4ec5\u4ec5\u5305\u62ec\u4e3b\u952e\u5b57\u6bb5\u7684\u6570\u636e\uff0c\u8fd8\u5305\u62ec\u5176\u4ed6\u5b57\u6bb5\u7684\u6570\u636e\u636e\u4ee5\u4e3b\u952e\u503c\u6709\u5e8f\u7684\u6392\u5217\u3002\u800c Secondary Index \u5219\u548c\u5176\u4ed6\u666e\u901a\u7684 B-Tree \u7d22\u5f15\u6ca1\u6709\u592a\u5927\u7684\u5dee\u5f02\uff0cLeaf Nodes \u51fa\u4e86\u5b58\u653e\u7d22\u5f15\u952e \u7684\u76f8\u5173\u4fe1\u606f\u5916\uff0c\u8fd8\u5b58\u653e\u4e86 Innodb \u7684\u4e3b\u952e\u503c\u3002 \u6240\u4ee5\uff0c\u5728 Innodb \u4e2d\u5982\u679c\u901a\u8fc7\u4e3b\u952e\u6765\u8bbf\u95ee\u6570\u636e\u6548\u7387\u662f\u975e\u5e38\u9ad8\u7684\uff0c\u800c\u5982\u679c\u662f\u901a\u8fc7 Secondary Index \u6765\u8bbf\u95ee\u6570\u636e\u7684\u8bdd\uff0c Innodb \u9996\u5148\u901a\u8fc7 Secondary Index \u7684\u76f8\u5173\u4fe1\u606f\uff0c\u901a\u8fc7\u76f8\u5e94\u7684\u7d22\u5f15\u952e\u68c0\u7d22\u5230 Leaf Node\u4e4b\u540e\uff0c\u9700\u8981\u518d\u901a\u8fc7 Leaf Node \u4e2d\u5b58\u653e\u7684\u4e3b\u952e\u503c\u518d\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6765\u83b7\u53d6\u76f8\u5e94\u7684\u6570\u636e\u884c\u3002MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u975e\u4e3b\u952e\u7d22\u5f15\u5dee\u522b\u5f88\u5c0f\uff0c\u53ea\u4e0d\u8fc7\u662f\u4e3b\u952e\u7d22\u5f15\u7684\u7d22\u5f15\u952e\u662f\u4e00\u4e2a\u552f\u4e00\u4e14\u975e\u7a7a \u7684\u952e\u800c\u5df2\u3002\u800c\u4e14 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u7d22\u5f15\u548c Innodb \u7684 Secondary Index \u7684\u5b58\u50a8\u7ed3\u6784\u4e5f\u57fa\u672c\u76f8\u540c\uff0c\u4e3b\u8981\u7684\u533a\u522b\u53ea\u662f MyISAM \u5b58\u50a8\u5f15\u64ce\u5728 Leaf Nodes \u4e0a\u9762\u51fa\u4e86\u5b58\u653e\u7d22\u5f15\u952e\u4fe1\u606f\u4e4b\u5916\uff0c\u518d\u5b58\u653e\u80fd\u76f4\u63a5\u5b9a\u4f4d\u5230 MyISAM \u6570\u636e\u6587\u4ef6\u4e2d\u76f8\u5e94\u7684\u6570\u636e\u884c\u7684\u4fe1\u606f\uff08\u5982 Row Number \uff09\uff0c\u4f46\u5e76\u4e0d\u4f1a\u5b58\u653e\u4e3b\u952e\u7684\u952e\u503c\u4fe1\u606f","title":"B+\u6811\u7d22\u5f15\u548chash\u7d22\u5f15\u7684\u5dee\u5f02"},{"location":"database/mysql/datetime_vs_int/","text":"https://blog.csdn.net/riemann_/article/details/100679675 \u4e00\u3001\u4e09\u8005\u7684\u533a\u522b 1\u3001int \u5360\u75284\u4e2a\u5b57\u8282 \u5efa\u7acb\u7d22\u5f15\u4e4b\u540e\uff0c\u67e5\u8be2\u901f\u5ea6\u5feb \u6761\u4ef6\u8303\u56f4\u641c\u7d22\u53ef\u4ee5\u4f7f\u7528\u4f7f\u7528between \u4e0d\u80fd\u4f7f\u7528mysql\u63d0\u4f9b\u7684\u65f6\u95f4\u51fd\u6570 \u7ed3\u8bba\uff1a\u9002\u5408\u9700\u8981\u8fdb\u884c\u5927\u91cf\u65f6\u95f4\u8303\u56f4\u67e5\u8be2\u7684\u6570\u636e\u8868 2\u3001datetime \u5360\u75288\u4e2a\u5b57\u8282 \u5141\u8bb8\u4e3a\u7a7a\u503c\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u503c\uff0c\u7cfb\u7edf\u4e0d\u4f1a\u81ea\u52a8\u4fee\u6539\u5176\u503c \u5b9e\u9645\u683c\u5f0f\u50a8\u5b58\uff08Just stores what you have stored and retrieves the same thing which you have stored.\uff09 \u4e0e\u65f6\u533a\u65e0\u5173\uff08It has nothing to deal with the TIMEZONE and Conversion.\uff09 \u53ef\u4ee5\u5728\u6307\u5b9adatetime\u5b57\u6bb5\u7684\u503c\u7684\u65f6\u5019\u4f7f\u7528now()\u53d8\u91cf\u6765\u81ea\u52a8\u63d2\u5165\u7cfb\u7edf\u7684\u5f53\u524d\u65f6\u95f4 datetime\u662f\u53ef\u4ee5\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u7684, DEFAULT CURRENT_TIMESTAMP\u5728mysql5.7\u4e2d\u4eb2\u6d4b\u53ef\u7528 \u7ed3\u8bba\uff1adatetime\u7c7b\u578b\u9002\u5408\u7528\u6765\u8bb0\u5f55\u6570\u636e\u7684\u539f\u59cb\u7684\u521b\u5efa\u65f6\u95f4\uff0c\u56e0\u4e3a\u65e0\u8bba\u4f60\u600e\u4e48\u66f4\u6539\u8bb0\u5f55\u4e2d\u5176\u4ed6\u5b57\u6bb5\u7684\u503c\uff0cdatetime\u5b57\u6bb5\u7684\u503c\u90fd\u4e0d\u4f1a\u6539\u53d8\uff0c\u9664\u975e\u4f60\u624b\u52a8\u66f4\u6539\u5b83\u3002 3\u3001timestamp \u5360\u75284\u4e2a\u5b57\u8282 \u5141\u8bb8\u4e3a\u7a7a\u503c\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u81ea\u5b9a\u4e49\u503c\uff0c\u6240\u4ee5\u4e3a\u7a7a\u503c\u65f6\u6ca1\u6709\u4efb\u4f55\u610f\u4e49 TIMESTAMP\u503c\u4e0d\u80fd\u65e9\u4e8e1970\u6216\u665a\u4e8e2037\u3002\u8fd9\u8bf4\u660e\u4e00\u4e2a\u65e5\u671f\uff0c\u4f8b\u5982\u20191968-01-01\u2019\uff0c\u867d\u7136\u5bf9\u4e8eDATETIME\u6216DATE\u503c\u662f\u6709\u6548\u7684\uff0c\u4f46\u5bf9\u4e8eTIMESTAMP\u503c\u5374\u65e0\u6548\uff0c\u5982\u679c\u5206\u914d\u7ed9\u8fd9\u6837\u4e00\u4e2a\u5bf9\u8c61\u5c06\u88ab\u8f6c\u6362\u4e3a0\u3002 \u503c\u4ee5UTC\u683c\u5f0f\u4fdd\u5b58\uff08 it stores the number of milliseconds\uff09 \u65f6\u533a\u8f6c\u5316 \uff0c\u5b58\u50a8\u65f6\u5bf9\u5f53\u524d\u7684\u65f6\u533a\u8fdb\u884c\u8f6c\u6362\uff0c\u68c0\u7d22\u65f6\u518d\u8f6c\u6362\u56de\u5f53\u524d\u7684\u65f6\u533a \u9ed8\u8ba4\u503c\u4e3aCURRENT_TIMESTAMP()\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u5f53\u524d\u7684\u7cfb\u7edf\u65f6\u95f4 \u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u4fee\u6539\u5176\u503c\uff0c\u6240\u4ee5\u5728\u63d2\u5165\u8bb0\u5f55\u65f6\u4e0d\u9700\u8981\u6307\u5b9atimestamp\u5b57\u6bb5\u7684\u540d\u79f0\u548ctimestamp\u5b57\u6bb5\u7684\u503c\uff0c\u4f60\u53ea\u9700\u8981\u5728\u8bbe\u8ba1\u8868\u7684\u65f6\u5019\u6dfb\u52a0\u4e00\u4e2atimestamp\u5b57\u6bb5\u5373\u53ef\uff0c\u63d2\u5165\u540e\u8be5\u5b57\u6bb5\u7684\u503c\u4f1a\u81ea\u52a8\u53d8\u4e3a\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4ee5\u540e\u4efb\u4f55\u65f6\u95f4\u4fee\u6539\u8868\u4e2d\u7684\u8bb0\u5f55\u65f6\uff0c\u5bf9\u5e94\u8bb0\u5f55\u7684timestamp\u503c\u4f1a\u81ea\u52a8\u88ab\u66f4\u65b0\u4e3a\u5f53\u524d\u7684\u7cfb\u7edf\u65f6\u95f4 \u5982\u679c\u9700\u8981\u53ef\u4ee5\u8bbe\u7f6etimestamp\u4e0d\u81ea\u52a8\u66f4\u65b0\u3002\u901a\u8fc7\u8bbe\u7f6eDEFAULT CURRENT_TIMESTAMP \u53ef\u4ee5\u5b9e\u73b0 \u4fee\u6539\u81ea\u52a8\u66f4\u65b0 field_time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE \u4fee\u6539\u4e0d\u81ea\u52a8\u66f4\u65b0 field_time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP \u7ed3\u8bba\uff1atimestamp\u7c7b\u578b\u9002\u5408\u7528\u6765\u8bb0\u5f55\u6570\u636e\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\uff0c\u56e0\u4e3a\u53ea\u8981\u4f60\u66f4\u6539\u4e86\u8bb0\u5f55\u4e2d\u5176\u4ed6\u5b57\u6bb5\u7684\u503c\uff0ctimestamp\u5b57\u6bb5\u7684\u503c\u90fd\u4f1a\u88ab\u81ea\u52a8\u66f4\u65b0\u3002\uff08\u5982\u679c\u9700\u8981\u53ef\u4ee5\u8bbe\u7f6etimestamp\u4e0d\u81ea\u52a8\u66f4\u65b0\uff09 \u4e8c\u3001MySQL\u4e2d\u5982\u4f55\u8868\u793a\u5f53\u524d\u65f6\u95f4\uff1f \u5176\u5b9e\uff0c\u8868\u8fbe\u65b9\u5f0f\u8fd8\u662f\u86ee\u591a\u7684\uff0c\u6c47\u603b\u5982\u4e0b\uff1a CURRENT_TIMESTAMP CURRENT_TIMESTAMP() NOW() LOCALTIME LOCALTIME() LOCALTIMESTAMP LOCALTIMESTAMP() \u4e09\u3001\u5173\u4e8etimestamp\u548cdatetime\u7684\u6bd4\u8f83 \u4e00\u4e2a\u5b8c\u6574\u7684\u65e5\u671f\u683c\u5f0f\u5982\u4e0b\uff1aYYYY-MM-DD HH:MM:SS[.fraction]\uff0c\u5b83\u53ef\u5206\u4e3a\u4e24\u90e8\u5206\uff1adate\u90e8\u5206\u548ctime\u90e8\u5206\uff0c\u5176\u4e2d\uff0cdate\u90e8\u5206\u5bf9\u5e94\u683c\u5f0f\u4e2d\u7684\u201cYYYY-MM-DD\u201d\uff0ctime\u90e8\u5206\u5bf9\u5e94\u683c\u5f0f\u4e2d\u7684\u201cHH:MM:SS[.fraction]\u201d\u3002\u5bf9\u4e8edate\u5b57\u6bb5\u6765\u8bf4\uff0c\u5b83\u53ea\u652f\u6301date\u90e8\u5206\uff0c\u5982\u679c\u63d2\u5165\u4e86time\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u5b83\u4f1a\u4e22\u5f03\u6389\u8be5\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u5e76\u63d0\u793a\u4e00\u4e2awarning\u3002 1\u3001\u5173\u4e8eupdate_time\u8bbe\u7f6e\u6210date\u7c7b\u578b insert into user(update_time) values('20190909000000'); 1 date\u540e\u9762\u7684time\u90e8\u5206\u90fd\u4e22\u5f03\u6389\u4e86\u3002 2\u3001timestamp\u548cdatetime\u7684\u76f8\u540c\u70b9 \u4e24\u8005\u90fd\u53ef\u7528\u6765\u8868\u793aYYYY-MM-DD HH:MM:SS[.fraction]\u7c7b\u578b\u7684\u65e5\u671f\u3002 3\u3001timestamp\u548cdatetime\u7684\u4e0d\u540c\u70b9 \uff081\uff09\u3001\u4e24\u8005\u7684\u5b58\u50a8\u65b9\u5f0f\u4e0d\u4e00\u6837 \u5bf9\u4e8eTIMESTAMP\uff0c\u5b83\u628a\u5ba2\u6237\u7aef\u63d2\u5165\u7684\u65f6\u95f4\u4ece\u5f53\u524d\u65f6\u533a\u8f6c\u5316\u4e3aUTC\uff08\u4e16\u754c\u6807\u51c6\u65f6\u95f4\uff09\u8fdb\u884c\u5b58\u50a8\u3002\u67e5\u8be2\u65f6\uff0c\u5c06\u5176\u53c8\u8f6c\u5316\u4e3a\u5ba2\u6237\u7aef\u5f53\u524d\u65f6\u533a\u8fdb\u884c\u8fd4\u56de\u3002 \u800c\u5bf9\u4e8eDATETIME\uff0c\u4e0d\u505a\u4efb\u4f55\u6539\u53d8\uff0c\u57fa\u672c\u4e0a\u662f\u539f\u6837\u8f93\u5165\u548c\u8f93\u51fa\u3002 \u4e0b\u9762\uff0c\u6211\u4eec\u6765\u9a8c\u8bc1\u4e00\u4e0b \u9996\u5148\u521b\u5efa\u4e24\u79cd\u6d4b\u8bd5\u8868\uff0c\u4e00\u4e2a\u4f7f\u7528timestamp\u683c\u5f0f\uff0c\u4e00\u4e2a\u4f7f\u7528datetime\u683c\u5f0f\u3002 user\u8868 datetime\u7c7b\u578b user2\u8868 timestamp\u7c7b\u578b insert into user(id, update_time) values(1, '20190910000800'); insert into user2(id, update_time) values(1, '20190910000800'); select * from user; select * from user2; 1 2 3 4 5 \u4e24\u8005\u8f93\u51fa\u662f\u4e00\u6837\u7684\u3002 \u5176\u6b21\u4fee\u6539\u5f53\u524d\u4f1a\u8bdd\u7684\u65f6\u533a show variables like '%time_zone%'; 1 set time_zone='+0:00'; 1 select * from user; select * from user2; 1 2 \u201cCST\u201d\u6307\u7684\u662fMySQL\u6240\u5728\u4e3b\u673a\u7684\u7cfb\u7edf\u65f6\u95f4\uff0c\u662f\u4e2d\u56fd\u6807\u51c6\u65f6\u95f4\u7684\u7f29\u5199\uff0cChina Standard Time UT+8:00\uff0c\u8fd9\u91ccsystem_time_zone\u4e3a\u7a7a\u3002 \u901a\u8fc7\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0cuser2\u4e2d\u8fd4\u56de\u7684\u65f6\u95f4\u63d0\u524d\u4e868\u4e2a\u5c0f\u65f6\uff0c\u800cuser\u4e2d\u65f6\u95f4\u5219\u4e0d\u53d8\u3002\u8fd9\u5145\u5206\u9a8c\u8bc1\u4e86\u4e24\u8005\u7684\u533a\u522b\u3002 \uff082\uff09\u3001\u4e24\u8005\u6240\u80fd\u5b58\u50a8\u7684\u65f6\u95f4\u8303\u56f4\u4e0d\u4e00\u6837 timestamp\u6240\u80fd\u5b58\u50a8\u7684\u65f6\u95f4\u8303\u56f4\u4e3a\uff1a'1970-01-01 00:00:01.000000' \u5230 '2038-01-19 03:14:07.999999'\u3002 datetime\u6240\u80fd\u5b58\u50a8\u7684\u65f6\u95f4\u8303\u56f4\u4e3a\uff1a'1000-01-01 00:00:00.000000' \u5230 '9999-12-31 23:59:59.999999'\u3002 \u603b\u7ed3\uff1atimestamp\u548cdatetime\u9664\u4e86\u5b58\u50a8\u8303\u56f4\u548c\u5b58\u50a8\u65b9\u5f0f\u4e0d\u4e00\u6837\uff0c\u6ca1\u6709\u592a\u5927\u533a\u522b\u3002\u5f53\u7136\uff0c\u5bf9\u4e8e\u8de8\u65f6\u533a\u7684\u4e1a\u52a1\uff0ctimestamp\u66f4\u4e3a\u5408\u9002\u3002 \u56db\u3001\u5173\u4e8etimestamp\u548cdatetime\u7684\u81ea\u52a8\u521d\u59cb\u5316\u548c\u66f4\u65b0 \u9996\u5148\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u9762\u7684\u64cd\u4f5c\uff1a mysql> create table user3(id int, update_time timestam Query OK, 0 rows affected (0.02 sec) mysql> insert into user3(id) values(1); Query OK, 1 row affected (0.00 sec) mysql> select * from user3; +------+---------------------+ | id | update_time | +------+---------------------+ | 1 | 2019-09-10 00:37:57 | +------+---------------------+ 1 row in set (0.00 sec) mysql> show create table user3\\G * * * * * 1. row * * *** Table: user3 Create Table: CREATE TABLE user3 ( id int(11) default NULL, update_time timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP ) ENGINE=InnoDB DEFAULT CHARSET=utf8 1 row in set (0.00 sec) \u770b\u8d77\u6765\u662f\u4e0d\u662f\u6709\u70b9\u5947\u602a\uff0c\u6211\u5e76\u6ca1\u6709\u5bf9update_time\u5b57\u6bb5\u8fdb\u884c\u63d2\u5165\u64cd\u4f5c\uff0c\u5b83\u7684\u503c\u81ea\u52a8\u4fee\u6539\u4e3a\u5f53\u524d\u503c\uff0c\u800c\u4e14\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\uff0c\u6211\u4e5f\u5e76\u6ca1\u6709\u5b9a\u4e49\u201cshow create table test\\G\u201d\u7ed3\u679c\u4e2d\u663e\u793a\u7684\u201c default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP\u201d\u3002 \u5176\u5b9e\uff0c\u8fd9\u4e2a\u7279\u6027\u662f\u81ea\u52a8\u521d\u59cb\u5316\u548c\u81ea\u52a8\u66f4\u65b0\uff08Automatic Initialization and Updating\uff09\u3002 \u81ea\u52a8\u521d\u59cb\u5316\u6307\u7684\u662f\u5982\u679c\u5bf9\u8be5\u5b57\u6bb5\uff08\u8b6c\u5982\u4e0a\u4f8b\u4e2d\u7684update_time\u5b57\u6bb5\uff09\u6ca1\u6709\u663e\u6027\u8d4b\u503c\uff0c\u5219\u81ea\u52a8\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\u3002 \u81ea\u52a8\u66f4\u65b0\u6307\u7684\u662f\u5982\u679c\u4fee\u6539\u4e86\u5176\u5b83\u5b57\u6bb5\uff0c\u5219\u8be5\u5b57\u6bb5\u7684\u503c\u5c06\u81ea\u52a8\u66f4\u65b0\u4e3a\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\u3002 \u5b83\u4e0e\u201cexplicit_defaults_for_timestamp\u201d\u53c2\u6570\u6709\u5173\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u53c2\u6570\u7684\u503c\u4e3aOFF\uff0c\u5982\u4e0b\u6240\u793a\uff1a mysql> show variables like '%explicit_defaults_for_timestamp%'; +---------------------------------+-------+ | Variable_name | Value | +---------------------------------+-------+ | explicit_defaults_for_timestamp | OFF | +---------------------------------+-------+ row in set (0.00 sec) \u4e0b\u9762\u6211\u4eec\u770b\u770b\u5b98\u6863\u7684\u8bf4\u660e\uff1a By default, the first TIMESTAMP column has both DEFAULT CURRENT_TIMESTAMP and ON UPDATE CURRENT_TIMESTAMP if neither is specified explicitly\u3002 \u5f88\u591a\u65f6\u5019\uff0c\u8fd9\u5e76\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\uff0c\u5982\u4f55\u7981\u7528\u5462\uff1f \u5c06\u201cexplicit_defaults_for_timestamp\u201d\u7684\u503c\u8bbe\u7f6e\u4e3aON\u3002 \u201cexplicit_defaults_for_timestamp\u201d\u7684\u503c\u4f9d\u65e7\u662fOFF\uff0c\u4e5f\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u7981\u7528 <1> \u7528DEFAULT\u5b50\u53e5\u8be5\u8be5\u5217\u6307\u5b9a\u4e00\u4e2a\u9ed8\u8ba4\u503c <2> \u4e3a\u8be5\u5217\u6307\u5b9aNULL\u5c5e\u6027\u3002 \u5982\u4e0b\u6240\u793a\uff1a mysql> create table user4(id int, update_time timestamp null); Query OK, 0 rows affected (0.01 sec) mysql> show create table user4\\G * * * * * 1. row * * * **** Table: user4 Create Table: CREATE TABLE user4 ( id int(11) DEFAULT NULL, update_time timestamp NULL DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf-8 row in set (0.00 sec) mysql> create table user5(id int,update_time timestamp default 0); Query OK, 0 rows affected (0.01 sec) mysql> show create table user5\\G * * * * * 1. row * * * **** Table: user5 Create Table: CREATE TABLE user5 ( id int(11) DEFAULT NULL, update_time timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' ) ENGINE=InnoDB DEFAULT CHARSET=utf-8 row in set (0.00 sec) \u5728MySQL 5.6.5\u7248\u672c\u4e4b\u524d\uff0cAutomatic Initialization and Updating\u53ea\u9002\u7528\u4e8eTIMESTAMP\uff0c\u800c\u4e14\u4e00\u5f20\u8868\u4e2d\uff0c\u6700\u591a\u5141\u8bb8\u4e00\u4e2aTIMESTAMP\u5b57\u6bb5\u91c7\u7528\u8be5\u7279\u6027\u3002\u4eceMySQL 5.6.5\u5f00\u59cb\uff0cAutomatic Initialization and Updating\u540c\u65f6\u9002\u7528\u4e8eTIMESTAMP\u548cDATETIME\uff0c\u4e14\u4e0d\u9650\u5236\u6570\u91cf\u3002 \u7248\u6743\u58f0\u660e\uff1a\u672c\u6587\u4e3aCSDN\u535a\u4e3b\u300c\u8001\u5468\u804a\u67b6\u6784\u300d\u7684\u539f\u521b\u6587\u7ae0\uff0c\u9075\u5faaCC 4.0 BY-SA\u7248\u6743\u534f\u8bae\uff0c\u8f6c\u8f7d\u8bf7\u9644\u4e0a\u539f\u6587\u51fa\u5904\u94fe\u63a5\u53ca\u672c\u58f0\u660e\u3002 \u539f\u6587\u94fe\u63a5\uff1ahttps://blog.csdn.net/riemann_/article/details/100679675","title":"mysql datetime\u548cint\u5206\u6790\u5bf9\u6bd4"},{"location":"database/mysql/index_not_work/","text":"SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5 \u524d\u8a00\uff1a \u5728\u7d22\u5f15\u4f18\u5316\u65f6\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u7684\u4e00\u53e5\u8bdd\uff1a\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u51fa\u73b0\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u7684\u8bdd\uff0c\u90a3\u4e48\u7d22\u5f15\u5c06\u5931\u6548\uff0c\u8fdb\u800c\u8f6c\u4e3a\u5168\u8868\u626b\u63cf\uff0c\u67e5\u8be2\u6548\u7387\u5c06\u5927\u5927\u964d\u4f4e\uff0c\u8981\u907f\u514d\u51fa\u73b0\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\uff1b \u5728\u6b64\u6211\u60f3\u95ee\u95ee\u540c\u5b66\u4eec\uff1a \u5927\u5bb6\u77e5\u9053\u4e3a\u4ec0\u4e48\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u5417\uff1f \u5b9e\u9645\u573a\u666f\u4e2d\u6709\u6ca1\u6709\u9047\u5230\u8fc7\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\uff0c\u5177\u4f53\u6392\u67e5\u7684\u8fc7\u7a0b\uff1b \u672c\u6587\u4e3b\u7ebf \u7531\u4e0a\u9762\u7684\u4e24\u4e2a\u95ee\u9898\u7275\u5f15\u51fa\u4e86\u672c\u6587\u7684\u4e3b\u7ebf\uff1b \u7b80\u5355\u63cf\u8ff0\u4e0b\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0 \u7136\u540e\u6a21\u62df\u5b9e\u9645\u573a\u666f\u6392\u67e5\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u8fc7\u7a0b \u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0 MySQL\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u662f B+Tree\uff0c\u60f3\u8981\u8d70\u7d22\u5f15\u67e5\u8be2\u5fc5\u987b\u8981\u6ee1\u8db3\u5176 \u6700\u5de6\u524d\u7f00\u539f\u5219 \uff0c\u5426\u5219\u65e0\u6cd5\u901a\u8fc7\u7d22\u5f15\u6811\u8fdb\u884c\u67e5\u627e\uff0c\u53ea\u80fd\u8fdb\u884c\u5168\u8868\u626b\u63cf\uff1b \u4f8b\u5982\uff1a\u4e0b\u9762\u7684\u8fd9\u4e2aSQL\u7531\u4e8e\u5728 \u7d22\u5f15\u5b57\u6bb5 \u4e0a\u4f7f\u7528\u51fd\u6570\u8fdb\u884c\u8fd0\u7b97\uff0c\u5bfc\u81f4\u7d22\u5f15\u5931\u6548 select * from t_user where SUBSTR(name, 1, 2) = '\u674e\u5f64' \u4e0a\u9762\u7684\u8fd9\u4e2aSQL\u600e\u4e48\u6539\u9020\u624d\u80fd\u4f7f\u7d22\u5f15\u751f\u6548\u5462\uff1f\u5982\u4e0b\u6240\u793a\uff1a select * from t_user where name like '\u674e\u5f64%' \u901a\u8fc7\u4e0a\u9762\u7684\u5c0f\u4f8b\u5b50\u53ef\u4ee5\u77e5\u9053\uff0c\u5982\u679c\u5728\u7d22\u5f15\u5b57\u6bb5\u4e0a\u4f7f\u7528\u51fd\u6570\u8fd0\u7b97\uff0c\u5219\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u7d22\u5f15\u5b57\u6bb5\u7684 \u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362 \u7531\u4e8eMySQL\u4f1a\u81ea\u52a8\u7684\u5728\u7d22\u5f15\u5b57\u6bb5\u4e0a\u52a0\u4e0a \u8f6c\u6362\u51fd\u6570 \uff0c\u8fdb\u800c\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff1b \u90a3\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u901a\u8fc7\u6a21\u62df\u7684\u5b9e\u9645\u573a\u666f\u6765\u5177\u4f53\u770b\u770b\u662f\u4e0d\u662f\u7531\u4e8eMySQL\u81ea\u52a8\u7ed9\u52a0\u4e0a\u4e86\u8f6c\u6362\u51fd\u6570\u800c\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\uff1b \u6a21\u62df\u573a\u666f + \u95ee\u9898\u6392\u67e5 \u7531\u4e8e\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0\u6709\u5f88\u591a\uff0c\u5982\u679c\u81ea\u5df1\u5199\u7684SQL\u600e\u4e48\u770b\u90fd\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u901a\u8fc7\u67e5\u770b\u6267\u884c\u8ba1\u5212\u53d1\u73b0\u5c31\u662f\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0c\u6b64\u65f6\u5c31\u4f1a\u8ba9\u5f88\u591a\u4eba\u9677\u5165\u56f0\u5883\uff0c\u8fd9\u5230\u5e95\u662f\u600e\u4e48\u5bfc\u81f4\u7684\u5462\uff1f \u6b64\u65f6\u672c\u6587\u91cd\u70b9\u5c06\u8981\u8bb2\u8ff0\u7684\u5de5\u5177\u5c31\u8981\u95ea\u4eae\u767b\u573a\u5566\uff1a explain extended + show warnings \uff1b \u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u5c06\u6267\u884c\u7684SQL\u8bed\u53e5\u7684\u4e00\u4e9b\u6269\u5c55\u4fe1\u606f\u5c55\u793a\u51fa\u6765\uff0c\u8fd9\u4e9b\u6269\u5c55\u4fe1\u606f\u5c31\u5305\u62ec\uff1aMySQL\u4f18\u5316\u65f6\u53ef\u80fd\u4f1a\u6dfb\u52a0\u4e0a\u5b57\u7b26\u96c6\u8f6c\u6362\u51fd\u6570\uff0c\u4f7f\u5f97\u5b57\u7b26\u96c6\u4e0d\u5339\u914d\u7684SQL\u53ef\u4ee5\u6b63\u786e\u6267\u884c\u4e0b\u53bb\uff1b \u4e0b\u9762\u5c31\u6765\u5177\u4f53\u804a\u804a explain extended + show warnings \u7684\u4f7f\u7528\uff1b \u6a21\u62df\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u7684\u573a\u666f\uff1a \u9996\u5148\u521b\u5efa\u4e24\u4e2a\u5b57\u7b26\u96c6\u4e0d\u4e00\u6837\u7684\u8868\uff1a CREATE TABLE `t_department` ( `id` int(11) NOT NULL AUTO_INCREMENT, `de_no` varchar(32) NOT NULL, `info` varchar(200) DEFAULT NULL, `de_name` varchar(200) DEFAULT NULL, PRIMARY KEY (`id`), KEY `index_de_no` (`de_no`) USING BTREE ) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4; CREATE TABLE `t_employees` ( `id` int(11) NOT NULL AUTO_INCREMENT, `em_no` varchar(32) NOT NULL, `de_no` varchar(32) NOT NULL, `age` int(11) DEFAULT NULL, `info` varchar(200) DEFAULT NULL, `em_name` varchar(200) DEFAULT NULL, PRIMARY KEY (`id`), KEY `index_em_no` (`de_no`) USING BTREE ) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8; \u7136\u540e\u4f7f\u7528\u5b58\u50a8\u8fc7\u7a0b\u6784\u9020\u6570\u636e\uff1a # \u5982\u679c\u5b58\u50a8\u8fc7\u7a0b\u5b58\u5728\u5219\u5220\u9664 DROP PROCEDURE IF EXISTS proc_initData; DELIMITER $ # \u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b CREATE PROCEDURE proc_initData() BEGIN DECLARE i INT DEFAULT 1; WHILE i<=30 DO # \u65b0\u589e\u6570\u636e INSERT INTO t_employees ( em_no, de_no, info, em_name , age) VALUES ( CONCAT('001', i), '003', 'test11', 'test2', i ); #\u6267\u884c\u7684sql\u8bed\u53e5 SET i = i+1; END WHILE; END $ # \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b CALL proc_initData(); \u6ce8\u610f\uff1a\u5728\u6784\u9020\u6570\u636e\u65f6\uff0c\u8bb0\u5f97\u5c06 t_employees \u8868\u4e2d\u7684 de_no \u5b57\u6bb5\u503c\u6784\u9020\u7684 \u79bb\u6563\u4e9b \uff0c\u56e0\u4e3a\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u503c\u7684 \u533a\u5206\u5ea6\u5f88\u4f4e \u7684\u8bdd\uff0c\u90a3\u4e48MyQSL\u4f18\u5316\u5668\u901a\u8fc7\u91c7\u6837\u7edf\u8ba1\u5206\u6790\u65f6\uff0c\u53d1\u73b0\u7d22\u5f15\u67e5\u8be2\u548c\u5168\u8868\u626b\u63cf\u6027\u80fd\u5dee\u4e0d\u591a\uff0c\u5c31\u4f1a\u76f4\u63a5\u8fdb\u884c\u5168\u8868\u626b\u63cf\u4e86\uff1b \u7d22\u5f15\u5931\u6548\u7684\u67e5\u8be2SQL\u8bed\u53e5\uff1a \u5c06\u8868\u548c\u6570\u636e\u6784\u9020\u5b8c\u540e\uff0c\u6211\u4eec\u4f7f\u7528SQL\u8bed\u53e5\u8fdb\u884c\u67e5\u8be2\u4e0b\uff0c\u7136\u540e\u518d\u770b\u770b\u5176\u6267\u884c\u8ba1\u5212\uff1b explain select * from t_department a LEFT JOIN t_employees b on a.de_no = b.de_no where a.id = 16 \u5176\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff1a \u53d1\u73b0 t_employees \u8868\u4e2d\u7684 de_no \u5b57\u6bb5\u6709\u7d22\u5f15\uff0c\u4f46\u662f\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0ctype=ALL \u8d70\u7684\u5168\u8868\u626b\u63cf\uff0c\u4f46\u662f\u901a\u8fc7\u67e5\u770bSQL\u8bed\u53e5\u53d1\u73b0\u5176\u6ca1\u6709\u95ee\u9898\u5440\uff0c\u8868\u9762\u770b\u4e0a\u53bb\u90fd\u662f\u6ee1\u8db3\u8d70\u7d22\u5f15\u67e5\u8be2\u7684\u6761\u4ef6\u5440\uff0c\u6392\u67e5\u5230\u8fd9\u53d1\u73b0\u9047\u5230\u4e86\u56f0\u5883\uff0c\u82e6\u607c\u554a\uff01 \u8fd8\u597d\uff0c\u901a\u8fc7\u5728\u7f51\u7edc\u4e16\u754c\u4e0a\u9068\u6e38\uff0c\u6700\u7ec8\u53d1\u73b0\u4e86 explain extended + show warnings \u5229\u5668\uff0c\u5229\u7528\u5b83\u5feb\u901f\u53d1\u73b0\u4e86\u7d22\u5f15\u5931\u6548\u7684\u6839\u672c\u539f\u56e0\uff0c\u7136\u540e\u5feb\u901f\u627e\u5230\u4e86\u89e3\u51b3\u65b9\u6848\uff1b \u4e0b\u9762\u5c31\u6765\u804a\u804a\u8fd9\u4e2a\u5229\u5668\u7684\u5177\u4f53\u4f7f\u7528\uff0c\u5f00\u68ee\uff01 \u4f7f\u7528\u5229\u5668\u5feb\u901f\u6392\u67e5\u95ee\u9898\uff1a \u6ce8\u610f\uff1aexplain \u540e\u9762\u8ddf\u7684\u5173\u952e\u5b57 EXTENDED\uff08\u6269\u5c55\u4fe1\u606f\uff09 \u5728MySQL5.7\u53ca\u4e4b\u540e\u7684\u7248\u672c\u4e2d\u5e9f\u5f03\u4e86\uff0c\u4f46\u662f\u8be5\u8bed\u6cd5\u4ecd\u88ab\u8bc6\u522b\u4e3a\u5411\u540e\u517c\u5bb9\uff0c\u6240\u4ee5\u57285.7\u7248\u672c\u53ca\u540e\u7eed\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u4e0d\u7528\u5728 explain \u540e\u9762\u6dfb\u52a0 EXTENDED \u4e86\uff1b EXTENDED\u5173\u952e\u5b57\u7684\u5177\u4f53\u67e5\u9605\u8d44\u6599\uff1a https://dev.mysql.com/doc/refman/5.7/en/explain-extended.html \u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a \u2460\u3001\u9996\u5148\u5728MySQL\u7684\u53ef\u89c6\u5316\u5de5\u5177\u4e2d\u6253\u5f00\u4e00\u4e2a \u547d\u4ee4\u5217\u4ecb\u9762 \uff1a\u5de5\u5177 --> \u547d\u4ee4\u5217\u4ecb\u9762 \u2461\u3001\u7136\u540e\u8f93\u5165\u4e0b\u9762\u7684SQL\u5e76\u6309\u56de\u8f66\uff1a explain EXTENDED select * from t_department a LEFT JOIN t_employees b on a.de_no = b.de_no where a.id = 4019; \u2462\u3001\u7136\u540e\u7d27\u63a5\u7740\u8f93\u5165\u547d\u4ee4 show warnings; \u5e76\u56de\u8f66\uff0c\u4f1a\u51fa\u73b0\u5982\u4e0b\u56fe\u6240\u793a\u5185\u5bb9\uff1a \u901a\u8fc7\u5c55\u793a\u51fa\u7684\u6267\u884cSQL\u6269\u5c55\u4fe1\u606f\uff0c\u53d1\u73b0MySQL\u5728\u5b57\u7b26\u96c6\u4e0d\u4e00\u81f4\u65f6\u81ea\u52a8\u6dfb\u52a0\u4e0a\u5b57\u7b26\u96c6\u8f6c\u6362\u51fd\u6570\uff0c\u56e0\u4e3a\u662f\u5728 \u7d22\u5f15\u5b57\u6bb5 de_no \u4e0a\u6dfb\u52a0\u7684\u8f6c\u6362\u51fd\u6570\uff0c\u6240\u4ee5\u5c31\u5bfc\u81f4\u4e86\u7d22\u5f15\u5931\u6548\uff1b \u800c\u5982\u679c\u6211\u4eec\u6ca1\u770b\u6269\u5c55\u4fe1\u606f\u7684\u8bdd\uff0c\u90a3\u4e48\u53ef\u80fd\u76f4\u5230\u6211\u4eec\u67e5\u770b\u8868\u7ed3\u6784\u7684\u65f6\u5019\u624d\u4f1a\u53d1\u73b0\u662f\u7531\u4e8e\u5b57\u7b26\u96c6\u4e0d\u4e00\u81f4\u5bfc\u81f4\u7684\uff0c\u8fd9\u6837\u5c31\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff1b \u6269\u5c55\uff1a\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362 \u54b1\u4eec\u804a\u5b8c\u4e0a\u9762\u7684\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff0c\u518d\u6765\u7b80\u5355\u804a\u804a\u53e6\u4e00\u79cd \u9690\u5f0f\u7c7b\u578b\u8f6c\u6362 \u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1b \u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff1a\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u5b57\u6bb5\u7684\u7c7b\u578b\u4e0e\u5176\u8d4b\u503c\u7684\u7c7b\u578b\u4e0d\u4e00\u81f4\u65f6\u4f1a\u8fdb\u884c\u9690\u5f0f\u7684\u8f6c\u6362\uff1b \u5c0f\u4f8b\u5982\u4e0b\uff1a select * from t_employees where em_name = 123; \u4e0a\u9762\u7684SQL\u4e2d em_name \u4e3a\u7d22\u5f15\u5b57\u6bb5\uff0c\u5b57\u6bb5\u7c7b\u578b\u662f varchar\uff0c\u4e3a\u5176\u8d4b int \u7c7b\u578b\u7684\u503c\u65f6\uff0c\u4f1a\u53d1\u73b0\u7d22\u5f15\u5931\u6548\uff0c\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u901a\u8fc7 explain extended + show warnings \u67e5\u770b\uff0c\u4f1a\u53d1\u73b0\u5982\u4e0b\u56fe\u6240\u793a\u5185\u5bb9\uff1a \u81f3\u6b64\u672c\u6587\u8fdb\u5165\u7ed3\u5c3e\uff0c\u5728\u6b64\u518d\u8bf4\u660e\u4e0b\uff0c\u4e0a\u6587\u4e2d\u6d4b\u8bd5\u65f6\u4f7f\u7528\u7684MySQL\u7248\u672c\u90fd\u662f 5.7 \uff1b","title":"SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5"},{"location":"database/mysql/index_not_work/#sql","text":"","title":"SQL\u8bed\u53e5\u4e0d\u8d70\u7d22\u5f15\u65f6\u7684\u6392\u67e5"},{"location":"database/mysql/index_not_work/#_1","text":"\u5728\u7d22\u5f15\u4f18\u5316\u65f6\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u7684\u4e00\u53e5\u8bdd\uff1a\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u51fa\u73b0\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u7684\u8bdd\uff0c\u90a3\u4e48\u7d22\u5f15\u5c06\u5931\u6548\uff0c\u8fdb\u800c\u8f6c\u4e3a\u5168\u8868\u626b\u63cf\uff0c\u67e5\u8be2\u6548\u7387\u5c06\u5927\u5927\u964d\u4f4e\uff0c\u8981\u907f\u514d\u51fa\u73b0\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\uff1b","title":"\u524d\u8a00\uff1a"},{"location":"database/mysql/index_not_work/#_2","text":"\u5927\u5bb6\u77e5\u9053\u4e3a\u4ec0\u4e48\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u5417\uff1f \u5b9e\u9645\u573a\u666f\u4e2d\u6709\u6ca1\u6709\u9047\u5230\u8fc7\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\uff0c\u5177\u4f53\u6392\u67e5\u7684\u8fc7\u7a0b\uff1b","title":"\u5728\u6b64\u6211\u60f3\u95ee\u95ee\u540c\u5b66\u4eec\uff1a"},{"location":"database/mysql/index_not_work/#_3","text":"\u7531\u4e0a\u9762\u7684\u4e24\u4e2a\u95ee\u9898\u7275\u5f15\u51fa\u4e86\u672c\u6587\u7684\u4e3b\u7ebf\uff1b \u7b80\u5355\u63cf\u8ff0\u4e0b\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0 \u7136\u540e\u6a21\u62df\u5b9e\u9645\u573a\u666f\u6392\u67e5\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u8fc7\u7a0b","title":"\u672c\u6587\u4e3b\u7ebf"},{"location":"database/mysql/index_not_work/#_4","text":"MySQL\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u662f B+Tree\uff0c\u60f3\u8981\u8d70\u7d22\u5f15\u67e5\u8be2\u5fc5\u987b\u8981\u6ee1\u8db3\u5176 \u6700\u5de6\u524d\u7f00\u539f\u5219 \uff0c\u5426\u5219\u65e0\u6cd5\u901a\u8fc7\u7d22\u5f15\u6811\u8fdb\u884c\u67e5\u627e\uff0c\u53ea\u80fd\u8fdb\u884c\u5168\u8868\u626b\u63cf\uff1b \u4f8b\u5982\uff1a\u4e0b\u9762\u7684\u8fd9\u4e2aSQL\u7531\u4e8e\u5728 \u7d22\u5f15\u5b57\u6bb5 \u4e0a\u4f7f\u7528\u51fd\u6570\u8fdb\u884c\u8fd0\u7b97\uff0c\u5bfc\u81f4\u7d22\u5f15\u5931\u6548 select * from t_user where SUBSTR(name, 1, 2) = '\u674e\u5f64' \u4e0a\u9762\u7684\u8fd9\u4e2aSQL\u600e\u4e48\u6539\u9020\u624d\u80fd\u4f7f\u7d22\u5f15\u751f\u6548\u5462\uff1f\u5982\u4e0b\u6240\u793a\uff1a select * from t_user where name like '\u674e\u5f64%' \u901a\u8fc7\u4e0a\u9762\u7684\u5c0f\u4f8b\u5b50\u53ef\u4ee5\u77e5\u9053\uff0c\u5982\u679c\u5728\u7d22\u5f15\u5b57\u6bb5\u4e0a\u4f7f\u7528\u51fd\u6570\u8fd0\u7b97\uff0c\u5219\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u7d22\u5f15\u5b57\u6bb5\u7684 \u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362 \u7531\u4e8eMySQL\u4f1a\u81ea\u52a8\u7684\u5728\u7d22\u5f15\u5b57\u6bb5\u4e0a\u52a0\u4e0a \u8f6c\u6362\u51fd\u6570 \uff0c\u8fdb\u800c\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff1b \u90a3\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u901a\u8fc7\u6a21\u62df\u7684\u5b9e\u9645\u573a\u666f\u6765\u5177\u4f53\u770b\u770b\u662f\u4e0d\u662f\u7531\u4e8eMySQL\u81ea\u52a8\u7ed9\u52a0\u4e0a\u4e86\u8f6c\u6362\u51fd\u6570\u800c\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\uff1b","title":"\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0"},{"location":"database/mysql/index_not_work/#_5","text":"\u7531\u4e8e\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0\u6709\u5f88\u591a\uff0c\u5982\u679c\u81ea\u5df1\u5199\u7684SQL\u600e\u4e48\u770b\u90fd\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u901a\u8fc7\u67e5\u770b\u6267\u884c\u8ba1\u5212\u53d1\u73b0\u5c31\u662f\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0c\u6b64\u65f6\u5c31\u4f1a\u8ba9\u5f88\u591a\u4eba\u9677\u5165\u56f0\u5883\uff0c\u8fd9\u5230\u5e95\u662f\u600e\u4e48\u5bfc\u81f4\u7684\u5462\uff1f \u6b64\u65f6\u672c\u6587\u91cd\u70b9\u5c06\u8981\u8bb2\u8ff0\u7684\u5de5\u5177\u5c31\u8981\u95ea\u4eae\u767b\u573a\u5566\uff1a explain extended + show warnings \uff1b \u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u5c06\u6267\u884c\u7684SQL\u8bed\u53e5\u7684\u4e00\u4e9b\u6269\u5c55\u4fe1\u606f\u5c55\u793a\u51fa\u6765\uff0c\u8fd9\u4e9b\u6269\u5c55\u4fe1\u606f\u5c31\u5305\u62ec\uff1aMySQL\u4f18\u5316\u65f6\u53ef\u80fd\u4f1a\u6dfb\u52a0\u4e0a\u5b57\u7b26\u96c6\u8f6c\u6362\u51fd\u6570\uff0c\u4f7f\u5f97\u5b57\u7b26\u96c6\u4e0d\u5339\u914d\u7684SQL\u53ef\u4ee5\u6b63\u786e\u6267\u884c\u4e0b\u53bb\uff1b \u4e0b\u9762\u5c31\u6765\u5177\u4f53\u804a\u804a explain extended + show warnings \u7684\u4f7f\u7528\uff1b","title":"\u6a21\u62df\u573a\u666f + \u95ee\u9898\u6392\u67e5"},{"location":"database/mysql/index_not_work/#_6","text":"\u9996\u5148\u521b\u5efa\u4e24\u4e2a\u5b57\u7b26\u96c6\u4e0d\u4e00\u6837\u7684\u8868\uff1a CREATE TABLE `t_department` ( `id` int(11) NOT NULL AUTO_INCREMENT, `de_no` varchar(32) NOT NULL, `info` varchar(200) DEFAULT NULL, `de_name` varchar(200) DEFAULT NULL, PRIMARY KEY (`id`), KEY `index_de_no` (`de_no`) USING BTREE ) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4; CREATE TABLE `t_employees` ( `id` int(11) NOT NULL AUTO_INCREMENT, `em_no` varchar(32) NOT NULL, `de_no` varchar(32) NOT NULL, `age` int(11) DEFAULT NULL, `info` varchar(200) DEFAULT NULL, `em_name` varchar(200) DEFAULT NULL, PRIMARY KEY (`id`), KEY `index_em_no` (`de_no`) USING BTREE ) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8; \u7136\u540e\u4f7f\u7528\u5b58\u50a8\u8fc7\u7a0b\u6784\u9020\u6570\u636e\uff1a # \u5982\u679c\u5b58\u50a8\u8fc7\u7a0b\u5b58\u5728\u5219\u5220\u9664 DROP PROCEDURE IF EXISTS proc_initData; DELIMITER $ # \u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b CREATE PROCEDURE proc_initData() BEGIN DECLARE i INT DEFAULT 1; WHILE i<=30 DO # \u65b0\u589e\u6570\u636e INSERT INTO t_employees ( em_no, de_no, info, em_name , age) VALUES ( CONCAT('001', i), '003', 'test11', 'test2', i ); #\u6267\u884c\u7684sql\u8bed\u53e5 SET i = i+1; END WHILE; END $ # \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b CALL proc_initData(); \u6ce8\u610f\uff1a\u5728\u6784\u9020\u6570\u636e\u65f6\uff0c\u8bb0\u5f97\u5c06 t_employees \u8868\u4e2d\u7684 de_no \u5b57\u6bb5\u503c\u6784\u9020\u7684 \u79bb\u6563\u4e9b \uff0c\u56e0\u4e3a\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u503c\u7684 \u533a\u5206\u5ea6\u5f88\u4f4e \u7684\u8bdd\uff0c\u90a3\u4e48MyQSL\u4f18\u5316\u5668\u901a\u8fc7\u91c7\u6837\u7edf\u8ba1\u5206\u6790\u65f6\uff0c\u53d1\u73b0\u7d22\u5f15\u67e5\u8be2\u548c\u5168\u8868\u626b\u63cf\u6027\u80fd\u5dee\u4e0d\u591a\uff0c\u5c31\u4f1a\u76f4\u63a5\u8fdb\u884c\u5168\u8868\u626b\u63cf\u4e86\uff1b \u7d22\u5f15\u5931\u6548\u7684\u67e5\u8be2SQL\u8bed\u53e5\uff1a \u5c06\u8868\u548c\u6570\u636e\u6784\u9020\u5b8c\u540e\uff0c\u6211\u4eec\u4f7f\u7528SQL\u8bed\u53e5\u8fdb\u884c\u67e5\u8be2\u4e0b\uff0c\u7136\u540e\u518d\u770b\u770b\u5176\u6267\u884c\u8ba1\u5212\uff1b explain select * from t_department a LEFT JOIN t_employees b on a.de_no = b.de_no where a.id = 16 \u5176\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff1a \u53d1\u73b0 t_employees \u8868\u4e2d\u7684 de_no \u5b57\u6bb5\u6709\u7d22\u5f15\uff0c\u4f46\u662f\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0ctype=ALL \u8d70\u7684\u5168\u8868\u626b\u63cf\uff0c\u4f46\u662f\u901a\u8fc7\u67e5\u770bSQL\u8bed\u53e5\u53d1\u73b0\u5176\u6ca1\u6709\u95ee\u9898\u5440\uff0c\u8868\u9762\u770b\u4e0a\u53bb\u90fd\u662f\u6ee1\u8db3\u8d70\u7d22\u5f15\u67e5\u8be2\u7684\u6761\u4ef6\u5440\uff0c\u6392\u67e5\u5230\u8fd9\u53d1\u73b0\u9047\u5230\u4e86\u56f0\u5883\uff0c\u82e6\u607c\u554a\uff01 \u8fd8\u597d\uff0c\u901a\u8fc7\u5728\u7f51\u7edc\u4e16\u754c\u4e0a\u9068\u6e38\uff0c\u6700\u7ec8\u53d1\u73b0\u4e86 explain extended + show warnings \u5229\u5668\uff0c\u5229\u7528\u5b83\u5feb\u901f\u53d1\u73b0\u4e86\u7d22\u5f15\u5931\u6548\u7684\u6839\u672c\u539f\u56e0\uff0c\u7136\u540e\u5feb\u901f\u627e\u5230\u4e86\u89e3\u51b3\u65b9\u6848\uff1b \u4e0b\u9762\u5c31\u6765\u804a\u804a\u8fd9\u4e2a\u5229\u5668\u7684\u5177\u4f53\u4f7f\u7528\uff0c\u5f00\u68ee\uff01","title":"\u6a21\u62df\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u7684\u573a\u666f\uff1a"},{"location":"database/mysql/index_not_work/#_7","text":"\u6ce8\u610f\uff1aexplain \u540e\u9762\u8ddf\u7684\u5173\u952e\u5b57 EXTENDED\uff08\u6269\u5c55\u4fe1\u606f\uff09 \u5728MySQL5.7\u53ca\u4e4b\u540e\u7684\u7248\u672c\u4e2d\u5e9f\u5f03\u4e86\uff0c\u4f46\u662f\u8be5\u8bed\u6cd5\u4ecd\u88ab\u8bc6\u522b\u4e3a\u5411\u540e\u517c\u5bb9\uff0c\u6240\u4ee5\u57285.7\u7248\u672c\u53ca\u540e\u7eed\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u4e0d\u7528\u5728 explain \u540e\u9762\u6dfb\u52a0 EXTENDED \u4e86\uff1b EXTENDED\u5173\u952e\u5b57\u7684\u5177\u4f53\u67e5\u9605\u8d44\u6599\uff1a https://dev.mysql.com/doc/refman/5.7/en/explain-extended.html \u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a \u2460\u3001\u9996\u5148\u5728MySQL\u7684\u53ef\u89c6\u5316\u5de5\u5177\u4e2d\u6253\u5f00\u4e00\u4e2a \u547d\u4ee4\u5217\u4ecb\u9762 \uff1a\u5de5\u5177 --> \u547d\u4ee4\u5217\u4ecb\u9762 \u2461\u3001\u7136\u540e\u8f93\u5165\u4e0b\u9762\u7684SQL\u5e76\u6309\u56de\u8f66\uff1a explain EXTENDED select * from t_department a LEFT JOIN t_employees b on a.de_no = b.de_no where a.id = 4019; \u2462\u3001\u7136\u540e\u7d27\u63a5\u7740\u8f93\u5165\u547d\u4ee4 show warnings; \u5e76\u56de\u8f66\uff0c\u4f1a\u51fa\u73b0\u5982\u4e0b\u56fe\u6240\u793a\u5185\u5bb9\uff1a \u901a\u8fc7\u5c55\u793a\u51fa\u7684\u6267\u884cSQL\u6269\u5c55\u4fe1\u606f\uff0c\u53d1\u73b0MySQL\u5728\u5b57\u7b26\u96c6\u4e0d\u4e00\u81f4\u65f6\u81ea\u52a8\u6dfb\u52a0\u4e0a\u5b57\u7b26\u96c6\u8f6c\u6362\u51fd\u6570\uff0c\u56e0\u4e3a\u662f\u5728 \u7d22\u5f15\u5b57\u6bb5 de_no \u4e0a\u6dfb\u52a0\u7684\u8f6c\u6362\u51fd\u6570\uff0c\u6240\u4ee5\u5c31\u5bfc\u81f4\u4e86\u7d22\u5f15\u5931\u6548\uff1b \u800c\u5982\u679c\u6211\u4eec\u6ca1\u770b\u6269\u5c55\u4fe1\u606f\u7684\u8bdd\uff0c\u90a3\u4e48\u53ef\u80fd\u76f4\u5230\u6211\u4eec\u67e5\u770b\u8868\u7ed3\u6784\u7684\u65f6\u5019\u624d\u4f1a\u53d1\u73b0\u662f\u7531\u4e8e\u5b57\u7b26\u96c6\u4e0d\u4e00\u81f4\u5bfc\u81f4\u7684\uff0c\u8fd9\u6837\u5c31\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff1b","title":"\u4f7f\u7528\u5229\u5668\u5feb\u901f\u6392\u67e5\u95ee\u9898\uff1a"},{"location":"database/mysql/index_not_work/#_8","text":"\u54b1\u4eec\u804a\u5b8c\u4e0a\u9762\u7684\u9690\u5f0f\u5b57\u7b26\u96c6\u8f6c\u6362\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff0c\u518d\u6765\u7b80\u5355\u804a\u804a\u53e6\u4e00\u79cd \u9690\u5f0f\u7c7b\u578b\u8f6c\u6362 \u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1b \u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff1a\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u5b57\u6bb5\u7684\u7c7b\u578b\u4e0e\u5176\u8d4b\u503c\u7684\u7c7b\u578b\u4e0d\u4e00\u81f4\u65f6\u4f1a\u8fdb\u884c\u9690\u5f0f\u7684\u8f6c\u6362\uff1b \u5c0f\u4f8b\u5982\u4e0b\uff1a select * from t_employees where em_name = 123; \u4e0a\u9762\u7684SQL\u4e2d em_name \u4e3a\u7d22\u5f15\u5b57\u6bb5\uff0c\u5b57\u6bb5\u7c7b\u578b\u662f varchar\uff0c\u4e3a\u5176\u8d4b int \u7c7b\u578b\u7684\u503c\u65f6\uff0c\u4f1a\u53d1\u73b0\u7d22\u5f15\u5931\u6548\uff0c\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u901a\u8fc7 explain extended + show warnings \u67e5\u770b\uff0c\u4f1a\u53d1\u73b0\u5982\u4e0b\u56fe\u6240\u793a\u5185\u5bb9\uff1a \u81f3\u6b64\u672c\u6587\u8fdb\u5165\u7ed3\u5c3e\uff0c\u5728\u6b64\u518d\u8bf4\u660e\u4e0b\uff0c\u4e0a\u6587\u4e2d\u6d4b\u8bd5\u65f6\u4f7f\u7528\u7684MySQL\u7248\u672c\u90fd\u662f 5.7 \uff1b","title":"\u6269\u5c55\uff1a\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362"},{"location":"database/mysql/index_xingneg/","text":"In MySQL, a foreign key requires an index. If an index already exists, the foreign key will use that index (even using the prefix of an existing multi-column index). If no index exists, defining the foreign key will build the index. So the size increase and time to create a foreign key is about the same as to create an index on the same column(s). The performance of a SELECT is not impacted significantly by the presence of a foreign key. Only a slight additional work for the optimizer, to consider the new indexes. The performance of updating is more, because for each foreign key, an INSERT/UPDATE/DELETE has to check to see if the constraint is satisfied. That means a primary key lookup to the referenced tables. This impact is measurable, and it is greater if the referenced tables are not in the buffer pool. Another impact is the locking. If I update a row in a child row that has a foreign key, InnoDB places a shared-lock on the referenced rows in the parent tables. That means no one can update those parent rows until I commit. If you have lots of threads updating child rows, then the parent rows may be locked most of the time, and this can make it hard to do concurrent work in the parent tables. Not so much a performance problem, but a concurrency problem. As with all \"how does that perform\" questions, the answer really depends on your workload. If you don't have concurrent updates, for example, that issue may not effect you for all practical purposes. Testing it yourself with load testing is the only way to be sure. It's not something anyone on StackOverflow can answer precisely for you. \u8bfb\u540e\u5c0f\u7ed3\uff1a 1.\u5916\u952e\u5c31\u60f3\u5176\u4ed6\u7c7b\u578b\u7684\u7d22\u5f15\u4e00\u6837\uff0c\u8981\u8bf4\u6027\u80fd\u65b9\u9762\u7684\u5f71\u54cd\uff0c\u5b83\u5f71\u54cd\u7684\u4e3b\u8981\u662f\u5199\u5165\u64cd\u4f5c(\u5982\uff0cUPDATE/INSERT/DELETE)\uff1b 2.\u4f46\u5b83\u4e0e\u5355\u8868\u7d22\u5f15\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4f1a\u5f15\u7528\u4e00\u5f20\u6216\u591a\u5f20\u7236\u8868\uff0c\u8fd9\u6837\u5f53\u5bf9\u5b50\u8868\u8fdb\u884c\u5199\u5165\u64cd\u4f5c(UPDATE/INSERT)\u7684\u65f6\u5019\uff0c\u7236\u8868\u5c31\u4f1a\u88ab\u52a0\u4e0a\u201c\u5171\u4eab\u9501\u201d\uff0c\u8fd9\u6837\u5728\u5bf9\u5b50\u8868\u9ad8\u5e76\u53d1\u8fdb\u884c\u5199\u5165\u64cd\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7236\u8868\u7684\u5199\u5165\u64cd\u4f5c\u5c31\u4f1a\u7531\u4e8e\u201c\u5171\u4eab\u9501\u201d\u7684\u5b58\u5728\uff0c\u800c\u4f1a\u957f\u65f6\u95f4\u4e0d\u80fd\u5f97\u5230\u66f4\u65b0\uff01\u5f53\u7136\u67e5\u8be2\u662f\u53ef\u4ee5\u7684\u3002 3.\u4f5c\u8005\u7ed9\u51fa\u4e86\u4e00\u4e2a\u89c2\u70b9\uff1a\u5916\u952e\u4e3b\u8981\u9020\u6210\u7684\u95ee\u9898\uff0c\u5e76\u4e0d\u662f\u5f71\u54cd\u6027\u80fd\u591a\u5c11\u7684\u95ee\u9898\uff0c\u800c\u662f\u4e00\u4e2a\u5e76\u53d1\u8bbf\u95ee\u7684\u95ee\u9898\uff01 4.\u6240\u4ee5\u662f\u5426\u4f7f\u7528\u5916\u952e\uff0c\u5173\u952e\u662f\u8981\u770b\u4f60\u5bf9\u5e76\u53d1\u8981\u6c42\u7684\u9ad8\u4f4e\u4e86\uff01","title":"MySQL\u5916\u952e\u5bf9\u6027\u80fd\u5f71\u54cd"},{"location":"database/mysql/interview/","text":"\u539f\u6587\u8fde\u63a5\uff1a MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f_IT\u90a6\u5fb7\u7684\u535a\u5ba2-CSDN\u535a\u5ba2","title":"MySQL\u516b\u80a1\u6587\u8fde\u73af45\u95ee,\u4f60\u80fd\u575a\u6301\u7b2c\u51e0\u95ee\uff1f"},{"location":"database/mysql/varchar_length/","text":"1.MySQL\u5efa\u7acb\u7d22\u5f15\u65f6\u5982\u679c\u6ca1\u6709\u9650\u5236\u7d22\u5f15\u7684\u5927\u5c0f\uff0c\u7d22\u5f15\u957f\u5ea6\u4f1a\u9ed8\u8ba4\u91c7\u7528\u7684\u8be5\u5b57\u6bb5\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u8bf4varchar(20)\u548cvarchar(255)\u5bf9\u5e94\u7684\u7d22\u5f15\u957f\u5ea6\u5206\u522b\u4e3a20 3(utf-8)(+2+1),255 3(utf-8)(+2+1)\uff0c\u5176\u4e2d\"+2\"\u7528\u6765\u5b58\u50a8\u957f\u5ea6\u4fe1\u606f\uff0c\u201c+1\u201d\u7528\u6765\u6807\u8bb0\u662f\u5426\u4e3a\u7a7a\uff0c\u52a0\u8f7d\u7d22\u5f15\u4fe1\u606f\u65f6\u7528varchar(255)\u7c7b\u578b\u4f1a\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58\uff1b \uff08\u5907\u6ce8\uff1a\u5f53\u5b57\u6bb5\u5b9a\u4e49\u4e3a\u975e\u7a7a\u7684\u65f6\u5019\uff0c\u662f\u5426\u4e3a\u7a7a\u7684\u6807\u8bb0\u5c06\u4e0d\u5360\u7528\u5b57\u8282\uff09\u4f8b\u5982\uff0c\u6d4b\u8bd5sql(InnoDB\u5f15\u64ce)\u5982\u4e0b: CREATE DATABASE TestDataBase; USE TestDataBase; CREATE TABLE ABC ( `id` int(11) DEFAULT null, `name` varchar(20) DEFAULT NULL ) ENGINE=InnoDB DEFAULT charset=utf8; ALTER TABLE `ABC` ADD INDEX `nameIndex`(`name`); explain select name from ABC; alter table ABC modify name varchar(255); explain select name from ABC; varchr(10)\u53d8\u957f\u5b57\u6bb5\u4e14\u5141\u8bb8NULL:10*(Character Set\uff1autf8=3,gbk=2,latin1=1)+1(NULL)+2(\u53d8\u957f\u5b57\u6bb5) varchr(10)\u53d8\u957f\u5b57\u6bb5\u4e14\u4e0d\u5141\u8bb8NULL:10*(Character Set\uff1autf8=3,gbk=2,latin1=1)+2(\u53d8\u957f\u5b57\u6bb5) char(10)\u56fa\u5b9a\u5b57\u6bb5\u4e14\u5141\u8bb8NULL:10*(Character Set\uff1autf8=3,gbk=2,latin1=1)+1(NULL) char(10)\u56fa\u5b9a \u5b57\u6bb5\u4e14\u5141\u8bb8NULL:10*(Character Set\uff1autf8=3,gbk=2,latin1=1)\u6839\u636e\u8fd9\u4e2a\u503c\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5\uff0c\u7279\u522b\u662f\u5728\u7ec4\u5408\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u5224\u65ad\u6240\u6709\u7684\u7d22\u5f15\u5b57\u6bb5\u90fd\u88ab\u67e5\u8be2\u7528\u5230\u3002 2.varchar(20)\u4e0evarchar(255)\u90fd\u662f\u4fdd\u6301\u53ef\u53d8\u7684\u5b57\u7b26\u4e32\uff0c\u5f53\u4f7f\u7528ROW_FORMAT=FIXED\u521b\u5efaMyISAM\u8868\u65f6\uff0c\u4f1a\u4e3a\u6bcf\u884c\u4f7f\u7528\u56fa\u5b9a\u7684\u957f\u5ea6\u7a7a\u95f4\uff0c\u8fd9\u6837\u8bbe\u7f6e\u4e0d\u540c\u7684varchar\u957f\u5ea6\u503c\u65f6\uff0c\u5b58\u50a8\u76f8\u540c\u6570\u636e\u6240\u5360\u7528\u7684\u7a7a\u95f4\u662f\u4e0d\u4e00\u6837\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\u4f7f\u7528varchar(20)\u548cvarchar(255)\u4fdd\u6301'hello'\u5360\u7528\u7684\u7a7a\u95f4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u4f7f\u7528\u957f\u5ea6\u8f83\u77ed\u7684\u5217\u5374\u6709\u5de8\u5927\u7684\u4f18\u52bf\u3002\u8f83\u5927\u7684\u5217\u4f7f\u7528\u66f4\u591a\u7684\u5185\u5b58\uff0c\u56e0\u4e3aMySQL\u901a\u5e38\u4f1a\u5206\u914d\u56fa\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u5757\u6765\u4fdd\u5b58\u503c\uff0c\u8fd9\u5bf9\u6392\u5e8f\u6216\u4f7f\u7528\u57fa\u4e8e\u5185\u5b58\u7684\u4e34\u65f6\u8868\u5c24\u5176\u4e0d\u597d\u3002\u540c\u6837\u7684\u4e8b\u60c5\u4e5f\u4f1a\u53d1\u751f\u5728\u4f7f\u7528\u6587\u4ef6\u6392\u5e8f\u6216\u8005\u57fa\u4e8e\u78c1\u76d8\u7684\u4e34\u65f6\u8868\u7684\u65f6\u5019\u3002","title":"mysql varchar  length \u5bf9\u6027\u80fd\u5f71\u54cd\u5206\u6790"},{"location":"framework/","text":"GraphQL \u5b9e\u8df5 GraphQL \u5b9e\u8df5","title":"Index"},{"location":"framework/graphql/","text":"\u7f8e\u56e2\u56fe\u6570\u636e\u5e93\u5e73\u53f0\u5efa\u8bbe\u53ca\u4e1a\u52a1\u5b9e\u8df5 - \u7f8e\u56e2\u6280\u672f\u56e2\u961f (meituan.com)","title":"GraphQL \u5b9e\u8df5"},{"location":"knowledge/","text":"\u4e09\u6b21\u63e1\u624b\u56db\u6b21\u6325\u624b HTTP\u53d1\u5c55\u5386\u53f2 \u67b6\u6784\u9762\u8bd5\u9898 RocketMQ vs RabbitMQ vs Kafka nginx\u77e5\u8bc6\u68b3\u7406 rokcetmq 1 2 auth JWT for stateless authentication Oauth2 for stateless authentication HTTP\u53d1\u5c55\u5386\u53f2 \u67b6\u6784\u9762\u8bd5\u9898 RocketMQ vs RabbitMQ vs Kafka nginx\u77e5\u8bc6\u68b3\u7406 \u4e09\u6b21\u63e1\u624b\u56db\u6b21\u6325\u624b auth JWT for stateless authentication Oauth2 for stateless authentication rokcetmq 1 2","title":"Index"},{"location":"knowledge/http/","text":"HTTP\u53d1\u5c55\u5386\u53f2 HTTP/0.9 HTTP/0.9 \u662f\u4e8e 1991 \u5e74\u63d0\u51fa\u7684\uff0c\u4e3b\u8981\u7528\u4e8e\u5b66\u672f\u4ea4\u6d41\uff0c\u9700\u6c42\u5f88\u7b80\u5355\u2014\u2014\u7528\u6765\u5728\u7f51\u7edc\u4e4b\u95f4\u4f20\u9012 HTML \u8d85\u6587\u672c\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u88ab\u79f0\u4e3a\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u3002\u6574\u4f53\u6765\u770b\uff0c\u5b83\u7684\u5b9e\u73b0\u4e5f\u5f88\u7b80\u5355\uff0c\u91c7\u7528\u4e86\u57fa\u4e8e\u8bf7\u6c42\u54cd\u5e94\u7684\u6a21\u5f0f\uff0c\u4ece\u5ba2\u6237\u7aef\u53d1\u51fa\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\u3002 \u5b8c\u6574\u8bf7\u6c42\u6d41\u7a0b \u56e0\u4e3a HTTP \u90fd\u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u5148\u8981\u6839\u636e IP \u5730\u5740\u3001\u7aef\u53e3\u548c\u670d\u52a1\u5668\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u5c31\u662f TCP \u534f\u8bae\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u3002 \u5efa\u7acb\u597d\u8fde\u63a5\u4e4b\u540e\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a GET \u8bf7\u6c42\u884c\u7684\u4fe1\u606f\uff0c\u5982GET /index.html \u7528\u6765\u83b7\u53d6 index.html\u3002 \u670d\u52a1\u5668\u63a5\u6536\u8bf7\u6c42\u4fe1\u606f\u4e4b\u540e\uff0c\u8bfb\u53d6\u5bf9\u5e94\u7684 HTML \u6587\u4ef6\uff0c\u5e76\u5c06\u6570\u636e\u4ee5 ASCII \u5b57\u7b26\u6d41\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 HTML \u6587\u6863\u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u65ad\u5f00\u8fde\u63a5\u3002 \u7279\u70b9 \u7b2c\u4e00\u4e2a\u662f\u53ea\u6709\u4e00\u4e2a\u8bf7\u6c42\u884c\uff0c\u5e76\u6ca1\u6709 HTTP \u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\uff0c\u56e0\u4e3a\u53ea\u9700\u8981\u4e00\u4e2a\u8bf7\u6c42\u884c\u5c31\u53ef\u4ee5\u5b8c\u6574\u8868\u8fbe\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u662f\u670d\u52a1\u5668\u4e5f\u6ca1\u6709\u8fd4\u56de\u5934\u4fe1\u606f\uff0c\u8fd9\u662f\u56e0\u4e3a\u670d\u52a1\u5668\u7aef\u5e76\u4e0d\u9700\u8981\u544a\u8bc9\u5ba2\u6237\u7aef\u592a\u591a\u4fe1\u606f\uff0c\u53ea\u9700\u8981\u8fd4\u56de\u6570\u636e\u5c31\u53ef\u4ee5\u4e86\u3002 \u7b2c\u4e09\u4e2a\u662f\u8fd4\u56de\u7684\u6587\u4ef6\u5185\u5bb9\u662f\u4ee5 ASCII \u5b57\u7b26\u6d41\u6765\u4f20\u8f93\u7684\uff0c\u56e0\u4e3a\u90fd\u662f HTML \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u6240\u4ee5\u4f7f\u7528 ASCII \u5b57\u8282\u7801\u6765\u4f20\u8f93\u662f\u6700\u5408\u9002\u7684\u3002 HTTP/1.0 HTTP/0.9 \u5b58\u5728\u8bb8\u591a\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u5982\u4e0b\u7684\u8fd9\u4e9b\uff1a \u53ea\u652f\u6301 HTML \u7c7b\u578b\u6587\u4ef6\uff0c\u65e0\u6cd5\u4f20\u8f93 JS\u3001CSS\u3001\u5b57\u4f53\u3001\u56fe\u7247\u548c\u89c6\u9891\u7b49\u7c7b\u578b\u7684\u6587\u4ef6\uff1b \u6587\u4ef6\u4f20\u8f93\u683c\u5f0f\u5c40\u9650\u4e8e ASCII\uff0c\u65e0\u6cd5\u8f93\u51fa\u5176\u4ed6\u7c7b\u578b\u7f16\u7801\u7684\u6587\u4ef6\uff1b \u53ea\u6709\u8bf7\u6c42\u884c\uff0c\u4f20\u8f93\u7ed9\u670d\u52a1\u5668\u7684\u4fe1\u606f\u592a\u5c11\uff1b \u53ea\u54cd\u5e94\u8bf7\u6c42\u6570\u636e\uff0c\u4e0d\u80fd\u4f20\u8f93\u989d\u5916\u7684\u6570\u636e\u7ed9\u6d4f\u89c8\u5668\u3002 \u6240\u4ee5\u5b83\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u5f53\u65f6\u7684\u9700\u6c42\u4e86\uff0c\u4e8e\u662f\u4e4e HTTP/1.0 \u6765\u4e86\uff0c\u5b83\u5e26\u6765\u4e86\u8fd9\u4e9b\uff1a \u65b0\u589e\u4e86\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\uff0c\u80fd\u4f20\u8f93\u66f4\u591a\u7684\u4fe1\u606f\u7ed9\u670d\u52a1\u5668\uff0c\u6bd4\u5982\u5982\u4e0b\u8bf7\u6c42\u5934\u5b57\u6bb5\uff1aAccept \u6587\u4ef6\u7c7b\u578b\uff0cAccept-Encoding \u538b\u7f29\u683c\u5f0f\uff0cAccept-Charset \u5b57\u7b26\u7f16\u7801\u683c\u5f0f\uff0cAccept-Language \u56fd\u9645\u5316\u8bed\u97f3\uff1a Accept: text/html Accept-Encoding: gzip, deflate, br Accept-Charset: ISO-8859-1,utf-8 Accept-Language: zh-CN,zh \u8bf7\u6c42\u5934\u65b0\u589e User-Agent \u5b57\u6bb5\uff0c\u7528\u4e8e\u670d\u52a1\u5668\u7edf\u8ba1\u5ba2\u6237\u7aef\u4fe1\u606f\uff1a User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 \u65b0\u589e\u4e86\u54cd\u5e94\u5934\uff0c\u80fd\u591f\u544a\u8bc9\u6d4f\u89c8\u5668\u66f4\u591a\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 Content-Encoding \u8868\u793a\u670d\u52a1\u5668\u8fd4\u56de\u6587\u4ef6\u7684\u538b\u7f29\u7c7b\u578b\uff0cContent-Type \u544a\u8bc9\u6d4f\u89c8\u5668\u670d\u52a1\u5668\u8fd4\u56de\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u6587\u4ef6\u4ee5\u53ca\u4f7f\u7528\u4e86\u4ec0\u4e48\u7f16\u7801\u683c\u5f0f\uff1a Content-Encoding: gzip Content-Type: text/html; charset=utf-8 \u65b0\u589e\u54cd\u5e94\u884c\u72b6\u6001\u7801\uff0c\u7528\u4e8e\u544a\u77e5\u6d4f\u89c8\u5668\u5f53\u524d\u8bf7\u6c42\u7684\u72b6\u6001\uff0c\u6bd4\u5982 200 \u8868\u793a\u8bf7\u6c42\u6210\u529f\uff1a HTTP/1.1 200 OK \u65b0\u589e\u7f13\u5b58\u673a\u5236\uff0c\u7528\u6765\u7f13\u5b58\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\u7684\u8d44\u6e90\uff0c\u51cf\u8f7b\u4e86\u670d\u52a1\u7aef\u538b\u529b\u3002 \u5728\u6784\u5efa\u8bf7\u6c42\u6d41\u7a0b\u4e0a\u6765\u770b\uff0cHTTP/1.0 \u533a\u522b\u4e8e HTTP/0.9 \u6700\u5927\u7684\u533a\u522b\u5c31\u662f\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u65f6\u5019\u65b0\u589e\u4e86\u4e0d\u5c11\u5b57\u6bb5\u7528\u4e8e\u5728\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u901a\u4fe1\u3002 HTTP/1.1 HTTP/1.0 \u867d\u8bf4\u5df2\u7ecf\u80fd\u591f\u4f20\u8f93\u4e0d\u540c\u7c7b\u578b\u7684\u6587\u4ef6\u4e86\uff0c\u4f46\u662f\u5b83\u8fd8\u662f\u6709\u7f3a\u70b9\u7684\uff0c\u6bd4\u5982\u6bcf\u53d1\u51fa\u4e00\u6b21 HTTP \u8bf7\u6c42\u90fd\u9700\u8981\u7ecf\u5386\u5982\u4e0b\u9636\u6bb5\uff1a \u5efa\u7acb TCP \u8fde\u63a5\uff1b HTTP \u8bf7\u6c42\uff1b HTTP \u54cd\u5e94\uff1b \u65ad\u5f00 TCP \u8fde\u63a5\u3002 HTTP/1.0 \u53d1\u9001\u591a\u4e2a\u540c\u57df\u540d\u8bf7\u6c42\uff1a \u53ef\u4ee5\u53d1\u73b0\u6bcf\u6b21\u8bf7\u6c42\u90fd\u9700\u8981\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u64cd\u4f5c\uff0c\u8fd9\u65e0\u7591\u589e\u52a0\u4e86\u7f51\u7edc\u5f00\u9500\uff0c\u540c\u65f6\u4e5f\u5ef6\u8fdf\u4e86\u9875\u9762\u663e\u793a\u3002 HTTP/1.1 \u5728\u8bf7\u6c42\u5934\u4e2d\u589e\u52a0\u4e86 Connection \u5b57\u6bb5 \uff1a\u7528\u4e8e\u63d0\u4f9b TCP \u7684\u6301\u4e45\u8fde\u63a5**\uff1a Connection: keep-alive \u5b83\u9ed8\u8ba4\u662f\u5f00\u542f\u6301\u4e45\u8fde\u63a5\u7684\uff0c\u5373\u5bf9\u4e8e\u540c\u4e00\u4e2a\u57df\u540d\uff0c\u6d4f\u89c8\u5668\u9ed8\u8ba4\u652f\u6301 6 \u4e2a TCP \u6301\u4e45\u8fde\u63a5\u3002 \u5f53\u542f\u7528\u6301\u4e45\u8fde\u63a5\u540e\uff0c\u591a\u4e2a\u540c\u57df\u540d\u4e0b\u7684\u8bf7\u6c42\u53d1\u9001\u4f1a\u662f\u5982\u4e0b\u60c5\u51b5\uff1a HTTP/1.1 \u4e2d\u65b0\u589e Host \u5b57\u6bb5\uff0c\u7528\u4e8e\u652f\u6301\u865a\u62df\u4e3b\u673a Host: bubuzou.com \u865a\u62df\u4e3b\u673a\uff1a\u4e00\u53f0\u7269\u7406\u673a\u5668\u4e0a\u7ed1\u5b9a\u591a\u4e2a\u865a\u62df\u4e3b\u673a\uff0c\u6bcf\u4e2a\u865a\u62df\u4e3b\u673a\u6709\u5355\u72ec\u7684\u57df\u540d\uff0c\u8fd9\u4e9b\u57df\u540d\u90fd\u516c\u7528\u4e00\u4e2a IP \u5730\u5740\u3002 HTTP/1.1 \u901a\u8fc7\u5f15\u5165 Chunk transfer \u673a\u5236\u6765\u652f\u6301\u52a8\u6001\u5185\u5bb9 \uff1a\u670d\u52a1\u5668\u4f1a\u5c06\u6570\u636e\u5206\u5272\u6210\u82e5\u5e72\u4e2a\u4efb\u610f\u5927\u5c0f\u7684\u6570\u636e\u5757\uff0c\u6bcf\u4e2a\u6570\u636e\u5757\u53d1\u9001\u65f6\u4f1a\u9644\u4e0a\u4e0a\u4e2a\u6570\u636e\u5757\u7684\u957f\u5ea6\uff0c\u6700\u540e\u4f7f\u7528\u4e00\u4e2a\u96f6\u957f\u5ea6\u7684\u5757\u4f5c\u4e3a\u53d1\u9001\u6570\u636e\u5b8c\u6210\u7684\u6807\u5fd7\u3002 HTTP/1.1 \u8fd8\u5f15\u5165\u4e86\u5ba2\u6237\u7aef Cookie \u673a\u5236\u548c\u5b89\u5168\u673a\u5236 HTTP/2 \u6211\u4eec\u77e5\u9053 HTTP/1.1 \u4e3a\u7f51\u7edc\u6548\u7387\u505a\u4e86\u5927\u91cf\u7684\u4f18\u5316\uff0c\u6700\u6838\u5fc3\u7684\u6709\u5982\u4e0b\u4e09\u79cd\u65b9\u5f0f\uff1a \u589e\u52a0\u4e86\u6301\u4e45\u8fde\u63a5\uff1b \u6d4f\u89c8\u5668\u4e3a\u6bcf\u4e2a\u57df\u540d\u6700\u591a\u540c\u65f6\u7ef4\u62a4 6 \u4e2a TCP \u6301\u4e45\u8fde\u63a5\uff1b \u4f7f\u7528 CDN \u7684\u5b9e\u73b0\u57df\u540d\u5206\u7247\u673a\u5236\u3002 HTTP/1.1 \u4e2d\u4f9d\u7136\u5b58\u5728\u7684\u95ee\u9898 \u867d\u7136 HTTP/1.1 \u91c7\u53d6\u4e86\u5f88\u591a\u4f18\u5316\u8d44\u6e90\u52a0\u8f7d\u901f\u5ea6\u7684\u7b56\u7565\uff0c\u4e5f\u53d6\u5f97\u4e86\u4e00\u5b9a\u7684\u6548\u679c\uff0c\u4f46\u662f HTTP/1.1\u5bf9\u5e26\u5bbd\u7684\u5229\u7528\u7387\u5374\u5e76\u4e0d\u7406\u60f3\uff0c\u8fd9\u4e5f\u662f HTTP/1.1 \u7684\u4e00\u4e2a\u6838\u5fc3\u95ee\u9898\u3002 \u5e26\u5bbd\u662f\u6307\u6bcf\u79d2\u6700\u5927\u80fd\u53d1\u9001\u6216\u8005\u63a5\u6536\u7684\u5b57\u8282\u6570\u3002\u6211\u4eec\u628a\u6bcf\u79d2\u80fd\u53d1\u9001\u7684\u6700\u5927\u5b57\u8282\u6570\u79f0\u4e3a\u4e0a\u884c\u5e26\u5bbd\uff0c\u6bcf\u79d2\u80fd\u591f\u63a5\u6536\u7684\u6700\u5927\u5b57\u8282\u6570\u79f0\u4e3a\u4e0b\u884c\u5e26\u5bbd\u3002 \u4e4b\u6240\u4ee5\u8bf4 HTTP/1.1 \u5bf9\u5e26\u5bbd\u7684\u5229\u7528\u7387\u4e0d\u7406\u60f3\uff0c\u662f\u56e0\u4e3a HTTP/1.1 \u5f88\u96be\u5c06\u5e26\u5bbd\u7528\u6ee1\u3002\u6bd4\u5982\u6211\u4eec\u5e38\u8bf4\u7684 100M \u5e26\u5bbd\uff0c\u5b9e\u9645\u7684\u4e0b\u8f7d\u901f\u5ea6\u80fd\u8fbe\u5230 12.5M/S\uff0c\u800c\u91c7\u7528 HTTP/1.1 \u65f6\uff0c\u4e5f\u8bb8\u5728\u52a0\u8f7d\u9875\u9762\u8d44\u6e90\u65f6\u6700\u5927\u53ea\u80fd\u4f7f\u7528\u5230 2.5M/S\uff0c\u5f88\u96be\u5c06 12.5M \u5168\u90e8\u7528\u6ee1\u3002 \u4e4b\u6240\u4ee5\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e3b\u8981\u662f 3 \u4e2a\u95ee\u9898\u5bfc\u81f4\u7684\uff1a \u7b2c\u4e00\u4e2a\u539f\u56e0\uff0cTCP \u7684\u6162\u542f\u52a8 \u4e00\u65e6\u4e00\u4e2a TCP \u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u5c31\u8fdb\u5165\u4e86\u53d1\u9001\u6570\u636e\u72b6\u6001\uff0c\u521a\u5f00\u59cb TCP \u534f\u8bae\u4f1a\u91c7\u7528\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u901f\u5ea6\u53bb\u53d1\u9001\u6570\u636e\uff0c\u7136\u540e\u6162\u6162\u52a0\u5feb\u53d1\u9001\u6570\u636e\u7684\u901f\u5ea6\uff0c\u76f4\u5230\u53d1\u9001\u6570\u636e\u7684\u901f\u5ea6\u8fbe\u5230\u4e00\u4e2a\u7406\u60f3\u72b6\u6001\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u6162\u542f\u52a8\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u60f3\u8c61\u662f\u4e00\u8f86\u8f66\u7684\u542f\u52a8\u8fc7\u7a0b\uff0c\u5f00\u59cb\u7684\u65f6\u5019\u6162\uff0c\u5f53\u901f\u5ea6\u8d77\u6765\u540e\u52a0\u901f\u5c31\u66f4\u5feb\u4e86\u3002 \u800c\u4e4b\u6240\u4ee5\u8bf4\u6162\u542f\u52a8\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\uff0c\u662f\u56e0\u4e3a\u9875\u9762\u4e2d\u5e38\u7528\u7684\u4e00\u4e9b\u5173\u952e\u8d44\u6e90\u6587\u4ef6\u672c\u6765\u5c31\u4e0d\u5927\uff0c\u5982 HTML \u6587\u4ef6\u3001CSS \u6587\u4ef6\u548c JavaScript \u6587\u4ef6\uff0c\u901a\u5e38\u8fd9\u4e9b\u6587\u4ef6\u5728 TCP \u8fde\u63a5\u5efa\u7acb\u597d\u4e4b\u540e\u5c31\u8981\u53d1\u8d77\u8bf7\u6c42\u7684\uff0c\u4f46\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6162\u542f\u52a8\uff0c\u6240\u4ee5\u8017\u8d39\u7684\u65f6\u95f4\u6bd4\u6b63\u5e38\u7684\u65f6\u95f4\u8981\u591a\u5f88\u591a\uff0c\u8fd9\u6837\u5c31\u63a8\u8fdf\u4e86\u5b9d\u8d35\u7684\u9996\u6b21\u6e32\u67d3\u9875\u9762\u7684\u65f6\u957f\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u539f\u56e0\uff0c\u540c\u65f6\u5f00\u542f\u4e86\u591a\u6761 TCP \u8fde\u63a5\uff0c\u90a3\u4e48\u8fd9\u4e9b\u8fde\u63a5\u4f1a\u7ade\u4e89\u56fa\u5b9a\u7684\u5e26\u5bbd \u4f60\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e0b\uff0c\u7cfb\u7edf\u540c\u65f6\u5efa\u7acb\u4e86\u591a\u6761 TCP \u8fde\u63a5\uff0c\u5f53\u5e26\u5bbd\u5145\u8db3\u65f6\uff0c\u6bcf\u6761\u8fde\u63a5\u53d1\u9001\u6216\u8005\u63a5\u6536\u901f\u5ea6\u4f1a\u6162\u6162\u5411\u4e0a\u589e\u52a0\uff1b\u800c\u4e00\u65e6\u5e26\u5bbd\u4e0d\u8db3\u65f6\uff0c\u8fd9\u4e9b TCP \u8fde\u63a5\u53c8\u4f1a\u51cf\u6162\u53d1\u9001\u6216\u8005\u63a5\u6536\u7684\u901f\u5ea6\u3002 \u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u6709\u7684 TCP \u8fde\u63a5\u4e0b\u8f7d\u7684\u662f\u4e00\u4e9b\u5173\u952e\u8d44\u6e90\uff0c\u5982 CSS \u6587\u4ef6\u3001JavaScript \u6587\u4ef6\u7b49\uff0c\u800c\u6709\u7684 TCP \u8fde\u63a5\u4e0b\u8f7d\u7684\u662f\u56fe\u7247\u3001\u89c6\u9891\u7b49\u666e\u901a\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u4f46\u662f\u591a\u6761 TCP \u8fde\u63a5\u4e4b\u95f4\u53c8\u4e0d\u80fd\u534f\u5546\u8ba9\u54ea\u4e9b\u5173\u952e\u8d44\u6e90\u4f18\u5148\u4e0b\u8f7d\uff0c\u8fd9\u6837\u5c31\u6709\u53ef\u80fd\u5f71\u54cd\u90a3\u4e9b\u5173\u952e\u8d44\u6e90\u7684\u4e0b\u8f7d\u901f\u5ea6\u4e86\u3002 \u7b2c\u4e09\u4e2a\u539f\u56e0\uff0cHTTP/1.1 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898 \u6211\u4eec\u77e5\u9053\u5728 HTTP/1.1 \u4e2d\u4f7f\u7528\u6301\u4e45\u8fde\u63a5\u65f6\uff0c\u867d\u7136\u80fd\u516c\u7528\u4e00\u4e2a TCP \u7ba1\u9053\uff0c\u4f46\u662f\u5728\u4e00\u4e2a\u7ba1\u9053\u4e2d\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5728\u5f53\u524d\u7684\u8bf7\u6c42\u6ca1\u6709\u7ed3\u675f\u4e4b\u524d\uff0c\u5176\u4ed6\u7684\u8bf7\u6c42\u53ea\u80fd\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u4e0d\u80fd\u968f\u610f\u5728\u4e00\u4e2a\u7ba1\u9053\u4e2d\u53d1\u9001\u8bf7\u6c42\u548c\u63a5\u6536\u5185\u5bb9\u3002 \u8fd9\u662f\u4e00\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u963b\u585e\u8bf7\u6c42\u7684\u56e0\u7d20\u6709\u5f88\u591a\uff0c\u5e76\u4e14\u90fd\u662f\u4e00\u4e9b\u4e0d\u786e\u5b9a\u6027\u7684\u56e0\u7d20\uff0c\u5047\u5982\u6709\u7684\u8bf7\u6c42\u88ab\u963b\u585e\u4e86 5 \u79d2\uff0c\u90a3\u4e48\u540e\u7eed\u6392\u961f\u7684\u8bf7\u6c42\u90fd\u8981\u5ef6\u8fdf\u7b49\u5f85 5 \u79d2\uff0c\u5728\u8fd9\u4e2a\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e26\u5bbd\u3001CPU \u90fd\u88ab\u767d\u767d\u6d6a\u8d39\u4e86\u3002 HTTP/2 \u7684\u591a\u8def\u590d\u7528 \u4e3a\u4e86\u89e3\u51b3 HTTP/1.1 \u4e2d\u5b58\u5728\u7684\u95ee\u9898\uff0c\u5728 HTTP/2 \u4e2d\u91c7\u7528\u6700\u5177\u98a0\u8986\u6027\u7684\u65b9\u6848\uff1a\u591a\u8def\u590d\u7528\u673a\u5236\u3002 HTTP/2 \u591a\u8def\u590d\u7528\u662f\u4ec0\u4e48 HTTP/2 \u7684\u591a\u8def\u590d\u7528\u673a\u5236\u7528\u7b80\u5355\u7684\u8bdd\u6765\u8bf4\u5c31\u662f\u6d4f\u89c8\u5668\u9488\u5bf9\u540c\u4e00\u57df\u540d\u7684\u8d44\u6e90\uff0c\u53ea\u5efa\u7acb\u4e00\u4e2a TCP \u8fde\u63a5\u901a\u9053\uff0c\u6240\u6709\u7684\u9488\u5bf9\u8fd9\u4e2a\u57df\u540d\u7684\u8bf7\u6c42\u5168\u90e8\u90fd\u5728\u8fd9\u4e2a\u901a\u9053\u4e2d\u5b8c\u6210\uff1b \u9664\u6b64\u4e4b\u5916\uff0c\u6570\u636e\u7684\u4f20\u8f93\u4e0d\u518d\u4f7f\u7528\u6587\u672c\u683c\u5f0f\uff0c\u800c\u662f\u4f1a\u5c06\u5b83\u4eec\u5206\u5272\u4e3a\u66f4\u5c0f\u7684\u6d41\u548c\u5e27\uff0c\u5e76\u5bf9\u4ed6\u4eec\u91c7\u7528\u4e8c\u8fdb\u5236\u683c\u5f0f\u7684\u7f16\u7801\u3002\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u901a\u9053\u4e2d\uff0c\u652f\u6301\u4efb\u610f\u6570\u91cf\u7684\u53cc\u5411\u6570\u636e\u6d41\uff0c\u8fd9\u4e9b\u6570\u636e\u6d41\u662f\u5e76\u884c\u3001\u4e71\u5e8f\u7684\u4e14\u5b83\u4eec\u4e4b\u95f4\u4e92\u4e0d\u5e72\u6270\u3002\u800c\u6570\u636e\u6d41\u4e2d\u4f20\u8f93\u7684\u6570\u636e\u662f\u4e8c\u8fdb\u5236\u5e27\uff0c\u5b83\u662f HTTP/2 \u4e2d\u6570\u636e\u4f20\u8f93\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u4e00\u4e2a\u6d41\u4e2d\u7684\u5e27\u662f\u6309\u7167\u987a\u5e8f\u4f20\u8f93\u7684\uff0c\u4e14\u662f\u5e76\u884c\u7684\uff0c\u6240\u4ee5\u65e0\u9700\u6309\u987a\u5e8f\u7b49\u5f85\u3002 \u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898 \u56e0\u4e3a\u53ea\u4f7f\u7528\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u6240\u4ee5\u51cf\u5c11\u4e86\u7531\u4e8e TCP \u6162\u542f\u52a8\u800c\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u53e6\u5916\u4e5f\u7531\u4e8e\u53ea\u6709\u5355\u6761 TCP \u8fde\u63a5\uff0c\u6240\u4ee5\u4e0d\u5b58\u5728\u4e0d\u540c\u7684 TCP \u4e89\u593a\u7f51\u7edc\u5e26\u5bbd\u7684\u95ee\u9898\u3002 \u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u7ecf\u8fc7\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u540e\uff0c\u4e0d\u518d\u662f\u4e00\u4e2a\u4e2a\u5b8c\u6574\u7684 HTTP \u8bf7\u6c42\u62a5\u6587\uff0c\u800c\u662f\u4e00\u5806\u4e71\u5e8f\u7684\u5e27\uff08\u5373\u4e0d\u540c\u6d41\u7684\u5e27\u662f\u4e71\u7684\uff0c\u4f46\u662f\u540c\u4e00\u6761\u6d41\u7684\u5e27\u6570\u987a\u5e8f\u4f20\u8f93\u7684\uff09\uff0c\u6240\u4ee5\u5c31\u4e0d\u4f1a\u6309\u987a\u5e8f\u4f20\u8f93\uff0c\u4e5f\u5c31\u4e0d\u5b58\u5728\u7b49\u5f85\uff0c\u4ece\u800c\u89e3\u51b3\u4e86 HTTP \u5bf9\u5934\u963b\u585e\u95ee\u9898\u3002 \u662f\u5982\u4f55\u5b9e\u73b0\u7684 \u9996\u5148\uff0c\u6d4f\u89c8\u5668\u51c6\u5907\u597d\u8bf7\u6c42\u6570\u636e\uff0c\u5305\u62ec\u4e86\u8bf7\u6c42\u884c\u3001\u8bf7\u6c42\u5934\u7b49\u4fe1\u606f\uff0c\u5982\u679c\u662f POST \u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd8\u8981\u6709\u8bf7\u6c42\u4f53\u3002 \u8fd9\u4e9b\u6570\u636e\u7ecf\u8fc7\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u5904\u7406\u4e4b\u540e\uff0c\u4f1a\u88ab\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e2a\u5e26\u6709\u8bf7\u6c42 ID \u7f16\u53f7\u7684\u5e27\uff0c\u901a\u8fc7\u534f\u8bae\u6808\u5c06\u8fd9\u4e9b\u5e27\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u3002\u8bf7\u6c42\u5934\u7684\u4fe1\u606f\u5b58\u5728 header \u5e27\u4e2d\uff0c\u800c\u8bf7\u6c42\u4f53\u6570\u636e\u5b58\u5728 data \u5e27\u4e2d\u3002 \u670d\u52a1\u5668\u63a5\u6536\u5230\u6240\u6709\u5e27\u4e4b\u540e\uff0c\u4f1a\u5c06\u6240\u6709\u76f8\u540c ID \u7684\u5e27\u5408\u5e76\u4e3a\u4e00\u6761\u5b8c\u6574\u7684\u8bf7\u6c42\u4fe1\u606f\u3002 \u7136\u540e\u670d\u52a1\u5668\u5904\u7406\u8be5\u6761\u8bf7\u6c42\uff0c\u5e76\u5c06\u5904\u7406\u7684\u54cd\u5e94\u884c\u3001\u54cd\u5e94\u5934\u548c\u54cd\u5e94\u4f53\u5206\u522b\u53d1\u9001\u81f3\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u3002 \u540c\u6837\uff0c\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u4f1a\u5c06\u8fd9\u4e9b\u54cd\u5e94\u6570\u636e\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e2a\u5e26\u6709\u8bf7\u6c42 ID \u7f16\u53f7\u7684\u5e27\uff0c\u7ecf\u8fc7\u534f\u8bae\u6808\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\u3002 \u6d4f\u89c8\u5668\u63a5\u6536\u5230\u54cd\u5e94\u5e27\u4e4b\u540e\uff0c\u4f1a\u6839\u636e ID \u7f16\u53f7\u5c06\u5e27\u7684\u6570\u636e\u63d0\u4ea4\u7ed9\u5bf9\u5e94\u7684\u8bf7\u6c42\u3002 HTTP/2 \u5176\u4ed6\u7279\u6027 1. \u53ef\u4ee5\u8bbe\u7f6e\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7 \u5728\u6d4f\u89c8\u5668\u4e2d\uff0c\u67d0\u4e9b\u6570\u636e\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u6bd4\u5982\u5173\u952e CSS \u6216\u8005 JS\uff0c\u8fd9\u4e9b\u91cd\u8981\u7684\u6570\u636e\u5982\u679c\u6bd4\u8f83\u665a\u624d\u63a8\u9001\u5230\u6d4f\u89c8\u5668\uff0c\u90a3\u4e48\u5bf9\u7528\u6237\u6765\u8bf4\u80af\u5b9a\u662f\u4e00\u4e2a\u4e0d\u597d\u7684\u4f53\u9a8c\u3002 \u6240\u4ee5 HTTP/2 \u4e2d\u53ef\u4ee5\u652f\u6301\u8bbe\u7f6e\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\uff0c\u8fd9\u6837\u670d\u52a1\u5668\u6536\u5230\u9ad8\u4f18\u5148\u7ea7\u7684\u8bf7\u6c42\u540e\uff0c\u4f1a\u4f18\u5148\u5904\u7406\u3002 2. \u670d\u52a1\u5668\u63a8\u9001 \u5728 HTTP/2 \u4e2d\u670d\u52a1\u5668\u89e3\u6790\u5230\u4e00\u4e2a HTML \u9875\u9762\u540e\uff0c\u670d\u52a1\u5668\u77e5\u9053\u6d4f\u89c8\u5668\u9700\u8981\u8fd9\u4e2a\u9875\u9762\u4e0a\u5f15\u7528\u5230\u7684\u8d44\u6e90\uff0c\u6bd4\u5982 CSS \u548c JS\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u5c31\u4f1a\u4e3b\u52a8\u7684\u628a\u8fd9\u4e9b\u8d44\u6e90\u4e00\u5e76\u63a8\u9001\u7ed9\u6d4f\u89c8\u5668\uff0c\u51cf\u5c11\u5ba2\u6237\u7aef\u7684\u7b49\u5f85\u65f6\u95f4\u3002 3. \u5934\u90e8\u538b\u7f29 HTTP/2 \u4f7f\u7528 HPACK \u538b\u7f29\u7b97\u6cd5\u5bf9\u8bf7\u6c42\u5934\u548c\u54cd\u5e94\u5934\u8fdb\u884c\u538b\u7f29\uff0c\u867d\u7136\u5355\u4e2a\u8bf7\u6c42\u538b\u7f29\u4e4b\u540e\u6548\u679c\u4e0d\u662f\u5f88\u660e\u663e\uff0c\u4f46\u662f\u5982\u679c\u4e00\u4e2a\u9875\u9762\u6709 100 \u4e2a\u8bf7\u6c42\uff0c\u90a3\u6bcf\u4e2a\u8bf7\u6c42\u538b\u7f29 20% \u4e4b\u540e\uff0c\u90a3\u63d0\u901f\u6548\u679c\u5c31\u5f88\u660e\u663e\u4e86\u3002 \u800c HPACK \u7684\u538b\u7f29\u539f\u7406\u5176\u5b9e\u5c31\u662f 2 \u70b9\uff1a \u5b83\u8981\u6c42\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e24\u8005\u90fd\u7ef4\u62a4\u548c\u66f4\u65b0\u5148\u524d\u770b\u5230\u7684\u62a5\u5934\u5b57\u6bb5\u7684\u7d22\u5f15\u5217\u8868\uff08\u5373\uff0c\u5efa\u7acb\u5171\u4eab\u7684\u538b\u7f29\u4e0a\u4e0b\u6587\uff09\uff0c\u7136\u540e\u5c06\u8be5\u5217\u8868\u7528\u4f5c\u6709\u6548\u7f16\u7801\u5148\u524d\u4f20\u8f93\u7684\u503c\u7684\u53c2\u8003\u3002\u5728\u5b9e\u9645\u4f20\u8f93\u7684\u65f6\u5019\u7528\u7d22\u5f15\u4ee3\u66ff\u6bcf\u4e00\u4fa7\u7684\u9759\u6001\u6216\u52a8\u6001\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u5b57\u6bb5\uff0c\u4ece\u800c\u51cf\u5c0f\u6bcf\u4e2a\u8bf7\u6c42\u7684\u5927\u5c0f\u3002 \u5b83\u5141\u8bb8\u901a\u8fc7\u9759\u6001\u970d\u592b\u66fc\u7801\u5bf9\u53d1\u9001\u7684\u6807\u5934\u5b57\u6bb5\u8fdb\u884c\u7f16\u7801\uff0c\u4ece\u800c\u51cf\u5c0f\u4e86\u5b83\u4eec\u5404\u81ea\u7684\u4f20\u8f93\u5927\u5c0f\u3002 HTTP/3 HTTP/2 \u4f9d\u7136\u662f\u57fa\u4e8e TCP \u7684\uff0c\u6240\u4ee5\u8fd8\u5b58\u5728\u4ee5\u4e0b\u4e00\u4e9b\u95ee\u9898\u3002 TCP \u7684\u961f\u5934\u963b\u585e HTTP/2 \u4e2d\u591a\u4e2a\u8bf7\u6c42\u662f\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u7684\uff0c\u5982\u679c\u67d0\u4e2a\u6570\u636e\u6d41\u4e2d\u51fa\u73b0\u4e86\u4e22\u5305\u7684\u60c5\u51b5\uff0c\u5c31\u4f1a\u963b\u585e\u8be5 TCP \u8fde\u63a5\u4e2d\u7684\u6240\u6709\u8bf7\u6c42\u3002\u8fd9\u4e2a\u548c HTTP/1.1 \u4e2d\u7684\u4e0d\u540c\uff0c\u5728 HTTP/1.1 \u4e2d\uff0c\u7531\u4e8e\u6d4f\u89c8\u5668\u4e3a\u6bcf\u4e2a\u57df\u540d\u5efa\u7acb\u4e86 6 \u4e2a TCP \u8fde\u63a5\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u4e2a TCP \u8fde\u63a5\u53d1\u751f\u4e86\u961f\u5934\u963b\u585e\uff0c\u90a3\u4e48\u5176\u4ed6\u7684 5 \u4e2a\u8fde\u63a5\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u4f20\u8f93\u6570\u636e\u3002 TCP \u5efa\u7acb\u8fde\u63a5\u7684\u5ef6\u65f6 \u5728\u4f20\u8f93\u6570\u636e\u4e4b\u524d\uff0c\u9700\u8981\u8fdb\u884c TCP \u7684 3 \u6b21\u63e1\u624b\uff0c\u9700\u8981\u82b1\u8d39 1.5 \u4e2a RTT\uff1b\u5982\u679c\u662f HTTPS\uff0c\u90a3\u8fd8\u9700\u8981\u8fdb\u884c TLS \u8fde\u63a5\uff0c\u53c8\u9700\u8981 1 ~ 2 \u4e2a RTT\u3002 \u7f51\u7edc\u5ef6\u8fdf\u53c8\u53eb RTT(Round Trip Time)\uff0c\u662f\u4ece\u6d4f\u89c8\u5668\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5305\u5230\u670d\u52a1\u5668\uff0c\u518d\u4ece\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\u5305\u5230\u6d4f\u89c8\u5668\u7684\u6574\u4e2a\u5f80\u8fd4\u65f6\u95f4\u3002 \u603b\u4e4b\uff0c\u5728\u4f20\u8f93\u6570\u636e\u4e4b\u524d\u9700\u8981\u82b1\u6389 3 ~ 4 \u4e2a RTT\u3002\u5982\u679c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8ddd\u79bb\u8fd1\u7684\u8bdd\uff0c\u90a3 1 \u4e2a RTT \u5927\u6982\u662f 10ms\uff0c\u4f46\u5982\u679c\u8fdc\u7684\u8bdd\uff0c\u53ef\u80fd\u662f 100ms\uff0c\u6240\u4ee5\u4f20\u8f93\u6570\u636e\u4e4b\u524d\u9700\u8981\u82b1\u6389 300ms \u5de6\u53f3\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u80fd\u611f\u89c9\u5230\u6162\u4e86\u3002 TCP \u534f\u8bae\u50f5\u5316 \u6211\u4eec\u77e5\u9053 TCP \u534f\u8bae\u5b58\u5728\u961f\u5934\u963b\u585e\u548c\u5efa\u7acb\u8fde\u63a5\u5ef6\u8fdf\u7684\u95ee\u9898\uff0c\u4f46\u662f\u53c8\u6ca1\u529e\u6cd5\u6539\u8fdb TCP \u534f\u8bae\uff0c\u7406\u7531\u6709\u5982\u4e0b 2 \u4e2a\uff1a \u4e2d\u95f4\u8bbe\u5907\u50f5\u5316\u3002\u4e2d\u95f4\u8bbe\u5907\u6bd4\u5982\u8def\u7531\u5668\u3001\u4ea4\u6362\u673a\u3001\u9632\u706b\u5899\u548c NAT \u7b49\uff0c\u8fd9\u4e9b\u8bbe\u5907\u4f9d\u8d56\u7684\u8f6f\u4ef6\u4f7f\u7528\u4e86\u5927\u91cf\u7684 TCP \u7279\u6027\uff0c\u4e00\u65e6\u529f\u80fd\u88ab\u8bbe\u7f6e\u540e\u5c31\u5f88\u5c11\u8fdb\u884c\u66f4\u65b0\u4e86\u3002\u5982\u679c\u5728\u5ba2\u6237\u7aef\u8fdb\u884c\u5347\u7ea7 TCP \u534f\u8bae\uff0c\u90a3\u4e48\u5f53\u65b0\u534f\u8bae\u7684\u6570\u636e\u5305\u7ecf\u8fc7\u8fd9\u4e9b\u8bbe\u5907\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u4e0d\u7406\u89e3\u5305\u7684\u5185\u5bb9\uff0c\u9020\u6210\u6570\u636e\u4e22\u5931\u3002 \u64cd\u4f5c\u7cfb\u7edf\u4e5f\u662f\u5bfc\u81f4 TCP \u534f\u8bae\u50f5\u5316\u7684\u53e6\u5916\u4e00\u4e2a\u539f\u56e0\u3002 QUIC \u534f\u8bae HTTP/3 \u662f\u57fa\u4e8e UDP \u5b9e\u73b0\u7684\uff0c\u5b9e\u73b0\u4e86\u7c7b\u4f3c\u4e8e TCP \u7684\u591a\u8def\u6570\u636e\u6d41\u3001\u4f20\u8f93\u53ef\u9760\u6027\u7b49\u529f\u80fd\uff0c\u6211\u4eec\u628a\u8fd9\u5957\u529f\u80fd\u79f0\u4e3a QUIC \u534f\u8bae\u3002 \u5b9e\u73b0\u4e86\u7c7b\u4f3c TCP \u7684\u6d41\u91cf\u63a7\u5236\u3001\u4f20\u8f93\u53ef\u9760\u6027\u7684\u529f\u80fd\u3002\u867d\u7136 UDP \u4e0d\u63d0\u4f9b\u53ef\u9760\u6027\u7684\u4f20\u8f93\uff0c\u4f46 QUIC \u5728 UDP \u7684\u57fa\u7840\u4e4b\u4e0a\u589e\u52a0\u4e86\u4e00\u5c42\u6765\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u4f20\u8f93\u3002\u5b83\u63d0\u4f9b\u4e86\u6570\u636e\u5305\u91cd\u4f20\u3001\u62e5\u585e\u63a7\u5236\u4ee5\u53ca\u5176\u4ed6\u4e00\u4e9b TCP \u4e2d\u5b58\u5728\u7684\u7279\u6027\u3002 \u96c6\u6210\u4e86 TLS \u52a0\u5bc6\u529f\u80fd\u3002\u76ee\u524d QUIC \u4f7f\u7528\u7684\u662f TLS1.3\uff0c\u76f8\u8f83\u4e8e\u65e9\u671f\u7248\u672c TLS1.3 \u6709\u66f4\u591a\u7684\u4f18\u70b9\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u70b9\u662f\u51cf\u5c11\u4e86\u63e1\u624b\u6240\u82b1\u8d39\u7684 RTT \u4e2a\u6570\u3002 \u5b9e\u73b0\u4e86 HTTP/2 \u4e2d\u7684\u591a\u8def\u590d\u7528\u529f\u80fd\u3002\u548c TCP \u4e0d\u540c\uff0cQUIC \u5b9e\u73b0\u4e86\u5728\u540c\u4e00\u7269\u7406\u8fde\u63a5\u4e0a\u53ef\u4ee5\u6709\u591a\u4e2a\u72ec\u7acb\u7684\u903b\u8f91\u6570\u636e\u6d41\uff08\u5982\u4e0b\u56fe\uff09\u3002\u5b9e\u73b0\u4e86\u6570\u636e\u6d41\u7684\u5355\u72ec\u4f20\u8f93\uff0c\u5c31\u89e3\u51b3\u4e86 TCP \u4e2d\u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u3002 \u5b9e\u73b0\u4e86\u5feb\u901f\u63e1\u624b\u529f\u80fd\u3002\u7531\u4e8e QUIC \u662f\u57fa\u4e8e UDP \u7684\uff0c\u6240\u4ee5 QUIC \u53ef\u4ee5\u5b9e\u73b0\u4f7f\u7528 0-RTT \u6216\u8005 1-RTT \u6765\u5efa\u7acb\u8fde\u63a5\uff0c\u8fd9\u610f\u5473\u7740 QUIC \u53ef\u4ee5\u7528\u6700\u5feb\u7684\u901f\u5ea6\u6765\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u63d0\u5347\u9996\u6b21\u6253\u5f00\u9875\u9762\u7684\u901f\u5ea6\u3002 HTTP/3 \u7684\u6311\u6218 \u7b2c\u4e00\uff0c\u4ece\u76ee\u524d\u7684\u60c5\u51b5\u6765\u770b\uff0c\u670d\u52a1\u5668\u548c\u6d4f\u89c8\u5668\u7aef\u90fd\u6ca1\u6709\u5bf9 HTTP/3 \u63d0\u4f9b\u6bd4\u8f83\u5b8c\u6574\u7684\u652f\u6301\u3002Chrome \u867d\u7136\u5728\u6570\u5e74\u524d\u5c31\u5f00\u59cb\u652f\u6301 Google \u7248\u672c\u7684 QUIC\uff0c\u4f46\u662f\u8fd9\u4e2a\u7248\u672c\u7684 QUIC \u548c\u5b98\u65b9\u7684 QUIC \u5b58\u5728\u7740\u975e\u5e38\u5927\u7684\u5dee\u5f02\u3002 \u7b2c\u4e8c\uff0c\u90e8\u7f72 HTTP/3 \u4e5f\u5b58\u5728\u7740\u975e\u5e38\u5927\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u7cfb\u7edf\u5185\u6838\u5bf9 UDP \u7684\u4f18\u5316\u8fdc\u8fdc\u6ca1\u6709\u8fbe\u5230 TCP \u7684\u4f18\u5316\u7a0b\u5ea6\uff0c\u8fd9\u4e5f\u662f\u963b\u788d QUIC \u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u3002 \u7b2c\u4e09\uff0c\u4e2d\u95f4\u8bbe\u5907\u50f5\u5316\u7684\u95ee\u9898\u3002\u8fd9\u4e9b\u8bbe\u5907\u5bf9 UDP \u7684\u4f18\u5316\u7a0b\u5ea6\u8fdc\u8fdc\u4f4e\u4e8e TCP\uff0c\u636e\u7edf\u8ba1\u4f7f\u7528 QUIC \u534f\u8bae\u65f6\uff0c\u5927\u7ea6\u6709 3%\uff5e7% \u7684\u4e22\u5305\u7387\u3002","title":"HTTP\u53d1\u5c55\u5386\u53f2"},{"location":"knowledge/http/#http","text":"","title":"HTTP\u53d1\u5c55\u5386\u53f2"},{"location":"knowledge/http/#http09","text":"HTTP/0.9 \u662f\u4e8e 1991 \u5e74\u63d0\u51fa\u7684\uff0c\u4e3b\u8981\u7528\u4e8e\u5b66\u672f\u4ea4\u6d41\uff0c\u9700\u6c42\u5f88\u7b80\u5355\u2014\u2014\u7528\u6765\u5728\u7f51\u7edc\u4e4b\u95f4\u4f20\u9012 HTML \u8d85\u6587\u672c\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u88ab\u79f0\u4e3a\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u3002\u6574\u4f53\u6765\u770b\uff0c\u5b83\u7684\u5b9e\u73b0\u4e5f\u5f88\u7b80\u5355\uff0c\u91c7\u7528\u4e86\u57fa\u4e8e\u8bf7\u6c42\u54cd\u5e94\u7684\u6a21\u5f0f\uff0c\u4ece\u5ba2\u6237\u7aef\u53d1\u51fa\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\u3002","title":"HTTP/0.9"},{"location":"knowledge/http/#_1","text":"\u56e0\u4e3a HTTP \u90fd\u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u5148\u8981\u6839\u636e IP \u5730\u5740\u3001\u7aef\u53e3\u548c\u670d\u52a1\u5668\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u5c31\u662f TCP \u534f\u8bae\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u3002 \u5efa\u7acb\u597d\u8fde\u63a5\u4e4b\u540e\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a GET \u8bf7\u6c42\u884c\u7684\u4fe1\u606f\uff0c\u5982GET /index.html \u7528\u6765\u83b7\u53d6 index.html\u3002 \u670d\u52a1\u5668\u63a5\u6536\u8bf7\u6c42\u4fe1\u606f\u4e4b\u540e\uff0c\u8bfb\u53d6\u5bf9\u5e94\u7684 HTML \u6587\u4ef6\uff0c\u5e76\u5c06\u6570\u636e\u4ee5 ASCII \u5b57\u7b26\u6d41\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 HTML \u6587\u6863\u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u65ad\u5f00\u8fde\u63a5\u3002","title":"\u5b8c\u6574\u8bf7\u6c42\u6d41\u7a0b"},{"location":"knowledge/http/#_2","text":"\u7b2c\u4e00\u4e2a\u662f\u53ea\u6709\u4e00\u4e2a\u8bf7\u6c42\u884c\uff0c\u5e76\u6ca1\u6709 HTTP \u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\uff0c\u56e0\u4e3a\u53ea\u9700\u8981\u4e00\u4e2a\u8bf7\u6c42\u884c\u5c31\u53ef\u4ee5\u5b8c\u6574\u8868\u8fbe\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u662f\u670d\u52a1\u5668\u4e5f\u6ca1\u6709\u8fd4\u56de\u5934\u4fe1\u606f\uff0c\u8fd9\u662f\u56e0\u4e3a\u670d\u52a1\u5668\u7aef\u5e76\u4e0d\u9700\u8981\u544a\u8bc9\u5ba2\u6237\u7aef\u592a\u591a\u4fe1\u606f\uff0c\u53ea\u9700\u8981\u8fd4\u56de\u6570\u636e\u5c31\u53ef\u4ee5\u4e86\u3002 \u7b2c\u4e09\u4e2a\u662f\u8fd4\u56de\u7684\u6587\u4ef6\u5185\u5bb9\u662f\u4ee5 ASCII \u5b57\u7b26\u6d41\u6765\u4f20\u8f93\u7684\uff0c\u56e0\u4e3a\u90fd\u662f HTML \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u6240\u4ee5\u4f7f\u7528 ASCII \u5b57\u8282\u7801\u6765\u4f20\u8f93\u662f\u6700\u5408\u9002\u7684\u3002","title":"\u7279\u70b9"},{"location":"knowledge/http/#http10","text":"HTTP/0.9 \u5b58\u5728\u8bb8\u591a\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u5982\u4e0b\u7684\u8fd9\u4e9b\uff1a \u53ea\u652f\u6301 HTML \u7c7b\u578b\u6587\u4ef6\uff0c\u65e0\u6cd5\u4f20\u8f93 JS\u3001CSS\u3001\u5b57\u4f53\u3001\u56fe\u7247\u548c\u89c6\u9891\u7b49\u7c7b\u578b\u7684\u6587\u4ef6\uff1b \u6587\u4ef6\u4f20\u8f93\u683c\u5f0f\u5c40\u9650\u4e8e ASCII\uff0c\u65e0\u6cd5\u8f93\u51fa\u5176\u4ed6\u7c7b\u578b\u7f16\u7801\u7684\u6587\u4ef6\uff1b \u53ea\u6709\u8bf7\u6c42\u884c\uff0c\u4f20\u8f93\u7ed9\u670d\u52a1\u5668\u7684\u4fe1\u606f\u592a\u5c11\uff1b \u53ea\u54cd\u5e94\u8bf7\u6c42\u6570\u636e\uff0c\u4e0d\u80fd\u4f20\u8f93\u989d\u5916\u7684\u6570\u636e\u7ed9\u6d4f\u89c8\u5668\u3002 \u6240\u4ee5\u5b83\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u5f53\u65f6\u7684\u9700\u6c42\u4e86\uff0c\u4e8e\u662f\u4e4e HTTP/1.0 \u6765\u4e86\uff0c\u5b83\u5e26\u6765\u4e86\u8fd9\u4e9b\uff1a \u65b0\u589e\u4e86\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\uff0c\u80fd\u4f20\u8f93\u66f4\u591a\u7684\u4fe1\u606f\u7ed9\u670d\u52a1\u5668\uff0c\u6bd4\u5982\u5982\u4e0b\u8bf7\u6c42\u5934\u5b57\u6bb5\uff1aAccept \u6587\u4ef6\u7c7b\u578b\uff0cAccept-Encoding \u538b\u7f29\u683c\u5f0f\uff0cAccept-Charset \u5b57\u7b26\u7f16\u7801\u683c\u5f0f\uff0cAccept-Language \u56fd\u9645\u5316\u8bed\u97f3\uff1a Accept: text/html Accept-Encoding: gzip, deflate, br Accept-Charset: ISO-8859-1,utf-8 Accept-Language: zh-CN,zh \u8bf7\u6c42\u5934\u65b0\u589e User-Agent \u5b57\u6bb5\uff0c\u7528\u4e8e\u670d\u52a1\u5668\u7edf\u8ba1\u5ba2\u6237\u7aef\u4fe1\u606f\uff1a User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 \u65b0\u589e\u4e86\u54cd\u5e94\u5934\uff0c\u80fd\u591f\u544a\u8bc9\u6d4f\u89c8\u5668\u66f4\u591a\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 Content-Encoding \u8868\u793a\u670d\u52a1\u5668\u8fd4\u56de\u6587\u4ef6\u7684\u538b\u7f29\u7c7b\u578b\uff0cContent-Type \u544a\u8bc9\u6d4f\u89c8\u5668\u670d\u52a1\u5668\u8fd4\u56de\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u6587\u4ef6\u4ee5\u53ca\u4f7f\u7528\u4e86\u4ec0\u4e48\u7f16\u7801\u683c\u5f0f\uff1a Content-Encoding: gzip Content-Type: text/html; charset=utf-8 \u65b0\u589e\u54cd\u5e94\u884c\u72b6\u6001\u7801\uff0c\u7528\u4e8e\u544a\u77e5\u6d4f\u89c8\u5668\u5f53\u524d\u8bf7\u6c42\u7684\u72b6\u6001\uff0c\u6bd4\u5982 200 \u8868\u793a\u8bf7\u6c42\u6210\u529f\uff1a HTTP/1.1 200 OK \u65b0\u589e\u7f13\u5b58\u673a\u5236\uff0c\u7528\u6765\u7f13\u5b58\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\u7684\u8d44\u6e90\uff0c\u51cf\u8f7b\u4e86\u670d\u52a1\u7aef\u538b\u529b\u3002 \u5728\u6784\u5efa\u8bf7\u6c42\u6d41\u7a0b\u4e0a\u6765\u770b\uff0cHTTP/1.0 \u533a\u522b\u4e8e HTTP/0.9 \u6700\u5927\u7684\u533a\u522b\u5c31\u662f\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u65f6\u5019\u65b0\u589e\u4e86\u4e0d\u5c11\u5b57\u6bb5\u7528\u4e8e\u5728\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u901a\u4fe1\u3002","title":"HTTP/1.0"},{"location":"knowledge/http/#http11","text":"HTTP/1.0 \u867d\u8bf4\u5df2\u7ecf\u80fd\u591f\u4f20\u8f93\u4e0d\u540c\u7c7b\u578b\u7684\u6587\u4ef6\u4e86\uff0c\u4f46\u662f\u5b83\u8fd8\u662f\u6709\u7f3a\u70b9\u7684\uff0c\u6bd4\u5982\u6bcf\u53d1\u51fa\u4e00\u6b21 HTTP \u8bf7\u6c42\u90fd\u9700\u8981\u7ecf\u5386\u5982\u4e0b\u9636\u6bb5\uff1a \u5efa\u7acb TCP \u8fde\u63a5\uff1b HTTP \u8bf7\u6c42\uff1b HTTP \u54cd\u5e94\uff1b \u65ad\u5f00 TCP \u8fde\u63a5\u3002 HTTP/1.0 \u53d1\u9001\u591a\u4e2a\u540c\u57df\u540d\u8bf7\u6c42\uff1a \u53ef\u4ee5\u53d1\u73b0\u6bcf\u6b21\u8bf7\u6c42\u90fd\u9700\u8981\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u64cd\u4f5c\uff0c\u8fd9\u65e0\u7591\u589e\u52a0\u4e86\u7f51\u7edc\u5f00\u9500\uff0c\u540c\u65f6\u4e5f\u5ef6\u8fdf\u4e86\u9875\u9762\u663e\u793a\u3002 HTTP/1.1 \u5728\u8bf7\u6c42\u5934\u4e2d\u589e\u52a0\u4e86 Connection \u5b57\u6bb5 \uff1a\u7528\u4e8e\u63d0\u4f9b TCP \u7684\u6301\u4e45\u8fde\u63a5**\uff1a Connection: keep-alive \u5b83\u9ed8\u8ba4\u662f\u5f00\u542f\u6301\u4e45\u8fde\u63a5\u7684\uff0c\u5373\u5bf9\u4e8e\u540c\u4e00\u4e2a\u57df\u540d\uff0c\u6d4f\u89c8\u5668\u9ed8\u8ba4\u652f\u6301 6 \u4e2a TCP \u6301\u4e45\u8fde\u63a5\u3002 \u5f53\u542f\u7528\u6301\u4e45\u8fde\u63a5\u540e\uff0c\u591a\u4e2a\u540c\u57df\u540d\u4e0b\u7684\u8bf7\u6c42\u53d1\u9001\u4f1a\u662f\u5982\u4e0b\u60c5\u51b5\uff1a HTTP/1.1 \u4e2d\u65b0\u589e Host \u5b57\u6bb5\uff0c\u7528\u4e8e\u652f\u6301\u865a\u62df\u4e3b\u673a Host: bubuzou.com \u865a\u62df\u4e3b\u673a\uff1a\u4e00\u53f0\u7269\u7406\u673a\u5668\u4e0a\u7ed1\u5b9a\u591a\u4e2a\u865a\u62df\u4e3b\u673a\uff0c\u6bcf\u4e2a\u865a\u62df\u4e3b\u673a\u6709\u5355\u72ec\u7684\u57df\u540d\uff0c\u8fd9\u4e9b\u57df\u540d\u90fd\u516c\u7528\u4e00\u4e2a IP \u5730\u5740\u3002 HTTP/1.1 \u901a\u8fc7\u5f15\u5165 Chunk transfer \u673a\u5236\u6765\u652f\u6301\u52a8\u6001\u5185\u5bb9 \uff1a\u670d\u52a1\u5668\u4f1a\u5c06\u6570\u636e\u5206\u5272\u6210\u82e5\u5e72\u4e2a\u4efb\u610f\u5927\u5c0f\u7684\u6570\u636e\u5757\uff0c\u6bcf\u4e2a\u6570\u636e\u5757\u53d1\u9001\u65f6\u4f1a\u9644\u4e0a\u4e0a\u4e2a\u6570\u636e\u5757\u7684\u957f\u5ea6\uff0c\u6700\u540e\u4f7f\u7528\u4e00\u4e2a\u96f6\u957f\u5ea6\u7684\u5757\u4f5c\u4e3a\u53d1\u9001\u6570\u636e\u5b8c\u6210\u7684\u6807\u5fd7\u3002 HTTP/1.1 \u8fd8\u5f15\u5165\u4e86\u5ba2\u6237\u7aef Cookie \u673a\u5236\u548c\u5b89\u5168\u673a\u5236","title":"HTTP/1.1"},{"location":"knowledge/http/#http2","text":"\u6211\u4eec\u77e5\u9053 HTTP/1.1 \u4e3a\u7f51\u7edc\u6548\u7387\u505a\u4e86\u5927\u91cf\u7684\u4f18\u5316\uff0c\u6700\u6838\u5fc3\u7684\u6709\u5982\u4e0b\u4e09\u79cd\u65b9\u5f0f\uff1a \u589e\u52a0\u4e86\u6301\u4e45\u8fde\u63a5\uff1b \u6d4f\u89c8\u5668\u4e3a\u6bcf\u4e2a\u57df\u540d\u6700\u591a\u540c\u65f6\u7ef4\u62a4 6 \u4e2a TCP \u6301\u4e45\u8fde\u63a5\uff1b \u4f7f\u7528 CDN \u7684\u5b9e\u73b0\u57df\u540d\u5206\u7247\u673a\u5236\u3002","title":"HTTP/2"},{"location":"knowledge/http/#http11_1","text":"\u867d\u7136 HTTP/1.1 \u91c7\u53d6\u4e86\u5f88\u591a\u4f18\u5316\u8d44\u6e90\u52a0\u8f7d\u901f\u5ea6\u7684\u7b56\u7565\uff0c\u4e5f\u53d6\u5f97\u4e86\u4e00\u5b9a\u7684\u6548\u679c\uff0c\u4f46\u662f HTTP/1.1\u5bf9\u5e26\u5bbd\u7684\u5229\u7528\u7387\u5374\u5e76\u4e0d\u7406\u60f3\uff0c\u8fd9\u4e5f\u662f HTTP/1.1 \u7684\u4e00\u4e2a\u6838\u5fc3\u95ee\u9898\u3002 \u5e26\u5bbd\u662f\u6307\u6bcf\u79d2\u6700\u5927\u80fd\u53d1\u9001\u6216\u8005\u63a5\u6536\u7684\u5b57\u8282\u6570\u3002\u6211\u4eec\u628a\u6bcf\u79d2\u80fd\u53d1\u9001\u7684\u6700\u5927\u5b57\u8282\u6570\u79f0\u4e3a\u4e0a\u884c\u5e26\u5bbd\uff0c\u6bcf\u79d2\u80fd\u591f\u63a5\u6536\u7684\u6700\u5927\u5b57\u8282\u6570\u79f0\u4e3a\u4e0b\u884c\u5e26\u5bbd\u3002 \u4e4b\u6240\u4ee5\u8bf4 HTTP/1.1 \u5bf9\u5e26\u5bbd\u7684\u5229\u7528\u7387\u4e0d\u7406\u60f3\uff0c\u662f\u56e0\u4e3a HTTP/1.1 \u5f88\u96be\u5c06\u5e26\u5bbd\u7528\u6ee1\u3002\u6bd4\u5982\u6211\u4eec\u5e38\u8bf4\u7684 100M \u5e26\u5bbd\uff0c\u5b9e\u9645\u7684\u4e0b\u8f7d\u901f\u5ea6\u80fd\u8fbe\u5230 12.5M/S\uff0c\u800c\u91c7\u7528 HTTP/1.1 \u65f6\uff0c\u4e5f\u8bb8\u5728\u52a0\u8f7d\u9875\u9762\u8d44\u6e90\u65f6\u6700\u5927\u53ea\u80fd\u4f7f\u7528\u5230 2.5M/S\uff0c\u5f88\u96be\u5c06 12.5M \u5168\u90e8\u7528\u6ee1\u3002 \u4e4b\u6240\u4ee5\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e3b\u8981\u662f 3 \u4e2a\u95ee\u9898\u5bfc\u81f4\u7684\uff1a \u7b2c\u4e00\u4e2a\u539f\u56e0\uff0cTCP \u7684\u6162\u542f\u52a8 \u4e00\u65e6\u4e00\u4e2a TCP \u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u5c31\u8fdb\u5165\u4e86\u53d1\u9001\u6570\u636e\u72b6\u6001\uff0c\u521a\u5f00\u59cb TCP \u534f\u8bae\u4f1a\u91c7\u7528\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u901f\u5ea6\u53bb\u53d1\u9001\u6570\u636e\uff0c\u7136\u540e\u6162\u6162\u52a0\u5feb\u53d1\u9001\u6570\u636e\u7684\u901f\u5ea6\uff0c\u76f4\u5230\u53d1\u9001\u6570\u636e\u7684\u901f\u5ea6\u8fbe\u5230\u4e00\u4e2a\u7406\u60f3\u72b6\u6001\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u6162\u542f\u52a8\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u60f3\u8c61\u662f\u4e00\u8f86\u8f66\u7684\u542f\u52a8\u8fc7\u7a0b\uff0c\u5f00\u59cb\u7684\u65f6\u5019\u6162\uff0c\u5f53\u901f\u5ea6\u8d77\u6765\u540e\u52a0\u901f\u5c31\u66f4\u5feb\u4e86\u3002 \u800c\u4e4b\u6240\u4ee5\u8bf4\u6162\u542f\u52a8\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\uff0c\u662f\u56e0\u4e3a\u9875\u9762\u4e2d\u5e38\u7528\u7684\u4e00\u4e9b\u5173\u952e\u8d44\u6e90\u6587\u4ef6\u672c\u6765\u5c31\u4e0d\u5927\uff0c\u5982 HTML \u6587\u4ef6\u3001CSS \u6587\u4ef6\u548c JavaScript \u6587\u4ef6\uff0c\u901a\u5e38\u8fd9\u4e9b\u6587\u4ef6\u5728 TCP \u8fde\u63a5\u5efa\u7acb\u597d\u4e4b\u540e\u5c31\u8981\u53d1\u8d77\u8bf7\u6c42\u7684\uff0c\u4f46\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6162\u542f\u52a8\uff0c\u6240\u4ee5\u8017\u8d39\u7684\u65f6\u95f4\u6bd4\u6b63\u5e38\u7684\u65f6\u95f4\u8981\u591a\u5f88\u591a\uff0c\u8fd9\u6837\u5c31\u63a8\u8fdf\u4e86\u5b9d\u8d35\u7684\u9996\u6b21\u6e32\u67d3\u9875\u9762\u7684\u65f6\u957f\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u539f\u56e0\uff0c\u540c\u65f6\u5f00\u542f\u4e86\u591a\u6761 TCP \u8fde\u63a5\uff0c\u90a3\u4e48\u8fd9\u4e9b\u8fde\u63a5\u4f1a\u7ade\u4e89\u56fa\u5b9a\u7684\u5e26\u5bbd \u4f60\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e0b\uff0c\u7cfb\u7edf\u540c\u65f6\u5efa\u7acb\u4e86\u591a\u6761 TCP \u8fde\u63a5\uff0c\u5f53\u5e26\u5bbd\u5145\u8db3\u65f6\uff0c\u6bcf\u6761\u8fde\u63a5\u53d1\u9001\u6216\u8005\u63a5\u6536\u901f\u5ea6\u4f1a\u6162\u6162\u5411\u4e0a\u589e\u52a0\uff1b\u800c\u4e00\u65e6\u5e26\u5bbd\u4e0d\u8db3\u65f6\uff0c\u8fd9\u4e9b TCP \u8fde\u63a5\u53c8\u4f1a\u51cf\u6162\u53d1\u9001\u6216\u8005\u63a5\u6536\u7684\u901f\u5ea6\u3002 \u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u6709\u7684 TCP \u8fde\u63a5\u4e0b\u8f7d\u7684\u662f\u4e00\u4e9b\u5173\u952e\u8d44\u6e90\uff0c\u5982 CSS \u6587\u4ef6\u3001JavaScript \u6587\u4ef6\u7b49\uff0c\u800c\u6709\u7684 TCP \u8fde\u63a5\u4e0b\u8f7d\u7684\u662f\u56fe\u7247\u3001\u89c6\u9891\u7b49\u666e\u901a\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u4f46\u662f\u591a\u6761 TCP \u8fde\u63a5\u4e4b\u95f4\u53c8\u4e0d\u80fd\u534f\u5546\u8ba9\u54ea\u4e9b\u5173\u952e\u8d44\u6e90\u4f18\u5148\u4e0b\u8f7d\uff0c\u8fd9\u6837\u5c31\u6709\u53ef\u80fd\u5f71\u54cd\u90a3\u4e9b\u5173\u952e\u8d44\u6e90\u7684\u4e0b\u8f7d\u901f\u5ea6\u4e86\u3002 \u7b2c\u4e09\u4e2a\u539f\u56e0\uff0cHTTP/1.1 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898 \u6211\u4eec\u77e5\u9053\u5728 HTTP/1.1 \u4e2d\u4f7f\u7528\u6301\u4e45\u8fde\u63a5\u65f6\uff0c\u867d\u7136\u80fd\u516c\u7528\u4e00\u4e2a TCP \u7ba1\u9053\uff0c\u4f46\u662f\u5728\u4e00\u4e2a\u7ba1\u9053\u4e2d\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5728\u5f53\u524d\u7684\u8bf7\u6c42\u6ca1\u6709\u7ed3\u675f\u4e4b\u524d\uff0c\u5176\u4ed6\u7684\u8bf7\u6c42\u53ea\u80fd\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u4e0d\u80fd\u968f\u610f\u5728\u4e00\u4e2a\u7ba1\u9053\u4e2d\u53d1\u9001\u8bf7\u6c42\u548c\u63a5\u6536\u5185\u5bb9\u3002 \u8fd9\u662f\u4e00\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u963b\u585e\u8bf7\u6c42\u7684\u56e0\u7d20\u6709\u5f88\u591a\uff0c\u5e76\u4e14\u90fd\u662f\u4e00\u4e9b\u4e0d\u786e\u5b9a\u6027\u7684\u56e0\u7d20\uff0c\u5047\u5982\u6709\u7684\u8bf7\u6c42\u88ab\u963b\u585e\u4e86 5 \u79d2\uff0c\u90a3\u4e48\u540e\u7eed\u6392\u961f\u7684\u8bf7\u6c42\u90fd\u8981\u5ef6\u8fdf\u7b49\u5f85 5 \u79d2\uff0c\u5728\u8fd9\u4e2a\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e26\u5bbd\u3001CPU \u90fd\u88ab\u767d\u767d\u6d6a\u8d39\u4e86\u3002","title":"HTTP/1.1 \u4e2d\u4f9d\u7136\u5b58\u5728\u7684\u95ee\u9898"},{"location":"knowledge/http/#http2_1","text":"\u4e3a\u4e86\u89e3\u51b3 HTTP/1.1 \u4e2d\u5b58\u5728\u7684\u95ee\u9898\uff0c\u5728 HTTP/2 \u4e2d\u91c7\u7528\u6700\u5177\u98a0\u8986\u6027\u7684\u65b9\u6848\uff1a\u591a\u8def\u590d\u7528\u673a\u5236\u3002 HTTP/2 \u591a\u8def\u590d\u7528\u662f\u4ec0\u4e48 HTTP/2 \u7684\u591a\u8def\u590d\u7528\u673a\u5236\u7528\u7b80\u5355\u7684\u8bdd\u6765\u8bf4\u5c31\u662f\u6d4f\u89c8\u5668\u9488\u5bf9\u540c\u4e00\u57df\u540d\u7684\u8d44\u6e90\uff0c\u53ea\u5efa\u7acb\u4e00\u4e2a TCP \u8fde\u63a5\u901a\u9053\uff0c\u6240\u6709\u7684\u9488\u5bf9\u8fd9\u4e2a\u57df\u540d\u7684\u8bf7\u6c42\u5168\u90e8\u90fd\u5728\u8fd9\u4e2a\u901a\u9053\u4e2d\u5b8c\u6210\uff1b \u9664\u6b64\u4e4b\u5916\uff0c\u6570\u636e\u7684\u4f20\u8f93\u4e0d\u518d\u4f7f\u7528\u6587\u672c\u683c\u5f0f\uff0c\u800c\u662f\u4f1a\u5c06\u5b83\u4eec\u5206\u5272\u4e3a\u66f4\u5c0f\u7684\u6d41\u548c\u5e27\uff0c\u5e76\u5bf9\u4ed6\u4eec\u91c7\u7528\u4e8c\u8fdb\u5236\u683c\u5f0f\u7684\u7f16\u7801\u3002\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u901a\u9053\u4e2d\uff0c\u652f\u6301\u4efb\u610f\u6570\u91cf\u7684\u53cc\u5411\u6570\u636e\u6d41\uff0c\u8fd9\u4e9b\u6570\u636e\u6d41\u662f\u5e76\u884c\u3001\u4e71\u5e8f\u7684\u4e14\u5b83\u4eec\u4e4b\u95f4\u4e92\u4e0d\u5e72\u6270\u3002\u800c\u6570\u636e\u6d41\u4e2d\u4f20\u8f93\u7684\u6570\u636e\u662f\u4e8c\u8fdb\u5236\u5e27\uff0c\u5b83\u662f HTTP/2 \u4e2d\u6570\u636e\u4f20\u8f93\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u4e00\u4e2a\u6d41\u4e2d\u7684\u5e27\u662f\u6309\u7167\u987a\u5e8f\u4f20\u8f93\u7684\uff0c\u4e14\u662f\u5e76\u884c\u7684\uff0c\u6240\u4ee5\u65e0\u9700\u6309\u987a\u5e8f\u7b49\u5f85\u3002 \u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898 \u56e0\u4e3a\u53ea\u4f7f\u7528\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u6240\u4ee5\u51cf\u5c11\u4e86\u7531\u4e8e TCP \u6162\u542f\u52a8\u800c\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u53e6\u5916\u4e5f\u7531\u4e8e\u53ea\u6709\u5355\u6761 TCP \u8fde\u63a5\uff0c\u6240\u4ee5\u4e0d\u5b58\u5728\u4e0d\u540c\u7684 TCP \u4e89\u593a\u7f51\u7edc\u5e26\u5bbd\u7684\u95ee\u9898\u3002 \u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u7ecf\u8fc7\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u540e\uff0c\u4e0d\u518d\u662f\u4e00\u4e2a\u4e2a\u5b8c\u6574\u7684 HTTP \u8bf7\u6c42\u62a5\u6587\uff0c\u800c\u662f\u4e00\u5806\u4e71\u5e8f\u7684\u5e27\uff08\u5373\u4e0d\u540c\u6d41\u7684\u5e27\u662f\u4e71\u7684\uff0c\u4f46\u662f\u540c\u4e00\u6761\u6d41\u7684\u5e27\u6570\u987a\u5e8f\u4f20\u8f93\u7684\uff09\uff0c\u6240\u4ee5\u5c31\u4e0d\u4f1a\u6309\u987a\u5e8f\u4f20\u8f93\uff0c\u4e5f\u5c31\u4e0d\u5b58\u5728\u7b49\u5f85\uff0c\u4ece\u800c\u89e3\u51b3\u4e86 HTTP \u5bf9\u5934\u963b\u585e\u95ee\u9898\u3002 \u662f\u5982\u4f55\u5b9e\u73b0\u7684 \u9996\u5148\uff0c\u6d4f\u89c8\u5668\u51c6\u5907\u597d\u8bf7\u6c42\u6570\u636e\uff0c\u5305\u62ec\u4e86\u8bf7\u6c42\u884c\u3001\u8bf7\u6c42\u5934\u7b49\u4fe1\u606f\uff0c\u5982\u679c\u662f POST \u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd8\u8981\u6709\u8bf7\u6c42\u4f53\u3002 \u8fd9\u4e9b\u6570\u636e\u7ecf\u8fc7\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u5904\u7406\u4e4b\u540e\uff0c\u4f1a\u88ab\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e2a\u5e26\u6709\u8bf7\u6c42 ID \u7f16\u53f7\u7684\u5e27\uff0c\u901a\u8fc7\u534f\u8bae\u6808\u5c06\u8fd9\u4e9b\u5e27\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u3002\u8bf7\u6c42\u5934\u7684\u4fe1\u606f\u5b58\u5728 header \u5e27\u4e2d\uff0c\u800c\u8bf7\u6c42\u4f53\u6570\u636e\u5b58\u5728 data \u5e27\u4e2d\u3002 \u670d\u52a1\u5668\u63a5\u6536\u5230\u6240\u6709\u5e27\u4e4b\u540e\uff0c\u4f1a\u5c06\u6240\u6709\u76f8\u540c ID \u7684\u5e27\u5408\u5e76\u4e3a\u4e00\u6761\u5b8c\u6574\u7684\u8bf7\u6c42\u4fe1\u606f\u3002 \u7136\u540e\u670d\u52a1\u5668\u5904\u7406\u8be5\u6761\u8bf7\u6c42\uff0c\u5e76\u5c06\u5904\u7406\u7684\u54cd\u5e94\u884c\u3001\u54cd\u5e94\u5934\u548c\u54cd\u5e94\u4f53\u5206\u522b\u53d1\u9001\u81f3\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u3002 \u540c\u6837\uff0c\u4e8c\u8fdb\u5236\u5206\u5e27\u5c42\u4f1a\u5c06\u8fd9\u4e9b\u54cd\u5e94\u6570\u636e\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e2a\u5e26\u6709\u8bf7\u6c42 ID \u7f16\u53f7\u7684\u5e27\uff0c\u7ecf\u8fc7\u534f\u8bae\u6808\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\u3002 \u6d4f\u89c8\u5668\u63a5\u6536\u5230\u54cd\u5e94\u5e27\u4e4b\u540e\uff0c\u4f1a\u6839\u636e ID \u7f16\u53f7\u5c06\u5e27\u7684\u6570\u636e\u63d0\u4ea4\u7ed9\u5bf9\u5e94\u7684\u8bf7\u6c42\u3002","title":"HTTP/2 \u7684\u591a\u8def\u590d\u7528"},{"location":"knowledge/http/#http2_2","text":"1. \u53ef\u4ee5\u8bbe\u7f6e\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7 \u5728\u6d4f\u89c8\u5668\u4e2d\uff0c\u67d0\u4e9b\u6570\u636e\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u6bd4\u5982\u5173\u952e CSS \u6216\u8005 JS\uff0c\u8fd9\u4e9b\u91cd\u8981\u7684\u6570\u636e\u5982\u679c\u6bd4\u8f83\u665a\u624d\u63a8\u9001\u5230\u6d4f\u89c8\u5668\uff0c\u90a3\u4e48\u5bf9\u7528\u6237\u6765\u8bf4\u80af\u5b9a\u662f\u4e00\u4e2a\u4e0d\u597d\u7684\u4f53\u9a8c\u3002 \u6240\u4ee5 HTTP/2 \u4e2d\u53ef\u4ee5\u652f\u6301\u8bbe\u7f6e\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\uff0c\u8fd9\u6837\u670d\u52a1\u5668\u6536\u5230\u9ad8\u4f18\u5148\u7ea7\u7684\u8bf7\u6c42\u540e\uff0c\u4f1a\u4f18\u5148\u5904\u7406\u3002 2. \u670d\u52a1\u5668\u63a8\u9001 \u5728 HTTP/2 \u4e2d\u670d\u52a1\u5668\u89e3\u6790\u5230\u4e00\u4e2a HTML \u9875\u9762\u540e\uff0c\u670d\u52a1\u5668\u77e5\u9053\u6d4f\u89c8\u5668\u9700\u8981\u8fd9\u4e2a\u9875\u9762\u4e0a\u5f15\u7528\u5230\u7684\u8d44\u6e90\uff0c\u6bd4\u5982 CSS \u548c JS\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u5c31\u4f1a\u4e3b\u52a8\u7684\u628a\u8fd9\u4e9b\u8d44\u6e90\u4e00\u5e76\u63a8\u9001\u7ed9\u6d4f\u89c8\u5668\uff0c\u51cf\u5c11\u5ba2\u6237\u7aef\u7684\u7b49\u5f85\u65f6\u95f4\u3002 3. \u5934\u90e8\u538b\u7f29 HTTP/2 \u4f7f\u7528 HPACK \u538b\u7f29\u7b97\u6cd5\u5bf9\u8bf7\u6c42\u5934\u548c\u54cd\u5e94\u5934\u8fdb\u884c\u538b\u7f29\uff0c\u867d\u7136\u5355\u4e2a\u8bf7\u6c42\u538b\u7f29\u4e4b\u540e\u6548\u679c\u4e0d\u662f\u5f88\u660e\u663e\uff0c\u4f46\u662f\u5982\u679c\u4e00\u4e2a\u9875\u9762\u6709 100 \u4e2a\u8bf7\u6c42\uff0c\u90a3\u6bcf\u4e2a\u8bf7\u6c42\u538b\u7f29 20% \u4e4b\u540e\uff0c\u90a3\u63d0\u901f\u6548\u679c\u5c31\u5f88\u660e\u663e\u4e86\u3002 \u800c HPACK \u7684\u538b\u7f29\u539f\u7406\u5176\u5b9e\u5c31\u662f 2 \u70b9\uff1a \u5b83\u8981\u6c42\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e24\u8005\u90fd\u7ef4\u62a4\u548c\u66f4\u65b0\u5148\u524d\u770b\u5230\u7684\u62a5\u5934\u5b57\u6bb5\u7684\u7d22\u5f15\u5217\u8868\uff08\u5373\uff0c\u5efa\u7acb\u5171\u4eab\u7684\u538b\u7f29\u4e0a\u4e0b\u6587\uff09\uff0c\u7136\u540e\u5c06\u8be5\u5217\u8868\u7528\u4f5c\u6709\u6548\u7f16\u7801\u5148\u524d\u4f20\u8f93\u7684\u503c\u7684\u53c2\u8003\u3002\u5728\u5b9e\u9645\u4f20\u8f93\u7684\u65f6\u5019\u7528\u7d22\u5f15\u4ee3\u66ff\u6bcf\u4e00\u4fa7\u7684\u9759\u6001\u6216\u52a8\u6001\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u5b57\u6bb5\uff0c\u4ece\u800c\u51cf\u5c0f\u6bcf\u4e2a\u8bf7\u6c42\u7684\u5927\u5c0f\u3002 \u5b83\u5141\u8bb8\u901a\u8fc7\u9759\u6001\u970d\u592b\u66fc\u7801\u5bf9\u53d1\u9001\u7684\u6807\u5934\u5b57\u6bb5\u8fdb\u884c\u7f16\u7801\uff0c\u4ece\u800c\u51cf\u5c0f\u4e86\u5b83\u4eec\u5404\u81ea\u7684\u4f20\u8f93\u5927\u5c0f\u3002","title":"HTTP/2 \u5176\u4ed6\u7279\u6027"},{"location":"knowledge/http/#http3","text":"HTTP/2 \u4f9d\u7136\u662f\u57fa\u4e8e TCP \u7684\uff0c\u6240\u4ee5\u8fd8\u5b58\u5728\u4ee5\u4e0b\u4e00\u4e9b\u95ee\u9898\u3002","title":"HTTP/3"},{"location":"knowledge/http/#tcp","text":"HTTP/2 \u4e2d\u591a\u4e2a\u8bf7\u6c42\u662f\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u7684\uff0c\u5982\u679c\u67d0\u4e2a\u6570\u636e\u6d41\u4e2d\u51fa\u73b0\u4e86\u4e22\u5305\u7684\u60c5\u51b5\uff0c\u5c31\u4f1a\u963b\u585e\u8be5 TCP \u8fde\u63a5\u4e2d\u7684\u6240\u6709\u8bf7\u6c42\u3002\u8fd9\u4e2a\u548c HTTP/1.1 \u4e2d\u7684\u4e0d\u540c\uff0c\u5728 HTTP/1.1 \u4e2d\uff0c\u7531\u4e8e\u6d4f\u89c8\u5668\u4e3a\u6bcf\u4e2a\u57df\u540d\u5efa\u7acb\u4e86 6 \u4e2a TCP \u8fde\u63a5\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u4e2a TCP \u8fde\u63a5\u53d1\u751f\u4e86\u961f\u5934\u963b\u585e\uff0c\u90a3\u4e48\u5176\u4ed6\u7684 5 \u4e2a\u8fde\u63a5\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u4f20\u8f93\u6570\u636e\u3002","title":"TCP \u7684\u961f\u5934\u963b\u585e"},{"location":"knowledge/http/#tcp_1","text":"\u5728\u4f20\u8f93\u6570\u636e\u4e4b\u524d\uff0c\u9700\u8981\u8fdb\u884c TCP \u7684 3 \u6b21\u63e1\u624b\uff0c\u9700\u8981\u82b1\u8d39 1.5 \u4e2a RTT\uff1b\u5982\u679c\u662f HTTPS\uff0c\u90a3\u8fd8\u9700\u8981\u8fdb\u884c TLS \u8fde\u63a5\uff0c\u53c8\u9700\u8981 1 ~ 2 \u4e2a RTT\u3002 \u7f51\u7edc\u5ef6\u8fdf\u53c8\u53eb RTT(Round Trip Time)\uff0c\u662f\u4ece\u6d4f\u89c8\u5668\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5305\u5230\u670d\u52a1\u5668\uff0c\u518d\u4ece\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\u5305\u5230\u6d4f\u89c8\u5668\u7684\u6574\u4e2a\u5f80\u8fd4\u65f6\u95f4\u3002 \u603b\u4e4b\uff0c\u5728\u4f20\u8f93\u6570\u636e\u4e4b\u524d\u9700\u8981\u82b1\u6389 3 ~ 4 \u4e2a RTT\u3002\u5982\u679c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8ddd\u79bb\u8fd1\u7684\u8bdd\uff0c\u90a3 1 \u4e2a RTT \u5927\u6982\u662f 10ms\uff0c\u4f46\u5982\u679c\u8fdc\u7684\u8bdd\uff0c\u53ef\u80fd\u662f 100ms\uff0c\u6240\u4ee5\u4f20\u8f93\u6570\u636e\u4e4b\u524d\u9700\u8981\u82b1\u6389 300ms \u5de6\u53f3\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u80fd\u611f\u89c9\u5230\u6162\u4e86\u3002","title":"TCP \u5efa\u7acb\u8fde\u63a5\u7684\u5ef6\u65f6"},{"location":"knowledge/http/#tcp_2","text":"\u6211\u4eec\u77e5\u9053 TCP \u534f\u8bae\u5b58\u5728\u961f\u5934\u963b\u585e\u548c\u5efa\u7acb\u8fde\u63a5\u5ef6\u8fdf\u7684\u95ee\u9898\uff0c\u4f46\u662f\u53c8\u6ca1\u529e\u6cd5\u6539\u8fdb TCP \u534f\u8bae\uff0c\u7406\u7531\u6709\u5982\u4e0b 2 \u4e2a\uff1a \u4e2d\u95f4\u8bbe\u5907\u50f5\u5316\u3002\u4e2d\u95f4\u8bbe\u5907\u6bd4\u5982\u8def\u7531\u5668\u3001\u4ea4\u6362\u673a\u3001\u9632\u706b\u5899\u548c NAT \u7b49\uff0c\u8fd9\u4e9b\u8bbe\u5907\u4f9d\u8d56\u7684\u8f6f\u4ef6\u4f7f\u7528\u4e86\u5927\u91cf\u7684 TCP \u7279\u6027\uff0c\u4e00\u65e6\u529f\u80fd\u88ab\u8bbe\u7f6e\u540e\u5c31\u5f88\u5c11\u8fdb\u884c\u66f4\u65b0\u4e86\u3002\u5982\u679c\u5728\u5ba2\u6237\u7aef\u8fdb\u884c\u5347\u7ea7 TCP \u534f\u8bae\uff0c\u90a3\u4e48\u5f53\u65b0\u534f\u8bae\u7684\u6570\u636e\u5305\u7ecf\u8fc7\u8fd9\u4e9b\u8bbe\u5907\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u4e0d\u7406\u89e3\u5305\u7684\u5185\u5bb9\uff0c\u9020\u6210\u6570\u636e\u4e22\u5931\u3002 \u64cd\u4f5c\u7cfb\u7edf\u4e5f\u662f\u5bfc\u81f4 TCP \u534f\u8bae\u50f5\u5316\u7684\u53e6\u5916\u4e00\u4e2a\u539f\u56e0\u3002","title":"TCP \u534f\u8bae\u50f5\u5316"},{"location":"knowledge/http/#quic","text":"HTTP/3 \u662f\u57fa\u4e8e UDP \u5b9e\u73b0\u7684\uff0c\u5b9e\u73b0\u4e86\u7c7b\u4f3c\u4e8e TCP \u7684\u591a\u8def\u6570\u636e\u6d41\u3001\u4f20\u8f93\u53ef\u9760\u6027\u7b49\u529f\u80fd\uff0c\u6211\u4eec\u628a\u8fd9\u5957\u529f\u80fd\u79f0\u4e3a QUIC \u534f\u8bae\u3002 \u5b9e\u73b0\u4e86\u7c7b\u4f3c TCP \u7684\u6d41\u91cf\u63a7\u5236\u3001\u4f20\u8f93\u53ef\u9760\u6027\u7684\u529f\u80fd\u3002\u867d\u7136 UDP \u4e0d\u63d0\u4f9b\u53ef\u9760\u6027\u7684\u4f20\u8f93\uff0c\u4f46 QUIC \u5728 UDP \u7684\u57fa\u7840\u4e4b\u4e0a\u589e\u52a0\u4e86\u4e00\u5c42\u6765\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u4f20\u8f93\u3002\u5b83\u63d0\u4f9b\u4e86\u6570\u636e\u5305\u91cd\u4f20\u3001\u62e5\u585e\u63a7\u5236\u4ee5\u53ca\u5176\u4ed6\u4e00\u4e9b TCP \u4e2d\u5b58\u5728\u7684\u7279\u6027\u3002 \u96c6\u6210\u4e86 TLS \u52a0\u5bc6\u529f\u80fd\u3002\u76ee\u524d QUIC \u4f7f\u7528\u7684\u662f TLS1.3\uff0c\u76f8\u8f83\u4e8e\u65e9\u671f\u7248\u672c TLS1.3 \u6709\u66f4\u591a\u7684\u4f18\u70b9\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u70b9\u662f\u51cf\u5c11\u4e86\u63e1\u624b\u6240\u82b1\u8d39\u7684 RTT \u4e2a\u6570\u3002 \u5b9e\u73b0\u4e86 HTTP/2 \u4e2d\u7684\u591a\u8def\u590d\u7528\u529f\u80fd\u3002\u548c TCP \u4e0d\u540c\uff0cQUIC \u5b9e\u73b0\u4e86\u5728\u540c\u4e00\u7269\u7406\u8fde\u63a5\u4e0a\u53ef\u4ee5\u6709\u591a\u4e2a\u72ec\u7acb\u7684\u903b\u8f91\u6570\u636e\u6d41\uff08\u5982\u4e0b\u56fe\uff09\u3002\u5b9e\u73b0\u4e86\u6570\u636e\u6d41\u7684\u5355\u72ec\u4f20\u8f93\uff0c\u5c31\u89e3\u51b3\u4e86 TCP \u4e2d\u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u3002 \u5b9e\u73b0\u4e86\u5feb\u901f\u63e1\u624b\u529f\u80fd\u3002\u7531\u4e8e QUIC \u662f\u57fa\u4e8e UDP \u7684\uff0c\u6240\u4ee5 QUIC \u53ef\u4ee5\u5b9e\u73b0\u4f7f\u7528 0-RTT \u6216\u8005 1-RTT \u6765\u5efa\u7acb\u8fde\u63a5\uff0c\u8fd9\u610f\u5473\u7740 QUIC \u53ef\u4ee5\u7528\u6700\u5feb\u7684\u901f\u5ea6\u6765\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u63d0\u5347\u9996\u6b21\u6253\u5f00\u9875\u9762\u7684\u901f\u5ea6\u3002","title":"QUIC \u534f\u8bae"},{"location":"knowledge/http/#http3_1","text":"\u7b2c\u4e00\uff0c\u4ece\u76ee\u524d\u7684\u60c5\u51b5\u6765\u770b\uff0c\u670d\u52a1\u5668\u548c\u6d4f\u89c8\u5668\u7aef\u90fd\u6ca1\u6709\u5bf9 HTTP/3 \u63d0\u4f9b\u6bd4\u8f83\u5b8c\u6574\u7684\u652f\u6301\u3002Chrome \u867d\u7136\u5728\u6570\u5e74\u524d\u5c31\u5f00\u59cb\u652f\u6301 Google \u7248\u672c\u7684 QUIC\uff0c\u4f46\u662f\u8fd9\u4e2a\u7248\u672c\u7684 QUIC \u548c\u5b98\u65b9\u7684 QUIC \u5b58\u5728\u7740\u975e\u5e38\u5927\u7684\u5dee\u5f02\u3002 \u7b2c\u4e8c\uff0c\u90e8\u7f72 HTTP/3 \u4e5f\u5b58\u5728\u7740\u975e\u5e38\u5927\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u7cfb\u7edf\u5185\u6838\u5bf9 UDP \u7684\u4f18\u5316\u8fdc\u8fdc\u6ca1\u6709\u8fbe\u5230 TCP \u7684\u4f18\u5316\u7a0b\u5ea6\uff0c\u8fd9\u4e5f\u662f\u963b\u788d QUIC \u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u3002 \u7b2c\u4e09\uff0c\u4e2d\u95f4\u8bbe\u5907\u50f5\u5316\u7684\u95ee\u9898\u3002\u8fd9\u4e9b\u8bbe\u5907\u5bf9 UDP \u7684\u4f18\u5316\u7a0b\u5ea6\u8fdc\u8fdc\u4f4e\u4e8e TCP\uff0c\u636e\u7edf\u8ba1\u4f7f\u7528 QUIC \u534f\u8bae\u65f6\uff0c\u5927\u7ea6\u6709 3%\uff5e7% \u7684\u4e22\u5305\u7387\u3002","title":"HTTP/3 \u7684\u6311\u6218"},{"location":"knowledge/jiagou/","text":"\u573a\u666f\u9898 \u79d2\u6740\u7cfb\u7edf \u7ea2\u5305\u7cfb\u7edf \u5206\u5e03\u5f0fID \u5206\u5e03\u5f0f\u9650\u6d41 \u5206\u5e03\u5f0f\u5b9a\u65f6\u4efb\u52a1 \u5fae\u535a\u63a8\u9001 \u5927\u6587\u4ef6\u6392\u5e8f \u5176\u4ed6\u573a\u666f\u9898 \u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u67b6\u6784 \u95ee1.\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf \u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u76ee\u6807\u4e0e\u8981\u7d20 \u5206\u5e03\u5f0f\u7cfb\u7edf\u8bbe\u8ba1\u4e24\u5927\u601d\u8def\uff1a\u4e2d\u5fc3\u5316\u548c\u53bb\u4e2d\u5fc3\u5316 \u5206\u5e03\u5f0f\u4e0e\u96c6\u7fa4\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f \u95ee2. \u5982\u4f55\u9632\u6b62HA\u96c6\u7fa4\u7684\u8111\u88c2 \u5982\u4f55\u9632\u6b62HA\u96c6\u7fa4\u8111\u88c2 \u6ca1\u6709fence\u8bbe\u5907\u662f\u5426\u5b89\u5168 \u4e3b\u4ece\u5207\u6362\u540e\u6570\u636e\u80fd\u5426\u4fdd\u8bc1\u4e0d\u4e22 \u5982\u4f55\u5b9e\u73b0\u4e0a\u9762\u7684\u7b56\u7565 \u95ee3. \u5fae\u670d\u52a1\u67b6\u6784\u57fa\u672c\u7406\u5ff5\u548c\u539f\u5219\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u5728\u56e2\u961f\u4e2d\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u5b9e\u884c\u5fae\u670d\u52a1\u67b6\u6784\u8fc7\u7a0b\u4e2d\u78b0\u5230\u7684\u95ee\u9898\u53ca\u5176\u89e3\u51b3\u65b9\u6848 \u5173\u952e\u601d\u8def \u95ee3. RPC \u7684\u6982\u5ff5\u53ca\u5176\u5305\u542b\u7684\u6838\u5fc3\u7ec4\u4ef6\u548c\u4e3b\u6d41\u5b9e\u73b0\u6280\u672f\uff0c\u5982\u4f55\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 RPC \u6846\u67b6\u3002 RPC\u7684\u7531\u6765 RPC\u7684\u5b9e\u73b0\u539f\u7406 PRC\u67b6\u6784\u7ec4\u4ef6 RPC\u8c03\u7528\u8fc7\u7a0b \u95ee4 \u8bf4\u8bf4 springcloud rpc \u7684\u6267\u884c\u6d41\u7a0b\u548c\u539f\u7406? \u5982\u4f55\u5bf9springcloud \u5fae\u670d\u52a1\u8fdb\u884c\u9ad8\u5e76\u53d1\u7684\u6027\u80fd\u4f18\u5316\uff1f \u5206\u5e03\u5f0f\u4e8b\u52a1 \u95ee1\uff1a\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1f CAP\u5b9a\u7406 CAP\u5b9a\u7406\u7684\u8bc1\u660e BASE\u7406\u8bba BASE\u7406\u8bba\u7684\u6838\u5fc3\u601d\u60f3 BASE\u7406\u8bba\u4e09\u8981\u7d20 \u57fa\u672c\u53ef\u7528 \u8f6f\u72b6\u6001 \u6700\u7ec8\u4e00\u81f4\u6027 \u8d1f\u8f7d\u5747\u8861\u7684\u7b97\u6cd5\u4e0e\u5b9e\u73b0 \u8f6e\u8be2\uff08Round Robin\uff09 \u52a0\u6743\u8f6e\u8be2\uff08Weighted Round Robbin\uff09 \u52a0\u6743\u6700\u5c0f\u8fde\u63a5\uff08Weighted Least Connection\uff09 \u968f\u673a\u7b97\u6cd5\uff08Random\uff09 DNS \u89e3\u6790 \u4fee\u6539 MAC \u5730\u5740 \u4fee\u6539 IP \u5730\u5740 HTTP \u91cd\u5b9a\u5411 \u53cd\u5411\u4ee3\u7406 \u5206\u5e03\u5f0f\u9501 \u6570\u636e\u5e93\u5206\u5e03\u5f0f\u9501 Redis \u5206\u5e03\u5f0f\u9501 Zookeeper \u5206\u5e03\u5f0f\u9501 \u5206\u5e03\u5f0f Session 1 \u7c98\u6027 Session 2 \u670d\u52a1\u5668 Session \u590d\u5236 3 Session \u5171\u4eab\u673a\u5236 4 Session \u6301\u4e45\u5316\u5230\u6570\u636e\u5e93 5 Terracotta \u5b9e\u73b0 Session \u590d\u5236 \u5206\u5e93\u4e0e\u5206\u8868 Java\u57fa\u7840 1\uff1a JVM\u9762\u8bd5\u9898\uff08\u53f2\u4e0a\u6700\u5f3a\u3001\u6301\u7eed\u66f4\u65b0\u3001\u5410\u8840\u63a8\u8350\uff09 https://www.cnblogs.com/crazymakercircle/p/14365820.html 2\uff1aJava\u57fa\u7840\u9762\u8bd5\u9898\uff08\u53f2\u4e0a\u6700\u5168\u3001\u6301\u7eed\u66f4\u65b0\u3001\u5410\u8840\u63a8\u8350\uff09 https://www.cnblogs.com/crazymakercircle/p/14366081.html 3\uff1a\u6b7b\u9501\u9762\u8bd5\u9898\uff08\u53f2\u4e0a\u6700\u5f3a\u3001\u6301\u7eed\u66f4\u65b0\uff09 [https://www.cnblogs.com/crazymakercircle/p/14323919.html] 4\uff1a\u8bbe\u8ba1\u6a21\u5f0f\u9762\u8bd5\u9898 \uff08\u53f2\u4e0a\u6700\u5168\u3001\u6301\u7eed\u66f4\u65b0\u3001\u5410\u8840\u63a8\u8350\uff09 https://www.cnblogs.com/crazymakercircle/p/14367101.html 5\uff1a\u67b6\u6784\u8bbe\u8ba1\u9762\u8bd5\u9898 \uff08\u53f2\u4e0a\u6700\u5168\u3001\u6301\u7eed\u66f4\u65b0\u3001\u5410\u8840\u63a8\u8350\uff09 https://www.cnblogs.com/crazymakercircle/p/14367907.html \u8fd8\u6709 10 \u51e0\u7bc7 \u7bc7\u4ef7\u503c\u8fde\u57ce \u7684\u9762\u8bd5\u9898 \u5177\u4f53\u2026 \u8bf7\u53c2\u89c1\u3010 \u75af\u72c2\u521b\u5ba2\u5708 \u9ad8\u5e76\u53d1 \u603b\u76ee\u5f55 \u3011 \u4e07\u5b57\u957f\u6587\uff1a \u75af\u72c2\u521b\u5ba2\u5708 springCloud \u9ad8\u5e76\u53d1\u7cfb\u5217 springCloud \u9ad8\u8d28\u91cf \u535a\u6587 nacos \u5b9e\u6218\uff08\u53f2\u4e0a\u6700\u5168\uff09 sentinel \uff08\u53f2\u4e0a\u6700\u5168+\u5165\u95e8\u6559\u7a0b\uff09 springcloud + webflux \u9ad8\u5e76\u53d1\u5b9e\u6218 Webflux\uff08\u53f2\u4e0a\u6700\u5168\uff09 SpringCloud gateway \uff08\u53f2\u4e0a\u6700\u5168\uff09 \u8fd8\u6709 10 \u51e0\u7bc7 \u4e07\u5b57\u957f\u6587 \u7684\u9ad8\u8d28\u91cf \u535a\u6587 \u5177\u4f53\u2026 \u8bf7\u53c2\u89c1\u3010 \u75af\u72c2\u521b\u5ba2\u5708 \u9ad8\u5e76\u53d1 \u603b\u76ee\u5f55 \u3011 2021\u6625\u62db\u6708\u85aa\u8fc75\u4e07\uff08\u731b\uff01\u60ca\uff01\uff09\u9762\u8bd5\u9898\u4e4b\uff1a\u67b6\u6784\u8bbe\u8ba1\u7bc7 \u573a\u666f\u9898 \u6574\u7406\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u67b6\u6784\u8bbe\u8ba1\u9762\u8bd5\u9898\uff0c\u4e3b\u8981\u8bb0\u5f55\u5173\u952e\u70b9\uff0c\u5177\u4f53\u7ec6\u8282\u5c31\u4e0d\u8be6\u7ec6\u53d9\u8ff0\u4e86\uff0c\u6848\u4f8b\u6162\u6162\u8865\u5145\u3002\u76ee\u524d\u60f3\u8d77\u4ee5\u4e0b\u95ee\u9898\uff1a \u79d2\u6740\u7cfb\u7edf \u77ed\u94fe\u63a5\u751f\u6210 \u9ad8\u5e76\u53d1\u7684\u7ea2\u5305\u7cfb\u7edf \u5206\u5e03\u5f0fID\u751f\u6210 \u5206\u5e03\u5f0f\u9650\u6d41 \u5206\u5e03\u5f0f\u5b9a\u65f6\u4efb\u52a1 \u65b0\u6d6a\u5fae\u535a\u600e\u4e48\u63a8\u9001\u5fae\u535a \u5927\u6587\u4ef6\u6709\u9650\u5185\u5b58\u6392\u5e8f \u79d2\u6740\u7cfb\u7edf \u79d2\u6740\u7cfb\u7edf\u57fa\u672c\u9762\u8bd5\u88ab\u95ee\u70c2\u4e86\uff0c\u7f51\u4e0a\u8d44\u6599\u4e5f\u5f88\u591a\uff0c\u57fa\u672c\u6574\u7406\u4e86\u5185\u5bb9\u5982\u4e0b\uff1a \u8bbe\u8ba1\u96be\u70b9\uff1a\u5e76\u53d1\u91cf\u5927\uff0c\u5e94\u7528\u3001\u6570\u636e\u5e93\u90fd\u627f\u53d7\u4e0d\u4e86\u3002\u53e6\u5916\u96be\u63a7\u5236\u8d85\u5356\u3002 \u8bbe\u8ba1\u8981\u70b9\uff1a \u5c06\u8bf7\u6c42\u5c3d\u91cf\u62e6\u622a\u5728\u7cfb\u7edf\u4e0a\u6e38\uff0chtml\u5c3d\u91cf\u9759\u6001\u5316\uff0c\u90e8\u7f72\u5230cdn\u4e0a\u9762\u3002\u6309\u94ae\u53ca\u65f6\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u7528\uff0c\u7981\u6b62\u7528\u6237\u91cd\u590d\u63d0\u4ea4\u8bf7\u6c42\u3002 \u8bbe\u7f6e\u9875\u9762\u7f13\u5b58\uff0c\u9488\u5bf9\u540c\u4e00\u4e2a\u9875\u9762\u548cuid\u4e00\u6bb5\u65f6\u95f4\u5185\u8fd4\u56de\u7f13\u5b58\u9875\u9762\u3002 \u6570\u636e\u7528\u7f13\u5b58\u6297\uff0c\u4e0d\u76f4\u63a5\u843d\u5230\u6570\u636e\u5e93\u3002 \u8bfb\u6570\u636e\u7684\u65f6\u5019\u4e0d\u505a\u5f3a\u4e00\u81f4\u6027\u6559\u7814\uff0c\u5199\u6570\u636e\u7684\u65f6\u5019\u518d\u505a\u3002 \u5728\u6bcf\u53f0\u7269\u7406\u673a\u4e0a\u4e5f\u7f13\u5b58\u5546\u54c1\u4fe1\u606f\u7b49\u7b49\u53d8\u52a8\u4e0d\u5927\u7684\u76f8\u5173\u7684\u6570\u636e \u50cf\u5546\u54c1\u4e2d\u7684\u6807\u9898\u548c\u63cf\u8ff0\u8fd9\u4e9b\u672c\u8eab\u4e0d\u53d8\u7684\u4f1a\u5728\u79d2\u6740\u5f00\u59cb\u4e4b\u524d\u5168\u91cf\u63a8\u9001\u5230\u79d2\u6740\u673a\u5668\u4e0a\u5e76\u4e00\u76f4\u7f13\u5b58\u76f4\u5230\u79d2\u6740\u7ed3\u675f\u3002 \u50cf\u5e93\u5b58\u8fd9\u79cd\u52a8\u6001\u6570\u636e\u4f1a\u91c7\u7528\u88ab\u52a8\u5931\u6548\u7684\u65b9\u5f0f\u7f13\u5b58\u4e00\u5b9a\u65f6\u95f4\uff08\u4e00\u822c\u662f\u6570\u79d2\uff09\uff0c\u5931\u6548\u540e\u518d\u53bbTair\u7f13\u5b58\u62c9\u53d6\u6700\u65b0\u7684\u6570\u636e\u3002 \u5982\u679c\u5141\u8bb8\u7684\u8bdd\uff0c\u7528\u5f02\u6b65\u7684\u6a21\u5f0f\uff0c\u7b49\u7f13\u5b58\u90fd\u843d\u5e93\u4e4b\u540e\u518d\u8fd4\u56de\u7ed3\u679c\u3002 \u5982\u679c\u5141\u8bb8\u7684\u8bdd\uff0c\u589e\u52a0\u7b54\u9898\u6559\u7814\u7b49\u9a8c\u8bc1\u63aa\u65bd\u3002 \u5176\u4ed6\u4e1a\u52a1\u548c\u6280\u672f\u4fdd\u969c\u63aa\u65bd\uff1a \u4e1a\u52a1\u9694\u79bb\u3002\u628a\u79d2\u6740\u505a\u6210\u4e00\u79cd\u8425\u9500\u6d3b\u52a8\uff0c\u5356\u5bb6\u8981\u53c2\u52a0\u79d2\u6740\u8fd9\u79cd\u8425\u9500\u6d3b\u52a8\u9700\u8981\u5355\u72ec\u62a5\u540d\uff0c\u4ece\u6280\u672f\u4e0a\u6765\u8bf4\uff0c\u5356\u5bb6\u62a5\u540d\u540e\u5bf9\u6211\u4eec\u6765\u8bf4\u5c31\u662f\u5df2\u77e5\u70ed\u70b9\uff0c\u5f53\u771f\u6b63\u5f00\u59cb\u65f6\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u505a\u597d\u9884\u70ed\u3002 \u7cfb\u7edf\u9694\u79bb\u3002\u7cfb\u7edf\u9694\u79bb\u66f4\u591a\u662f\u8fd0\u884c\u65f6\u7684\u9694\u79bb\uff0c\u53ef\u4ee5\u901a\u8fc7\u5206\u7ec4\u90e8\u7f72\u7684\u65b9\u5f0f\u548c\u53e6\u5916 99% \u5206\u5f00\u3002\u79d2\u6740\u8fd8\u7533\u8bf7\u4e86\u5355\u72ec\u7684\u57df\u540d\uff0c\u76ee\u7684\u4e5f\u662f\u8ba9\u8bf7\u6c42\u843d\u5230\u4e0d\u540c\u7684\u96c6\u7fa4\u4e2d\u3002 \u6570\u636e\u9694\u79bb\u3002\u79d2\u6740\u6240\u8c03\u7528\u7684\u6570\u636e\u5927\u90e8\u5206\u90fd\u662f\u70ed\u6570\u636e\uff0c\u6bd4\u5982\u4f1a\u542f\u7528\u5355\u72ec cache \u96c6\u7fa4\u6216 MySQL \u6570\u636e\u5e93\u6765\u653e\u70ed\u70b9\u6570\u636e\uff0c\u76ee\u524d\u4e5f\u662f\u4e0d\u60f30.01%\u7684\u6570\u636e\u5f71\u54cd\u53e6\u591699.99%\u3002 \u53e6\u5916\u9700\u8981\u590d\u4e60\u7f13\u5b58\u7a7f\u900f\u3001\u96ea\u5d29\u7b49\u7b49\u95ee\u9898\uff0c\u4e3b\u8981\u7684\u6d41\u91cf\u90fd\u843d\u5728\u4e86\u7f13\u5b58\u6570\u636e\u5e93\u4e0a\uff0c\u9700\u8981\u9488\u5bf9\u7f13\u5b58\u6570\u636e\u5e93\u7684\u9ad8\u53ef\u7528\u4f5c\u4fdd\u969c\u3002 \u77ed\u94fe\u63a5\u751f\u6210 \u8fd9\u4e2a\u5e94\u8be5\u662f\u6bd4\u8f83\u516c\u8ba4\u7684\u65b9\u6848\u4e86\uff1a \u5206\u5e03\u5f0fID\u751f\u6210\u5668\u4ea7\u751fID ID\u8f6c62\u8fdb\u5236\u5b57\u7b26\u4e32 \u8bb0\u5f55\u6570\u636e\u5e93\uff0c\u6839\u636e\u4e1a\u52a1\u8981\u6c42\u786e\u5b9a\u8fc7\u671f\u65f6\u95f4\uff0c\u53ef\u4ee5\u4fdd\u7559\u90e8\u5206\u6c38\u4e45\u94fe\u63a5 \u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u5206\u5e03\u5f0fID\u751f\u6210\u3002\u9274\u4e8e\u77ed\u94fe\u4e00\u822c\u6ca1\u6709\u4e25\u683c\u9012\u589e\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528\u9884\u5148\u5206\u53d1\u4e00\u4e2a\u53f7\u6bb5\uff0c\u7136\u540e\u751f\u6210\u7684\u65b9\u5f0f\u3002 \u770b\u4e86\u4e0b\u65b0\u6d6a\u5fae\u535a\u7684\u77ed\u94fe\u63a5\uff0c8\u4f4d\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u4fdd\u5b58\u8d85\u8fc7200\u4e07\u4ebf\u5bf9\u5173\u7cfb\uff0c\u5177\u4f53\u600e\u4e48\u5b58\u50a8\u7684\u8fd8\u6709\u5f85\u7814\u7a76\u3002 \u7ea2\u5305\u7cfb\u7edf \u7ea2\u5305\u7cfb\u7edf\u5176\u5b9e\u5f88\u50cf\u79d2\u6740\u7cfb\u7edf\uff0c\u53ea\u4e0d\u8fc7\u540c\u4e00\u4e2a\u79d2\u6740\u7684\u603b\u91cf\u4e0d\u5927\uff0c\u4f46\u662f\u5168\u5c40\u7684\u5e76\u53d1\u91cf\u975e\u5e38\u5927\uff0c\u6bd4\u5982\u6625\u665a\u53ef\u80fd\u51e0\u767e\u4e07\u4eba\u540c\u65f6\u62a2\u7ea2\u5305\u3002 \u4e3b\u8981\u6280\u672f\u96be\u70b9\u4e5f\u7c7b\u4f3c\uff0c\u4e3b\u8981\u5728\u6570\u636e\u5e93\uff0c\u51cf\u5e93\u5b58\u7684\u65f6\u5019\u4f1a\u62a2\u9501\u3002\u53e6\u5916\u7531\u4e8e\u4e1a\u52a1\u9700\u6c42\u4e0d\u540c\uff0c\u6ca1\u529e\u6cd5\u5f02\u6b65\uff0c\u4e5f\u4e0d\u80fd\u8d85\u5356\uff0c\u4e8b\u52a1\u66f4\u52a0\u4e25\u683c\u3002 \u4e0d\u80fd\u91c7\u7528\u7684\u65b9\u5f0f\uff1a \u4e50\u89c2\u9501\uff1a\u624b\u6162\u4f1a\u5931\u8d25\uff0cDB \u9762\u4e34\u66f4\u5927\u538b\u529b\uff0c\u6240\u4ee5\u4e0d\u80fd\u91c7\u7528\u3002 \u76f4\u63a5\u7528\u7f13\u5b58\u9876\uff0c\u6d89\u53ca\u5230\u94b1\uff0c\u4e00\u65e6\u7f13\u5b58\u6302\u6389\u5c31\u5b8c\u4e86\u3002 \u5efa\u8bae\u7684\u65b9\u5f0f\uff1a \u63a5\u5165\u5c42\u5782\u76f4\u5207\u5206\uff0c\u6839\u636e\u7ea2\u5305ID\uff0c\u53d1\u7ea2\u5305\u3001\u62a2\u7ea2\u5305\u3001\u62c6\u7ea2\u5305\u3001\u67e5\u8be6\u60c5\u8be6\u60c5\u7b49\u7b49\u90fd\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u5904\u7406\uff0c\u4e92\u4e0d\u5f71\u54cd\uff0c\u5206\u800c\u6cbb\u4e4b\u3002 \u8bf7\u6c42\u8fdb\u884c\u6392\u961f\uff0c\u5230\u6570\u636e\u5e93\u7684\u65f6\u5019\u662f\u4e32\u884c\u7684\uff0c\u5c31\u4e0d\u6d89\u53ca\u62a2\u9501\u7684\u95ee\u9898\u4e86\u3002 \u4e3a\u4e86\u9632\u6b62\u961f\u5217\u592a\u957f\u8fc7\u8f7d\u5bfc\u81f4\u961f\u5217\u88ab\u964d\u7ea7\uff0c\u76f4\u63a5\u6253\u5230\u6570\u636e\u5e93\u4e0a\uff0c\u6240\u4ee5\u6570\u636e\u5e93\u524d\u9762\u518d\u52a0\u4e0a\u4e00\u4e2a\u7f13\u5b58\uff0c\u7528CAS\u81ea\u589e\u63a7\u5236\u5e76\u53d1\uff0c\u592a\u9ad8\u7684\u5e76\u53d1\u76f4\u63a5\u8fd4\u56de\u5931\u8d25\u3002 \u7ea2\u5305\u51b7\u70ed\u6570\u636e\u5206\u79bb\uff0c\u6309\u65f6\u95f4\u5206\u8868\u3002 \u5206\u5e03\u5f0fID \u5206\u5e03\u5f0fID\u751f\u6210\u5927\u6982\u4e5f\u7b97\u8001\u751f\u5e38\u8c08\u7684\u95ee\u9898\u4e86\uff0c\u4e3b\u8981\u5173\u952e\u5728\u4e8e\u662f\u5426\u9700\u8981\u4e25\u683c\u9012\u589e\uff0c\u4e25\u683c\u9012\u589e\u7684\u8bdd\u6548\u7387\u5fc5\u7136\u5927\u964d\u3002 \u4e0d\u9700\u8981\u9012\u589e\u7684\u8bdd\u6bd4\u8f83\u7b80\u5355: \u4e00\u79cd\u65b9\u5f0f\u662f\u9884\u5148\u5206\u7247\uff0c\u6bd4\u5982\u5341\u53f0\u673a\u5668\uff0c\u6bcf\u53f0\u5148\u5206\u4e00\u5343\u4e2aID\uff0c\u4e00\u53f7\u673a\u4ece0\u5f00\u59cb\uff0c\u4e8c\u53f7\u4ece1000\u5f00\u59cb\u7b49\u7b49\u3002\u7f3a\u70b9\u662f\u5927\u81f4\u4e0a\u53ef\u4ee5\u88ab\u4eba\u770b\u51fa\u6765\u4e1a\u52a1\u91cf\u3002 \u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u7c7b\u4f3c\u96ea\u82b1\u7b97\u6cd5\uff0c\u6bcf\u4e2a\u673a\u5668\u6709\u4e2aid\uff0c\u7136\u540e\u57fa\u4e8e\u65f6\u95f4\u7b97\u4e00\u4e2aid\uff0c\u518d\u52a0\u4e0a\u4e00\u4e2a\u9012\u589eid\u3002\u6bd4\u5982\u5982\u4e0b\u7f8e\u56e2\u7684\u65b9\u6848\u3002\u7f3a\u70b9\u662f\u673a\u5668\u7684\u65f6\u95f4\u6233\u4e0d\u80fd\u56de\u62e8\uff0c\u56de\u62e8\u7684\u8bdd\u4f1a\u51fa\u73b0\u95ee\u9898\u3002 \u5982\u679c\u8981\u6c42\u4e25\u683c\u9012\u589e\uff0c\u6211\u6ca1\u627e\u5230\u73b0\u6210\u7684\u5f88\u597d\u7684\u65b9\u6848\uff0c\u5927\u6982\u53ea\u80fd\u5355\u673a\u751f\u6210\uff0c\u4e0d\u80fd\u5206\u5e03\u5f0f\u4e86\uff0c\u7136\u540e\u90fd\u53bb\u5355\u673a\u4e0a\u53d6\u53f7\u3002\u6548\u7387\u7684\u8bdd\uff0c\u7c7b\u4f3cRedis\u7684\u6570\u636e\u5e93\u5927\u6982\u80fd\u5230\u6bcf\u79d2\u5341\u51e0\u4e8c\u5341\u51e0\u4e07\u7684\u901f\u5ea6\u3002 \u5206\u5e03\u5f0f\u9650\u6d41 \u5e38\u89c1\u7684\u9650\u6d41\u65b9\u6cd5\uff1a \u56fa\u5b9a\u7a97\u53e3\u8ba1\u6570\u5668\uff1a\u6309\u7167\u65f6\u95f4\u6bb5\u5212\u5206\u7a97\u53e3\uff0c\u6709\u4e00\u6b21\u8bf7\u6c42\u5c31+1\uff0c\u6700\u4e3a\u7b80\u5355\u7684\u7b97\u6cd5\uff0c\u4f46\u8fd9\u4e2a\u7b97\u6cd5\u6709\u65f6\u4f1a\u8ba9\u901a\u8fc7\u8bf7\u6c42\u91cf\u5141\u8bb8\u4e3a\u9650\u5236\u7684\u4e24\u500d\u3002 \u6ed1\u52a8\u7a97\u53e3\u8ba1\u6570\u5668\uff1a\u901a\u8fc7\u5c06\u7a97\u53e3\u518d\u7ec6\u5206\uff0c\u5e76\u4e14\u6309\u7167\u65f6\u95f4\u201c\u6ed1\u52a8\u201d\u6765\u89e3\u51b3\u7a81\u7834\u9650\u5236\u7684\u95ee\u9898\uff0c\u4f46\u662f\u65f6\u95f4\u533a\u95f4\u7684\u7cbe\u5ea6\u8d8a\u9ad8\uff0c\u7b97\u6cd5\u6240\u9700\u7684\u7a7a\u95f4\u5bb9\u91cf\u5c31\u8d8a\u5927\u3002 \u6f0f\u6876\uff1a\u8bf7\u6c42\u7c7b\u4f3c\u6c34\u6ef4\uff0c\u5148\u653e\u5230\u6876\u91cc\uff0c\u670d\u52a1\u7684\u63d0\u4f9b\u65b9\u5219\u6309\u7167\u56fa\u5b9a\u7684\u901f\u7387\u4ece\u6876\u91cc\u9762\u53d6\u51fa\u8bf7\u6c42\u5e76\u6267\u884c\u3002\u7f3a\u9677\u4e5f\u5f88\u660e\u663e\uff0c\u5f53\u77ed\u65f6\u95f4\u5185\u6709\u5927\u91cf\u7684\u7a81\u53d1\u8bf7\u6c42\u65f6\uff0c\u5373\u4fbf\u6b64\u65f6\u670d\u52a1\u5668\u6ca1\u6709\u4efb\u4f55\u8d1f\u8f7d\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u4e5f\u90fd\u5f97\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u624d\u80fd\u88ab\u54cd\u5e94\u3002 \u4ee4\u724c\u6876\uff1a\u5f80\u6876\u91cc\u9762\u53d1\u653e\u4ee4\u724c\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u8fc7\u6765\u4e4b\u540e\u62ff\u8d70\u4e00\u4e2a\u4ee4\u724c\uff0c\u7136\u540e\u53ea\u5904\u7406\u6709\u4ee4\u724c\u7684\u8bf7\u6c42\u3002\u4ee4\u724c\u6876\u6ee1\u4e86\u5219\u591a\u4f59\u7684\u4ee4\u724c\u4f1a\u76f4\u63a5\u4e22\u5f03\u3002\u4ee4\u724c\u6876\u7b97\u6cd5\u65e2\u80fd\u591f\u5c06\u6240\u6709\u7684\u8bf7\u6c42\u5e73\u5747\u5206\u5e03\u5230\u65f6\u95f4\u533a\u95f4\u5185\uff0c\u53c8\u80fd\u63a5\u53d7\u670d\u52a1\u5668\u80fd\u591f\u627f\u53d7\u8303\u56f4\u5185\u7684\u7a81\u53d1\u8bf7\u6c42\uff0c\u56e0\u6b64\u662f\u76ee\u524d\u4f7f\u7528\u8f83\u4e3a\u5e7f\u6cdb\u7684\u4e00\u79cd\u9650\u6d41\u7b97\u6cd5\u3002 Google \u7684\u5f00\u6e90\u9879\u76ee guava \u63d0\u4f9b\u4e86 RateLimiter \u7c7b\uff0c\u5b9e\u73b0\u4e86\u5355\u70b9\u7684\u4ee4\u724c\u6876\u9650\u6d41\u3002 \u5206\u5e03\u5f0f\u73af\u5883\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u7528 Redis+Lua \u811a\u672c\u5b9e\u73b0\u4ee4\u724c\u6876\u3002 \u5982\u679c\u8bf7\u6c42\u91cf\u592a\u5927\u4e86\uff0cRedis \u4e5f\u6491\u4e0d\u4f4f\u600e\u4e48\u529e\uff1f\u6211\u89c9\u5f97\u53ef\u4ee5\u7c7b\u4f3c\u4e8e\u5206\u5e03\u5f0f ID \u7684\u5904\u7406\u65b9\u5f0f\uff0cRedis \u524d\u9762\u5728\u589e\u52a0\u9884\u5904\u7406\uff0c\u6bd4\u5982\u6bcf\u53f0\u53ca\u5176\u9884\u5148\u7533\u8bf7\u4e00\u90e8\u5206\u4ee4\u724c\uff0c\u53ea\u6709\u4ee4\u724c\u7528\u5b8c\u4e4b\u540e\u624d\u53bb Redis\u3002\u5982\u679c\u8fd8\u662f\u592a\u5927\uff0c\u662f\u5426\u53ef\u4ee5\u5782\u76f4\u5207\u5206\uff1f\u6309\u7167\u6d41\u91cf\u7684\u6765\u6e90\uff0c\u6bd4\u5982\u5730\u7406\u4f4d\u7f6e\u3001IP \u4e4b\u7c7b\u7684\u518d\u62c6\u5f00\u3002 \u5206\u5e03\u5f0f\u5b9a\u65f6\u4efb\u52a1 \u4efb\u52a1\u8f6e\u8be2\u6216\u4efb\u52a1\u8f6e\u8be2+\u62a2\u5360\u6392\u961f\u65b9\u6848 \u6bcf\u4e2a\u670d\u52a1\u5668\u9996\u6b21\u542f\u52a8\u65f6\u52a0\u5165\u961f\u5217\uff1b \u6bcf\u6b21\u4efb\u52a1\u8fd0\u884c\u9996\u5148\u5224\u65ad\u81ea\u5df1\u662f\u5426\u662f\u5f53\u524d\u53ef\u8fd0\u884c\u4efb\u52a1\uff0c\u5982\u679c\u662f\u4fbf\u8fd0\u884c\uff1b \u5982\u679c\u4e0d\u662f\u5f53\u524d\u8fd0\u884c\u7684\u4efb\u52a1\uff0c\u68c0\u67e5\u81ea\u5df1\u662f\u5426\u5728\u961f\u5217\u4e2d\uff0c\u5982\u679c\u5728\uff0c\u4fbf\u9000\u51fa\uff0c\u5982\u679c\u4e0d\u5728\u961f\u5217\u4e2d\uff0c\u8fdb\u5165\u961f\u5217\u3002 \u5fae\u535a\u63a8\u9001 \u4e3b\u8981\u96be\u70b9\uff1a\u5173\u7cfb\u590d\u6742\uff0c\u6570\u636e\u91cf\u5927\u3002\u4e00\u4e2a\u4eba\u53ef\u4ee5\u5173\u6ce8\u975e\u5e38\u591a\u7684\u7528\u6237\uff0c\u4e00\u4e2a\u5927 V \u4e5f\u6709\u53ef\u80fd\u6709\u51e0\u5343\u4e07\u7684\u7c89\u4e1d\u3002 \u5148\u4ecb\u7ecd\u6700\u57fa\u672c\u7684\u65b9\u6848\uff1a \u63a8\u6a21\u5f0f\uff1a\u63a8\u6a21\u5f0f\u5c31\u662f\uff0c\u7528\u6237A\u5173\u6ce8\u4e86\u7528\u6237 B\uff0c\u7528\u6237 B \u6bcf\u53d1\u9001\u4e00\u4e2a\u52a8\u6001\uff0c\u540e\u53f0\u904d\u5386\u7528\u6237B\u7684\u7c89\u4e1d\uff0c\u5f80\u4ed6\u4eec\u7c89\u4e1d\u7684 feed \u91cc\u9762\u63a8\u9001\u4e00\u6761\u52a8\u6001\u3002 \u62c9\u6a21\u5f0f\uff1a\u63a8\u6a21\u5f0f\u76f8\u53cd\uff0c\u62c9\u6a21\u5f0f\u5219\u662f\uff0c\u7528\u6237\u6bcf\u6b21\u5237\u65b0 feed \u7b2c\u4e00\u9875\uff0c\u90fd\u53bb\u904d\u5386\u5173\u6ce8\u7684\u4eba\uff0c\u628a\u6700\u65b0\u7684\u52a8\u6001\u62c9\u53d6\u56de\u6765\u3002 \u4e00\u822c\u91c7\u7528\u63a8\u62c9\u7ed3\u5408\u7684\u65b9\u5f0f\uff0c\u7528\u6237\u53d1\u9001\u72b6\u6001\u4e4b\u540e\uff0c\u5148\u63a8\u9001\u7ed9\u7c89\u4e1d\u91cc\u9762\u5728\u7ebf\u7684\u7528\u6237\uff0c\u7136\u540e\u4e0d\u5728\u7ebf\u7684\u90a3\u90e8\u5206\u7b49\u5230\u4e0a\u7ebf\u7684\u65f6\u5019\u518d\u6765\u62c9\u53d6\u3002 \u53e6\u5916\u51b7\u70ed\u6570\u636e\u5206\u79bb\uff0c\u7528\u6237\u5173\u7cfb\u5728\u7f13\u5b58\u91cc\u9762\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u6bd4\u5982\u4e03\u5929\u3002\u4e03\u5929\u6ca1\u4e0a\u7ebf\u7684\u53ef\u80fd\u5c31\u5f88\u5c11\u7528\u8fd9\u4e2a APP\u3002 \u5927\u6587\u4ef6\u6392\u5e8f \u5bf9\u4e8e\u8fdc\u9ad8\u4e8e\u5185\u5b58\u7684\u6587\u4ef6\u6392\u5e8f\u3002 \u5916\u5f52\u5e76\u6392\u5e8f\uff1a \u5bf9\u6587\u4ef6\u5206\u5272\uff0c\u7136\u540e\u5206\u522b\u6392\u5e8f \u6392\u597d\u5e8f\u7684\u6587\u4ef6\u4f9d\u6b21\u8bfb\u53d6\u4e00\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u7136\u540e\u8fdb\u884c\u6392\u5e8f\uff0c\u8f93\u51fa\u5230\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u7136\u540e\u4fdd\u5b58\u5230\u7ed3\u679c\u6587\u4ef6\u3002 \u5982\u679c\u662f\u6570\u5b57\uff0c\u53ef\u4ee5\u7528\u4f4d\u56fe\u6392\u5e8f\uff0c\u4f46\u662f\u8981\u6c42\u6bd4\u8f83\u82db\u523b\uff1a \u6570\u5b57\u4e0d\u91cd\u590d \u77e5\u9053\u6700\u5927\u503c \u76f8\u5bf9\u5bc6\u96c6\uff0c\u56e0\u4e3a\u6ca1\u51fa\u73b0\u7684\u6570\u5b57\u4e5f\u4f1a\u5360\u7528\u7a7a\u95f4 \u6bd4\u8f83\u9002\u5408\u7535\u8bdd\u53f7\u4e4b\u7c7b\u7684\u3002 \u5176\u4ed6\u573a\u666f\u9898 1\u3001\u60c5\u666f\u9898\uff1a\u5982\u679c\u4e00\u4e2a\u5916\u5356\u914d\u9001\u5355\u5b50\u8981\u53d1\u5e03\uff0c\u73b0\u5728\u6709200\u4e2a\u9a91\u624b\u90fd\u60f3\u8981\u63a5\u8fd9\u4e00\u5355\uff0c\u5982\u4f55\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2a\u9a91\u624b\u63a5\u5230\u5355\u5b50\uff1f \u8fd9\u4e2a\u53ef\u4ee5\u7528redis\u7684lpush rpop\u6765\u5b9e\u73b0\u3002 2\u3001\u573a\u666f\u9898\uff1a\u7f8e\u56e2\u9996\u9875\u6bcf\u5929\u4f1a\u4ece10000\u4e2a\u5546\u5bb6\u91cc\u9762\u63a8\u835050\u4e2a\u5546\u5bb6\u7f6e\u9876\uff0c\u6bcf\u4e2a\u5546\u5bb6\u6709\u4e00\u4e2a\u6743\u503c\uff0c\u4f60\u5982\u4f55\u6765\u63a8\u8350\uff1f\u7b2c\u4e8c\u5929\u600e\u4e48\u66f4\u65b0\u63a8\u8350\u7684\u5546\u5bb6\uff1f \u8fd9\u4e2a\u53ef\u4ee5\u7528\u5806\u6392\uff0c\u7b2c\u4e8c\u5929\u66f4\u65b0\u63a8\u8350\u7684\u53ef\u4ee5\u5728\u8981\u66f4\u65b0\u4e4b\u524d\u7684\u65f6\u5019\u5728redis\u505a\u8ba1\u7b97\u64cd\u4f5c\uff0c\u7136\u540e\u653e\u6570\u636e\u5e93\u505a\u4e2a\u540c\u6b65\u5c31\u884c\u4e86\u3002 3\u3001\u573a\u666f\u9898\uff1a\u5fae\u4fe1\u62a2\u7ea2\u5305\u95ee\u9898 \u60b2\u89c2\u9501\uff0c\u4e50\u89c2\u9501\uff0c\u5b58\u50a8\u8fc7\u7a0b\u653e\u5728mysql\u6570\u636e\u5e93\u4e2d\u3002 4\u3001\u573a\u666f\u9898\uff1a1000\u4e2a\u4efb\u52a1\uff0c\u5206\u7ed910\u4e2a\u4eba\u505a\uff0c\u4f60\u600e\u4e48\u5206\u914d\uff0c\u5148\u5728\u7eb8\u4e0a\u5199\u4e2a\u6700\u7b80\u5355\u7684\u7248\u672c\uff0c\u7136\u540e\u4f18\u5316\u3002 \u5168\u5c40\u961f\u5217\uff0c\u628a1000\u4efb\u52a1\u653e\u5728\u4e00\u4e2a\u961f\u5217\u91cc\u9762\uff0c\u7136\u540e\u6bcf\u4e2a\u4eba\u90fd\u662f\u53d6\uff0c\u5b8c\u6210\u4efb\u52a1\u3002 \u5206\u4e3a10\u4e2a\u961f\u5217\uff0c\u6bcf\u4e2a\u4eba\u5206\u522b\u5230\u81ea\u5df1\u5bf9\u5e94\u7684\u961f\u5217\u4e2d\u53bb\u53d6\u52a1\u3002 5\u3001\u573a\u666f\u9898\uff1a\u4fdd\u8bc1\u53d1\u9001\u6d88\u606f\u7684\u6709\u5e8f\u6027\uff0c\u6d88\u606f\u5904\u7406\u7684\u6709\u5e8f\u6027\u3002 \u7ed9\u6d88\u606f\u52a0\u4e00\u4e2aheader\uff0c\u8bc6\u522b\u4e00\u4e0bheader\u7684syn\u5c31\u884c 6\u3001\u5982\u4f55\u628a\u4e00\u4e2a\u6587\u4ef6\u5feb\u901f\u4e0b\u53d1\u5230100w\u4e2a\u670d\u52a1\u5668 \u8fb9\u4e0b\u53d1\uff0c\u8fb9\u590d\u5236 7\u3001\u7ed9\u6bcf\u4e2a\u7ec4\u5206\u914d\u4e0d\u540c\u7684IP\u6bb5\uff0c\u600e\u4e48\u8bbe\u8ba1\u4e00\u79cd\u7ed3\u6784\u4f7f\u7684\u5feb\u901f\u5f97\u77e5IP\u662f\u54ea\u4e2a\u7ec4\u7684? 8\u300110\u4ebf\u4e2a\u6570\uff0c\u627e\u51fa\u6700\u5927\u768410\u4e2a\u3002 \u5efa\u8bae\u4e00\u4e2a\u5927\u5c0f\u4e3a10\u7684\u5c0f\u6839\u5806\u3002 9\u3001\u6709\u51e0\u53f0\u673a\u5668\u5b58\u50a8\u7740\u51e0\u4ebf\u6dd8\u5b9d\u641c\u7d22\u65e5\u5fd7\uff0c\u4f60\u53ea\u6709\u4e00\u53f02g\u7684\u7535\u8111\uff0c\u600e\u4e48\u9009\u51fa\u641c\u7d22\u70ed\u5ea6\u6700\u9ad8\u7684\u5341\u4e2a\u641c\u7d22\u5173\u952e\u8bcd\uff1f \u5206bucket\uff0c\u6bcf\u4e2abucket\u627e\u51fa\u9891\u6b21\u6700\u9ad8\u768410\u4e2a\uff0c\u603b\u4f53\u7528\u5206\u6cbb\u7b97\u6cd5\u505a\u3002 10\u3001\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\u5982\u4f55\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1f \u5206\u5e03\u5f0f\u9501\uff0c\u610f\u5728\u8ba9\u5206\u5e03\u5f0f\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u9488\u5bf9\u4e00\u4e2a\u5171\u4eab\u8d44\u6e90\u4e00\u6b21\u6027\u53ea\u4f1a\u6709\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u91cc\u7684\u8d44\u6e90\u3002\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u4e00\u822c\u5c31\u662fredis\u548czk\u5c45\u591a\u3002redis\u8bbe\u7f6e\u4e00\u4e0bexpire time\u5c31\u884c\u3002 11\u300110\u4e07\u4e2a\u6570\uff0c\u8f93\u51fa\u4ece\u5c0f\u5230\u5927\uff1f \u5148\u5212\u5206\u6210\u591a\u4e2a\u5c0f\u6587\u4ef6\uff0c\u9001\u8fdb\u5185\u5b58\u6392\u5e8f\uff0c\u7136\u540e\u518d\u91c7\u7528\u591a\u8def\u5f52\u5e76\u6392\u5e8f\u3002 12\u3001\u6709\u5341\u4e07\u4e2a\u5355\u8bcd\uff0c\u627e\u51fa\u91cd\u590d\u6b21\u6570\u6700\u9ad8\u5341\u4e2a\uff1f map \u5b57\u7b26\u4e32\uff0c\u9891\u6b21\uff0c\u7136\u540e\u5806\u6392\u3002 \u573a\u666f\u9898\u7b54\u9898\u5c0f\u5efa\u8bae\uff1a \u67b6\u6784\u8bbe\u8ba1\u9898\u76ee\u8fdc\u4e0d\u6b62\u8fd9\u4e9b\uff0c\u6211\u89c9\u5f97\u4e3b\u8981\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u51c6\u5907\uff1a \u5148\u4e86\u89e3\u5e38\u7528\u7b97\u6cd5\uff0c\u9488\u5bf9\u89e3\u51b3\u5404\u79cd\u95ee\u9898\u80fd\u7528\u54ea\u4e9b\u7b97\u6cd5\uff0c\u6bd4\u5982\u5927\u6587\u4ef6\u6392\u5e8f\u7528\u5916\u6392\u5e8f\uff0c\u5927\u91cf\u6570\u636e\u4e2d\u7684\u547d\u4e2d\u5224\u65ad\u7528\u4f4d\u56fe/\u5e03\u9686\u8fc7\u6ee4\u5668\u7b49\u7b49\u3002 \u6ce8\u610f\u6269\u5c55\u6027\u3001\u591a\u8003\u8651\u6781\u7aef\u60c5\u51b5\uff0c\u591a\u95ee\u81ea\u5df1\u51e0\u4e2a\u4e3a\u4ec0\u4e48\u3002\u6bd4\u5982\u8bf4\u8d77\u5355\u673a\u7684\u9650\u6d41\u7b97\u6cd5\u60f3\u60f3\u5206\u5e03\u5f0f\u7684\u600e\u4e48\u505a\u3002 \u5b9e\u5728\u4e0d\u77e5\u9053\u600e\u4e48\u5f04\u7684\u53d9\u8ff0\u81ea\u5df1\u7684\u601d\u8003\u8fc7\u7a0b\uff0c\u7740\u91cd\u5c55\u793a\u81ea\u5df1\u8003\u8651\u5468\u5168\u3001\u601d\u7ef4\u7f1c\u5bc6\u3002 \u6bd4\u5982\u4e4b\u524d\u4e00\u4e2a\u540c\u4e8b\u9762\u963f\u91cc\u88ab\u95ee\u6574\u4e2a\u673a\u623f\u7f51\u7edc\u6302\u4e86/\u65ad\u7535\u4e86\u4e4b\u7c7b\u7684\u6781\u7aef\u95ee\u9898\uff0c\u76f8\u4fe1\u5f88\u591a\u4eba\u4e0d\u53ef\u80fd\u771f\u7684\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u800c\u4e14\u53ef\u7528\u6027\u4e00\u822c\u4e5f\u5230\u4e0d\u4e86\u8fd9\u4e2a\u7ea7\u522b\u3002\u5982\u679c\u662f\u6211\u7684\u8bdd\uff0c\u6211\u4f1a\u7740\u91cd\u8003\u8651\u6570\u636e\u4e00\u81f4\u6027\u3001\u6570\u636e\u6062\u590d\u3001\u810f\u6570\u636e\u5904\u7406\u4e4b\u7c7b\u7684\u95ee\u9898\uff0c\u662f\u5426\u6709\u5176\u4ed6\u673a\u623f\u63d0\u4f9b\u670d\u52a1\uff0c\u5982\u679c\u6709\u7684\u8bdd\u6d89\u53ca\u5230\u7f51\u7edc\u5206\u533a\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u5f15\u7533\u8c08\u8c08 zab\u3001raft \u7b97\u6cd5\uff0c\u53e6\u5916\u539f\u672c\u4e24\u4e2a\u6216\u8005\u4e09\u4e2a\u673a\u623f\u63d0\u4f9b\u670d\u52a1\uff0c\u73b0\u5728\u77ac\u95f4\u5c11\u4e86\u4e00\u4e2a\uff0c\u5176\u4ed6\u673a\u623f\u7684\u8d1f\u8f7d\u77ac\u95f4\u4e0a\u5347\uff0c\u600e\u4e48\u505a\u524a\u5cf0\u3001\u964d\u7ea7\uff0c\u8fd9\u5c31\u6709\u56de\u5230\u6211\u4eec\u4f1a\u7684\u95ee\u9898\u4e0a\u4e86\u3002\u53e6\u5916\u7b49\u5230\u7f51\u7edc\u6062\u590d\u4e86\uff0c\u600e\u4e48\u6062\u590d\u670d\u52a1\uff1f\u4e4b\u524d\u5904\u7406\u5230\u4e00\u534a\u7684\u6570\u636e\u600e\u4e48\u5904\u7406\uff1f\u8fd9\u4e9b\u5f15\u7533\u5f00\u6765\u90fd\u6709\u592a\u591a\u53ef\u4ee5\u804a\u3002 \u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u67b6\u6784 \u95ee1.\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf \u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u76ee\u6807\u4e0e\u8981\u7d20 \u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u76ee\u6807\u662f\u63d0\u5347\u7cfb\u7edf\u7684\u6574\u4f53\u6027\u80fd\u548c\u541e\u5410\u91cf\u53e6\u5916\u8fd8\u8981\u5c3d\u91cf\u4fdd\u8bc1\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5bb9\u9519\u6027\uff08\u5047\u5982\u589e\u52a010\u53f0\u670d\u52a1\u5668\u624d\u8fbe\u5230\u5355\u673a\u8fd0\u884c\u6548\u679c2\u500d\u5de6\u53f3\u7684\u6027\u80fd\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u5c31\u6839\u672c\u6ca1\u6709\u5b58\u5728\u7684\u610f\u4e49\uff09\u3002 \u5373\u4f7f\u91c7\u7528\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u6211\u4eec\u4e5f\u8981\u5c3d\u529b\u8fd0\u7528\u5e76\u53d1\u7f16\u7a0b\u3001\u9ad8\u6027\u80fd\u7f51\u7edc\u6846\u67b6\u7b49\u7b49\u624b\u6bb5\u63d0\u5347\u5355\u673a\u4e0a\u7684\u7a0b\u5e8f\u6027\u80fd\u3002 \u5206\u5e03\u5f0f\u7cfb\u7edf\u8bbe\u8ba1\u4e24\u5927\u601d\u8def\uff1a\u4e2d\u5fc3\u5316\u548c\u53bb\u4e2d\u5fc3\u5316 \u4e2d\u5fc3\u5316\u8bbe\u8ba1 \u4e24\u4e2a\u89d2\u8272\uff1a \u4e2d\u5fc3\u5316\u7684\u8bbe\u8ba1\u601d\u60f3\u5f88\u7b80\u5355\uff0c\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u673a\u5668\u6309\u7167\u89d2\u8272\u5206\u5de5\uff0c\u5927\u4f53\u4e0a\u5206\u4e3a\u4e24\u79cd\u89d2\u8272\uff1a \u201c\u9886\u5bfc\u201d \u548c \u201c\u5e72\u6d3b\u7684\u201d \u89d2\u8272\u804c\u8d23\uff1a \u201c\u9886\u5bfc\u201d\u901a\u5e38\u8d1f\u8d23\u5206\u53d1\u4efb\u52a1\u5e76\u76d1\u7763\u201c\u5e72\u6d3b\u7684\u201d\uff0c\u53d1\u73b0\u8c01\u592a\u95f2\u4e86\uff0c\u5c31\u60f3\u53d1\u8bbe\u6cd5\u5730\u7ed9\u5176\u5b89\u6392\u65b0\u4efb\u52a1\uff0c\u786e\u4fdd\u6ca1\u6709\u4e00\u4e2a\u201c\u5e72\u6d3b\u7684\u201d\u80fd\u591f\u5077\u61d2\uff0c\u5982\u679c\u201c\u9886\u5bfc\u201d\u53d1\u73b0\u67d0\u4e2a\u201c\u5e72\u6d3b\u7684\u201d\u56e0\u4e3a\u52b3\u7d2f\u8fc7\u5ea6\u800c\u75c5\u5012\u4e86\uff0c\u5219\u662f\u4e0d\u4f1a\u8003\u8651\u5148\u5c1d\u8bd5\u201c\u533b\u6cbb\u201d\u4ed6\u7684\uff0c\u800c\u662f\u4e00\u811a\u8e22\u51fa\u53bb\uff0c\u7136\u540e\u628a\u4ed6\u7684\u4efb\u52a1\u5206\u7ed9\u5176\u4ed6\u4eba\u3002\u5176\u4e2d\u5fae\u670d\u52a1\u67b6\u6784 Kubernetes \u5c31\u6070\u597d\u91c7\u7528\u4e86\u8fd9\u4e00\u8bbe\u8ba1\u601d\u8def\u3002 \u4e2d\u5fc3\u5316\u8bbe\u8ba1\u7684\u95ee\u9898 \u4e2d\u5fc3\u5316\u7684\u8bbe\u8ba1\u5b58\u5728\u7684\u6700\u5927\u95ee\u9898\u662f\u201c\u9886\u5bfc\u201d\u7684\u5b89\u5371\u95ee\u9898\uff0c\u5982\u679c\u201c\u9886\u5bfc\u201d\u51fa\u4e86\u95ee\u9898\uff0c\u5219\u7fa4\u9f99\u65e0\u9996\uff0c\u6574\u4e2a\u96c6\u7fa4\u5c31\u5954\u6e83\u4e86\u3002\u4f46\u6211\u4eec\u96be\u4ee5\u540c\u65f6\u5b89\u6392\u4e24\u4e2a\u201c\u9886\u5bfc\u201d\u4ee5\u907f\u514d\u5355\u70b9\u95ee\u9898\u3002 \u4e2d\u5fc3\u5316\u8bbe\u8ba1\u8fd8\u5b58\u5728\u53e6\u5916\u4e00\u4e2a\u6f5c\u5728\u7684\u95ee\u9898\uff0c\u65e2\u201c\u9886\u5bfc\u201d\u7684\u80fd\u529b\u95ee\u9898\uff1a\u53ef\u4ee5\u9886\u5bfc10\u4e2a\u4eba\u9ad8\u6548\u5de5\u4f5c\u5e76\u4e0d\u610f\u5473\u7740\u53ef\u4ee5\u9886\u5bfc100\u4e2a\u4eba\u9ad8\u6548\u5de5\u4f5c\uff0c\u6240\u4ee5\u5982\u679c\u7cfb\u7edf\u8bbe\u8ba1\u548c\u5b9e\u73b0\u5f97\u4e0d\u597d\uff0c\u95ee\u9898\u5c31\u4f1a\u5361\u5728\u201c\u9886\u5bfc\u201d\u8eab\u4e0a\u3002 \u9886\u5bfc\u5b89\u5371\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5\uff1a \u5927\u591a\u6570\u4e2d\u5fc3\u5316\u7cfb\u7edf\u90fd\u91c7\u7528\u4e86\u4e3b\u5907\u4e24\u4e2a\u201c\u9886\u5bfc\u201d\u7684\u8bbe\u8ba1\u65b9\u6848\uff0c\u53ef\u4ee5\u662f\u70ed\u5907\u6216\u8005\u51b7\u5907\uff0c\u4e5f\u53ef\u4ee5\u662f\u81ea\u52a8\u5207\u6362\u6216\u8005\u624b\u52a8\u5207\u6362\uff0c\u800c\u4e14\u8d8a\u6765\u8d8a\u591a\u7684\u65b0\u7cfb\u7edf\u90fd\u5f00\u59cb\u5177\u5907\u81ea\u52a8\u9009\u4e3e\u5207\u6362\u201c\u9886\u5bfc\u201d\u7684\u80fd\u529b\uff0c\u4ee5\u63d0\u5347\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u3002 \u53bb\u4e2d\u5fc3\u5316\u8bbe\u8ba1 \u4f17\u751f\u5730\u4f4d\u5e73\u7b49\uff1a \u5728\u53bb\u4e2d\u5fc3\u5316\u7684\u8bbe\u8ba1\u91cc\uff0c\u901a\u5e38\u6ca1\u6709\u201c\u9886\u5bfc\u201d\u548c\u201c\u5e72\u6d3b\u7684\u201d\u8fd9\u4e24\u79cd\u89d2\u8272\u7684\u533a\u5206\uff0c\u5927\u5bb6\u7684\u89d2\u8272\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5730\u4f4d\u662f\u5e73\u7b49\u7684\uff0c\u5168\u7403\u4e92\u8054\u7f51\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u53bb\u4e2d\u5fc3\u5316\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u8054\u7f51\u7684\u4efb\u610f\u8282\u70b9\u8bbe\u5907\u5b95\u673a\uff0c\u90fd\u53ea\u4f1a\u5f71\u54cd\u5f88\u5c0f\u8303\u56f4\u7684\u529f\u80fd\u3002 \u201c\u53bb\u4e2d\u5fc3\u5316\u201d\u4e0d\u662f\u4e0d\u8981\u4e2d\u5fc3\uff0c\u800c\u662f\u7531\u8282\u70b9\u6765\u81ea\u7531\u9009\u62e9\u4e2d\u5fc3\u3002 \uff08\u96c6\u7fa4\u7684\u6210\u5458\u4f1a\u81ea\u53d1\u7684\u4e3e\u884c\u201c\u4f1a\u8bae\u201d\u9009\u4e3e\u65b0\u7684\u201c\u9886\u5bfc\u201d\u4e3b\u6301\u5de5\u4f5c\u3002\u6700\u5178\u578b\u7684\u6848\u4f8b\u5c31\u662fZooKeeper\u53caGo\u8bed\u8a00\u5b9e\u73b0\u7684Etcd\uff09 \u53bb\u4e2d\u5fc3\u5316\u8bbe\u8ba1\u7684\u95ee\u9898\uff1a \u53bb\u4e2d\u5fc3\u5316\u8bbe\u8ba1\u91cc\u6700\u96be\u89e3\u51b3\u7684\u4e00\u4e2a\u95ee\u9898\u662f \u201c\u8111\u88c2\u201d\u95ee\u9898 \uff0c\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\u6982\u7387\u5f88\u4f4e\uff0c\u4f46\u5f71\u54cd\u5f88\u5927\u3002\u8111\u88c2\u6307\u4e00\u4e2a\u96c6\u7fa4\u7531\u4e8e\u7f51\u7edc\u7684\u6545\u969c\uff0c\u88ab\u5206\u4e3a\u81f3\u5c11\u4e24\u4e2a\u5f7c\u6b64\u65e0\u6cd5\u901a\u4fe1\u7684\u5355\u72ec\u96c6\u7fa4\uff0c\u6b64\u65f6\u5982\u679c\u4e24\u4e2a\u96c6\u7fa4\u90fd\u5404\u81ea\u5de5\u4f5c\uff0c\u5219\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e25\u91cd\u7684\u6570\u636e\u51b2\u7a81\u548c\u9519\u8bef\u3002\u4e00\u822c\u7684\u8bbe\u8ba1\u601d\u8def\u662f\uff0c\u5f53\u96c6\u7fa4\u5224\u65ad\u53d1\u751f\u4e86\u8111\u88c2\u95ee\u9898\u65f6\uff0c\u89c4\u6a21\u8f83\u5c0f\u7684\u96c6\u7fa4\u5c31\u201c\u81ea\u6740\u201d\u6216\u8005\u62d2\u7edd\u670d\u52a1\u3002 \u5206\u5e03\u5f0f\u4e0e\u96c6\u7fa4\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f \u5206\u5e03\u5f0f\uff1a \u4e00\u4e2a\u4e1a\u52a1\u5206\u62c6\u591a\u4e2a\u5b50\u4e1a\u52a1\uff0c\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a \u96c6\u7fa4\uff1a \u540c\u4e00\u4e2a\u4e1a\u52a1\uff0c\u90e8\u7f72\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\u3002\u6bd4\u5982\u4e4b\u524d\u505a\u7535\u5546\u7f51\u7ad9\u642d\u7684redis\u96c6\u7fa4\u4ee5\u53casolr\u96c6\u7fa4\u90fd\u662f\u5c5e\u4e8e\u5c06redis\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u7f13\u5b58\u670d\u52a1\u4ee5\u53casolr\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u641c\u7d22\u670d\u52a1\u90e8\u7f72\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u6027\u80fd\u3001\u5e76\u53d1\u91cf\u89e3\u51b3\u6d77\u91cf\u5b58\u50a8\u95ee\u9898\u3002 \u95ee2. \u5982\u4f55\u9632\u6b62HA\u96c6\u7fa4\u7684\u8111\u88c2 1. \u5f15\u8a00 \u8111\u88c2\uff08split-brain\uff09\uff0c\u6307\u5728\u4e00\u4e2a\u9ad8\u53ef\u7528\uff08HA\uff09\u7cfb\u7edf\u4e2d\uff0c\u5f53\u8054\u7cfb\u7740\u7684\u4e24\u4e2a\u8282\u70b9\u65ad\u5f00\u8054\u7cfb\u65f6\uff0c\u672c\u6765\u4e3a\u4e00\u4e2a\u6574\u4f53\u7684\u7cfb\u7edf\uff0c\u5206\u88c2\u4e3a\u4e24\u4e2a\u72ec\u7acb\u8282\u70b9\uff0c\u8fd9\u65f6\u4e24\u4e2a\u8282\u70b9\u5f00\u59cb\u4e89\u62a2\u5171\u4eab\u8d44\u6e90\uff0c\u7ed3\u679c\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u6df7\u4e71\uff0c\u6570\u636e\u635f\u574f\u3002 \u5bf9\u4e8e\u65e0\u72b6\u6001\u670d\u52a1\u7684HA\uff0c\u65e0\u6240\u8c13\u8111\u88c2\u4e0d\u8111\u88c2\uff1b\u4f46\u5bf9\u6709\u72b6\u6001\u670d\u52a1(\u6bd4\u5982MySQL)\u7684HA\uff0c\u5fc5\u987b\u8981\u4e25\u683c\u9632\u6b62\u8111\u88c2\u3002\uff08\u4f46\u6709\u4e9b\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u7cfb\u7edf\u6309\u7167\u65e0\u72b6\u6001\u670d\u52a1HA\u7684\u90a3\u4e00\u5957\u53bb\u914d\u7f6e\u6709\u72b6\u6001\u670d\u52a1\uff0c\u7ed3\u679c\u53ef\u60f3\u800c\u77e5\u2026\uff09 2\u5982\u4f55\u9632\u6b62HA\u96c6\u7fa4\u8111\u88c2 \u4e00\u822c\u91c7\u75282\u4e2a\u65b9\u6cd5 \u4ef2\u88c1 \u5f53\u4e24\u4e2a\u8282\u70b9\u51fa\u73b0\u5206\u6b67\u65f6\uff0c\u7531\u7b2c3\u65b9\u7684\u4ef2\u88c1\u8005\u51b3\u5b9a\u542c\u8c01\u7684\u3002\u8fd9\u4e2a\u4ef2\u88c1\u8005\uff0c\u53ef\u80fd\u662f\u4e00\u4e2a\u9501\u670d\u52a1\uff0c\u4e00\u4e2a\u5171\u4eab\u76d8\u6216\u8005\u5176\u5b83\u4ec0\u4e48\u4e1c\u897f\u3002 fencing \u5f53\u4e0d\u80fd\u786e\u5b9a\u67d0\u4e2a\u8282\u70b9\u7684\u72b6\u6001\u65f6\uff0c\u901a\u8fc7fencing\u628a\u5bf9\u65b9\u5e72\u6389\uff0c\u786e\u4fdd\u5171\u4eab\u8d44\u6e90\u88ab\u5b8c\u5168\u91ca\u653e\uff0c\u524d\u63d0\u662f\u5fc5\u987b\u8981\u6709\u53ef\u9760\u7684fence\u8bbe\u5907\u3002 \u7406\u60f3\u7684\u60c5\u51b5\u4e0b\uff0c\u4ee5\u4e0a\u4e24\u8005\u4e00\u4e2a\u90fd\u4e0d\u80fd\u5c11\u3002\u4f46\u662f\uff0c\u5982\u679c\u8282\u70b9\u6ca1\u6709\u4f7f\u7528\u5171\u4eab\u8d44\u6e90\uff0c\u6bd4\u5982\u57fa\u4e8e\u4e3b\u4ece\u590d\u5236\u7684\u6570\u636e\u5e93HA\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5b89\u5168\u7684\u7701\u6389fence\u8bbe\u5907\uff0c\u53ea\u4fdd\u7559\u4ef2\u88c1\u3002\u800c\u4e14\u5f88\u591a\u65f6\u5019\u6211\u4eec\u7684\u73af\u5883\u91cc\u4e5f\u6ca1\u6709\u53ef\u7528\u7684fence\u8bbe\u5907\uff0c\u6bd4\u5982\u5728\u4e91\u4e3b\u673a\u91cc\u3002 \u6240\u4ee5\uff0c\u5355\u7eaf\u7684\u53cc\u8282\u70b9\uff0c\u65e0\u8bba\u5982\u4f55\u4e5f\u9632\u6b62\u4e0d\u4e86\u8111\u88c2\u3002 \u6ca1\u6709fence\u8bbe\u5907\u662f\u5426\u5b89\u5168 \u4ee5PostgreSQL\u6216MySQL\u7684\u6570\u636e\u590d\u5236\u4e3a\u4f8b\u6765\u8bf4\u660e\u8fd9\u4e2a\u95ee\u9898\u3002 \u5ba2\u6237\u7aef\u8def\u7531\u6709\u51e0\u79cd\u65b9\u5f0f\uff0c\u57fa\u4e8eVIP\uff0c\u57fa\u4e8eProxy\uff0c\u57fa\u4e8eDNS\u6216\u8005\u5e72\u8106\u5ba2\u6237\u7aef\u7ef4\u62a4\u4e00\u4e2a\u670d\u52a1\u7aef\u5730\u5740\u5217\u8868\u81ea\u5df1\u5224\u65ad\u4e3b\u4ece\u3002\u4e0d\u7ba1\u91c7\u7528\u54ea\u79cd\u65b9\u5f0f\uff0c\u4e3b\u4ece\u5207\u6362\u7684\u65f6\u5019\u90fd\u8981\u66f4\u65b0\u8def\u7531\u3002 \u57fa\u4e8eVIP\u7684\u8def\u7531\u6709\u4e00\u4e9b\u53d8\u6570\uff0c\u5982\u679c\u672c\u8be5\u6b7b\u6389\u7684\u8282\u70b9\u6ca1\u6709\u6458\u6389\u81ea\u5df1\u8eab\u4e0a\u7684VIP\uff0c\u90a3\u4e48\u5b83\u968f\u65f6\u53ef\u80fd\u51fa\u6765\u6363\u4e71\uff08\u5373\u4f7f\u65b0\u4e3b\u5df2\u7ecf\u901a\u8fc7arping\u66f4\u65b0\u4e86\u6240\u6709\u4e3b\u673a\u4e0a\u7684arp\u7f13\u5b58\uff0c\u5982\u679c\u67d0\u4e2a\u4e3b\u673a\u7684arp\u8fc7\u671f\uff0c\u53d1\u4e00\u4e2aarp\u67e5\u8be2\uff0c\u90a3\u4e48\u5c31\u4f1a\u53d1\u751fip\u51b2\u7a81\uff09\u3002\u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3aVIP\u4e5f\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5171\u4eab\u8d44\u6e90\uff0c\u5fc5\u9700\u628a\u5b83\u4ece\u6545\u969c\u8282\u70b9\u4e0a\u6458\u6389\u3002\u81f3\u4e8e\u600e\u4e48\u6458\uff0c\u6700\u7b80\u5355\u7684\u529e\u6cd5\u5c31\u662f\u6545\u969c\u8282\u70b9\u53d1\u73b0\u81ea\u5df1\u5931\u8054\u540e\u81ea\u5df1\u6458\uff0c\u5982\u679c\u5b83\u8fd8\u6d3b\u7740\u7684\u8bdd\uff08\u5982\u679c\u5b83\u6b7b\u4e86\uff0c\u4e5f\u5c31\u4e0d\u7528\u6458\u4e86\uff09\u3002\u5982\u679c\u8d1f\u8d23\u6458vip\u7684\u8fdb\u7a0b\u65e0\u6cd5\u5de5\u4f5c\u600e\u4e48\u529e\uff1f\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u7528\u4e0a\u672c\u6765\u4e0d\u592a\u9760\u8c31\u7684\u8f6ffence\u8bbe\u5907\u4e86(\u6bd4\u5982ssh)\u3002 \u4e5f\u8981\u8003\u8651Proxy\u7684\u9ad8\u53ef\u7528 \u81f3\u4e8e\u57fa\u4e8e\u670d\u52a1\u7aef\u5730\u5740\u5217\u8868\u7684\u65b9\u6cd5\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u901a\u8fc7\u540e\u53f0\u670d\u52a1\u5224\u65ad\u4e3b\u4ece\uff08\u6bd4\u5982PostgreSQL/MySQL\u4f1a\u8bdd\u662f\u5426\u5904\u4e8e\u53ea\u8bfb\u6a21\u5f0f\uff09\u3002\u8fd9\u65f6\uff0c\u5982\u679c\u51fa\u73b02\u4e2a\u4e3b\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u9519\u4e71\u3002\u4e3a\u9632\u6b62\u8fd9\u4e2a\u95ee\u9898\uff0c\u539f\u4e3b\u8282\u70b9\u53d1\u73b0\u81ea\u5df1\u5931\u8054\u540e\u8981\u81ea\u5df1\u628a\u670d\u52a1\u505c\u6389\uff0c\u8fd9\u548c\u524d\u9762\u6458vip\u7684\u9053\u7406\u662f\u4e00\u6837\u7684\u3002 \u4e3b\u4ece\u5207\u6362\u540e\u6570\u636e\u80fd\u5426\u4fdd\u8bc1\u4e0d\u4e22 \u4e3b\u4ece\u5207\u6362\u540e\u6570\u636e\u4f1a\u4e0d\u4f1a\u4e22\u548c\u8111\u88c2\u53ef\u4ee5\u8ba4\u4e3a\u662f2\u4e2a\u4e0d\u540c\u7684\u95ee\u9898\u3002\u8fd8\u4ee5PostgreSQL\u6216MySQL\u7684\u6570\u636e\u590d\u5236\u4e3a\u4f8b\u6765\u8bf4\u660e\u3002 \u5bf9PostgreSQL\uff0c\u5982\u679c\u914d\u7f6e\u6210\u540c\u6b65\u6d41\u590d\u5236\uff0c\u53ef\u4ee5\u505a\u5230\u4e0d\u7ba1\u8def\u7531\u662f\u5426\u6b63\u786e\uff0c\u90fd\u4e0d\u4f1a\u4e22\u6570\u636e\u3002\u56e0\u4e3a\u8def\u7531\u5230\u9519\u8bef\u8282\u70b9\u7684\u5ba2\u6237\u7aef\u6839\u672c\u5199\u4e0d\u8fdb\u4efb\u4f55\u6570\u636e\uff0c\u5b83\u4f1a\u4e00\u76f4\u7b49\u5f85\u4ece\u8282\u70b9\u7684\u53cd\u9988\uff0c\u800c\u5b83\u4ee5\u4e3a\u7684\u4ece\u8282\u70b9\uff0c\u73b0\u5728\u5df2\u7ecf\u662f\u4e3b\u5b50\u4e86\uff0c\u5f53\u7136\u4e0d\u4f1a\u7406\u5b83\u3002\u5f53\u7136\u5982\u679c\u8001\u662f\u8fd9\u6837\u4e5f\u4e0d\u597d\uff0c\u4f46\u5b83\u7ed9\u96c6\u7fa4\u76d1\u89c6\u8f6f\u4ef6\u7ea0\u6b63\u8def\u7531\u9519\u8bef\u63d0\u4f9b\u4e86\u5145\u8db3\u7684\u65f6\u95f4\u3002 \u5982\u679c\u672c\u6765\u5c31\u662f\u914d\u7f6e\u7684\u5f02\u6b65\u590d\u5236\uff0c\u90a3\u5c31\u662f\u8bf4\u5df2\u7ecf\u505a\u597d\u4e22\u6570\u636e\u7684\u51c6\u5907\u4e86\u3002\u8fd9\u65f6\u5019\uff0c\u4e3b\u4ece\u5207\u6362\u65f6\u4e22\u70b9\u6570\u636e\u4e5f\u6ca1\u5565\u5927\u4e0d\u4e86\uff0c\u4f46\u8981\u63a7\u5236\u81ea\u52a8\u5207\u6362\u7684\u6b21\u6570\u3002\u6bd4\u5982\u63a7\u5236\u5df2\u7ecf\u88abfailover\u6389\u7684\u539f\u4e3b\u4e0d\u5141\u8bb8\u81ea\u52a8\u4e0a\u7ebf\uff0c\u5426\u5219\u5982\u679c\u56e0\u4e3a\u7f51\u7edc\u6296\u52a8\u5bfc\u81f4\u6545\u969c\u5207\u6362\uff0c\u90a3\u4e48\u4e3b\u4ece\u5c31\u4f1a\u4e0d\u505c\u7684\u6765\u56de\u5207\uff0c\u4e0d\u505c\u7684\u4e22\u6570\u636e\uff0c\u7834\u574f\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002 \u5982\u4f55\u5b9e\u73b0\u4e0a\u9762\u7684\u7b56\u7565 \u4f60\u53ef\u4ee5\u81ea\u5df1\u5b8c\u5168\u4ece\u5934\u5f00\u59cb\u5b9e\u73b0\u4e00\u5957\u7b26\u5408\u4e0a\u8ff0\u903b\u8f91\u7684\u811a\u672c\u3002\u4f46\u6211\u66f4\u503e\u5411\u4e8e\u57fa\u4e8e\u6210\u719f\u7684\u96c6\u7fa4\u8f6f\u4ef6\u53bb\u642d\u5efa\uff0c\u6bd4\u5982Pacemaker+Corosync+\u5408\u9002\u7684\u8d44\u6e90Agent\u3002Keepalived\u6211\u662f\u6781\u4e0d\u63a8\u8350\u7684\uff0c\u5b83\u5c31\u4e0d\u9002\u5408\u7528\u4e8e\u6709\u72b6\u6001\u670d\u52a1\u7684HA\uff0c\u5373\u4f7f\u4f60\u628a\u4ef2\u88c1\uff0cfence\u90a3\u4e9b\u4e1c\u897f\u90fd\u52a0\u5230\u65b9\u6848\u91cc\uff0c\u603b\u89c9\u5f97\u522b\u626d\u3002 \u4f7f\u7528Pacemaker+Corosync\u7684\u65b9\u6848\u4e5f\u6709\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879 1\uff09\u4e86\u89e3\u8d44\u6e90Agent\u7684\u529f\u80fd\u548c\u539f\u7406 \u4e86\u89e3\u8d44\u6e90Agent\u7684\u529f\u80fd\u548c\u539f\u7406\uff0c\u624d\u80fd\u77e5\u9053\u5b83\u9002\u7528\u7684\u573a\u666f\u3002\u6bd4\u5982pgsql\u7684\u8d44\u6e90Agent\u662f\u6bd4\u8f83\u5b8c\u5584\u7684\uff0c\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u6d41\u590d\u5236\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u4e24\u8005\u4e4b\u524d\u81ea\u52a8\u5207\u6362\uff0c\u5e76\u4e14\u53ef\u4ee5\u4fdd\u8bc1\u540c\u6b65\u590d\u5236\u4e0b\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002\u4f46\u76ee\u524dMySQL\u7684\u8d44\u6e90Agent\u5c31\u5f88\u5f31\u4e86\uff0c\u6ca1\u6709\u4f7f\u7528GTID\u53c8\u6ca1\u6709\u65e5\u5fd7\u8865\u507f\uff0c\u5f88\u5bb9\u6613\u4e22\u6570\u636e\uff0c\u8fd8\u662f\u4e0d\u8981\u7528\u7684\u597d\uff0c\u7ee7\u7eed\u7528MHA\u5427\uff08\u4f46\u662f\uff0c\u90e8\u7f72MHA\u65f6\u52a1\u5fc5\u8981\u9632\u8303\u8111\u88c2\uff09\u3002 2\uff09\u786e\u4fdd\u6cd5\u5b9a\u7968\u6570(quorum) quorum\u53ef\u4ee5\u8ba4\u4e3a\u662fPacemkaer\u81ea\u5e26\u7684\u4ef2\u88c1\u673a\u5236\uff0c\u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u4e2d\u7684\u591a\u6570\u9009\u51fa\u4e00\u4e2a\u534f\u8c03\u8005\uff0c\u96c6\u7fa4\u7684\u6240\u6709\u6307\u4ee4\u90fd\u7531\u8fd9\u4e2a\u534f\u8c03\u8005\u53d1\u51fa\uff0c\u53ef\u4ee5\u5b8c\u7f8e\u7684\u675c\u7edd\u8111\u88c2\u95ee\u9898\u3002\u4e3a\u4e86\u4f7f\u8fd9\u5957\u673a\u5236\u6709\u6548\u8fd0\u8f6c\uff0c\u96c6\u7fa4\u4e2d\u81f3\u5c11\u67093\u4e2a\u8282\u70b9\uff0c\u5e76\u4e14\u628ano-quorum-policy\u8bbe\u7f6e\u6210stop\uff0c\u8fd9\u4e5f\u662f\u9ed8\u8ba4\u503c\u3002\uff08\u5f88\u591a\u6559\u7a0b\u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\uff0c\u90fd\u628ano-quorum-policy\u8bbe\u7f6e\u6210ignore\uff0c\u751f\u4ea7\u73af\u5883\u5982\u679c\u4e5f\u8fd9\u4e48\u641e\uff0c\u53c8\u6ca1\u6709\u5176\u5b83\u4ef2\u88c1\u673a\u5236\uff0c\u662f\u5f88\u5371\u9669\u7684\uff01\uff09 \u4f46\u662f\uff0c\u5982\u679c\u53ea\u67092\u4e2a\u8282\u70b9\u8be5\u600e\u4e48\u529e\uff1f \u4e00\u662f\u62c9\u4e00\u4e2a\u673a\u5b50\u501f\u7528\u4e00\u4e0b\u51d1\u8db33\u4e2a\u8282\u70b9\uff0c\u518d\u8bbe\u7f6elocation\u9650\u5236\uff0c\u4e0d\u8ba9\u8d44\u6e90\u5206\u914d\u5230\u90a3\u4e2a\u8282\u70b9\u4e0a\u3002 \u4e8c\u662f\u628a\u591a\u4e2a\u4e0d\u6ee1\u8db3quorum\u5c0f\u96c6\u7fa4\u62c9\u5230\u4e00\u8d77\uff0c\u7ec4\u6210\u4e00\u4e2a\u5927\u7684\u96c6\u7fa4\uff0c\u540c\u6837\u9002\u7528location\u9650\u5236\u63a7\u5236\u8d44\u6e90\u7684\u5206\u914d\u7684\u4f4d\u7f6e\u3002 \u4f46\u662f\u5982\u679c\u4f60\u6709\u5f88\u591a\u53cc\u8282\u70b9\u96c6\u7fa4\uff0c\u627e\u4e0d\u5230\u90a3\u4e48\u591a\u7528\u4e8e\u51d1\u6570\u7684\u8282\u70b9\uff0c\u53c8\u4e0d\u60f3\u628a\u8fd9\u4e9b\u53cc\u8282\u70b9\u96c6\u7fa4\u62c9\u5230\u4e00\u8d77\u51d1\u6210\u4e00\u4e2a\u5927\u7684\u96c6\u7fa4\uff08\u6bd4\u5982\u89c9\u5f97\u4e0d\u65b9\u4fbf\u7ba1\u7406\uff09\u3002\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u7b2c\u4e09\u79cd\u65b9\u6cd5\u3002 \u7b2c\u4e09\u79cd\u65b9\u6cd5\u662f\u914d\u7f6e\u4e00\u4e2a\u62a2\u5360\u8d44\u6e90\uff0c\u4ee5\u53ca\u670d\u52a1\u548c\u8fd9\u4e2a\u62a2\u5360\u8d44\u6e90\u7684colocation\u7ea6\u675f\uff0c\u8c01\u62a2\u5230\u62a2\u5360\u8d44\u6e90\u8c01\u63d0\u4f9b\u670d\u52a1\u3002\u8fd9\u4e2a\u62a2\u5360\u8d44\u6e90\u53ef\u4ee5\u662f\u67d0\u4e2a\u9501\u670d\u52a1\uff0c\u6bd4\u5982\u57fa\u4e8ezookeeper\u5305\u88c5\u4e00\u4e2a\uff0c\u6216\u8005\u5e72\u8106\u81ea\u5df1\u4ece\u5934\u505a\u4e00\u4e2a\uff0c\u5c31\u50cf\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u3002http://my.oschina.net/hanhanztj/blog/515065\uff08\u8fd9\u4e2a\u4f8b\u5b50\u662f\u57fa\u4e8ehttp\u534f\u8bae\u7684\u77ed\u8fde\u63a5\uff0c\u66f4\u7ec6\u81f4\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u957f\u8fde\u63a5\u5fc3\u8df3\u68c0\u6d4b\uff0c\u8fd9\u6837\u670d\u52a1\u7aef\u53ef\u4ee5\u53ca\u65f6\u68c0\u51fa\u8fde\u63a5\u65ad\u5f00\u800c\u91ca\u653e\u9501\uff09\u4f46\u662f\uff0c\u4e00\u5b9a\u8981\u540c\u65f6\u786e\u4fdd\u8fd9\u4e2a\u62a2\u5360\u8d44\u6e90\u7684\u9ad8\u53ef\u7528\uff0c\u53ef\u4ee5\u628a\u63d0\u4f9b\u62a2\u5360\u8d44\u6e90\u7684\u670d\u52a1\u505a\u6210lingyig\u9ad8\u53ef\u7528\u7684\uff0c\u4e5f\u53ef\u4ee5\u7b80\u5355\u70b9\uff0c\u90e8\u7f723\u4e2a\u670d\u52a1\uff0c\u53cc\u8282\u70b9\u4e0a\u4e2a\u90e8\u7f72\u4e00\u4e2a\uff0c\u7b2c\u4e09\u4e2a\u90e8\u7f72\u5728\u53e6\u5916\u4e00\u4e2a\u4e13\u95e8\u7684\u4ef2\u88c1\u8282\u70b9\u4e0a\uff0c\u81f3\u5c11\u83b7\u53d63\u4e2a\u9501\u4e2d\u76842\u4e2a\u624d\u89c6\u4e3a\u53d6\u5f97\u4e86\u9501\u3002\u8fd9\u4e2a\u4ef2\u88c1\u8282\u70b9\u53ef\u4ee5\u4e3a\u5f88\u591a\u96c6\u7fa4\u63d0\u4f9b\u4ef2\u88c1\u670d\u52a1\uff08\u56e0\u4e3a\u4e00\u4e2a\u673a\u5668\u53ea\u80fd\u90e8\u7f72\u4e00\u4e2aPacemaker\u5b9e\u4f8b\uff0c\u5426\u5219\u53ef\u4ee5\u7528\u90e8\u7f72\u4e86N\u4e2aPacemaker\u5b9e\u4f8b\u7684\u4ef2\u88c1\u8282\u70b9\u505a\u540c\u6837\u7684\u4e8b\u60c5\u3002\uff09\u3002\u4f46\u662f\uff0c\u5982\u975e\u8feb\u4e0d\u5f97\u5df2\uff0c\u5c3d\u91cf\u8fd8\u662f\u91c7\u7528\u524d\u9762\u7684\u65b9\u6cd5\uff0c\u5373\u6ee1\u8db3Pacemaker\u6cd5\u5b9a\u7968\u6570\uff0c\u8fd9\u79cd\u65b9\u6cd5\u66f4\u7b80\u5355\uff0c\u53ef\u9760 \u95ee3. \u5fae\u670d\u52a1\u67b6\u6784\u57fa\u672c\u7406\u5ff5\u548c\u539f\u5219\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u5728\u56e2\u961f\u4e2d\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u5b9e\u884c\u5fae\u670d\u52a1\u67b6\u6784\u8fc7\u7a0b\u4e2d\u78b0\u5230\u7684\u95ee\u9898\u53ca\u5176\u89e3\u51b3\u65b9\u6848\u3002 \u5173\u952e\u601d\u8def \u5bf9\u4e8e\u5fae\u670d\u52a1\u67b6\u6784\u800c\u8a00\uff0c\u670d\u52a1\u5efa\u6a21\u3001\u670d\u52a1\u62c6\u5206\u548c\u670d\u52a1\u96c6\u6210\u662f\u57fa\u672c\u7684\u8bbe\u8ba1\u7406\u5ff5\uff0c\u800c RPC\u3001RESTful\u3001API \u7f51\u5173\u3001\u5206\u5e03\u5f0f\u914d\u7f6e\u4e2d\u5fc3\u7b49\u57fa\u7840\u7ec4\u4ef6\u4ee5\u53ca\u670d\u52a1\u53ef\u7528\u6027\u548c\u6570\u636e\u6700\u7ec8\u4e00\u81f4\u6027\u7b49\u5173\u952e\u8981\u7d20\u4e5f\u662f\u91cd\u70b9\u5185\u5bb9\u3002\u81f3\u4e8e\u5f15\u5165\u5fae\u670d\u52a1\u67b6\u6784\u7684\u539f\u56e0\u548c\u78b0\u5230\u7684\u56f0\u96be\uff0c\u56e2\u961f\u4e1a\u52a1\u53d1\u5c55\u7279\u70b9\u548c\u7ec4\u7ec7\u67b6\u6784\u3001\u5fae\u670d\u52a1\u7c92\u5ea6\u548c\u8fb9\u754c\u7b49\u90fd\u662f\u56de\u7b54\u8be5\u95ee\u9898\u7684\u5207\u5165\u70b9\u3002\u4e3a\u4e86\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u6211\u4eec\u53ef\u4ee5\u5f15\u5165 Spring Cloud \u7b49\u76f8\u5bf9\u5b8c\u5584\u7684\u6280\u672f\u5b9e\u73b0\u4f53\u7cfb\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Dubbo \u4f5c\u4e3a\u6211\u4eec\u7684\u57fa\u7840\u5fae\u670d\u52a1\u67b6\u6784\u3002 \u53c2\u8003\u7b54\u6848\uff1a \u4e00\u4f53\u5316\u67b6\u6784\u7684\u95ee\u9898 \u6216\u8005\u8bf4\u662f\u5fae\u670d\u52a1\u67b6\u6784\u6240\u89e3\u51b3\u7684\u95ee\u9898\u3002 1.\u96be\u4ee5\u6269\u5c55 \u4e00\u4f53\u5316\u67b6\u6784\u5e94\u7528\u53ea\u80fd\u901a\u8fc7\u5728\u8d1f\u8f7d\u5747\u8861\u5668\u540e\u9762\u653e\u7f6e\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u591a\u4e2a\u5b9e\u4f8b\u6765\u8fdb\u884c\u6c34\u5e73\u6269\u5c55\u3002\u5982\u679c\u5e94\u7528\u4e2d\u7684\u7279\u5b9a\u670d\u52a1\u9700\u8981\u6269\u5c55\uff0c\u5219\u6ca1\u6709\u7b80\u5355\u7684\u9009\u9879\u3002\u6211\u4eec\u9700\u8981\u5b8c\u6574\u5730\u6269\u5c55\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u663e\u7136\u4f1a\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u8d44\u6e90\u6d6a\u8d39\u3002 \u76f8\u6bd4\u4e4b\u4e0b\uff0c\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u5141\u8bb8\u6211\u4eec\u6839\u636e\u9700\u8981\u72ec\u7acb\u6269\u5c55\u5355\u4e2a\u670d\u52a1\u3002\u5728\u4e0a\u56fe\u4e2d\uff0c\u5982\u679c\u9700\u8981\u7f29\u653e\u670d\u52a1B\uff0c\u5219\u53ef\u4ee5\u670910\u4e2a\u5b9e\u4f8b\uff0c\u540c\u65f6\u4fdd\u6301\u5176\u4ed6\u5b9e\u4f8b\uff0c\u5e76\u53ef\u4ee5\u6839\u636e\u9700\u8981\u968f\u65f6\u66f4\u6539\u3002 2.\u4ea4\u4ed8\u65f6\u95f4\u957f \u4e00\u4f53\u5316\u67b6\u6784\u5728\u5355\u4e2a\u5e94\u7528\u7684\u4efb\u4f55\u90e8\u5206/\u5c42\u4e2d\u8fdb\u884c\u7684\u4efb\u4f55\u66f4\u6539\u90fd\u9700\u8981\u6784\u5efa\u548c\u90e8\u7f72\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002\u4e2a\u4eba\u5f00\u53d1\u4eba\u5458\u8fd8\u9700\u8981\u4e0b\u8f7d\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u6765\u4fee\u590d\u548c\u6d4b\u8bd5\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u53d7\u5f71\u54cd\u7684\u6a21\u5757\uff0c\u8fd9\u5c31\u5f71\u54cd\u5230\u4e86\u6301\u7eed\u90e8\u7f72\u7684\u6548\u7387\u3002 \u800c\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5982\u679c\u4ec5\u5728\u4e00\u767e\u4e2a\u5fae\u670d\u52a1\u4e2d\u7684\u4e00\u4e2a\u4e2d\u9700\u8981\u6539\u53d8\uff0c\u5219\u4ec5\u6784\u5efa\u548c\u90e8\u7f72\u6539\u53d8\u7684\u5fae\u670d\u52a1\uff0c\u6ca1\u6709\u5fc5\u8981\u90e8\u7f72\u4e00\u5207\u3002\u6211\u4eec\u751a\u81f3\u53ef\u4ee5\u5728\u77ed\u65f6\u95f4\u5185\u591a\u6b21\u90e8\u7f72\u3002 3.\u5e94\u7528\u590d\u6742\u6027 \u8fc7\u53bb\uff0c\u968f\u7740\u5e94\u7528\u89c4\u6a21\u7684\u589e\u957f\uff08\u529f\u80fd\u3001\u529f\u80fd\u7b49\uff09\uff0c\u56e2\u961f\u4e5f\u4f1a\u76f8\u5e94\u6269\u5f20\uff0c\u5e94\u7528\u5f88\u5feb\u5c31\u5c31\u4f1a\u53d8\u5f97\u590d\u6742\u548c\u4ea4\u7ec7\u5728\u4e00\u8d77\u3002\u968f\u7740\u4e0d\u540c\u7684\u56e2\u961f\u4e0d\u65ad\u4fee\u6539\u4ee3\u7801\uff0c\u7ef4\u62a4\u6a21\u5757\u5316\u7ed3\u6784\u6162\u6162\u53d8\u5f97\u8d8a\u6765\u8d8a\u56f0\u96be\uff0c\u5e76\u6162\u6162\u5bfc\u81f4\u50cf\u610f\u5927\u5229\u9762\u4e00\u6837\u4ea4\u7ec7\u7684\u4ee3\u7801\u3002\u8fd9\u4e0d\u4ec5\u4f1a\u5f71\u54cd\u4ee3\u7801\u8d28\u91cf\uff0c\u8fd8\u4f1a\u5f71\u54cd\u6574\u4e2a\u7ec4\u7ec7\u3002 \u5728\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u4e2d\uff0c\u6bcf\u4e2a\u56e2\u961f\u90fd\u5728\u5355\u72ec\u7684\u5fae\u670d\u52a1\u4e0a\u5de5\u4f5c\uff0c\u4ee3\u7801\u4f1a\u6709\u5e8f\u5f88\u591a\u3002 4.\u6ca1\u6709\u660e\u786e\u7684\u6240\u6709\u6743 \u5728\u4e00\u4f53\u5316\u5e94\u7528\u4e2d\uff0c\u770b\u8d77\u6765\u72ec\u7acb\u7684\u56e2\u961f\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u72ec\u7acb\u7684\u3002\u5b83\u4eec\u540c\u65f6\u5728\u76f8\u540c\u7684\u4ee3\u7801\u5e93\u4e0a\u5de5\u4f5c\uff0c\u4e25\u91cd\u4f9d\u8d56\u4e8e\u5f7c\u6b64\u3002 \u5728\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u4e2d\uff0c\u72ec\u7acb\u56e2\u961f\u5904\u7406\u5355\u72ec\u7684\u5fae\u670d\u52a1\u3002\u4e00\u4e2a\u56e2\u961f\u5c06\u62e5\u6709\u4e00\u4e2a\u5b8c\u6574\u7684\u5fae\u670d\u52a1\u3002\u5de5\u4f5c\u7684\u660e\u786e\u6240\u6709\u6743\u660e\u786e\u63a7\u5236\u670d\u52a1\u7684\u4e00\u5207\uff0c\u5305\u62ec\u5f00\u53d1\u3001\u90e8\u7f72\u548c\u76d1\u63a7\u3002 5.\u6545\u969c\u7ea7\u8054 \u5982\u679c\u6ca1\u6709\u6b63\u786e\u8bbe\u8ba1\uff0c\u4e00\u4f53\u5316\u4ea4\u5abe\u5e94\u7528\u7684\u4e00\u90e8\u5206\u5931\u8d25\u53ef\u80fd\u4f1a\u7ea7\u8054\u5e76\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u5d29\u6e83\u3002 \u5728\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u67b6\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u65ad\u8def\u5668\u6765\u907f\u514d\u8fd9\u79cd\u6545\u969c\u3002 6.Dev\u548cOps\u4e4b\u95f4\u7684\u5899 \u5f00\u53d1\u56e2\u961f\u901a\u5e38\u4f1a\u8fdb\u884c\u5f00\u53d1\u3001\u6d4b\u8bd5\uff0c\u4e00\u65e6\u90e8\u7f72\uff0c\u5c31\u4f1a\u5c06\u7ef4\u62a4\u548c\u652f\u6301\u7684\u6240\u6709\u6743\u4ea4\u7ed9\u8fd0\u7ef4\u56e2\u961f\uff0c\u5e94\u7528\u6b64\u65f6\u4e0e\u5f00\u53d1\u56e2\u961f\u65e0\u5173\u4e86\uff0c\u800c\u8fd0\u7ef4\u56e2\u961f\u9700\u8981\u52aa\u529b\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u652f\u6301\u4e00\u4f53\u5316\u67b6\u6784\u5e94\u7528\u3002 \u5728\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u4e2d\uff0c\u56e2\u961f\u7684\u7ec4\u7ec7\u7406\u89e3\u4e3a\u201c\u6784\u5efa\u5b83\u3001\u8fd0\u884c\u5b83\u201d\uff0c\u5f00\u53d1\u56e2\u961f\u7ee7\u7eed\u5728\u751f\u4ea7\u4e2d\u62e5\u6709\u8be5\u5e94\u7528\u3002 7.\u9677\u5165\u67d0\u79cd\u6280\u672f/\u8bed\u8a00 \u4f7f\u7528\u4e00\u4f53\u5316\u67b6\u6784\uff0c\u610f\u5473\u7740\u88ab\u67d0\u79cd\u5df2\u5b9e\u73b0\u7684\u6280\u672f/\u8bed\u8a00\u9501\u5b9a\u3002\u5982\u679c\u9700\u8981\u66f4\u6539\u6280\u672f/\u8bed\u8a00\uff0c\u5219\u5fc5\u987b\u91cd\u5199\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002 \u4f7f\u7528\u5fae\u670d\u52a1\uff0c\u6bcf\u4e2a\u670d\u52a1\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u548c\u4e1a\u52a1\u4ee5\u4e0d\u540c\u7684\u6280\u672f\u6216\u8bed\u8a00\u5b9e\u73b0\u3002\u4efb\u4f55\u6539\u53d8\u670d\u52a1\u6280\u672f/\u8bed\u8a00\u7684\u51b3\u5b9a\u90fd\u53ea\u9700\u8981\u91cd\u5199\u8be5\u7279\u5b9a\u670d\u52a1\uff0c\u56e0\u4e3a\u6240\u6709\u5fae\u670d\u52a1\u90fd\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002 8.\u652f\u6301\u5fae\u670d\u52a1\u7684\u6b63\u786e\u5de5\u5177/\u6280\u672f\u7684\u53ef\u7528\u6027 \u51e0\u5e74\u524d\uff0c\u6211\u4eec\u8fd8\u6ca1\u6709\u9002\u5f53\u7684\u5de5\u5177\u548c\u6280\u672f\u6765\u652f\u6301\u5fae\u670d\u52a1\u3002\u4f46\u81ea\u4eceDocker\u5bb9\u5668\u548c\u4e91\u57fa\u7840\u8bbe\u65bd\uff08\u7279\u522b\u662fPaaS\uff09\u5411\u5927\u4f17\u63d0\u4f9b\u670d\u52a1\u4ee5\u6765\uff0c\u5fae\u670d\u52a1\u6b63\u5728\u5927\u89c4\u6a21\u91c7\u7528\uff0c\u56e0\u4e3a\u5b83\u4eec\u63d0\u4f9b\u4e86\u6211\u4eec\u6240\u9700\u7684\u201c\u81ea\u7531\u201d\uff0c\u800c\u65e0\u9700\u8fdb\u884c\u4f20\u7edf\u7684\u914d\u7f6e\u7a0b\u5e8f\u3002 \u5c0f\u7ed3 \u7b80\u5355\u6765\u8bf4\uff0c\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784\u4f1a\u83b7\u5f97\u4ee5\u4e0b\u597d\u5904\uff1a \u72ec\u7acb\u5f00\u53d1\u90e8\u7f72\u670d\u52a1 \u901f\u5ea6\u548c\u654f\u6377\u6027 \u66f4\u9ad8\u7684\u4ee3\u7801\u8d28\u91cf \u83b7\u5f97\u56f4\u7ed5\u4e1a\u52a1\u529f\u80fd\u521b\u5efa/\u7ec4\u7ec7\u7684\u4ee3\u7801 \u63d0\u9ad8\u751f\u4ea7\u529b \u66f4\u5bb9\u6613\u6269\u5c55 \u81ea\u7531\uff08\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\uff09\u9009\u62e9\u5b9e\u65bd\u6280\u672f/\u8bed\u8a00 \u95ee3. RPC \u7684\u6982\u5ff5\u53ca\u5176\u5305\u542b\u7684\u6838\u5fc3\u7ec4\u4ef6\u548c\u4e3b\u6d41\u5b9e\u73b0\u6280\u672f\uff0c\u5982\u4f55\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 RPC \u6846\u67b6\u3002 \u5173\u952e\u601d\u8def \u8be5\u9762\u8bd5\u9898\u76f8\u5bf9\u5bb9\u6613\u56de\u7b54\uff0cRPC \u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u57fa\u7840\uff0c\u4ece\u601d\u8def\u4e0a\u6211\u4eec\u5e94\u8be5\u7406\u89e3\u5b83\u662f\u7531\u7f51\u7edc\u901a\u4fe1\u3001\u5e8f\u5217\u5316\u3001\u4f20\u8f93\u534f\u8bae\u3001\u670d\u52a1\u8c03\u7528\u7b49\u7ec4\u4ef6\u6240\u6784\u6210\u3002\u540c\u65f6\uff0c\u5bf9\u4e1a\u754c\u4e3b\u6d41 RPC \u7684\u5b9e\u73b0\u6280\u672f\u4e5f\u8981\u6709\u8db3\u591f\u7684\u4e86\u89e3\uff0c\u5982 Alibaba Dubbo\u3001Google gRPC\u3001Facebook Thrift \u7b49\u3002 RPC\u7684\u7531\u6765 \u968f\u7740\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0c\u7f51\u7ad9\u5e94\u7528\u7684\u89c4\u6a21\u4e0d\u65ad\u6269\u5927\uff0c\u5e38\u89c4\u7684\u5782\u76f4\u5e94\u7528\u67b6\u6784\u5df2\u65e0\u6cd5\u5e94\u5bf9\uff0c\u5206\u5e03\u5f0f\u670d\u52a1\u67b6\u6784\u4ee5\u53ca\u6d41\u52a8\u8ba1\u7b97\u67b6\u6784\u52bf\u5728\u5fc5\u884c\uff0c\u4e9f\u9700\u4e00\u4e2a\u6cbb\u7406\u7cfb\u7edf\u786e\u4fdd\u67b6\u6784\u6709\u6761\u4e0d\u7d0a\u7684\u6f14\u8fdb\u3002 \u5355\u4e00\u5e94\u7528\u67b6\u6784 \u5f53\u7f51\u7ad9\u6d41\u91cf\u5f88\u5c0f\u65f6\uff0c\u53ea\u9700\u4e00\u4e2a\u5e94\u7528\uff0c\u5c06\u6240\u6709\u529f\u80fd\u90fd\u90e8\u7f72\u5728\u4e00\u8d77\uff0c\u4ee5\u51cf\u5c11\u90e8\u7f72\u8282\u70b9\u548c\u6210\u672c\u3002 \u6b64\u65f6\uff0c\u7528\u4e8e\u7b80\u5316\u589e\u5220\u6539\u67e5\u5de5\u4f5c\u91cf\u7684 \u6570\u636e\u8bbf\u95ee\u6846\u67b6\uff08ORM\uff09 \u662f\u5173\u952e\u3002 \u5782\u76f4\u5e94\u7528\u67b6\u6784 \u5f53\u8bbf\u95ee\u91cf\u9010\u6e10\u589e\u5927\uff0c\u5355\u4e00\u5e94\u7528\u589e\u52a0\u673a\u5668\u5e26\u6765\u7684\u52a0\u901f\u5ea6\u8d8a\u6765\u8d8a\u5c0f\uff0c\u5c06\u5e94\u7528\u62c6\u6210\u4e92\u4e0d\u76f8\u5e72\u7684\u51e0\u4e2a\u5e94\u7528\uff0c\u4ee5\u63d0\u5347\u6548\u7387\u3002 \u6b64\u65f6\uff0c\u7528\u4e8e\u52a0\u901f\u524d\u7aef\u9875\u9762\u5f00\u53d1\u7684 Web\u6846\u67b6\uff08MVC\uff09 \u662f\u5173\u952e\u3002 \u5206\u5e03\u5f0f\u670d\u52a1\u67b6\u6784 \u5f53\u5782\u76f4\u5e94\u7528\u8d8a\u6765\u8d8a\u591a\uff0c\u5e94\u7528\u4e4b\u95f4\u4ea4\u4e92\u4e0d\u53ef\u907f\u514d\uff0c\u5c06\u6838\u5fc3\u4e1a\u52a1\u62bd\u53d6\u51fa\u6765\uff0c\u4f5c\u4e3a\u72ec\u7acb\u7684\u670d\u52a1\uff0c\u9010\u6e10\u5f62\u6210\u7a33\u5b9a\u7684\u670d\u52a1\u4e2d\u5fc3\uff0c\u4f7f\u524d\u7aef\u5e94\u7528\u80fd\u66f4\u5feb\u901f\u7684\u54cd\u5e94\u591a\u53d8\u7684\u5e02\u573a\u9700\u6c42\u3002 \u6b64\u65f6\uff0c\u7528\u4e8e\u63d0\u9ad8\u4e1a\u52a1\u590d\u7528\u53ca\u6574\u5408\u7684 \u5206\u5e03\u5f0f\u670d\u52a1\u6846\u67b6\uff08RPC\uff09\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\u670d\u52a1\u662f\u5173\u952e\u3002 \u4f8b\u5982\uff1a\u5404\u4e2a\u56e2\u961f\u7684\u670d\u52a1\u63d0\u4f9b\u65b9\u5c31\u4e0d\u8981\u5404\u81ea\u5b9e\u73b0\u4e00\u5957\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u3001\u7f51\u7edc\u6846\u67b6\u3001\u8fde\u63a5\u6c60\u3001\u6536\u53d1\u7ebf\u7a0b\u3001\u8d85\u65f6\u5904\u7406\u3001\u72b6\u6001\u673a\u7b49\u201c\u4e1a\u52a1\u4e4b\u5916\u201d\u7684\u91cd\u590d\u6280\u672f\u52b3\u52a8\uff0c\u9020\u6210\u6574\u4f53\u7684\u4f4e\u6548\u3002 \u6240\u4ee5\uff0c\u7edf\u4e00RPC\u6846\u67b6\u6765\u89e3\u51b3\u63d0\u4f9b\u7edf\u4e00\u7684\u670d\u52a1\u3002 \u4ee5\u4e0b\u6211\u5c06\u5206\u522b\u4ece\u5982\u4e0b\u56db\u4e2a\u65b9\u9762\u8be6\u89e3RPC\u3002 RPC\u7684\u5b9e\u73b0\u539f\u7406 \u4e5f\u5c31\u662f\u8bf4\u4e24\u53f0\u670d\u52a1\u5668A\uff0cB\uff0c\u4e00\u4e2a\u5e94\u7528\u90e8\u7f72\u5728A\u670d\u52a1\u5668\u4e0a\uff0c\u60f3\u8981\u8c03\u7528B\u670d\u52a1\u5668\u4e0a\u5e94\u7528\u63d0\u4f9b\u7684\u51fd\u6570/\u65b9\u6cd5\uff0c\u7531\u4e8e\u4e0d\u5728\u4e00\u4e2a\u5185\u5b58\u7a7a\u95f4\uff0c\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\uff0c\u9700\u8981\u901a\u8fc7\u7f51\u7edc\u6765\u8868\u8fbe\u8c03\u7528\u7684\u8bed\u4e49\u548c\u4f20\u8fbe\u8c03\u7528\u7684\u6570\u636e\u3002 \u6bd4\u5982\u8bf4\uff0cA\u670d\u52a1\u5668\u60f3\u8c03\u7528B\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a\u65b9\u6cd5\uff1a Employee getEmployeeByName\uff08String fullName\uff09 \u6574\u4e2a\u8c03\u7528\u8fc7\u7a0b\uff0c\u4e3b\u8981\u7ecf\u5386\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a 1\u3001\u5efa\u7acb\u901a\u4fe1 \u9996\u5148\u8981\u89e3\u51b3\u901a\u8baf\u7684\u95ee\u9898\uff1a\u5373A\u673a\u5668\u60f3\u8981\u8c03\u7528B\u673a\u5668\uff0c\u9996\u5148\u5f97\u5efa\u7acb\u8d77\u901a\u4fe1\u8fde\u63a5\u3002 \u4e3b\u8981\u662f\u901a\u8fc7\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u5efa\u7acbTCP\u8fde\u63a5\uff0c\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u7684\u6240\u6709\u4ea4\u6362\u7684\u6570\u636e\u90fd\u5728\u8fd9\u4e2a\u8fde\u63a5\u91cc\u4f20\u8f93\u3002\u8fde\u63a5\u53ef\u4ee5\u662f\u6309\u9700\u8fde\u63a5\uff0c\u8c03\u7528\u7ed3\u675f\u540e\u5c31\u65ad\u6389\uff0c\u4e5f\u53ef\u4ee5\u662f\u957f\u8fde\u63a5\uff0c\u591a\u4e2a\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u5171\u4eab\u540c\u4e00\u4e2a\u8fde\u63a5\u3002 2\u3001\u670d\u52a1\u5bfb\u5740 \u8981\u89e3\u51b3\u5bfb\u5740\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cA\u670d\u52a1\u5668\u4e0a\u7684\u5e94\u7528\u600e\u4e48\u544a\u8bc9\u5e95\u5c42\u7684RPC\u6846\u67b6\uff0c\u5982\u4f55\u8fde\u63a5\u5230B\u670d\u52a1\u5668\uff08\u5982\u4e3b\u673a\u6216IP\u5730\u5740\uff09\u4ee5\u53ca\u7279\u5b9a\u7684\u7aef\u53e3\uff0c\u65b9\u6cd5\u7684\u540d\u79f0\u540d\u79f0\u662f\u4ec0\u4e48\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u9700\u8981\u63d0\u4f9bB\u673a\u5668\uff08\u4e3b\u673a\u540d\u6216IP\u5730\u5740\uff09\u4ee5\u53ca\u7279\u5b9a\u7684\u7aef\u53e3\uff0c\u7136\u540e\u6307\u5b9a\u8c03\u7528\u7684\u65b9\u6cd5\u6216\u8005\u51fd\u6570\u7684\u540d\u79f0\u4ee5\u53ca\u5165\u53c2\u51fa\u53c2\u7b49\u4fe1\u606f\uff0c\u8fd9\u6837\u624d\u80fd\u5b8c\u6210\u670d\u52a1\u7684\u4e00\u4e2a\u8c03\u7528\u3002 \u53ef\u9760\u7684\u5bfb\u5740\u65b9\u5f0f\uff08\u4e3b\u8981\u662f\u63d0\u4f9b\u670d\u52a1\u7684\u53d1\u73b0\uff09\u662fRPC\u7684\u5b9e\u73b0\u57fa\u77f3\uff0c\u6bd4\u5982\u53ef\u4ee5\u91c7\u7528redis\u6216\u8005zookeeper\u6765\u6ce8\u518c\u670d\u52a1\u7b49\u7b49\u3002 \u4ece\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u89d2\u5ea6\u770b\uff1a\u5f53\u63d0\u4f9b\u8005\u670d\u52a1\u542f\u52a8\u65f6\uff0c\u9700\u8981\u81ea\u52a8\u5411\u6ce8\u518c\u4e2d\u5fc3\u6ce8\u518c\u670d\u52a1\uff1b \u5f53\u63d0\u4f9b\u8005\u670d\u52a1\u505c\u6b62\u65f6\uff0c\u9700\u8981\u5411\u6ce8\u518c\u4e2d\u5fc3\u6ce8\u9500\u670d\u52a1\uff1b \u63d0\u4f9b\u8005\u9700\u8981\u5b9a\u65f6\u5411\u6ce8\u518c\u4e2d\u5fc3\u53d1\u9001\u5fc3\u8df3\uff0c\u4e00\u6bb5\u65f6\u95f4\u672a\u6536\u5230\u6765\u81ea\u63d0\u4f9b\u8005\u7684\u5fc3\u8df3\u540e\uff0c\u8ba4\u4e3a\u63d0\u4f9b\u8005\u5df2\u7ecf\u505c\u6b62\u670d\u52a1\uff0c\u4ece\u6ce8\u518c\u4e2d\u5fc3\u4e0a\u6458\u53d6\u6389\u5bf9\u5e94\u7684\u670d\u52a1\u3002 \u4ece\u8c03\u7528\u8005\u7684\u89d2\u5ea6\u770b\uff1a\u8c03\u7528\u8005\u542f\u52a8\u65f6\u8ba2\u9605\u6ce8\u518c\u4e2d\u5fc3\u7684\u6d88\u606f\u5e76\u4ece\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u63d0\u4f9b\u8005\u7684\u5730\u5740\uff1b \u5f53\u6709\u63d0\u4f9b\u8005\u4e0a\u7ebf\u6216\u8005\u4e0b\u7ebf\u65f6\uff0c\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u544a\u77e5\u5230\u8c03\u7528\u8005\uff1b \u8c03\u7528\u8005\u4e0b\u7ebf\u65f6\uff0c\u53d6\u6d88\u8ba2\u9605\u3002 3\u3001\u7f51\u7edc\u4f20\u8f93 3.1\u3001\u5e8f\u5217\u5316 \u5f53A\u673a\u5668\u4e0a\u7684\u5e94\u7528\u53d1\u8d77\u4e00\u4e2aRPC\u8c03\u7528\u65f6\uff0c\u8c03\u7528\u65b9\u6cd5\u548c\u5176\u5165\u53c2\u7b49\u4fe1\u606f\u9700\u8981\u901a\u8fc7\u5e95\u5c42\u7684\u7f51\u7edc\u534f\u8bae\u5982TCP\u4f20\u8f93\u5230B\u673a\u5668\uff0c\u7531\u4e8e\u7f51\u7edc\u534f\u8bae\u662f\u57fa\u4e8e\u4e8c\u8fdb\u5236\u7684\uff0c\u6240\u6709\u6211\u4eec\u4f20\u8f93\u7684\u53c2\u6570\u6570\u636e\u90fd\u9700\u8981\u5148\u8fdb\u884c\u5e8f\u5217\u5316\uff08Serialize\uff09\u6216\u8005\u7f16\u7ec4\uff08marshal\uff09\u6210\u4e8c\u8fdb\u5236\u7684\u5f62\u5f0f\u624d\u80fd\u5728\u7f51\u7edc\u4e2d\u8fdb\u884c\u4f20\u8f93\u3002\u7136\u540e\u901a\u8fc7\u5bfb\u5740\u64cd\u4f5c\u548c\u7f51\u7edc\u4f20\u8f93\u5c06\u5e8f\u5217\u5316\u6216\u8005\u7f16\u7ec4\u4e4b\u540e\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u53d1\u9001\u7ed9B\u673a\u5668\u3002 3.2\u3001\u53cd\u5e8f\u5217\u5316 \u5f53B\u673a\u5668\u63a5\u6536\u5230A\u673a\u5668\u7684\u5e94\u7528\u53d1\u6765\u7684\u8bf7\u6c42\u4e4b\u540e\uff0c\u53c8\u9700\u8981\u5bf9\u63a5\u6536\u5230\u7684\u53c2\u6570\u7b49\u4fe1\u606f\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff08\u5e8f\u5217\u5316\u7684\u9006\u64cd\u4f5c\uff09\uff0c\u5373\u5c06\u4e8c\u8fdb\u5236\u4fe1\u606f\u6062\u590d\u4e3a\u5185\u5b58\u4e2d\u7684\u8868\u8fbe\u65b9\u5f0f\uff0c\u7136\u540e\u518d\u627e\u5230\u5bf9\u5e94\u7684\u65b9\u6cd5\uff08\u5bfb\u5740\u7684\u4e00\u90e8\u5206\uff09\u8fdb\u884c\u672c\u5730\u8c03\u7528\uff08\u4e00\u822c\u662f\u901a\u8fc7\u751f\u6210\u4ee3\u7406Proxy\u53bb\u8c03\u7528, \u901a\u5e38\u4f1a\u6709JDK\u52a8\u6001\u4ee3\u7406\u3001CGLIB\u52a8\u6001\u4ee3\u7406\u3001Javassist\u751f\u6210\u5b57\u8282\u7801\u6280\u672f\u7b49\uff09\uff0c\u4e4b\u540e\u5f97\u5230\u8c03\u7528\u7684\u8fd4\u56de\u503c\u3002 4\u3001\u670d\u52a1\u8c03\u7528 B\u673a\u5668\u8fdb\u884c\u672c\u5730\u8c03\u7528\uff08\u901a\u8fc7\u4ee3\u7406Proxy\uff09\u4e4b\u540e\u5f97\u5230\u4e86\u8fd4\u56de\u503c\uff0c\u6b64\u65f6\u8fd8\u9700\u8981\u518d\u628a\u8fd4\u56de\u503c\u53d1\u9001\u56deA\u673a\u5668\uff0c\u540c\u6837\u4e5f\u9700\u8981\u7ecf\u8fc7\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u7136\u540e\u518d\u7ecf\u8fc7\u7f51\u7edc\u4f20\u8f93\u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u53d1\u9001\u56deA\u673a\u5668\uff0c\u800c\u5f53A\u673a\u5668\u63a5\u6536\u5230\u8fd9\u4e9b\u8fd4\u56de\u503c\u4e4b\u540e\uff0c\u5219\u518d\u6b21\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u6062\u590d\u4e3a\u5185\u5b58\u4e2d\u7684\u8868\u8fbe\u65b9\u5f0f\uff0c\u6700\u540e\u518d\u4ea4\u7ed9A\u673a\u5668\u4e0a\u7684\u5e94\u7528\u8fdb\u884c\u76f8\u5173\u5904\u7406\uff08\u4e00\u822c\u662f\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u64cd\u4f5c\uff09\u3002 \u901a\u5e38\uff0c\u7ecf\u8fc7\u4ee5\u4e0a\u56db\u4e2a\u6b65\u9aa4\u4e4b\u540e\uff0c\u4e00\u6b21\u5b8c\u6574\u7684RPC\u8c03\u7528\u7b97\u662f\u5b8c\u6210\u4e86\u3002 PRC\u67b6\u6784\u7ec4\u4ef6 \u4e00\u4e2a\u57fa\u672c\u7684RPC\u67b6\u6784\u91cc\u9762\u5e94\u8be5\u81f3\u5c11\u5305\u542b\u4ee5\u4e0b4\u4e2a\u7ec4\u4ef6\uff1a 1\u3001\u5ba2\u6237\u7aef\uff08Client\uff09:\u670d\u52a1\u8c03\u7528\u65b9\uff08\u670d\u52a1\u6d88\u8d39\u8005\uff09 2\u3001\u5ba2\u6237\u7aef\u5b58\u6839\uff08Client Stub\uff09:\u5b58\u653e\u670d\u52a1\u7aef\u5730\u5740\u4fe1\u606f\uff0c\u5c06\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\u6570\u636e\u4fe1\u606f\u6253\u5305\u6210\u7f51\u7edc\u6d88\u606f\uff0c\u518d\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u53d1\u9001\u7ed9\u670d\u52a1\u7aef 3\u3001\u670d\u52a1\u7aef\u5b58\u6839\uff08Server Stub\uff09:\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u8bf7\u6c42\u6d88\u606f\u5e76\u8fdb\u884c\u89e3\u5305\uff0c\u7136\u540e\u518d\u8c03\u7528\u672c\u5730\u670d\u52a1\u8fdb\u884c\u5904\u7406 4\u3001\u670d\u52a1\u7aef\uff08Server\uff09:\u670d\u52a1\u7684\u771f\u6b63\u63d0\u4f9b\u8005 RPC\u8c03\u7528\u8fc7\u7a0b 1\u3001\u670d\u52a1\u6d88\u8d39\u8005\uff08client\u5ba2\u6237\u7aef\uff09\u901a\u8fc7\u672c\u5730\u8c03\u7528\u7684\u65b9\u5f0f\u8c03\u7528\u670d\u52a1 2\u3001\u5ba2\u6237\u7aef\u5b58\u6839\uff08client stub\uff09\u63a5\u6536\u5230\u8c03\u7528\u8bf7\u6c42\u540e\u8d1f\u8d23\u5c06\u65b9\u6cd5\u3001\u5165\u53c2\u7b49\u4fe1\u606f\u5e8f\u5217\u5316\uff08\u7ec4\u88c5\uff09\u6210\u80fd\u591f\u8fdb\u884c\u7f51\u7edc\u4f20\u8f93\u7684\u6d88\u606f\u4f53 3\u3001\u5ba2\u6237\u7aef\u5b58\u6839\uff08client stub\uff09\u627e\u5230\u8fdc\u7a0b\u7684\u670d\u52a1\u5730\u5740\uff0c\u5e76\u4e14\u5c06\u6d88\u606f\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u7ed9\u670d\u52a1\u7aef 4\u3001\u670d\u52a1\u7aef\u5b58\u6839\uff08server stub\uff09\u6536\u5230\u6d88\u606f\u540e\u8fdb\u884c\u89e3\u7801\uff08\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff09 5\u3001\u670d\u52a1\u7aef\u5b58\u6839\uff08server stub\uff09\u6839\u636e\u89e3\u7801\u7ed3\u679c\u8c03\u7528\u672c\u5730\u7684\u670d\u52a1\u8fdb\u884c\u76f8\u5173\u5904\u7406 6\u3001\u672c\u5730\u670d\u52a1\u6267\u884c\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u5e76\u5c06\u5904\u7406\u7ed3\u679c\u8fd4\u56de\u7ed9\u670d\u52a1\u7aef\u5b58\u6839\uff08server stub\uff09 7\u3001\u670d\u52a1\u7aef\u5b58\u6839\uff08server stub\uff09\u5c06\u8fd4\u56de\u7ed3\u679c\u91cd\u65b0\u6253\u5305\u6210\u6d88\u606f\uff08\u5e8f\u5217\u5316\uff09\u5e76\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u81f3\u6d88\u8d39\u65b9 8\u3001\u5ba2\u6237\u7aef\u5b58\u6839\uff08client stub\uff09\u63a5\u6536\u5230\u6d88\u606f\uff0c\u5e76\u8fdb\u884c\u89e3\u7801\uff08\u53cd\u5e8f\u5217\u5316\uff09 9\u3001\u670d\u52a1\u6d88\u8d39\u65b9\u5f97\u5230\u6700\u7ec8\u7ed3\u679c \u95ee4 \u8bf4\u8bf4springcloud rpc \u7684\u6267\u884c\u6d41\u7a0b\u548c\u539f\u7406? \u5982\u4f55\u5bf9springcloud \u5fae\u670d\u52a1\u8fdb\u884c\u9ad8\u5e76\u53d1\u7684\u6027\u80fd\u4f18\u5316\uff1f \u8bf7\u53c2\u8003 \u300aspringcloud nginx \u9ad8\u5e76\u53d1\u6838\u5fc3\u7f16\u7a0b\u300b\u4e00\u4e66 \u5206\u5e03\u5f0f\u4e8b\u52a1 \u95ee1\uff1a\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1f \u6307\u4e8b\u52a1\u7684\u6bcf\u4e2a\u64cd\u4f5c\u6b65\u9aa4\u90fd\u4f4d\u4e8e\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u9700\u8981\u4fdd\u8bc1\u4e8b\u52a1\u7684 AICD \u7279\u6027\u3002 \u4ea7\u751f\u539f\u56e0 \u6570\u636e\u5e93\u5206\u5e93\u5206\u8868\uff1b SOA \u67b6\u6784\uff0c\u6bd4\u5982\u4e00\u4e2a\u7535\u5546\u7f51\u7ad9\u5c06\u8ba2\u5355\u4e1a\u52a1\u548c\u5e93\u5b58\u4e1a\u52a1\u5206\u79bb\u51fa\u6765\u653e\u5230\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\u3002 \u5e94\u7528\u573a\u666f \u4e0b\u5355\uff1a\u51cf\u5c11\u5e93\u5b58\u540c\u65f6\u66f4\u65b0\u8ba2\u5355\u72b6\u6001\u3002\u5e93\u5b58\u548c\u8ba2\u5355\u4e0d\u5728\u4e0d\u540c\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u56e0\u6b64\u6d89\u53ca\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 \u652f\u4ed8\uff1a\u4e70\u5bb6\u8d26\u6237\u6263\u6b3e\u540c\u65f6\u5356\u5bb6\u8d26\u6237\u5165\u8d26\u3002\u4e70\u5bb6\u548c\u5356\u5bb6\u8d26\u6237\u4fe1\u606f\u4e0d\u5728\u540c\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u56e0\u6b64\u6d89\u53ca\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 \u89e3\u51b3\u65b9\u6848 3.1 \u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae \u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u53ef\u4ee5\u5f88\u597d\u5f97\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\uff0c\u5b83\u53ef\u4ee5\u4f7f\u7528 XA \u6765\u5b9e\u73b0\uff0cXA \u5b83\u5305\u542b\u4e24\u4e2a\u90e8\u5206\uff1a\u4e8b\u52a1\u7ba1\u7406\u5668\u548c\u672c\u5730\u8d44\u6e90\u7ba1\u7406\u5668\u3002\u5176\u4e2d\u672c\u5730\u8d44\u6e90\u7ba1\u7406\u5668\u5f80\u5f80\u7531\u6570\u636e\u5e93\u5b9e\u73b0\uff0c\u6bd4\u5982 Oracle\u3001DB2 \u8fd9\u4e9b\u5546\u4e1a\u6570\u636e\u5e93\u90fd\u5b9e\u73b0\u4e86 XA \u63a5\u53e3\uff0c\u800c\u4e8b\u52a1\u7ba1\u7406\u5668\u4f5c\u4e3a\u5168\u5c40\u7684\u534f\u8c03\u8005\uff0c\u8d1f\u8d23\u5404\u4e2a\u672c\u5730\u8d44\u6e90\u7684\u63d0\u4ea4\u548c\u56de\u6eda\u3002 3.2 \u6d88\u606f\u4e2d\u95f4\u4ef6 \u6d88\u606f\u4e2d\u95f4\u4ef6\u4e5f\u53ef\u79f0\u4f5c\u6d88\u606f\u7cfb\u7edf (MQ)\uff0c\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u6682\u5b58\u8f6c\u53d1\u6d88\u606f\u7684\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u3002\u5728\u5206\u5e03\u5f0f\u5e94\u7528\u5f53\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e2a\u4e1a\u52a1\u64cd\u4f5c\u8f6c\u6362\u6210\u4e00\u4e2a\u6d88\u606f\uff0c\u6bd4\u5982\u652f\u4ed8\u5b9d\u7684\u4f59\u989d\u8f6c\u5982\u4f59\u989d\u5b9d\u64cd\u4f5c\uff0c\u652f\u4ed8\u5b9d\u7cfb\u7edf\u6267\u884c\u51cf\u5c11\u4f59\u989d\u64cd\u4f5c\u4e4b\u540e\u5411\u6d88\u606f\u7cfb\u7edf\u53d1\u4e00\u4e2a\u6d88\u606f\uff0c\u4f59\u989d\u5b9d\u7cfb\u7edf\u8ba2\u9605\u8fd9\u6761\u6d88\u606f\u7136\u540e\u8fdb\u884c\u589e\u52a0\u8d26\u6237\u91d1\u989d\u64cd\u4f5c\u3002 3.2.1 \u6d88\u606f\u5904\u7406\u6a21\u578b \u70b9\u5bf9\u70b9 . \u53d1\u5e03/\u8ba2\u9605 . 3.2.2 \u6d88\u606f\u7684\u53ef\u9760\u6027 \u6d88\u606f\u7684\u53d1\u9001\u7aef\u7684\u53ef\u9760\u6027\uff1a\u53d1\u9001\u7aef\u5b8c\u6210\u64cd\u4f5c\u540e\u4e00\u5b9a\u80fd\u5c06\u6d88\u606f\u6210\u529f\u53d1\u9001\u5230\u6d88\u606f\u7cfb\u7edf\u3002 \u6d88\u606f\u7684\u63a5\u6536\u7aef\u7684\u53ef\u9760\u6027\uff1a\u63a5\u6536\u7aef\u4ec5\u4e14\u80fd\u591f\u4ece\u6d88\u606f\u4e2d\u95f4\u4ef6\u6210\u529f\u6d88\u8d39\u4e00\u6b21\u6d88\u606f\u3002 \u53d1\u9001\u7aef\u7684\u53ef\u9760\u6027 \u5728\u672c\u5730\u6570\u636e\u5efa\u4e00\u5f20\u6d88\u606f\u8868\uff0c\u5c06\u6d88\u606f\u6570\u636e\u4e0e\u4e1a\u52a1\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u6570\u636e\u5e93\u5b9e\u4f8b\u91cc\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5229\u7528\u672c\u5730\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u673a\u5236\u3002\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u540e\uff0c\u5c06\u6d88\u606f\u8868\u4e2d\u7684\u6d88\u606f\u8f6c\u79fb\u5230\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u82e5\u8f6c\u79fb\u6d88\u606f\u6210\u529f\u5219\u5220\u9664\u6d88\u606f\u8868\u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u7ee7\u7eed\u91cd\u4f20\u3002 \u63a5\u6536\u7aef\u7684\u53ef\u9760\u6027 \u4fdd\u8bc1\u63a5\u6536\u7aef\u5904\u7406\u6d88\u606f\u7684\u4e1a\u52a1\u903b\u8f91\u5177\u6709\u5e42\u7b49\u6027\uff1a\u53ea\u8981\u5177\u6709\u5e42\u7b49\u6027\uff0c\u90a3\u4e48\u6d88\u8d39\u591a\u5c11\u6b21\u6d88\u606f\uff0c\u6700\u540e\u5904\u7406\u7684\u7ed3\u679c\u90fd\u662f\u4e00\u6837\u7684\u3002 \u4fdd\u8bc1\u6d88\u606f\u5177\u6709\u552f\u4e00\u7f16\u53f7\uff0c\u5e76\u4f7f\u7528\u4e00\u5f20\u65e5\u5fd7\u8868\u6765\u8bb0\u5f55\u5df2\u7ecf\u6d88\u8d39\u7684\u6d88\u606f\u7f16\u53f7\u3002 CAP\u5b9a\u7406 \u5728\u7406\u8bba\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0cCAP\u5b9a\u7406\uff08CAP theorem\uff09\uff0c\u53c8\u88ab\u79f0\u4f5c\u5e03\u9c81\u5c14\u5b9a\u7406\uff08Brewer\u2019s theorem\uff09\uff0c\u5b83\u6307\u51fa\u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u8ba1\u7b97\u7cfb\u7edf\u6765\u8bf4\uff0c\u4e0d\u53ef\u80fd\u540c\u65f6\u6ee1\u8db3\u4ee5\u4e0b\u4e09\u70b9\uff1a \u9009\u9879 \u63cf\u8ff0 Consistency\uff08\u4e00\u81f4\u6027\uff09 \u6307\u6570\u636e\u5728\u591a\u4e2a\u526f\u672c\u4e4b\u95f4\u80fd\u591f\u4fdd\u6301\u4e00\u81f4\u7684\u7279\u6027\uff08\u4e25\u683c\u7684\u4e00\u81f4\u6027\uff09 Availability\uff08\u53ef\u7528\u6027\uff09 \u6307\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u5fc5\u987b\u4e00\u76f4\u5904\u4e8e\u53ef\u7528\u7684\u72b6\u6001\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u80fd\u83b7\u53d6\u5230\u975e\u9519\u7684\u54cd\u5e94\uff08\u4e0d\u4fdd\u8bc1\u83b7\u53d6\u7684\u6570\u636e\u4e3a\u6700\u65b0\u6570\u636e\uff09 Partition tolerance\uff08\u5206\u533a\u5bb9\u9519\u6027\uff09 \u5206\u5e03\u5f0f\u7cfb\u7edf\u5728\u9047\u5230\u4efb\u4f55\u7f51\u7edc\u5206\u533a\u6545\u969c\u7684\u65f6\u5019\uff0c\u4ecd\u7136\u80fd\u591f\u5bf9\u5916\u63d0\u4f9b\u6ee1\u8db3\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u7684\u670d\u52a1\uff0c\u9664\u975e\u6574\u4e2a\u7f51\u7edc\u73af\u5883\u90fd\u53d1\u751f\u4e86\u6545\u969c Spring Cloud\u5728CAP\u6cd5\u5219\u4e0a\u4e3b\u8981\u6ee1\u8db3\u7684\u662fA\u548cP\u6cd5\u5219\uff0cDubbo\u548cZookeeper\u5728CAP\u6cd5\u5219\u4e3b\u8981\u6ee1\u8db3\u7684\u662fC\u548cP\u6cd5\u5219 CAP\u4ec5\u9002\u7528\u4e8e\u539f\u5b50\u8bfb\u5199\u7684NOSQL\u573a\u666f\u4e2d\uff0c\u5e76\u4e0d\u9002\u5408\u6570\u636e\u5e93\u7cfb\u7edf\u3002\u73b0\u5728\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u5177\u6709\u66f4\u591a\u7279\u6027\u6bd4\u5982\u6269\u5c55\u6027\u3001\u53ef\u7528\u6027\u7b49\u7b49\uff0c\u5728\u8fdb\u884c\u7cfb\u7edf\u8bbe\u8ba1\u548c\u5f00\u53d1\u65f6\uff0c\u6211\u4eec\u4e0d\u5e94\u8be5\u4ec5\u4ec5\u5c40\u9650\u5728CAP\u95ee\u9898\u4e0a\u3002 \u6ce8\u610f\uff1a\u4e0d\u662f\u6240\u8c13\u76843\u90092\uff08\u4e0d\u8981\u88ab\u7f51\u4e0a\u5927\u591a\u6570\u6587\u7ae0\u8bef\u5bfc\u4e86\uff09 \u73b0\u5b9e\u751f\u6d3b\u4e2d\uff0c\u5927\u90e8\u5206\u4eba\u89e3\u91ca\u8fd9\u4e00\u5b9a\u5f8b\u65f6\uff0c\u5e38\u5e38\u7b80\u5355\u7684\u8868\u8ff0\u4e3a\uff1a\u201c\u4e00\u81f4\u6027\u3001\u53ef\u7528\u6027\u3001\u5206\u533a\u5bb9\u5fcd\u6027\u4e09\u8005\u4f60\u53ea\u80fd\u540c\u65f6\u8fbe\u5230\u5176\u4e2d\u4e24\u4e2a\uff0c\u4e0d\u53ef\u80fd\u540c\u65f6\u8fbe\u5230\u201d\u3002\u5b9e\u9645\u4e0a\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u5177\u6709\u8bef\u5bfc\u6027\u8d28\u7684\u8bf4\u6cd5\uff0c\u800c\u4e14\u5728CAP\u7406\u8bba\u8bde\u751f12\u5e74\u4e4b\u540e\uff0cCAP\u4e4b\u7236\u4e5f\u57282012\u5e74\u91cd\u5199\u4e86\u4e4b\u524d\u7684\u8bba\u6587\u3002 \u5f53\u53d1\u751f\u7f51\u7edc\u5206\u533a\u7684\u65f6\u5019\uff0c\u5982\u679c\u6211\u4eec\u8981\u7ee7\u7eed\u670d\u52a1\uff0c\u90a3\u4e48\u5f3a\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u53ea\u80fd2\u90091\u3002\u4e5f\u5c31\u662f\u8bf4\u5f53\u7f51\u7edc\u5206\u533a\u4e4b\u540eP\u662f\u524d\u63d0\uff0c\u51b3\u5b9a\u4e86P\u4e4b\u540e\u624d\u6709C\u548cA\u7684\u9009\u62e9\u3002\u4e5f\u5c31\u662f\u8bf4\u5206\u533a\u5bb9\u9519\u6027\uff08Partition tolerance\uff09\u6211\u4eec\u662f\u5fc5\u987b\u8981\u5b9e\u73b0\u7684\u3002 CAP\u5b9a\u7406\u7684\u8bc1\u660e \u5173\u4e8eCAP\u8fd9\u4e09\u4e2a\u7279\u6027\u6211\u4eec\u5c31\u4ecb\u7ecd\u5b8c\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8bd5\u7740\u8bc1\u660e\u4e00\u4e0b\u4e3a\u4ec0\u4e48CAP\u4e0d\u80fd\u540c\u65f6\u6ee1\u8db3\u3002 \u4e3a\u4e86\u7b80\u5316\u8bc1\u660e\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u5047\u8bbe\u6574\u4e2a\u96c6\u7fa4\u91cc\u53ea\u6709\u4e24\u4e2aN1\u548cN2\u4e24\u4e2a\u8282\u70b9\uff0c\u5982\u4e0b\u56fe\uff1a N1\u548cN2\u5f53\u4e2d\u5404\u81ea\u6709\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8fAB\u548c\u6570\u636e\u5e93\uff0c\u5f53\u7cfb\u7edf\u6ee1\u8db3\u4e00\u81f4\u6027\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8ba4\u4e3aN1\u548cN2\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u3002\u5728\u6ee1\u8db3\u53ef\u7528\u6027\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8ba4\u4e3a\u65e0\u8bba\u7528\u6237\u8bbf\u95eeN1\u8fd8\u662fN2\uff0c\u90fd\u53ef\u4ee5\u83b7\u5f97\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u5728\u6ee1\u8db3\u5206\u533a\u5bb9\u9519\u6027\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8ba4\u4e3a\u65e0\u8bbaN1\u8fd8\u662fN2\u5b95\u673a\u6216\u8005\u662f\u4e24\u8005\u7684\u901a\u4fe1\u4e2d\u65ad\uff0c\u90fd\u4e0d\u5f71\u54cd\u7cfb\u7edf\u7684\u8fd0\u884c\u3002 \u6211\u4eec\u5047\u8bbe\u4e00\u79cd\u6781\u7aef\u60c5\u51b5\uff0c\u5047\u8bbe\u67d0\u4e2a\u65f6\u523bN1\u548cN2\u4e4b\u95f4\u7684\u7f51\u7edc\u901a\u4fe1\u7a81\u7136\u4e2d\u65ad\u4e86\u3002\u5982\u679c\u7cfb\u7edf\u6ee1\u8db3\u5206\u533a\u5bb9\u9519\u6027\uff0c\u90a3\u4e48\u663e\u7136\u53ef\u4ee5\u652f\u6301\u8fd9\u79cd\u5f02\u5e38\u3002\u95ee\u9898\u662f\u5728\u6b64\u524d\u63d0\u4e0b\uff0c\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u662f\u5426\u53ef\u4ee5\u505a\u5230\u4e0d\u53d7\u5f71\u54cd\u5462\uff1f \u6211\u4eec\u505a\u4e2a\u5047\u8c61\u5b9e\u9a8c\uff0c\u5982\u4e0b\u56fe\uff0c\u7a81\u7136\u67d0\u4e00\u65f6\u523bN1\u548cN2\u4e4b\u95f4\u7684\u5173\u8054\u65ad\u5f00\uff1a \u6709\u7528\u6237\u5411N1\u53d1\u9001\u4e86\u8bf7\u6c42\u66f4\u6539\u4e86\u6570\u636e\uff0c\u5c06\u6570\u636e\u5e93\u4eceV0\u66f4\u65b0\u6210\u4e86V1\u3002\u7531\u4e8e\u7f51\u7edc\u65ad\u5f00\uff0c\u6240\u4ee5N2\u6570\u636e\u5e93\u4f9d\u7136\u662fV0\uff0c\u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u6709\u4e00\u4e2a\u8bf7\u6c42\u53d1\u7ed9\u4e86N2\uff0c\u4f46\u662fN2\u5e76\u6ca1\u6709\u529e\u6cd5\u53ef\u4ee5\u76f4\u63a5\u7ed9\u51fa\u6700\u65b0\u7684\u7ed3\u679cV1\uff0c\u8fd9\u4e2a\u65f6\u5019\u8be5\u600e\u4e48\u529e\u5462\uff1f \u8fd9\u4e2a\u65f6\u5019\u65e0\u6cd5\u4e24\u79cd\u65b9\u6cd5\uff0c\u4e00\u79cd\u662f\u5c06\u9519\u5c31\u9519\uff0c\u5c06\u9519\u8bef\u7684V0\u6570\u636e\u8fd4\u56de\u7ed9\u7528\u6237\u3002\u7b2c\u4e8c\u79cd\u662f\u963b\u585e\u7b49\u5f85\uff0c\u7b49\u5f85\u7f51\u7edc\u901a\u4fe1\u6062\u590d\uff0cN2\u4e2d\u7684\u6570\u636e\u66f4\u65b0\u4e4b\u540e\u518d\u8fd4\u56de\u7ed9\u7528\u6237\u3002\u663e\u7136\u524d\u8005\u727a\u7272\u4e86\u4e00\u81f4\u6027\uff0c\u540e\u8005\u727a\u7272\u4e86\u53ef\u7528\u6027\u3002 \u8fd9\u4e2a\u4f8b\u5b50\u867d\u7136\u7b80\u5355\uff0c\u4f46\u662f\u8bf4\u660e\u7684\u5185\u5bb9\u5374\u5f88\u91cd\u8981\u3002\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u5f53\u4e2d\uff0cCAP\u4e09\u4e2a\u7279\u6027\u6211\u4eec\u662f\u65e0\u6cd5\u540c\u65f6\u6ee1\u8db3\u7684\uff0c\u5fc5\u7136\u8981\u820d\u5f03\u4e00\u4e2a\u3002\u4e09\u8005\u820d\u5f03\u4e00\u4e2a\uff0c\u663e\u7136\u6392\u5217\u7ec4\u5408\u4e00\u5171\u6709\u4e09\u79cd\u53ef\u80fd\u3002 BASE\u7406\u8bba BASE\u7406\u8bba\u7531eBay\u67b6\u6784\u5e08Dan Pritchett\u63d0\u51fa\uff0c\u57282008\u5e74\u4e0a\u88ab\u5206\u8868\u4e3a\u8bba\u6587\uff0c\u5e76\u4e14eBay\u7ed9\u51fa\u4e86\u4ed6\u4eec\u5728\u5b9e\u8df5\u4e2d\u603b\u7ed3\u7684\u57fa\u4e8eBASE\u7406\u8bba\u7684\u4e00\u5957\u65b0\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\u3002 BASE \u662f Basically Available\uff08\u57fa\u672c\u53ef\u7528\uff09 \u3001Soft-state\uff08\u8f6f\u72b6\u6001\uff09 \u548c Eventually Consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09 \u4e09\u4e2a\u77ed\u8bed\u7684\u7f29\u5199\u3002BASE\u7406\u8bba\u662f\u5bf9CAP\u4e2d\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u6743\u8861\u7684\u7ed3\u679c\uff0c\u5176\u6765\u6e90\u4e8e\u5bf9\u5927\u89c4\u6a21\u4e92\u8054\u7f51\u7cfb\u7edf\u5206\u5e03\u5f0f\u5b9e\u8df5\u7684\u603b\u7ed3\uff0c\u662f\u57fa\u4e8eCAP\u5b9a\u7406\u9010\u6b65\u6f14\u5316\u800c\u6765\u7684\uff0c\u5b83\u5927\u5927\u964d\u4f4e\u4e86\u6211\u4eec\u5bf9\u7cfb\u7edf\u7684\u8981\u6c42\u3002 BASE\u7406\u8bba\u7684\u6838\u5fc3\u601d\u60f3 \u5373\u4f7f\u65e0\u6cd5\u505a\u5230\u5f3a\u4e00\u81f4\u6027\uff0c\u4f46\u6bcf\u4e2a\u5e94\u7528\u90fd\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u4e1a\u52a1\u7279\u70b9\uff0c\u91c7\u7528\u9002\u5f53\u7684\u65b9\u5f0f\u6765\u4f7f\u7cfb\u7edf\u8fbe\u5230\u6700\u7ec8\u4e00\u81f4\u6027\u3002\u4e5f\u5c31\u662f\u727a\u7272\u6570\u636e\u7684\u4e00\u81f4\u6027\u6765\u6ee1\u8db3\u7cfb\u7edf\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u7cfb\u7edf\u4e2d\u4e00\u90e8\u5206\u6570\u636e\u4e0d\u53ef\u7528\u6216\u8005\u4e0d\u4e00\u81f4\u65f6\uff0c\u4ecd\u9700\u8981\u4fdd\u6301\u7cfb\u7edf\u6574\u4f53\u201c\u4e3b\u8981\u53ef\u7528\u201d\u3002 \u9488\u5bf9\u6570\u636e\u5e93\u9886\u57df\uff0cBASE\u601d\u60f3\u7684\u4e3b\u8981\u5b9e\u73b0\u662f\u5bf9\u4e1a\u52a1\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c\u8ba9\u4e0d\u540c\u7684\u6570\u636e\u5206\u5e03\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u4ee5\u63d0\u5347\u7cfb\u7edf\u7684\u53ef\u7528\u6027\uff0c\u5f53\u524d\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e24\u79cd\u505a\u6cd5\uff1a \u6309\u529f\u80fd\u5212\u5206\u6570\u636e\u5e93 \u5206\u7247\uff08\u5982\u5f00\u6e90\u7684Mycat\u3001Amoeba\u7b49\uff09\u3002 \u7531\u4e8e\u62c6\u5206\u540e\u4f1a\u6d89\u53ca\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\uff0c\u6240\u4ee5eBay\u5728\u8be5BASE\u8bba\u6587\u4e2d\u63d0\u5230\u4e86\u5982\u4f55\u7528\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u601d\u8def\u6765\u5b9e\u73b0\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 BASE\u7406\u8bba\u4e09\u8981\u7d20 \u57fa\u672c\u53ef\u7528 \u57fa\u672c\u53ef\u7528\u662f\u6307\u5206\u5e03\u5f0f\u7cfb\u7edf\u5728\u51fa\u73b0\u4e0d\u53ef\u9884\u77e5\u6545\u969c\u7684\u65f6\u5019\uff0c\u5141\u8bb8\u635f\u5931\u90e8\u5206\u53ef\u7528\u6027\u3002\u4f46\u662f\uff0c\u8fd9\u7edd\u4e0d\u7b49\u4ef7\u4e8e\u7cfb\u7edf\u4e0d\u53ef\u7528\u3002 \u6bd4\u5982\uff1a \u54cd\u5e94\u65f6\u95f4\u4e0a\u7684\u635f\u5931\uff1a\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u5728\u7ebf\u641c\u7d22\u5f15\u64ce\u9700\u8981\u57280.5\u79d2\u4e4b\u5185\u8fd4\u56de\u7ed9\u7528\u6237\u76f8\u5e94\u7684\u67e5\u8be2\u7ed3\u679c\uff0c\u4f46\u7531\u4e8e\u51fa\u73b0\u6545\u969c\uff0c\u67e5\u8be2\u7ed3\u679c\u7684\u54cd\u5e94\u65f6\u95f4\u589e\u52a0\u4e861~2\u79d2 \u7cfb\u7edf\u529f\u80fd\u4e0a\u7684\u635f\u5931\uff1a\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5728\u4e00\u4e2a\u7535\u5b50\u5546\u52a1\u7f51\u7ad9\u4e0a\u8fdb\u884c\u8d2d\u7269\u7684\u65f6\u5019\uff0c\u6d88\u8d39\u8005\u51e0\u4e4e\u80fd\u591f\u987a\u5229\u5b8c\u6210\u6bcf\u4e00\u7b14\u8ba2\u5355\uff0c\u4f46\u662f\u5728\u4e00\u4e9b\u8282\u65e5\u5927\u4fc3\u8d2d\u7269\u9ad8\u5cf0\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6d88\u8d39\u8005\u7684\u8d2d\u7269\u884c\u4e3a\u6fc0\u589e\uff0c\u4e3a\u4e86\u4fdd\u62a4\u8d2d\u7269\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\uff0c\u90e8\u5206\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u88ab\u5f15\u5bfc\u5230\u4e00\u4e2a\u964d\u7ea7\u9875\u9762 2. \u8f6f\u72b6\u6001 \u8f6f\u72b6\u6001\u6307\u5141\u8bb8\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u5b58\u5728\u4e2d\u95f4\u72b6\u6001\uff0c\u5e76\u8ba4\u4e3a\u8be5\u4e2d\u95f4\u72b6\u6001\u7684\u5b58\u5728\u4e0d\u4f1a\u5f71\u54cd\u7cfb\u7edf\u7684\u6574\u4f53\u53ef\u7528\u6027\uff0c\u5373\u5141\u8bb8\u7cfb\u7edf\u5728\u4e0d\u540c\u8282\u70b9\u7684\u6570\u636e\u526f\u672c\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u8fc7\u7a0b\u5b58\u5728\u5ef6\u65f6 \u6700\u7ec8\u4e00\u81f4\u6027 \u6700\u7ec8\u4e00\u81f4\u6027\u5f3a\u8c03\u7684\u662f\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u6570\u636e\u526f\u672c\uff0c\u5728\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u540c\u6b65\u540e\uff0c\u6700\u7ec8\u80fd\u591f\u8fbe\u5230\u4e00\u4e2a\u4e00\u81f4\u7684\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u672c\u8d28\u662f\u9700\u8981\u7cfb\u7edf\u4fdd\u8bc1\u6700\u7ec8\u6570\u636e\u80fd\u591f\u8fbe\u5230\u4e00\u81f4\uff0c\u800c\u4e0d\u9700\u8981\u5b9e\u65f6\u4fdd\u8bc1\u7cfb\u7edf\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\u3002 \u8d1f\u8f7d\u5747\u8861\u7684\u7b97\u6cd5\u4e0e\u5b9e\u73b0 1.\u8f6e\u8be2\uff08Round Robin\uff09 \u8f6e\u8be2\u7b97\u6cd5\u628a\u6bcf\u4e2a\u8bf7\u6c42\u8f6e\u6d41\u53d1\u9001\u5230\u6bcf\u4e2a\u670d\u52a1\u5668\u4e0a\u3002\u4e0b\u56fe\u4e2d\uff0c\u4e00\u5171\u6709 6 \u4e2a\u5ba2\u6237\u7aef\u4ea7\u751f\u4e86 6 \u4e2a\u8bf7\u6c42\uff0c\u8fd9 6 \u4e2a\u8bf7\u6c42\u6309 (1, 2, 3, 4, 5, 6) \u7684\u987a\u5e8f\u53d1\u9001\u3002\u6700\u540e\uff0c(1, 3, 5) \u7684\u8bf7\u6c42\u4f1a\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 1\uff0c(2, 4, 6) \u7684\u8bf7\u6c42\u4f1a\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 2\u3002 . \u8be5\u7b97\u6cd5\u6bd4\u8f83\u9002\u5408\u6bcf\u4e2a\u670d\u52a1\u5668\u7684\u6027\u80fd\u5dee\u4e0d\u591a\u7684\u573a\u666f\uff0c\u5982\u679c\u6709\u6027\u80fd\u5b58\u5728\u5dee\u5f02\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48\u6027\u80fd\u8f83\u5dee\u7684\u670d\u52a1\u5668\u53ef\u80fd\u65e0\u6cd5\u627f\u62c5\u591a\u5927\u7684\u8d1f\u8f7d\u3002\u4e0b\u56fe\u4e2d\uff0c\u670d\u52a1\u5668 2 \u7684\u6027\u80fd\u6bd4\u670d\u52a1\u5668 1 \u5dee\uff0c\u90a3\u4e48\u670d\u52a1\u5668 2 \u53ef\u80fd\u65e0\u6cd5\u627f\u62c5\u591a\u5927\u7684\u8d1f\u8f7d\u3002 . \u52a0\u6743\u8f6e\u8be2\uff08Weighted Round Robbin\uff09 \u52a0\u6743\u8f6e\u8be2\u662f\u5728\u8f6e\u8be2\u7684\u57fa\u7840\u4e0a\uff0c\u6839\u636e\u670d\u52a1\u5668\u7684\u6027\u80fd\u5dee\u5f02\uff0c\u4e3a\u670d\u52a1\u5668\u8d4b\u4e88\u4e00\u5b9a\u7684\u6743\u503c\u3002\u4f8b\u5982\u4e0b\u56fe\u4e2d\uff0c\u670d\u52a1\u5668 1 \u88ab\u8d4b\u4e88\u7684\u6743\u503c\u4e3a 5\uff0c\u670d\u52a1\u5668 2 \u88ab\u8d4b\u4e88\u7684\u6743\u503c\u4e3a 1\uff0c\u90a3\u4e48 (1, 2, 3, 4, 5) \u8bf7\u6c42\u4f1a\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 1\uff0c(6) \u8bf7\u6c42\u4f1a\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 2\u3002 . 1.3 \u6700\u5c11\u8fde\u63a5\uff08least Connections\uff09 \u7531\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\u7684\u8fde\u63a5\u65f6\u95f4\u4e0d\u4e00\u6837\uff0c\u4f7f\u7528\u8f6e\u8be2\u6216\u8005\u52a0\u6743\u8f6e\u8be2\u7b97\u6cd5\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u8ba9\u4e00\u53f0\u670d\u52a1\u5668\u5f53\u524d\u8fde\u63a5\u6570\u591a\u5927\uff0c\u800c\u53e6\u4e00\u53f0\u670d\u52a1\u5668\u7684\u8fde\u63a5\u591a\u5c0f\uff0c\u9020\u6210\u8d1f\u8f7d\u4e0d\u5747\u8861\u3002\u4f8b\u5982\u4e0b\u56fe\u4e2d\uff0c(1, 3, 5) \u8bf7\u6c42\u4f1a\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 1\uff0c\u4f46\u662f (1, 3) \u5f88\u5feb\u5c31\u65ad\u5f00\u8fde\u63a5\uff0c\u6b64\u65f6\u53ea\u6709 (5) \u8bf7\u6c42\u8fde\u63a5\u670d\u52a1\u5668 1\uff1b(2, 4, 6) \u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 2\uff0c\u5b83\u4eec\u7684\u8fde\u63a5\u90fd\u8fd8\u6ca1\u6709\u65ad\u5f00\uff0c\u7ee7\u7eed\u8fd0\u884c\u65f6\uff0c\u670d\u52a1\u5668 2 \u4f1a\u627f\u62c5\u591a\u5927\u7684\u8d1f\u8f7d\u3002 . \u6700\u5c11\u8fde\u63a5\u7b97\u6cd5\u5c31\u662f\u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9\u5f53\u524d\u6700\u5c11\u8fde\u63a5\u6570\u7684\u670d\u52a1\u5668\u4e0a\u3002\u4f8b\u5982\u4e0b\u56fe\u4e2d\uff0c\u670d\u52a1\u5668 1 \u5f53\u524d\u8fde\u63a5\u6570\u6700\u5c0f\uff0c\u90a3\u4e48\u8bf7\u6c42 6 \u5c31\u4f1a\u88ab\u53d1\u9001\u5230\u670d\u52a1\u5668 1 \u4e0a\u3002 . 1.4 \u52a0\u6743\u6700\u5c0f\u8fde\u63a5\uff08Weighted Least Connection\uff09 \u5728\u6700\u5c0f\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\uff0c\u6839\u636e\u670d\u52a1\u5668\u7684\u6027\u80fd\u4e3a\u6bcf\u53f0\u670d\u52a1\u5668\u5206\u914d\u6743\u91cd\uff0c\u7136\u540e\u6839\u636e\u6743\u91cd\u8ba1\u7b97\u51fa\u6bcf\u53f0\u670d\u52a1\u5668\u80fd\u5904\u7406\u7684\u8fde\u63a5\u6570\u3002 . 1.5 \u968f\u673a\u7b97\u6cd5\uff08Random\uff09 \u628a\u8bf7\u6c42\u968f\u673a\u53d1\u9001\u5230\u670d\u52a1\u5668\u4e0a\u3002\u548c\u8f6e\u8be2\u7b97\u6cd5\u7c7b\u4f3c\uff0c\u8be5\u7b97\u6cd5\u6bd4\u8f83\u9002\u5408\u670d\u52a1\u5668\u6027\u80fd\u5dee\u4e0d\u591a\u7684\u573a\u666f\u3002 . \u5b9e\u73b0 2.1 DNS \u89e3\u6790 \u4f7f\u7528 DNS \u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u4f1a\u6839\u636e\u8d1f\u8f7d\u60c5\u51b5\u8fd4\u56de\u4e0d\u540c\u670d\u52a1\u5668\u7684 IP \u5730\u5740\u3002\u5927\u578b\u7f51\u7ad9\u57fa\u672c\u4f7f\u7528\u4e86\u8fd9\u79cd\u65b9\u5f0f\u6700\u4e3a\u7b2c\u4e00\u7ea7\u8d1f\u8f7d\u5747\u8861\u624b\u6bb5\uff0c\u7136\u540e\u5728\u5185\u90e8\u5728\u7b2c\u4e8c\u7ea7\u8d1f\u8f7d\u5747\u8861\u3002 . 2.2 \u4fee\u6539 MAC \u5730\u5740 \u4f7f\u7528 LVS\uff08Linux Virtual Server\uff09\u8fd9\u79cd\u94fe\u8def\u5c42\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u6839\u636e\u8d1f\u8f7d\u60c5\u51b5\u4fee\u6539\u8bf7\u6c42\u7684 MAC \u5730\u5740\u3002 . 2.3 \u4fee\u6539 IP \u5730\u5740 \u5728\u7f51\u7edc\u5c42\u4fee\u6539\u8bf7\u6c42\u7684\u76ee\u7684 IP \u5730\u5740\u3002 . 2.4 HTTP \u91cd\u5b9a\u5411 HTTP \u91cd\u5b9a\u5411\u8d1f\u8f7d\u5747\u8861\u670d\u52a1\u5668\u6536\u5230 HTTP \u8bf7\u6c42\u4e4b\u540e\u4f1a\u8fd4\u56de\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u5e76\u5c06\u8be5\u5730\u5740\u5199\u5165 HTTP \u91cd\u5b9a\u5411\u54cd\u5e94\u4e2d\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\uff0c\u6d4f\u89c8\u5668\u6536\u5230\u540e\u518d\u6b21\u53d1\u9001\u8bf7\u6c42\u3002 . 2.5 \u53cd\u5411\u4ee3\u7406 \u6b63\u5411\u4ee3\u7406\uff1a\u53d1\u751f\u5728\u5ba2\u6237\u7aef\uff0c\u662f\u7531\u7528\u6237\u4e3b\u52a8\u53d1\u8d77\u7684\u3002\u6bd4\u5982\u7ffb\u5899\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7\u4e3b\u52a8\u8bbf\u95ee\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u8ba9\u4ee3\u7406\u670d\u52a1\u5668\u83b7\u5f97\u9700\u8981\u7684\u5916\u7f51\u6570\u636e\uff0c\u7136\u540e\u8f6c\u53d1\u56de\u5ba2\u6237\u7aef\u3002 \u53cd\u5411\u4ee3\u7406\uff1a\u53d1\u751f\u5728\u670d\u52a1\u5668\u7aef\uff0c\u7528\u6237\u4e0d\u77e5\u9053\u53d1\u751f\u4e86\u4ee3\u7406\u3002 . \u5206\u5e03\u5f0f\u9501 Java \u63d0\u4f9b\u4e86\u4e24\u79cd\u5185\u7f6e\u7684\u9501\u7684\u5b9e\u73b0\uff0c\u4e00\u79cd\u662f\u7531 JVM \u5b9e\u73b0\u7684 synchronized \u548c JDK \u63d0\u4f9b\u7684 Lock\uff0c\u5f53\u4f60\u7684\u5e94\u7528\u662f\u5355\u673a\u6216\u8005\u8bf4\u5355\u8fdb\u7a0b\u5e94\u7528\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 synchronized \u6216 Lock \u6765\u5b9e\u73b0\u9501\u3002\u5f53\u5e94\u7528\u6d89\u53ca\u5230\u591a\u673a\u3001\u591a\u8fdb\u7a0b\u5171\u540c\u5b8c\u6210\u65f6\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4e00\u4e2a\u5168\u5c40\u9501\u6765\u5b9e\u73b0\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u3002 \u4f7f\u7528\u573a\u666f \u4f8b\u5982\u4e00\u4e2a\u5e94\u7528\u6709\u624b\u673a APP \u7aef\u548c Web \u7aef\uff0c\u5982\u679c\u5728\u4e24\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u8fdb\u884c\u4e00\u9879\u64cd\u4f5c\u65f6\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u8fd9\u9879\u64cd\u4f5c\u91cd\u590d\u8fdb\u884c\u3002 \u5b9e\u73b0\u65b9\u5f0f \u6570\u636e\u5e93\u5206\u5e03\u5f0f\u9501 \u57fa\u4e8e MySQL \u9501\u8868 \u8be5\u5b9e\u73b0\u65b9\u5f0f\u5b8c\u5168\u4f9d\u9760\u6570\u636e\u5e93\u552f\u4e00\u7d22\u5f15\u6765\u5b9e\u73b0\u3002\u5f53\u60f3\u8981\u83b7\u5f97\u9501\u65f6\uff0c\u5c31\u5411\u6570\u636e\u5e93\u4e2d\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u91ca\u653e\u9501\u65f6\u5c31\u5220\u9664\u8fd9\u6761\u8bb0\u5f55\u3002\u5982\u679c\u8bb0\u5f55\u5177\u6709\u552f\u4e00\u7d22\u5f15\uff0c\u5c31\u4e0d\u4f1a\u540c\u65f6\u63d2\u5165\u540c\u4e00\u6761\u8bb0\u5f55\u3002\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a \u9501\u6ca1\u6709\u5931\u6548\u65f6\u95f4\uff0c\u89e3\u9501\u5931\u8d25\u4f1a\u5bfc\u81f4\u6b7b\u9501\uff0c\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u518d\u83b7\u5f97\u9501\u3002 \u53ea\u80fd\u662f\u975e\u963b\u585e\u9501\uff0c\u63d2\u5165\u5931\u8d25\u76f4\u63a5\u5c31\u62a5\u9519\u4e86\uff0c\u65e0\u6cd5\u91cd\u8bd5\u3002 \u4e0d\u53ef\u91cd\u5165\uff0c\u540c\u4e00\u7ebf\u7a0b\u5728\u6ca1\u6709\u91ca\u653e\u9501\u4e4b\u524d\u65e0\u6cd5\u518d\u83b7\u5f97\u9501\u3002 \u91c7\u7528\u4e50\u89c2\u9501\u589e\u52a0\u7248\u672c\u53f7 \u6839\u636e\u7248\u672c\u53f7\u6765\u5224\u65ad\u66f4\u65b0\u4e4b\u524d\u6709\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u66f4\u65b0\u8fc7\uff0c\u5982\u679c\u88ab\u66f4\u65b0\u8fc7\uff0c\u5219\u83b7\u53d6\u9501\u5931\u8d25\u3002 Redis \u5206\u5e03\u5f0f\u9501 \u57fa\u4e8e SETNX\u3001EXPIRE \u4f7f\u7528 SETNX\uff08set if not exist\uff09\u547d\u4ee4\u63d2\u5165\u4e00\u4e2a\u952e\u503c\u5bf9\u65f6\uff0c\u5982\u679c Key \u5df2\u7ecf\u5b58\u5728\uff0c\u90a3\u4e48\u4f1a\u8fd4\u56de False\uff0c\u5426\u5219\u63d2\u5165\u6210\u529f\u5e76\u8fd4\u56de True\u3002\u56e0\u6b64\u5ba2\u6237\u7aef\u5728\u5c1d\u8bd5\u83b7\u5f97\u9501\u65f6\uff0c\u5148\u4f7f\u7528 SETNX \u5411 Redis \u4e2d\u63d2\u5165\u4e00\u4e2a\u8bb0\u5f55\uff0c\u5982\u679c\u8fd4\u56de True \u8868\u793a\u83b7\u5f97\u9501\uff0c\u8fd4\u56de False \u8868\u793a\u5df2\u7ecf\u6709\u5ba2\u6237\u7aef\u5360\u7528\u9501\u3002 EXPIRE \u53ef\u4ee5\u4e3a\u4e00\u4e2a\u952e\u503c\u5bf9\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u4ece\u800c\u907f\u514d\u4e86\u6b7b\u9501\u7684\u53d1\u751f\u3002 RedLock \u7b97\u6cd5 ReadLock \u7b97\u6cd5\u4f7f\u7528\u4e86\u591a\u4e2a Redis \u5b9e\u4f8b\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u8fd9\u662f\u4e3a\u4e86\u4fdd\u8bc1\u5728\u53d1\u751f\u5355\u70b9\u6545\u969c\u65f6\u8fd8\u53ef\u7528\u3002 \u5c1d\u8bd5\u4ece N \u4e2a\u76f8\u4e92\u72ec\u7acb Redis \u5b9e\u4f8b\u83b7\u53d6\u9501\uff0c\u5982\u679c\u4e00\u4e2a\u5b9e\u4f8b\u4e0d\u53ef\u7528\uff0c\u5e94\u8be5\u5c3d\u5feb\u5c1d\u8bd5\u4e0b\u4e00\u4e2a\u3002 \u8ba1\u7b97\u83b7\u53d6\u9501\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u53ea\u6709\u5f53\u8fd9\u4e2a\u65f6\u95f4\u5c0f\u4e8e\u9501\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5e76\u4e14\u4ece\u5927\u591a\u6570\uff08N/2+1\uff09\u5b9e\u4f8b\u4e0a\u83b7\u53d6\u4e86\u9501\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u9501\u83b7\u53d6\u6210\u529f\u4e86\u3002 \u5982\u679c\u9501\u83b7\u53d6\u5931\u8d25\uff0c\u4f1a\u5230\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u91ca\u653e\u9501\u3002 Zookeeper \u5206\u5e03\u5f0f\u9501 Zookeeper \u662f\u4e00\u4e2a\u4e3a\u5206\u5e03\u5f0f\u5e94\u7528\u63d0\u4f9b\u4e00\u81f4\u6027\u670d\u52a1\u7684\u8f6f\u4ef6\uff0c\u4f8b\u5982\u914d\u7f6e\u7ba1\u7406\u3001\u5206\u5e03\u5f0f\u534f\u540c\u4ee5\u53ca\u547d\u540d\u7684\u4e2d\u5fc3\u5316\u7b49\uff0c\u8fd9\u4e9b\u90fd\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u975e\u5e38\u5e95\u5c42\u800c\u4e14\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u57fa\u672c\u529f\u80fd\uff0c\u4f46\u662f\u5982\u679c\u81ea\u5df1\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\u800c\u4e14\u8981\u8fbe\u5230\u9ad8\u541e\u5410\u3001\u4f4e\u5ef6\u8fdf\u540c\u65f6\u8fd8\u8981\u4fdd\u6301\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\uff0c\u5b9e\u9645\u4e0a\u975e\u5e38\u56f0\u96be\u3002 \u62bd\u8c61\u6a21\u578b Zookeeper \u63d0\u4f9b\u4e86\u4e00\u79cd\u6811\u5f62\u7ed3\u6784\u7ea7\u7684\u547d\u540d\u7a7a\u95f4\uff0c/app1/p_1 \u8282\u70b9\u8868\u793a\u5b83\u7684\u7236\u8282\u70b9\u4e3a /app1\u3002 . \u8282\u70b9\u7c7b\u578b \u6c38\u4e45\u8282\u70b9\uff1a\u4e0d\u4f1a\u56e0\u4e3a\u4f1a\u8bdd\u7ed3\u675f\u6216\u8005\u8d85\u65f6\u800c\u6d88\u5931\uff1b \u4e34\u65f6\u8282\u70b9\uff1a\u5982\u679c\u4f1a\u8bdd\u7ed3\u675f\u6216\u8005\u8d85\u65f6\u5c31\u4f1a\u6d88\u5931\uff1b \u6709\u5e8f\u8282\u70b9\uff1a\u4f1a\u5728\u8282\u70b9\u540d\u7684\u540e\u9762\u52a0\u4e00\u4e2a\u6570\u5b57\u540e\u7f00\uff0c\u5e76\u4e14\u662f\u6709\u5e8f\u7684\uff0c\u4f8b\u5982\u751f\u6210\u7684\u6709\u5e8f\u8282\u70b9\u4e3a /lock/node-0000000000\uff0c\u5b83\u7684\u4e0b\u4e00\u4e2a\u6709\u5e8f\u8282\u70b9\u5219\u4e3a /lock/node-0000000001\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002 \u76d1\u542c\u5668 \u4e3a\u4e00\u4e2a\u8282\u70b9\u6ce8\u518c\u76d1\u542c\u5668\uff0c\u5728\u8282\u70b9\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u4f1a\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u3002 \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0 \u521b\u5efa\u4e00\u4e2a\u9501\u76ee\u5f55 /lock\u3002 \u5728 /lock \u4e0b\u521b\u5efa\u4e34\u65f6\u7684\u4e14\u6709\u5e8f\u7684\u5b50\u8282\u70b9\uff0c\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7aef\u5bf9\u5e94\u7684\u5b50\u8282\u70b9\u4e3a /lock/lock-0000000000\uff0c\u7b2c\u4e8c\u4e2a\u4e3a /lock/lock-0000000001\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u5ba2\u6237\u7aef\u83b7\u53d6 /lock \u4e0b\u7684\u5b50\u8282\u70b9\u5217\u8868\uff0c\u5224\u65ad\u81ea\u5df1\u521b\u5efa\u7684\u5b50\u8282\u70b9\u662f\u5426\u4e3a\u5f53\u524d\u5b50\u8282\u70b9\u5217\u8868\u4e2d\u5e8f\u53f7\u6700\u5c0f\u7684\u5b50\u8282\u70b9\uff0c\u5982\u679c\u662f\u5219\u8ba4\u4e3a\u83b7\u5f97\u9501\uff0c\u5426\u5219\u76d1\u542c\u81ea\u5df1\u7684\u524d\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u83b7\u5f97\u5b50\u8282\u70b9\u7684\u53d8\u66f4\u901a\u77e5\u540e\u91cd\u590d\u6b64\u6b65\u9aa4\u76f4\u81f3\u83b7\u5f97\u9501\uff1b \u6267\u884c\u4e1a\u52a1\u4ee3\u7801\uff0c\u5b8c\u6210\u540e\uff0c\u5220\u9664\u5bf9\u5e94\u7684\u5b50\u8282\u70b9\u3002 \u4f1a\u8bdd\u8d85\u65f6 \u5982\u679c\u4e00\u4e2a\u5df2\u7ecf\u83b7\u5f97\u9501\u7684\u4f1a\u8bdd\u8d85\u65f6\u4e86\uff0c\u56e0\u4e3a\u521b\u5efa\u7684\u662f\u4e34\u65f6\u8282\u70b9\uff0c\u56e0\u6b64\u8be5\u4f1a\u8bdd\u5bf9\u5e94\u7684\u4e34\u65f6\u8282\u70b9\u4f1a\u88ab\u5220\u9664\uff0c\u5176\u5b83\u4f1a\u8bdd\u5c31\u53ef\u4ee5\u83b7\u5f97\u9501\u4e86\u3002\u53ef\u4ee5\u770b\u5230\uff0cZookeeper \u5206\u5e03\u5f0f\u9501\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u5e93\u5206\u5e03\u5f0f\u9501\u7684\u6b7b\u9501\u95ee\u9898\u3002 \u7f8a\u7fa4\u6548\u5e94 \u5728\u6b65\u9aa4\u4e8c\uff0c\u4e00\u4e2a\u8282\u70b9\u672a\u83b7\u5f97\u9501\uff0c\u9700\u8981\u76d1\u542c\u76d1\u542c\u81ea\u5df1\u7684\u524d\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u76d1\u542c\u6240\u6709\u7684\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u4efb\u610f\u4e00\u4e2a\u5b50\u8282\u70b9\u72b6\u6001\u6539\u53d8\uff0c\u5176\u5b83\u6240\u6709\u5b50\u8282\u70b9\u90fd\u4f1a\u6536\u5230\u901a\u77e5\uff0c\u800c\u6211\u4eec\u53ea\u5e0c\u671b\u5b83\u7684\u4e0b\u4e00\u4e2a\u5b50\u8282\u70b9\u6536\u5230\u901a\u77e5\u3002 \u5206\u5e03\u5f0f Session \u5982\u679c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\u7684\u8bdd\uff0c\u7528\u6237\u5c06\u51fa\u73b0\u9891\u7e41\u767b\u5f55\u7684\u73b0\u8c61\uff0c\u6bd4\u5982\u96c6\u7fa4\u4e2d\u5b58\u5728 A\u3001B \u4e24\u53f0\u670d\u52a1\u5668\uff0c\u7528\u6237\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7f51\u7ad9\u65f6\uff0cNginx \u901a\u8fc7\u5176\u8d1f\u8f7d\u5747\u8861\u673a\u5236\u5c06\u7528\u6237\u8bf7\u6c42\u8f6c\u53d1\u5230 A \u670d\u52a1\u5668\uff0c\u8fd9\u65f6 A \u670d\u52a1\u5668\u5c31\u4f1a\u7ed9\u7528\u6237\u521b\u5efa\u4e00\u4e2a Session\u3002\u5f53\u7528\u6237\u7b2c\u4e8c\u6b21\u53d1\u9001\u8bf7\u6c42\u65f6\uff0cNginx \u5c06\u5176\u8d1f\u8f7d\u5747\u8861\u5230 B \u670d\u52a1\u5668\uff0c\u800c\u8fd9\u65f6\u5019 B \u670d\u52a1\u5668\u5e76\u4e0d\u5b58\u5728 Session\uff0c\u6240\u4ee5\u5c31\u4f1a\u5c06\u7528\u6237\u8e22\u5230\u767b\u5f55\u9875\u9762\u3002\u8fd9\u5c06\u5927\u5927\u964d\u4f4e\u7528\u6237\u4f53\u9a8c\u5ea6\uff0c\u5bfc\u81f4\u7528\u6237\u7684\u6d41\u5931\uff0c\u8fd9\u79cd\u60c5\u51b5\u662f\u9879\u76ee\u7edd\u4e0d\u5e94\u8be5\u51fa\u73b0\u7684\u3002 1 \u7c98\u6027 Session \u539f\u7406 \u7c98\u6027 Session \u662f\u6307\u5c06\u7528\u6237\u9501\u5b9a\u5230\u67d0\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\uff0c\u6bd4\u5982\u4e0a\u9762\u8bf4\u7684\u4f8b\u5b50\uff0c\u7528\u6237\u7b2c\u4e00\u6b21\u8bf7\u6c42\u65f6\uff0c\u8d1f\u8f7d\u5747\u8861\u5668\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u4e86 A \u670d\u52a1\u5668\u4e0a\uff0c\u5982\u679c\u8d1f\u8f7d\u5747\u8861\u5668\u8bbe\u7f6e\u4e86\u7c98\u6027 Session \u7684\u8bdd\uff0c\u90a3\u4e48\u7528\u6237\u4ee5\u540e\u7684\u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u8f6c\u53d1\u5230 A \u670d\u52a1\u5668\u4e0a\uff0c\u76f8\u5f53\u4e8e\u628a\u7528\u6237\u548c A \u670d\u52a1\u5668\u7c98\u5230\u4e86\u4e00\u5757\uff0c\u8fd9\u5c31\u662f\u7c98\u6027 Session \u673a\u5236\u3002 \u4f18\u70b9 \u7b80\u5355\uff0c\u4e0d\u9700\u8981\u5bf9 Session \u505a\u4efb\u4f55\u5904\u7406\u3002 \u7f3a\u70b9 \u7f3a\u4e4f\u5bb9\u9519\u6027\uff0c\u5982\u679c\u5f53\u524d\u8bbf\u95ee\u7684\u670d\u52a1\u5668\u53d1\u751f\u6545\u969c\uff0c\u7528\u6237\u88ab\u8f6c\u79fb\u5230\u7b2c\u4e8c\u4e2a\u670d\u52a1\u5668\u4e0a\u65f6\uff0c\u4ed6\u7684 Session \u4fe1\u606f\u90fd\u5c06\u5931\u6548\u3002 \u9002\u7528\u573a\u666f \u53d1\u751f\u6545\u969c\u5bf9\u5ba2\u6237\u4ea7\u751f\u7684\u5f71\u54cd\u8f83\u5c0f\uff1b \u670d\u52a1\u5668\u53d1\u751f\u6545\u969c\u662f\u4f4e\u6982\u7387\u4e8b\u4ef6\u3002 2 \u670d\u52a1\u5668 Session \u590d\u5236 \u539f\u7406 \u4efb\u4f55\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u7684 Session \u53d1\u751f\u6539\u53d8\uff0c\u8be5\u8282\u70b9\u4f1a\u628a\u8fd9\u4e2a Session \u7684\u6240\u6709\u5185\u5bb9\u5e8f\u5217\u5316\uff0c\u7136\u540e\u5e7f\u64ad\u7ed9\u6240\u6709\u5176\u5b83\u8282\u70b9\uff0c\u4e0d\u7ba1\u5176\u4ed6\u670d\u52a1\u5668\u9700\u4e0d\u9700\u8981 Session\uff0c\u4ee5\u6b64\u6765\u4fdd\u8bc1 Session \u540c\u6b65\u3002 \u4f18\u70b9 \u53ef\u5bb9\u9519\uff0c\u5404\u4e2a\u670d\u52a1\u5668\u95f4 Session \u80fd\u591f\u5b9e\u65f6\u54cd\u5e94\u3002 \u7f3a\u70b9 \u4f1a\u5bf9\u7f51\u7edc\u8d1f\u8377\u9020\u6210\u4e00\u5b9a\u538b\u529b\uff0c\u5982\u679c Session \u91cf\u5927\u7684\u8bdd\u53ef\u80fd\u4f1a\u9020\u6210\u7f51\u7edc\u5835\u585e\uff0c\u62d6\u6162\u670d\u52a1\u5668\u6027\u80fd\u3002 \u5b9e\u73b0\u65b9\u5f0f \u8bbe\u7f6e Tomcat \u7684 server.xml \u5f00\u542f tomcat \u96c6\u7fa4\u529f\u80fd\u3002 \u5728\u5e94\u7528\u91cc\u589e\u52a0\u4fe1\u606f\uff1a\u901a\u77e5\u5e94\u7528\u5f53\u524d\u5904\u4e8e\u96c6\u7fa4\u73af\u5883\u4e2d\uff0c\u652f\u6301\u5206\u5e03\u5f0f\uff0c\u5373\u5728 web.xml \u4e2d\u6dfb\u52a0 \u9009\u9879\u3002 3 Session \u5171\u4eab\u673a\u5236 \u4f7f\u7528\u5206\u5e03\u5f0f\u7f13\u5b58\u65b9\u6848\u6bd4\u5982 Memcached\u3001Redis\uff0c\u4f46\u662f\u8981\u6c42 Memcached \u6216 Redis \u5fc5\u987b\u662f\u96c6\u7fa4\u3002 \u4f7f\u7528 Session \u5171\u4eab\u4e5f\u5206\u4e24\u79cd\u673a\u5236\uff0c\u4e24\u79cd\u60c5\u51b5\u5982\u4e0b\uff1a 3.1 \u7c98\u6027 Session \u5171\u4eab\u673a\u5236 \u548c\u7c98\u6027 Session \u4e00\u6837\uff0c\u4e00\u4e2a\u7528\u6237\u7684 Session \u4f1a\u7ed1\u5b9a\u5230\u4e00\u4e2a Tomcat \u4e0a\u3002Memcached \u53ea\u662f\u8d77\u5230\u5907\u4efd\u4f5c\u7528\u3002 . 3.2 \u975e\u7c98\u6027 Session \u5171\u4eab\u673a\u5236 \u539f\u7406 Tomcat \u672c\u8eab\u4e0d\u5b58\u50a8 Session\uff0c\u800c\u662f\u5b58\u5165 Memcached \u4e2d\u3002Memcached \u96c6\u7fa4\u6784\u5efa\u4e3b\u4ece\u590d\u5236\u67b6\u6784\u3002 . \u4f18\u70b9 \u53ef\u5bb9\u9519\uff0cSession \u5b9e\u65f6\u54cd\u5e94\u3002 \u5b9e\u73b0\u65b9\u5f0f \u7528\u5f00\u6e90\u7684 msm \u63d2\u4ef6\u89e3\u51b3 Tomcat \u4e4b\u95f4\u7684 Session \u5171\u4eab\uff1aMemcached_Session_Manager\uff08MSM\uff09 4 Session \u6301\u4e45\u5316\u5230\u6570\u636e\u5e93 \u539f\u7406 \u62ff\u51fa\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u4e13\u95e8\u7528\u6765\u5b58\u50a8 Session \u4fe1\u606f\u3002\u4fdd\u8bc1 Session \u7684\u6301\u4e45\u5316\u3002 \u4f18\u70b9 \u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\uff0cSession \u4e0d\u4f1a\u4e22\u5931 \u7f3a\u70b9 \u5982\u679c\u7f51\u7ad9\u7684\u8bbf\u95ee\u91cf\u5f88\u5927\uff0c\u628a Session \u5b58\u50a8\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u4f1a\u5bf9\u6570\u636e\u5e93\u9020\u6210\u5f88\u5927\u538b\u529b\uff0c\u8fd8\u9700\u8981\u589e\u52a0\u989d\u5916\u7684\u5f00\u9500\u7ef4\u62a4\u6570\u636e\u5e93\u3002 5 Terracotta \u5b9e\u73b0 Session \u590d\u5236 \u539f\u7406 Terracotta \u7684\u57fa\u672c\u539f\u7406\u662f\u5bf9\u4e8e\u96c6\u7fa4\u95f4\u5171\u4eab\u7684\u6570\u636e\uff0c\u5f53\u5728\u4e00\u4e2a\u8282\u70b9\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019\uff0cTerracotta \u53ea\u628a\u53d8\u5316\u7684\u90e8\u5206\u53d1\u9001\u7ed9 Terracotta \u670d\u52a1\u5668\uff0c\u7136\u540e\u7531\u670d\u52a1\u5668\u628a\u5b83\u8f6c\u53d1\u7ed9\u771f\u6b63\u9700\u8981\u8fd9\u4e2a\u6570\u636e\u7684\u8282\u70b9\u3002\u5b83\u662f\u670d\u52a1\u5668 Session \u590d\u5236\u7684\u4f18\u5316\u3002 . \u4f18\u70b9 \u8fd9\u6837\u5bf9\u7f51\u7edc\u7684\u538b\u529b\u5c31\u975e\u5e38\u5c0f\uff0c\u5404\u4e2a\u8282\u70b9\u4e5f\u4e0d\u5fc5\u6d6a\u8d39 CPU \u65f6\u95f4\u548c\u5185\u5b58\u8fdb\u884c\u5927\u91cf\u7684\u5e8f\u5217\u5316\u64cd\u4f5c\u3002\u628a\u8fd9\u79cd\u96c6\u7fa4\u95f4\u6570\u636e\u5171\u4eab\u7684\u673a\u5236\u5e94\u7528\u5728 Session \u540c\u6b65\u4e0a\uff0c\u65e2\u907f\u514d\u4e86\u5bf9\u6570\u636e\u5e93\u7684\u4f9d\u8d56\uff0c\u53c8\u80fd\u8fbe\u5230\u8d1f\u8f7d\u5747\u8861\u548c\u707e\u96be\u6062\u590d\u7684\u6548\u679c\u3002 \u5206\u5e93\u4e0e\u5206\u8868 \u5206\u5e93\u4e0e\u5206\u8868\u5e26\u6765\u7684\u5206\u5e03\u5f0f\u56f0\u5883\u4e0e\u5e94\u5bf9\u4e4b\u7b56 . \u4e8b\u52a1\u95ee\u9898 \u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 \u67e5\u8be2\u95ee\u9898 \u4f7f\u7528\u6c47\u603b\u8868\u3002 ID \u552f\u4e00\u6027 \u4f7f\u7528\u5168\u5c40\u552f\u4e00 ID\uff1aGUID\uff1b \u4e3a\u6bcf\u4e2a\u5206\u7247\u6307\u5b9a\u4e00\u4e2a ID \u8303\u56f4","title":"\u67b6\u6784\u9762\u8bd5\u9898"},{"location":"knowledge/mqvs/","text":"\u4e09\u5927\u4e3b\u6d41MQ\u7684\u7ec4\u7ec7\u7ed3\u6784 1\u3001RabbitMQ RabbitMQ\u5404\u7ec4\u4ef6\u7684\u529f\u80fd Broker\uff1a \u4e00\u4e2aRabbitMQ\u5b9e\u4f8b \u5c31\u662f\u4e00\u4e2aBroker Virtual Host\uff1a \u865a\u62df\u4e3b\u673a\u3002 \u76f8\u5f53\u4e8eMysql\u7684DataBase , \u4e00\u4e2aBroker\u4e0a\u53ef\u4ee5\u5b58\u5728\u591a\u4e2avhost\uff0cvhost\u4e4b\u95f4\u76f8\u4e92\u9694\u79bb\u3002\u6bcf\u4e2avhost\u90fd\u62e5\u6709\u81ea\u5df1\u7684\u961f\u5217\u3001\u4ea4\u6362\u673a\u3001\u7ed1\u5b9a\u548c\u6743\u9650\u673a\u5236\u3002vhost\u5fc5\u987b\u5728\u8fde\u63a5\u65f6\u6307\u5b9a\uff0c\u9ed8\u8ba4\u7684vhost\u662f /\u3002 Exchange\uff1a \u4ea4\u6362\u673a\uff0c\u7528\u6765\u63a5\u6536\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u5e76\u5c06\u8fd9\u4e9b\u6d88\u606f\u8def\u7531\u7ed9\u670d\u52a1\u5668\u4e2d\u7684\u961f\u5217\u3002 Queue\uff1a \u6d88\u606f\u961f\u5217\uff0c\u7528\u6765\u4fdd\u5b58\u6d88\u606f\u76f4\u5230\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\u3002 \u5b83\u662f\u6d88\u606f\u7684\u5bb9\u5668 \u3002\u4e00\u4e2a\u6d88\u606f\u53ef\u6295\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u961f\u5217\u3002 Banding\uff1a \u7ed1\u5b9a\u5173\u7cfb\uff0c\u7528\u4e8e \u6d88\u606f\u961f\u5217\u548c\u4ea4\u6362\u673a\u4e4b\u95f4\u7684\u5173\u8054 \u3002\u901a\u8fc7\u8def\u7531\u952e( Routing Key )\u5c06\u4ea4\u6362\u673a\u548c\u6d88\u606f\u961f\u5217\u5173\u8054\u8d77\u6765\u3002 Channel\uff1a \u7ba1\u9053\uff0c\u4e00\u6761 \u53cc\u5411\u6570\u636e\u6d41\u901a\u9053 \u3002\u4e0d\u7ba1\u662f\u53d1\u5e03\u6d88\u606f\u3001\u8ba2\u9605\u961f\u5217\u8fd8\u662f\u63a5\u6536\u6d88\u606f\uff0c\u8fd9\u4e9b\u52a8\u4f5c\u90fd\u662f\u901a\u8fc7\u7ba1\u9053\u5b8c\u6210\u3002\u56e0\u4e3a\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6765\u8bf4\uff0c\u5efa\u7acb\u548c\u9500\u6bc1TCP\u90fd\u662f\u975e\u5e38\u6602\u8d35\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u5f15\u5165\u4e86\u7ba1\u9053\u7684\u6982\u5ff5\uff0c\u4ee5\u590d\u7528\u4e00\u6761TCP\u8fde\u63a5\u3002 Connection\uff1a \u751f\u4ea7\u8005/\u6d88\u8d39\u8005 \u4e0ebroker\u4e4b\u95f4\u7684TCP\u8fde\u63a5\u3002 Publisher\uff1a \u6d88\u606f\u7684\u751f\u4ea7\u8005\u3002 Consumer\uff1a \u6d88\u606f\u7684\u6d88\u8d39\u8005\u3002 Message\uff1a \u6d88\u606f\uff0c\u5b83\u662f\u7531\u6d88\u606f\u5934\u548c\u6d88\u606f\u4f53\u7ec4\u6210\u3002\u6d88\u606f\u5934\u5219\u5305\u62ec Routing-Key \u3001 Priority (\u4f18\u5148\u7ea7)\u7b49\u3002 RabbitMQ\u7684\u591a\u79cd\u4ea4\u6362\u673a\u7c7b\u578b Exchange \u5206\u53d1\u6d88\u606f\u7ed9 Queue \u65f6\uff0c Exchange \u7684\u7c7b\u578b\u5bf9\u5e94\u4e0d\u540c\u7684\u5206\u53d1\u7b56\u7565\uff0c\u67093\u79cd\u7c7b\u578b\u7684 Exchange \uff1a Direct \u3001 Fanout \u3001 Topic \u3002 Direct \uff1a \u6d88\u606f\u4e2d\u7684 Routing Key \u5982\u679c\u548c Binding \u4e2d\u7684 Routing Key \u5b8c\u5168\u4e00\u81f4\uff0c Exchange \u5c31\u4f1a\u5c06\u6d88\u606f\u5206\u53d1\u5230\u5bf9\u5e94\u7684\u961f\u5217\u4e2d\u3002 Fanout \uff1a \u6bcf\u4e2a\u53d1\u5230 Fanout \u7c7b\u578b\u4ea4\u6362\u673a\u7684\u6d88\u606f\u90fd\u4f1a\u5206\u53d1\u5230\u6240\u6709\u7ed1\u5b9a\u7684\u961f\u5217\u4e0a\u53bb\u3002Fanout\u4ea4\u6362\u673a\u6ca1\u6709 Routing Key \u3002 \u5b83\u5728\u4e09\u79cd\u7c7b\u578b\u7684\u4ea4\u6362\u673a\u4e2d\u8f6c\u53d1\u6d88\u606f\u662f\u6700\u5feb\u7684 \u3002 Topic \uff1a Topic\u4ea4\u6362\u673a\u901a\u8fc7\u6a21\u5f0f\u5339\u914d\u5206\u914d\u6d88\u606f\uff0c\u5c06 Routing Key \u548c\u67d0\u4e2a\u6a21\u5f0f\u8fdb\u884c\u5339\u914d\u3002\u5b83\u53ea\u80fd\u8bc6\u522b\u4e24\u4e2a \u901a\u914d\u7b26 \uff1a \"#\"\u548c\"*\" \u3002 # \u5339\u914d0\u4e2a\u6216\u591a\u4e2a\u5355\u8bcd\uff0c * \u5339\u914d1\u4e2a\u5355\u8bcd\u3002 TTL TTL(Time To Live)\uff1a\u751f\u5b58\u65f6\u95f4\u3002RabbitMQ\u652f\u6301\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4e00\u51712\u79cd\u3002 \u5728\u6d88\u606f\u53d1\u9001\u65f6\u8fdb\u884c\u6307\u5b9a \u3002\u901a\u8fc7\u914d\u7f6e\u6d88\u606f\u4f53\u7684 Properties \uff0c\u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u5728\u521b\u5efaExchange\u65f6\u6307\u5b9a \u3002\u4ece\u8fdb\u5165\u6d88\u606f\u961f\u5217\u5f00\u59cb\u8ba1\u7b97\uff0c\u53ea\u8981\u8d85\u8fc7\u4e86\u961f\u5217\u7684\u8d85\u65f6\u65f6\u95f4\u914d\u7f6e\uff0c\u90a3\u4e48\u6d88\u606f\u4f1a\u81ea\u52a8\u6e05\u9664\u3002 \u751f\u4ea7\u8005\u7684\u6d88\u606f\u786e\u8ba4\u673a\u5236 Confirm\u673a\u5236 \u6d88\u606f\u7684\u786e\u8ba4\uff0c\u662f\u6307\u751f\u4ea7\u8005\u6295\u9012\u6d88\u606f\u540e\uff0c\u5982\u679cBroker\u6536\u5230\u6d88\u606f\uff0c\u5219\u4f1a\u7ed9\u6211\u4eec\u751f\u4ea7\u8005\u4e00\u4e2a\u5e94\u7b54\u3002 \u751f\u4ea7\u8005\u8fdb\u884c\u63a5\u53d7\u5e94\u7b54\uff0c\u7528\u6765\u786e\u8ba4\u8fd9\u6761\u6d88\u606f\u662f\u5426\u6b63\u5e38\u7684\u53d1\u9001\u5230\u4e86Broker\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u662f \u6d88\u606f\u7684\u53ef\u9760\u6027\u6295\u9012\u7684\u6838\u5fc3\u4fdd\u969c\uff01 \u5982\u4f55\u5b9e\u73b0Confirm\u786e\u8ba4\u6d88\u606f\uff1f \u5728channel\u4e0a\u5f00\u542f\u786e\u8ba4\u6a21\u5f0f \uff1a channel.confirmSelect() \u5728channel\u4e0a\u5f00\u542f\u76d1\u542c \uff1a addConfirmListener \uff0c\u76d1\u542c\u6210\u529f\u548c\u5931\u8d25\u7684\u5904\u7406\u7ed3\u679c\uff0c\u6839\u636e\u5177\u4f53\u7684\u7ed3\u679c\u5bf9\u6d88\u606f\u8fdb\u884c\u91cd\u65b0\u53d1\u9001\u6216\u8bb0\u5f55\u65e5\u5fd7\u5904\u7406\u7b49\u540e\u7eed\u64cd\u4f5c\u3002 Return\u6d88\u606f\u673a\u5236 Return Listener \u7528\u4e8e\u5904\u7406\u4e00\u4e9b\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f \u3002 \u6211\u4eec\u7684\u6d88\u606f\u751f\u4ea7\u8005\uff0c\u901a\u8fc7\u6307\u5b9a\u4e00\u4e2aExchange\u548cRouting\uff0c\u628a\u6d88\u606f\u9001\u8fbe\u5230\u67d0\u4e00\u4e2a\u961f\u5217\u4e2d\u53bb\uff0c\u7136\u540e\u6211\u4eec\u7684\u6d88\u8d39\u8005\u76d1\u542c\u961f\u5217\u8fdb\u884c\u6d88\u606f\u7684\u6d88\u8d39\u5904\u7406\u64cd\u4f5c\u3002 \u4f46\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u5728\u53d1\u9001\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5f53\u524d\u7684exchange\u4e0d\u5b58\u5728\u6216\u8005\u6307\u5b9a\u7684\u8def\u7531key\u8def\u7531\u4e0d\u5230\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9700\u8981\u76d1\u542c\u8fd9\u79cd\u4e0d\u53ef\u8fbe\u6d88\u606f\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u5230Returrn Listener\u3002 \u57fa\u7840API\u4e2d\u6709\u4e2a\u5173\u952e\u7684\u914d\u7f6e\u9879 Mandatory \uff1a\u5982\u679c\u4e3atrue\uff0c\u76d1\u542c\u5668\u4f1a\u6536\u5230\u8def\u7531\u4e0d\u53ef\u8fbe\u7684\u6d88\u606f\uff0c\u7136\u540e\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c\u4e3afalse\uff0cbroker\u7aef\u4f1a\u81ea\u52a8\u5220\u9664\u8be5\u6d88\u606f\u3002 \u540c\u6837\uff0c\u901a\u8fc7\u76d1\u542c\u7684\u65b9\u5f0f\uff0c chennel.addReturnListener(ReturnListener rl) \u4f20\u5165\u5df2\u7ecf\u91cd\u5199\u8fc7handleReturn\u65b9\u6cd5\u7684ReturnListener\u3002 \u6d88\u8d39\u7aefACK\u4e0eNACK \u6d88\u8d39\u7aef\u8fdb\u884c\u6d88\u8d39\u7684\u65f6\u5019\uff0c\u5982\u679c\u7531\u4e8e\u4e1a\u52a1\u5f02\u5e38\u53ef\u4ee5\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u8fdb\u884c\u8865\u507f\u3002\u4f46\u662f\u5bf9\u4e8e\u670d\u52a1\u5668\u5b95\u673a\u7b49\u4e25\u91cd\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981 \u624b\u52a8ACK \u4fdd\u969c\u6d88\u8d39\u7aef\u6d88\u8d39\u6210\u529f\u3002 // deliveryTag\uff1a\u6d88\u606f\u5728mq\u4e2d\u7684\u552f\u4e00\u6807\u8bc6 // multiple\uff1a\u662f\u5426\u6279\u91cf(\u548cqos\u8bbe\u7f6e\u7c7b\u4f3c\u7684\u53c2\u6570) // requeue\uff1a\u662f\u5426\u9700\u8981\u91cd\u56de\u961f\u5217\u3002\u6216\u8005\u4e22\u5f03\u6216\u8005\u91cd\u56de\u961f\u9996\u518d\u6b21\u6d88\u8d39\u3002 public void basicNack(long deliveryTag, boolean multiple, boolean requeue) \u590d\u5236\u4ee3\u7801 \u5982\u4e0a\u4ee3\u7801\uff0c\u6d88\u606f\u5728 \u6d88\u8d39\u7aef\u91cd\u56de\u961f\u5217 \u662f\u4e3a\u4e86\u5bf9\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u628a\u6d88\u606f\u91cd\u65b0\u8fd4\u56de\u5230Broker\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u90fd\u4f1a\u5173\u95ed\u91cd\u56de\u961f\u5217( \u907f\u514d\u8fdb\u5165\u6b7b\u5faa\u73af )\uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3afalse\u3002 \u6b7b\u4fe1\u961f\u5217DLX \u6b7b\u4fe1\u961f\u5217(DLX Dead-Letter-Exchange)\uff1a \u5f53\u6d88\u606f\u5728\u4e00\u4e2a\u961f\u5217\u4e2d\u53d8\u6210\u6b7b\u4fe1\u4e4b\u540e\uff0c\u5b83\u4f1a\u88ab\u91cd\u65b0\u63a8\u9001\u5230\u53e6\u4e00\u4e2a\u961f\u5217\uff0c\u8fd9\u4e2a\u961f\u5217\u5c31\u662f\u6b7b\u4fe1\u961f\u5217\u3002 DLX\u4e5f\u662f\u4e00\u4e2a\u6b63\u5e38\u7684Exchange\uff0c\u548c\u4e00\u822c\u7684Exchange\u6ca1\u6709\u533a\u522b\uff0c\u5b83\u80fd\u5728\u4efb\u4f55\u7684\u961f\u5217\u4e0a\u88ab\u6307\u5b9a\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u8bbe\u7f6e\u67d0\u4e2a\u961f\u5217\u7684\u5c5e\u6027\u3002 \u5f53\u8fd9\u4e2a\u961f\u5217\u4e2d\u6709\u6b7b\u4fe1\u65f6\uff0cRabbitMQ\u5c31\u4f1a\u81ea\u52a8\u7684\u5c06\u8fd9\u4e2a\u6d88\u606f\u91cd\u65b0\u53d1\u5e03\u5230\u8bbe\u7f6e\u7684Exchange\u4e0a\u53bb\uff0c\u8fdb\u800c\u88ab\u8def\u7531\u5230\u53e6\u4e00\u4e2a\u961f\u5217\u3002 2\u3001RocketMQ \u963f\u91cc\u5df4\u5df4\u53cc\u5341\u4e00\u5b98\u65b9\u6307\u5b9a\u6d88\u606f\u4ea7\u54c1\uff0c\u652f\u6491\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u6240\u6709\u7684\u6d88\u606f\u670d\u52a1\uff0c\u5386\u7ecf\u5341\u4f59\u5e74\u9ad8\u53ef\u7528\u4e0e\u9ad8\u53ef\u9760\u7684\u4e25\u82db\u8003\u9a8c\uff0c\u662f\u963f\u91cc\u5df4\u5df4\u4ea4\u6613\u94fe\u8def\u7684\u6838\u5fc3\u4ea7\u54c1\uff1b Rocket\uff1a\u706b\u7bad\u7684\u610f\u601d\u3002 RocketMQ\u7684\u6838\u5fc3\u6982\u5ff5 \u4ed6\u6709\u4ee5\u4e0b\u6838\u5fc3\u6982\u5ff5\uff1a Broker \u3001 Topic \u3001 Tag \u3001 MessageQueue \u3001 NameServer \u3001 Group \u3001 Offset \u3001 Producer \u4ee5\u53ca Consumer \u3002 \u4e0b\u9762\u6765\u8be6\u7ec6\u4ecb\u7ecd\u3002 Broker \uff1a\u6d88\u606f\u4e2d\u8f6c\u89d2\u8272\uff0c\u8d1f\u8d23 \u5b58\u50a8\u6d88\u606f \uff0c\u8f6c\u53d1\u6d88\u606f\u3002 Broker \u662f\u5177\u4f53\u63d0\u4f9b\u4e1a\u52a1\u7684\u670d\u52a1\u5668\uff0c\u5355\u4e2aBroker\u8282\u70b9\u4e0e\u6240\u6709\u7684NameServer\u8282\u70b9\u4fdd\u6301\u957f\u8fde\u63a5\u53ca\u5fc3\u8df3\uff0c\u5e76\u4f1a\u5b9a\u65f6\u5c06 Topic \u4fe1\u606f\u6ce8\u518c\u5230NameServer\uff0c\u987a\u5e26\u4e00\u63d0\u5e95\u5c42\u7684\u901a\u4fe1\u548c\u8fde\u63a5\u90fd\u662f \u57fa\u4e8eNetty\u5b9e\u73b0 \u7684\u3002 Broker \u8d1f\u8d23\u6d88\u606f\u5b58\u50a8\uff0c\u4ee5Topic\u4e3a\u7eac\u5ea6\u652f\u6301\u8f7b\u91cf\u7ea7\u7684\u961f\u5217\uff0c\u5355\u673a\u53ef\u4ee5\u652f\u6491\u4e0a\u4e07\u961f\u5217\u89c4\u6a21\uff0c\u652f\u6301\u6d88\u606f\u63a8\u62c9\u6a21\u578b\u3002 \u5b98\u7f51\u4e0a\u6709\u6570\u636e\u663e\u793a\uff1a\u5177\u6709 \u4e0a\u4ebf\u7ea7\u6d88\u606f\u5806\u79ef\u80fd\u529b \uff0c\u540c\u65f6\u53ef \u4e25\u683c\u4fdd\u8bc1\u6d88\u606f\u7684\u6709\u5e8f\u6027 \u3002 Topic \uff1a\u4e3b\u9898\uff01\u5b83\u662f\u6d88\u606f\u7684\u7b2c\u4e00\u7ea7\u7c7b\u578b\u3002\u6bd4\u5982\u4e00\u4e2a\u7535\u5546\u7cfb\u7edf\u53ef\u4ee5\u5206\u4e3a\uff1a\u4ea4\u6613\u6d88\u606f\u3001\u7269\u6d41\u6d88\u606f\u7b49\uff0c\u4e00\u6761\u6d88\u606f\u5fc5\u987b\u6709\u4e00\u4e2a Topic \u3002 Topic \u4e0e\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7684\u5173\u7cfb\u975e\u5e38\u677e\u6563\uff0c\u4e00\u4e2a Topic \u53ef\u4ee5\u67090\u4e2a\u30011\u4e2a\u3001\u591a\u4e2a\u751f\u4ea7\u8005\u5411\u5176\u53d1\u9001\u6d88\u606f\uff0c\u4e00\u4e2a\u751f\u4ea7\u8005\u4e5f\u53ef\u4ee5\u540c\u65f6\u5411\u4e0d\u540c\u7684 Topic \u53d1\u9001\u6d88\u606f\u3002\u4e00\u4e2a Topic \u4e5f\u53ef\u4ee5\u88ab 0\u4e2a\u30011\u4e2a\u3001\u591a\u4e2a\u6d88\u8d39\u8005\u8ba2\u9605\u3002 Tag \uff1a\u6807\u7b7e\uff01\u53ef\u4ee5\u770b\u4f5c\u5b50\u4e3b\u9898\uff0c\u5b83\u662f\u6d88\u606f\u7684\u7b2c\u4e8c\u7ea7\u7c7b\u578b\uff0c\u7528\u4e8e\u4e3a\u7528\u6237\u63d0\u4f9b\u989d\u5916\u7684\u7075\u6d3b\u6027\u3002\u4f7f\u7528\u6807\u7b7e\uff0c\u540c\u4e00\u4e1a\u52a1\u6a21\u5757\u4e0d\u540c\u76ee\u7684\u7684\u6d88\u606f\u5c31\u53ef\u4ee5\u7528\u76f8\u540c Topic \u800c\u4e0d\u540c\u7684 Tag \u6765\u6807\u8bc6\u3002\u6bd4\u5982\u4ea4\u6613\u6d88\u606f\u53c8\u53ef\u4ee5\u5206\u4e3a\uff1a\u4ea4\u6613\u521b\u5efa\u6d88\u606f\u3001\u4ea4\u6613\u5b8c\u6210\u6d88\u606f\u7b49\uff0c\u4e00\u6761\u6d88\u606f\u53ef\u4ee5\u6ca1\u6709 Tag \u3002\u6807\u7b7e\u6709\u52a9\u4e8e\u4fdd\u6301\u60a8\u7684\u4ee3\u7801\u5e72\u51c0\u548c\u8fde\u8d2f\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u4e3a RocketMQ \u63d0\u4f9b\u7684\u67e5\u8be2\u7cfb\u7edf\u63d0\u4f9b\u5e2e\u52a9\u3002 MessageQueue \uff1a\u4e00\u4e2a Topic \u4e0b\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u53d1\u9001\u6d88\u606f\u65f6\u6267\u884c\u8be5\u6d88\u606f\u7684 Topic \uff0cRocketMQ \u4f1a\u8f6e\u8be2\u8be5 Topic \u4e0b\u7684\u6240\u6709\u961f\u5217\u5c06\u6d88\u606f\u53d1\u51fa\u53bb\u3002\u6d88\u606f\u7684\u7269\u7406\u7ba1\u7406\u5355\u4f4d\u3002\u4e00\u4e2aTopic\u4e0b\u53ef\u4ee5\u6709\u591a\u4e2aQueue\uff0cQueue\u7684\u5f15\u5165\u4f7f\u5f97\u6d88\u606f\u7684\u5b58\u50a8\u53ef\u4ee5\u5206\u5e03\u5f0f\u96c6\u7fa4\u5316\uff0c\u5177\u6709\u4e86\u6c34\u5e73\u6269\u5c55\u80fd\u529b\u3002 NameServer \uff1a\u7c7b\u4f3cKafka\u4e2d\u7684Zookeeper, \u4f46NameServer\u96c6\u7fa4\u4e4b\u95f4\u662f \u6ca1\u6709\u901a\u4fe1 \u7684\uff0c\u76f8\u5bf9ZK\u6765\u8bf4\u66f4\u52a0 \u8f7b\u91cf \u3002 \u5b83\u4e3b\u8981\u8d1f\u8d23\u5bf9\u4e8e\u6e90\u6570\u636e\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u4e86\u5bf9\u4e8e Topic \u548c\u8def\u7531\u4fe1\u606f\u7684\u7ba1\u7406\u3002\u6bcf\u4e2a Broker \u5728\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u5230 NameServer \u6ce8\u518c\uff0cProducer \u5728\u53d1\u9001\u6d88\u606f\u524d\u4f1a\u6839\u636e Topic \u53bb NameServer \u83b7\u53d6\u5bf9\u5e94 Broker \u7684\u8def\u7531\u4fe1\u606f \uff0cConsumer \u4e5f\u4f1a\u5b9a\u65f6\u83b7\u53d6 Topic \u7684\u8def\u7531\u4fe1\u606f\u3002 Producer \uff1a \u751f\u4ea7\u8005\uff0c\u652f\u6301\u4e09\u79cd\u65b9\u5f0f\u53d1\u9001\u6d88\u606f\uff1a \u540c\u6b65\u3001\u5f02\u6b65\u548c\u5355\u5411 \u5355\u5411\u53d1\u9001 \uff1a\u6d88\u606f\u53d1\u51fa\u53bb\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u6761\u6d88\u606f\u6216\u6267\u884c\u4e1a\u52a1\u4ee3\u7801\uff0c\u4e0d\u7b49\u5f85\u670d\u52a1\u5668\u56de\u5e94\uff0c\u4e14 \u6ca1\u6709\u56de\u8c03\u51fd\u6570 \u3002 \u5f02\u6b65\u53d1\u9001 \uff1a\u6d88\u606f\u53d1\u51fa\u53bb\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u6761\u6d88\u606f\u6216\u6267\u884c\u4e1a\u52a1\u4ee3\u7801\uff0c\u4e0d\u7b49\u5f85\u670d\u52a1\u5668\u56de\u5e94\uff0c \u6709\u56de\u8c03\u51fd\u6570 \u3002 \u540c\u6b65\u53d1\u9001 \uff1a\u6d88\u606f\u53d1\u51fa\u53bb\u540e\uff0c\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\u6210\u529f\u6216\u5931\u8d25\uff0c\u624d\u80fd\u7ee7\u7eed\u540e\u9762\u7684\u64cd\u4f5c\u3002 Consumer \uff1a\u6d88\u8d39\u8005\uff0c\u652f\u6301 PUSH \u548c PULL \u4e24\u79cd\u6d88\u8d39\u6a21\u5f0f\uff0c\u652f\u6301 \u96c6\u7fa4\u6d88\u8d39 \u548c \u5e7f\u64ad\u6d88\u8d39 \u96c6\u7fa4\u6d88\u8d39 : \u8be5\u6a21\u5f0f\u4e0b\u4e00\u4e2a\u6d88\u8d39\u8005\u96c6\u7fa4\u5171\u540c\u6d88\u8d39\u4e00\u4e2a\u4e3b\u9898\u7684\u591a\u4e2a\u961f\u5217\uff0c\u4e00\u4e2a\u961f\u5217\u53ea\u4f1a\u88ab\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff0c\u5982\u679c\u67d0\u4e2a\u6d88\u8d39\u8005\u6302\u6389\uff0c\u5206\u7ec4\u5185\u5176\u5b83\u6d88\u8d39\u8005\u4f1a\u63a5\u66ff\u6302\u6389\u7684\u6d88\u8d39\u8005\u7ee7\u7eed\u6d88\u8d39\u3002 \u5e7f\u64ad\u6d88\u8d39 : \u4f1a\u53d1\u7ed9\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u8fdb\u884c\u6d88\u8d39\u3002\u76f8\u5f53\u4e8e RabbitMQ \u7684\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u3002 Group \uff1a\u5206\u7ec4\uff0c\u4e00\u4e2a\u7ec4\u53ef\u4ee5\u8ba2\u9605\u591a\u4e2aTopic\u3002\u5206\u4e3a ProducerGroup\uff0cConsumerGroup\uff0c\u4ee3\u8868\u67d0\u4e00\u7c7b\u7684\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\uff0c\u4e00\u822c\u6765\u8bf4\u540c\u4e00\u4e2a\u670d\u52a1\u53ef\u4ee5\u4f5c\u4e3aGroup\uff0c\u540c\u4e00\u4e2aGroup\u4e00\u822c\u6765\u8bf4\u53d1\u9001\u548c\u6d88\u8d39\u7684\u6d88\u606f\u90fd\u662f\u4e00\u6837\u7684 Offset \uff1a\u5728 RocketMQ \u4e2d\uff0c\u6240\u6709\u6d88\u606f\u961f\u5217\u90fd\u662f\u6301\u4e45\u5316\uff0c\u957f\u5ea6\u65e0\u9650\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6240\u8c13\u957f\u5ea6\u65e0\u9650\u662f\u6307\u961f\u5217\u4e2d\u7684\u6bcf\u4e2a\u5b58\u50a8\u5355\u5143\u90fd\u662f\u5b9a\u957f\uff0c\u8bbf\u95ee\u5176\u4e2d\u7684\u5b58\u50a8\u5355\u5143\u4f7f\u7528Offset \u6765\u8bbf\u95ee\uff0cOffset \u4e3a java long \u7c7b\u578b\uff0c64 \u4f4d\uff0c\u7406\u8bba\u4e0a\u5728 100\u5e74\u5185\u4e0d\u4f1a\u6ea2\u51fa\uff0c\u6240\u4ee5\u8ba4\u4e3a\u662f\u957f\u5ea6\u65e0\u9650\u3002\u4e5f\u53ef\u4ee5\u8ba4\u4e3a Message Queue \u662f\u4e00\u4e2a\u957f\u5ea6\u65e0\u9650\u7684\u6570\u7ec4\uff0c Offset \u5c31\u662f\u4e0b\u6807\u3002 \u5ef6\u65f6\u6d88\u606f \u5f00\u6e90\u7248\u7684RocketMQ\u4e0d\u652f\u6301\u4efb\u610f\u65f6\u95f4\u7cbe\u5ea6\uff0c\u4ec5\u652f\u6301\u7279\u5b9a\u7684 level\uff0c\u4f8b\u5982\u5b9a\u65f6 5s\uff0c 10s\uff0c 1min \u7b49\u3002\u5176\u4e2d\uff0clevel=0 \u7ea7\u8868\u793a\u4e0d\u5ef6\u65f6\uff0clevel=1 \u8868\u793a 1 \u7ea7\u5ef6\u65f6\uff0clevel=2 \u8868\u793a 2 \u7ea7\u5ef6\u65f6\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u5ef6\u65f6\u7b49\u7ea7\u5982\u4e0b\uff1a messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h \u590d\u5236\u4ee3\u7801 \u987a\u5e8f\u6d88\u606f \u6d88\u606f\u6709\u5e8f\u6307\u7684\u662f\u53ef\u4ee5\u6309\u7167\u6d88\u606f\u7684\u53d1\u9001\u987a\u5e8f\u6765\u6d88\u8d39\uff08FIFO\uff09\u3002RocketMQ\u53ef\u4ee5\u4e25\u683c\u7684\u4fdd\u8bc1\u6d88\u606f\u6709\u5e8f\uff0c\u53ef\u4ee5\u5206\u4e3a \u5206\u533a\u6709\u5e8f \u6216\u8005 \u5168\u5c40\u6709\u5e8f \u3002 \u4e8b\u52a1\u6d88\u606f \u6d88\u606f\u961f\u5217 MQ \u63d0\u4f9b\u7c7b\u4f3c X/Open XA \u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u529f\u80fd\uff0c\u901a\u8fc7\u6d88\u606f\u961f\u5217 MQ \u4e8b\u52a1\u6d88\u606f\u80fd\u8fbe\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6700\u7ec8\u4e00\u81f4\u3002\u4e0a\u56fe\u8bf4\u660e\u4e86\u4e8b\u52a1\u6d88\u606f\u7684\u5927\u81f4\u6d41\u7a0b\uff1a\u6b63\u5e38\u4e8b\u52a1\u6d88\u606f\u7684\u53d1\u9001\u548c\u63d0\u4ea4\u3001\u4e8b\u52a1\u6d88\u606f\u7684\u8865\u507f\u6d41\u7a0b\u3002 \u4e8b\u52a1\u6d88\u606f\u53d1\u9001\u53ca\u63d0\u4ea4 \uff1a \u53d1\u9001half\u6d88\u606f \u670d\u52a1\u7aef\u54cd\u5e94\u6d88\u606f\u5199\u5165\u7ed3\u679c \u6839\u636e\u53d1\u9001\u7ed3\u679c\u6267\u884c\u672c\u5730\u4e8b\u52a1\uff08\u5982\u679c\u5199\u5165\u5931\u8d25\uff0c\u6b64\u65f6half\u6d88\u606f\u5bf9\u4e1a\u52a1\u4e0d\u53ef\u89c1\uff0c\u672c\u5730\u903b\u8f91\u4e0d\u6267\u884c\uff09\uff1b \u6839\u636e\u672c\u5730\u4e8b\u52a1\u72b6\u6001\u6267\u884cCommit\u6216Rollback\uff08Commit\u64cd\u4f5c\u751f\u6210\u6d88\u606f\u7d22\u5f15\uff0c\u6d88\u606f\u5bf9\u6d88\u8d39\u8005\u53ef\u89c1\uff09\u3002 \u4e8b\u52a1\u6d88\u606f\u7684\u8865\u507f\u6d41\u7a0b \uff1a \u5bf9\u6ca1\u6709Commit/Rollback\u7684\u4e8b\u52a1\u6d88\u606f\uff08pending\u72b6\u6001\u7684\u6d88\u606f\uff09\uff0c\u4ece\u670d\u52a1\u7aef\u53d1\u8d77\u4e00\u6b21\u201c\u56de\u67e5\u201d\uff1b Producer\u6536\u5230\u56de\u67e5\u6d88\u606f\uff0c\u68c0\u67e5\u56de\u67e5\u6d88\u606f\u5bf9\u5e94\u7684\u672c\u5730\u4e8b\u52a1\u7684\u72b6\u6001\u3002 \u6839\u636e\u672c\u5730\u4e8b\u52a1\u72b6\u6001\uff0c\u91cd\u65b0Commit\u6216RollBack \u5176\u4e2d\uff0c\u8865\u507f\u9636\u6bb5\u7528\u4e8e\u89e3\u51b3\u6d88\u606fCommit\u6216Rollback\u53d1\u751f\u8d85\u65f6\u6216\u8005\u5931\u8d25\u7684\u60c5\u51b5\u3002 \u4e8b\u52a1\u6d88\u606f\u72b6\u6001 \uff1a \u4e8b\u52a1\u6d88\u606f\u5171\u6709\u4e09\u79cd\u72b6\u6001\uff1a\u63d0\u4ea4\u72b6\u6001\u3001\u56de\u6eda\u72b6\u6001\u3001\u4e2d\u95f4\u72b6\u6001\uff1a TransactionStatus.CommitTransaction\uff1a\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5b83\u5141\u8bb8\u6d88\u8d39\u8005\u6d88\u8d39\u6b64\u6d88\u606f\u3002 TransactionStatus.RollbackTransaction\uff1a\u56de\u6eda\u4e8b\u52a1\uff0c\u5b83\u4ee3\u8868\u8be5\u6d88\u606f\u5c06\u88ab\u5220\u9664\uff0c\u4e0d\u5141\u8bb8\u88ab\u6d88\u8d39\u3002 TransactionStatus.Unkonwn\uff1a\u4e2d\u95f4\u72b6\u6001\uff0c\u5b83\u4ee3\u8868\u9700\u8981\u68c0\u67e5\u6d88\u606f\u961f\u5217\u6765\u786e\u5b9a\u6d88\u606f\u72b6\u6001\u3002 RocketMQ\u7684\u9ad8\u53ef\u7528\u673a\u5236 RocketMQ\u662f\u5929\u751f\u652f\u6301\u5206\u5e03\u5f0f\u7684\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e3b\u4ece\u4ee5\u53ca\u6c34\u5e73\u6269\u5c55 Master\u89d2\u8272\u7684Broker\u652f\u6301\u8bfb\u548c\u5199\uff0cSlave\u89d2\u8272\u7684Broker\u4ec5\u652f\u6301\u8bfb\uff0c\u4e5f\u5c31\u662f Producer\u53ea\u80fd\u548cMaster\u89d2\u8272\u7684Broker\u8fde\u63a5\u5199\u5165\u6d88\u606f\uff1bConsumer\u53ef\u4ee5\u8fde\u63a5 Master\u89d2\u8272\u7684Broker\uff0c\u4e5f\u53ef\u4ee5\u8fde\u63a5Slave\u89d2\u8272\u7684Broker\u6765\u8bfb\u53d6\u6d88\u606f\u3002 \u6d88\u606f\u6d88\u8d39\u7684\u9ad8\u53ef\u7528\uff08\u4e3b\u4ece\uff09 \u5728Consumer\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5e76\u4e0d\u9700\u8981\u8bbe\u7f6e\u662f\u4eceMaster\u8bfb\u8fd8\u662f\u4eceSlave \u8bfb\uff0c\u5f53Master\u4e0d\u53ef\u7528\u6216\u8005\u7e41\u5fd9\u7684\u65f6\u5019\uff0cConsumer\u4f1a\u88ab\u81ea\u52a8\u5207\u6362\u5230\u4eceSlave \u8bfb\u3002\u6709\u4e86\u81ea\u52a8\u5207\u6362Consumer\u8fd9\u79cd\u673a\u5236\uff0c\u5f53\u4e00\u4e2aMaster\u89d2\u8272\u7684\u673a\u5668\u51fa\u73b0\u6545\u969c\u540e\uff0cConsumer\u4ecd\u7136\u53ef\u4ee5\u4eceSlave\u8bfb\u53d6\u6d88\u606f\uff0c\u4e0d\u5f71\u54cdConsumer\u7a0b\u5e8f\u3002\u8fd9\u5c31\u8fbe\u5230\u4e86\u6d88\u8d39\u7aef\u7684\u9ad8\u53ef\u7528\u6027\u3002 RocketMQ\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\u628aSlave\u81ea\u52a8\u8f6c\u6210Master \uff0c\u5982\u679c\u673a\u5668\u8d44\u6e90\u4e0d\u8db3\uff0c\u9700\u8981\u628aSlave\u8f6c\u6210Master\uff0c\u5219\u8981\u624b\u52a8\u505c\u6b62Slave\u89d2\u8272\u7684Broker\uff0c\u66f4\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u542f\u52a8Broker\u3002 \u6d88\u606f\u53d1\u9001\u9ad8\u53ef\u7528\uff08\u914d\u7f6e\u591a\u4e2a\u4e3b\u8282\u70b9\uff09 \u5728\u521b\u5efaTopic\u7684\u65f6\u5019\uff0c\u628aTopic\u7684\u591a\u4e2aMessage Queue\u521b\u5efa\u5728\u591a\u4e2aBroker\u7ec4\u4e0a\uff08\u76f8\u540cBroker\u540d\u79f0\uff0c\u4e0d\u540c brokerId\u7684\u673a\u5668\u7ec4\u6210\u4e00\u4e2aBroker\u7ec4\uff09\uff0c\u8fd9\u6837\u5f53\u4e00\u4e2aBroker\u7ec4\u7684Master\u4e0d\u53ef\u7528\u540e\uff0c\u5176\u4ed6\u7ec4\u7684Master\u4ecd\u7136\u53ef\u7528\uff0cProducer\u4ecd\u7136\u53ef\u4ee5\u53d1\u9001\u6d88\u606f\u3002 \u4e3b\u4ece\u590d\u5236 \u5982\u679c\u4e00\u4e2aBroker\u7ec4\u6709Master\u548cSlave\uff0c\u6d88\u606f\u9700\u8981\u4eceMaster\u590d\u5236\u5230Slave \u4e0a\uff0c\u6709\u540c\u6b65\u548c\u5f02\u6b65\u4e24\u79cd\u590d\u5236\u65b9\u5f0f\u3002 \u540c\u6b65\u590d\u5236 \uff1a\u540c\u6b65\u590d\u5236\u65b9\u5f0f\u662f\u7b49Master\u548cSlave\u5747\u5199\u6210\u529f\u540e\u624d\u53cd\u9988\u7ed9\u5ba2\u6237\u7aef\u5199\u6210\u529f\u72b6\u6001\u3002\u5982\u679cMaster\u51fa\u6545\u969c\uff0c Slave\u4e0a\u6709\u5168\u90e8\u7684\u5907\u4efd\u6570\u636e\uff0c\u5bb9\u6613\u6062\u590d\u540c\u6b65\u590d\u5236\u4f1a\u589e\u5927\u6570\u636e\u5199\u5165\u5ef6\u8fdf\uff0c\u964d\u4f4e\u7cfb\u7edf\u541e\u5410\u91cf\u3002 \u5f02\u6b65\u590d\u5236 \uff1a\u5f02\u6b65\u590d\u5236\u65b9\u5f0f\u662f\u53ea\u8981Master\u5199\u6210\u529f \u5373\u53ef\u53cd\u9988\u7ed9\u5ba2\u6237\u7aef\u5199\u6210\u529f\u72b6\u6001\u3002\u5728\u5f02\u6b65\u590d\u5236\u65b9\u5f0f\u4e0b\uff0c\u7cfb\u7edf\u62e5\u6709\u8f83\u4f4e\u7684\u5ef6\u8fdf\u548c\u8f83\u9ad8\u7684\u541e\u5410\u91cf\uff0c\u4f46\u662f\u5982\u679cMaster\u51fa\u4e86\u6545\u969c\uff0c\u6709\u4e9b\u6570\u636e\u56e0\u4e3a\u6ca1\u6709\u88ab\u5199 \u5165Slave\uff0c\u6709\u53ef\u80fd\u4f1a\u4e22\u5931 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u628aMaster\u548cSave\u914d\u7f6e\u6210\u540c\u6b65\u5237\u76d8\u65b9\u5f0f\uff0c\u4e3b\u4ece\u4e4b\u95f4\u914d\u7f6e\u6210\u5f02\u6b65\u7684\u590d\u5236\u65b9\u5f0f\uff0c\u8fd9\u6837\u5373\u4f7f\u6709\u4e00\u53f0\u673a\u5668\u51fa\u6545\u969c\uff0c\u4ecd\u7136\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\uff0c\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u8d1f\u8f7d\u5747\u8861 Producer\u8d1f\u8f7d\u5747\u8861 Producer\u7aef\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5728\u53d1\u6d88\u606f\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u4f1a \u8f6e\u8be2 \u6240\u6709\u7684message queue\u53d1\u9001\uff0c\u4ee5\u8fbe\u5230\u8ba9\u6d88\u606f\u5e73\u5747\u843d\u5728\u4e0d\u540c\u7684queue\u4e0a\u3002\u800c\u7531\u4e8equeue\u53ef\u4ee5\u6563\u843d\u5728\u4e0d\u540c\u7684broker\uff0c\u6240\u4ee5\u6d88\u606f\u5c31\u53d1\u9001\u5230\u4e0d\u540c\u7684broker\u4e0b\uff0c\u5982\u4e0b\u56fe\uff1a Consumer\u8d1f\u8f7d\u5747\u8861 \u5982\u679cconsumer\u5b9e\u4f8b\u7684\u6570\u91cf\u6bd4message queue\u7684\u603b\u6570\u91cf\u8fd8\u591a\u7684\u8bdd\uff0c \u591a\u51fa\u6765\u7684consumer\u5b9e\u4f8b\u5c06\u65e0\u6cd5\u5206\u5230queue \uff0c\u4e5f\u5c31\u65e0\u6cd5\u6d88\u8d39\u5230\u6d88\u606f\uff0c\u4e5f\u5c31\u65e0\u6cd5\u8d77\u5230\u5206\u644a\u8d1f\u8f7d\u7684\u4f5c\u7528\u4e86\u3002\u6240\u4ee5\u9700\u8981\u63a7\u5236\u8ba9queue\u7684\u603b\u6570\u91cf\u5927\u4e8e\u7b49\u4e8econsumer\u7684\u6570\u91cf\u3002 \u6d88\u8d39\u8005\u7684\u96c6\u7fa4\u6a21\u5f0f\u2013\u542f\u52a8\u591a\u4e2a\u6d88\u8d39\u8005\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6d88\u8d39\u8005\u7684\u8d1f\u8f7d\u5747\u8861\uff08\u5747\u644a\u961f\u5217\uff09 \u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u5747\u644a\u961f\u5217 \uff1a\u4f1a\u6309\u7167queue\u7684\u6570\u91cf\u548c\u5b9e\u4f8b\u7684\u6570\u91cf\u5e73\u5747\u5206\u914dqueue\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\uff0c\u8fd9\u6837\u6bcf\u4e2a\u6d88\u8d39\u8005\u53ef\u4ee5\u5747\u644a\u6d88\u8d39\u7684\u961f\u5217\uff0c\u5982\u4e0b\u56fe\u6240\u793a6\u4e2a\u961f\u5217\u548c\u4e09\u4e2a\u751f\u4ea7\u8005\u3002 \u53e6\u5916\u4e00\u79cd\u5e73\u5747\u7684\u7b97\u6cd5 \u73af\u72b6\u8f6e\u6d41\u5206queue \u7684\u5f62\u5f0f\uff0c\u6bcf\u4e2a\u6d88\u8d39\u8005\uff0c\u5747\u644a\u4e0d\u540c\u4e3b\u8282\u70b9\u7684\u4e00\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5bf9\u4e8e\u5e7f\u64ad\u6a21\u5f0f\u5e76\u4e0d\u662f\u8d1f\u8f7d\u5747\u8861\u7684\uff0c\u8981\u6c42\u4e00\u6761\u6d88\u606f\u9700\u8981\u6295\u9012\u5230\u4e00\u4e2a\u6d88\u8d39\u7ec4\u4e0b\u9762\u6240\u6709\u7684\u6d88\u8d39\u8005\u5b9e\u4f8b\uff0c\u6240\u4ee5\u4e5f\u5c31\u6ca1\u6709\u6d88\u606f\u88ab\u5206\u644a\u6d88\u8d39\u7684\u8bf4\u6cd5\u3002 \u6b7b\u4fe1\u961f\u5217 \u5f53\u4e00\u6761\u6d88\u606f\u6d88\u8d39\u5931\u8d25\uff0cRocketMQ\u5c31\u4f1a\u81ea\u52a8\u8fdb\u884c\u6d88\u606f\u91cd\u8bd5\u3002\u800c\u5982\u679c\u6d88\u606f\u8d85\u8fc7\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0cRocketMQ\u5c31\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u6d88\u606f\u6709\u95ee\u9898\u3002\u4f46\u662f\u6b64\u65f6\uff0cRocketMQ\u4e0d\u4f1a\u7acb\u523b\u5c06\u8fd9\u4e2a\u6709\u95ee\u9898\u7684\u6d88\u606f\u4e22\u5f03\uff0c\u800c\u4f1a\u5c06\u5176\u53d1\u9001\u5230\u8fd9\u4e2a\u6d88\u8d39\u8005\u7ec4\u5bf9\u5e94\u7684\u4e00\u79cd\u7279\u6b8a\u961f\u5217\uff1a\u6b7b\u4fe1\u961f\u5217\u3002\u6b7b\u4fe1\u961f\u5217\u7684\u540d\u79f0\u662f %DLQ%+ConsumGroup \u6b7b\u4fe1\u961f\u5217\u5177\u6709\u4ee5\u4e0b\u7279\u6027 \uff1a \u4e00\u4e2a\u6b7b\u4fe1\u961f\u5217\u5bf9\u5e94\u4e00\u4e2a Group ID\uff0c \u800c\u4e0d\u662f\u5bf9\u5e94\u5355\u4e2a\u6d88\u8d39\u8005\u5b9e\u4f8b\u3002 \u5982\u679c\u4e00\u4e2a Group ID \u672a\u4ea7\u751f\u6b7b\u4fe1\u6d88\u606f\uff0c\u6d88\u606f\u961f\u5217 RocketMQ \u4e0d\u4f1a\u4e3a\u5176\u521b\u5efa\u76f8\u5e94\u7684\u6b7b\u4fe1\u961f\u5217\u3002 \u4e00\u4e2a\u6b7b\u4fe1\u961f\u5217\u5305\u542b\u4e86\u5bf9\u5e94 Group ID \u4ea7\u751f\u7684\u6240\u6709\u6b7b\u4fe1\u6d88\u606f\uff0c\u4e0d\u8bba\u8be5\u6d88\u606f\u5c5e\u4e8e\u54ea\u4e2a Topic\u3002 3\u3001Kafka Kafka\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u3001\u652f\u6301\u5206\u533a\u7684\u3001\u591a\u526f\u672c\u7684\uff0c \u57fa\u4e8eZookeeper \u534f\u8c03\u7684\u5206\u5e03\u5f0f\u6d88\u606f\u7cfb\u7edf\u3002 \u5b83\u6700\u5927\u7684\u7279\u6027\u5c31\u662f\u53ef\u4ee5\u5b9e\u65f6\u7684\u5904\u7406\u5927\u91cf\u6570\u636e\u4ee5\u6ee1\u8db3\u5404\u79cd\u9700\u6c42\u573a\u666f\uff1a\u6bd4\u5982\u57fa\u4e8ehadoop\u7684\u6279\u5904\u7406\u7cfb\u7edf\u3001\u4f4e\u5ef6\u8fdf\u7684\u5b9e\u65f6\u7cfb\u7edf\u3001Storm/Spark\u6d41\u5f0f\u5904\u7406\u5f15\u64ce\uff0cWeb/Nginx\u65e5\u5fd7\u3001\u8bbf\u95ee\u65e5\u5fd7\uff0c\u6d88\u606f\u670d\u52a1\u7b49\u7b49\uff0c\u7528 Scala\u8bed\u8a00\u7f16\u5199 \u3002\u5c5e\u4e8eApache\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\u3002 \u5148\u770b\u4e00\u4e0bKafka\u7684\u67b6\u6784\u56fe Kafka\u7684\u6838\u5fc3\u6982\u5ff5 \u5728Kafka\u4e2d\u6709\u51e0\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a Broker \u3001 Topic \u3001 Producer \u3001 Consumer \u3001 ConsumerGroup \u3001 Partition \u3001 Leader \u3001 Follower \u3001 Offset \u3002 Broker : \u6d88\u606f\u4e2d\u95f4\u4ef6\u5904\u7406\u8282\u70b9\uff0c\u4e00\u4e2aKafka\u8282\u70b9\u5c31\u662f\u4e00\u4e2abroker\uff0c\u4e00\u4e2a\u6216\u8005\u591a\u4e2aBroker\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2aKafka\u96c6\u7fa4 Topic : Kafka\u6839\u636etopic\u5bf9\u6d88\u606f\u8fdb\u884c\u5f52\u7c7b\uff0c\u53d1\u5e03\u5230Kafka\u96c6\u7fa4\u7684\u6bcf\u6761\u6d88\u606f\u90fd\u9700\u8981\u6307\u5b9a\u4e00\u4e2a topic Producer : \u6d88\u606f\u751f\u4ea7\u8005\uff0c\u5411Broker\u53d1\u9001\u6d88\u606f\u7684\u5ba2\u6237\u7aef Consumer : \u6d88\u606f\u6d88\u8d39\u8005\uff0c\u4eceBroker\u8bfb\u53d6\u6d88\u606f\u7684\u5ba2\u6237\u7aef ConsumerGroup : \u6bcf\u4e2aConsumer\u5c5e\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684ConsumerGroup\uff0c\u4e00\u6761\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u4e0d\u540c\u7684ConsumerGroup\u6d88\u8d39\uff0c\u4f46\u662f\u4e00\u4e2aConsumerGroup\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2aConsumer\u80fd\u591f\u6d88\u8d39\u8be5\u6d88\u606f Partition : \u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u4e00\u4e2atopic\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2apartition\uff0c\u6bcf\u4e2apartition\u5185\u90e8\u6d88\u606f\u662f\u6709\u5e8f\u7684 Leader : \u6bcf\u4e2apartition\u6709\u591a\u4e2a\u526f\u672c\uff0c\u5176\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u4f5c\u4e3aLeader\uff0cLeader\u662f\u8d1f\u8d23\u6570\u636e\u8bfb\u5199\u7684partition\u3002 Follower : Follower\u8ddf\u968fLeader\uff0c\u6240\u6709\u5199\u8bf7\u6c42\u90fd\u901a\u8fc7Leader\u8def\u7531\uff0c\u6570\u636e\u53d8\u66f4\u4f1a\u5e7f\u64ad\u7ed9\u6240\u6709Follower\uff0cFollower\u4e0eLeader\u4fdd\u6301\u6570\u636e\u540c\u6b65\u3002\u5982\u679cLeader\u5931\u6548\uff0c\u5219\u4eceFollower\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684Leader\u3002\u5f53Follower\u4e0eLeader\u6302\u6389\u3001\u5361\u4f4f\u6216\u8005\u540c\u6b65\u592a\u6162\uff0cleader\u4f1a\u628a\u8fd9\u4e2afollower\u4ece ISR\u5217\u8868 \u4e2d\u5220\u9664\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u4e2aFollower\u3002 Offset : \u504f\u79fb\u91cf\u3002kafka\u7684\u5b58\u50a8\u6587\u4ef6\u90fd\u662f\u6309\u7167offset.kafka\u6765\u547d\u540d\uff0c\u7528offset\u505a\u540d\u5b57\u7684\u597d\u5904\u662f\u65b9\u4fbf\u67e5\u627e\u3002\u4f8b\u5982\u4f60\u60f3\u627e\u4f4d\u4e8e2049\u7684\u4f4d\u7f6e\uff0c\u53ea\u8981\u627e\u52302048.kafka\u7684\u6587\u4ef6\u5373\u53ef \u53ef\u4ee5\u8fd9\u4e48\u6765\u7406\u89e3Topic\uff0cPartition\u548cBroker\uff1a \u4e00\u4e2aTopic\uff0c\u4ee3\u8868\u903b\u8f91\u4e0a\u7684\u4e00\u4e2a\u4e1a\u52a1\u6570\u636e\u96c6\uff0c\u6bd4\u5982\u8ba2\u5355\u76f8\u5173\u64cd\u4f5c\u6d88\u606f\u653e\u5165\u8ba2\u5355Topic\uff0c\u7528\u6237\u76f8\u5173\u64cd\u4f5c\u6d88\u606f\u653e\u5165\u7528\u6237Topic\uff0c\u5bf9\u4e8e\u5927\u578b\u7f51\u7ad9\u6765\u8bf4\uff0c\u540e\u7aef\u6570\u636e\u90fd\u662f\u6d77\u91cf\u7684\uff0c\u8ba2\u5355\u6d88\u606f\u5f88\u53ef\u80fd\u662f\u975e\u5e38\u5de8\u91cf\u7684\uff0c\u6bd4\u5982\u6709\u51e0\u767e\u4e2aG\u751a\u81f3\u8fbe\u5230TB\u7ea7\u522b\uff0c\u5982\u679c\u628a\u8fd9\u4e48\u591a\u6570\u636e\u90fd\u653e\u5728\u4e00\u53f0\u673a\u5668\u4e0a\u53ef\u5b9a\u4f1a\u6709\u5bb9\u91cf\u9650\u5236\u95ee\u9898\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728Topic\u5185\u90e8\u5212\u5206\u591a\u4e2aPartition\u6765\u5206\u7247\u5b58\u50a8\u6570\u636e\uff0c\u4e0d\u540c\u7684Partition\u53ef\u4ee5\u4f4d\u4e8e\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u76f8\u5f53\u4e8e \u5206\u5e03\u5f0f\u5b58\u50a8 \u3002\u6bcf\u53f0\u673a\u5668\u4e0a\u90fd\u8fd0\u884c\u4e00\u4e2aKafka\u7684\u8fdb\u7a0bBroker\u3002 Kafka\u6838\u5fc3\u603b\u63a7\u5236\u5668Controller \u5728Kafka\u96c6\u7fa4\u4e2d\u4f1a\u6709\u4e00\u4e2a\u6216\u8005\u591a\u4e2abroker\uff0c\u5176\u4e2d\u6709\u4e00\u4e2abroker\u4f1a\u88ab\u9009\u4e3e\u4e3a\u63a7\u5236\u5668\uff08Kafka Controller\uff09\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a Broker-Leader , \u5b83\u8d1f\u8d23\u7ba1\u7406\u6574\u4e2a \u96c6\u7fa4\u4e2d\u6240\u6709\u5206\u533a\u548c\u526f\u672c\u7684\u72b6\u6001\u3002 \u5f53\u67d0\u4e2a Partition-Leader \u526f\u672c\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u7531\u63a7\u5236\u5668\u8d1f\u8d23\u4e3a\u8be5\u5206\u533a\u9009\u4e3e\u65b0\u7684Leader\u526f\u672c\u3002 \u5f53\u68c0\u6d4b\u5230\u67d0\u4e2a\u5206\u533a\u7684ISR\u96c6\u5408\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u7531\u63a7\u5236\u5668\u8d1f\u8d23\u901a\u77e5\u6240\u6709broker\u66f4\u65b0\u5176\u5143\u6570\u636e\u4fe1\u606f\u3002 \u5f53\u4e3a\u67d0\u4e2atopic\u589e\u52a0\u5206\u533a\u6570\u91cf\u65f6\uff0c\u540c\u6837\u8fd8\u662f\u7531\u63a7\u5236\u5668\u8d1f\u8d23\u8ba9\u65b0\u5206\u533a\u88ab\u5176\u4ed6\u8282\u70b9\u611f\u77e5\u5230\u3002 Controller\u9009\u4e3e\u673a\u5236 \u5728kafka\u96c6\u7fa4\u542f\u52a8\u7684\u65f6\u5019\uff0c \u9009\u4e3e\u7684\u8fc7\u7a0b\u662f\u96c6\u7fa4\u4e2d\u6bcf\u4e2abroker\u90fd\u4f1a \u5c1d\u8bd5\u5728zookeeper\u4e0a\u521b\u5efa\u4e00\u4e2a /controller \u4e34\u65f6\u8282\u70b9\uff0czookeeper\u4f1a\u4fdd\u8bc1\u6709\u4e14\u4ec5\u6709\u4e00\u4e2abroker\u80fd\u521b\u5efa\u6210\u529f \uff0c\u8fd9\u4e2abroker \u5c31\u4f1a\u6210\u4e3a\u96c6\u7fa4\u7684\u603b\u63a7\u5668controller\u3002 \u5f53\u8fd9\u4e2acontroller\u89d2\u8272\u7684broker\u5b95\u673a\u4e86\uff0c\u6b64\u65f6zookeeper\u4e34\u65f6\u8282\u70b9\u4f1a\u6d88\u5931\uff0c\u96c6\u7fa4\u91cc\u5176\u4ed6broker\u4f1a\u4e00\u76f4\u76d1\u542c\u8fd9\u4e2a\u4e34\u65f6\u8282 \u70b9\uff0c\u53d1\u73b0\u4e34\u65f6\u8282\u70b9\u6d88\u5931\u4e86\uff0c\u5c31\u7ade\u4e89\u518d\u6b21\u521b\u5efa\u4e34\u65f6\u8282\u70b9\uff0c\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u8bf4\u7684\u9009\u4e3e\u673a\u5236\uff0czookeeper\u53c8\u4f1a\u4fdd\u8bc1\u6709\u4e00\u4e2abroker \u6210\u4e3a\u65b0\u7684controller\u3002 \u5177\u5907\u63a7\u5236\u5668\u8eab\u4efd\u7684broker\u9700\u8981\u6bd4\u5176\u4ed6\u666e\u901a\u7684broker\u591a\u4e00\u4efd\u804c\u8d23\uff0c\u5177\u4f53\u7ec6\u8282\u5982\u4e0b\uff1a \u76d1\u542cbroker\u76f8\u5173\u7684\u53d8\u5316 \u3002\u4e3aZookeeper\u4e2d\u7684/brokers/ids/\u8282\u70b9\u6dfb\u52a0BrokerChangeListener\uff0c\u7528\u6765\u5904\u7406broker \u589e\u51cf\u7684\u53d8\u5316\u3002 \u76d1\u542ctopic\u76f8\u5173\u7684\u53d8\u5316 \u3002\u4e3aZookeeper\u4e2d\u7684/brokers/topics\u8282\u70b9\u6dfb\u52a0TopicChangeListener\uff0c\u7528\u6765\u5904\u7406topic\u589e\u51cf \u7684\u53d8\u5316\uff1b\u4e3aZookeeper\u4e2d\u7684/admin/delete_topics\u8282\u70b9\u6dfb\u52a0TopicDeletionListener\uff0c\u7528\u6765\u5904\u7406\u5220\u9664topic\u7684\u52a8\u4f5c\u3002 \u4eceZookeeper\u4e2d\u8bfb\u53d6\u83b7\u53d6\u5f53\u524d\u6240\u6709\u4e0etopic\u3001partition\u4ee5\u53cabroker\u6709\u5173\u7684\u4fe1\u606f\u5e76\u8fdb\u884c\u76f8\u5e94\u7684\u7ba1\u7406 \u3002\u5bf9\u4e8e\u6240\u6709topic \u6240\u5bf9\u5e94\u7684Zookeeper\u4e2d\u7684/brokers/topics/\u8282\u70b9\u6dfb\u52a0PartitionModificationsListener\uff0c\u7528\u6765\u76d1\u542ctopic\u4e2d\u7684\u5206\u533a\u5206\u914d\u53d8\u5316\u3002 \u66f4\u65b0\u96c6\u7fa4\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u540c\u6b65\u5230\u5176\u4ed6\u666e\u901a\u7684broker\u8282\u70b9\u4e2d Partition\u526f\u672c\u9009\u4e3eLeader\u673a\u5236 controller\u611f\u77e5\u5230\u5206\u533aLeader\u6240\u5728\u7684broker\u6302\u4e86\uff0ccontroller\u4f1a\u4ece ISR\u5217\u8868(\u53c2\u6570unclean.leader.election.enable=false\u7684\u524d\u63d0\u4e0b)\u91cc\u6311\u7b2c\u4e00\u4e2abroker\u4f5c\u4e3aleader(\u7b2c\u4e00\u4e2abroker\u6700\u5148\u653e\u8fdbISR \u5217\u8868\uff0c\u53ef\u80fd\u662f\u540c\u6b65\u6570\u636e\u6700\u591a\u7684\u526f\u672c)\uff0c\u5982\u679c\u53c2\u6570unclean.leader.election.enable\u4e3atrue\uff0c\u4ee3\u8868\u5728ISR\u5217\u8868\u91cc\u6240\u6709\u526f\u672c\u90fd\u6302 \u4e86\u7684\u65f6\u5019\u53ef\u4ee5\u5728ISR\u5217\u8868\u4ee5\u5916\u7684\u526f\u672c\u4e2d\u9009leader\uff0c\u8fd9\u79cd\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u63d0\u9ad8\u53ef\u7528\u6027\uff0c\u4f46\u662f\u9009\u51fa\u7684\u65b0leader\u6709\u53ef\u80fd\u6570\u636e\u5c11\u5f88\u591a\u3002 \u526f\u672c\u8fdb\u5165ISR\u5217\u8868\u6709\u4e24\u4e2a\u6761\u4ef6\uff1a \u526f\u672c\u8282\u70b9\u4e0d\u80fd\u4ea7\u751f\u5206\u533a\uff0c\u5fc5\u987b\u80fd\u4e0ezookeeper\u4fdd\u6301\u4f1a\u8bdd\u4ee5\u53ca\u8ddfleader\u526f\u672c\u7f51\u7edc\u8fde\u901a \u526f\u672c\u80fd\u590d\u5236leader\u4e0a\u7684\u6240\u6709\u5199\u64cd\u4f5c\uff0c\u5e76\u4e14\u4e0d\u80fd\u843d\u540e\u592a\u591a\u3002(\u4e0eleader\u526f\u672c\u540c\u6b65\u6ede\u540e\u7684\u526f\u672c\uff0c\u662f\u7531 replica.lag.time.max.ms \u914d\u7f6e\u51b3\u5b9a\u7684\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\u90fd\u6ca1\u6709\u8ddfleader\u540c\u6b65\u8fc7\u7684\u4e00\u6b21\u7684\u526f\u672c\u4f1a\u88ab\u79fb\u51faISR\u5217\u8868) \u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u7684offset\u8bb0\u5f55\u673a\u5236 \u6bcf\u4e2aconsumer\u4f1a\u5b9a\u671f\u5c06\u81ea\u5df1\u6d88\u8d39\u5206\u533a\u7684offset\u63d0\u4ea4\u7ed9kafka\u5185\u90e8topic\uff1aconsumer_offsets\uff0c\u63d0\u4ea4\u8fc7\u53bb\u7684\u65f6\u5019\uff0ckey\u662f consumerGroupId+topic+\u5206\u533a\u53f7\uff0cvalue\u5c31\u662f\u5f53\u524doffset\u7684\u503c\uff0ckafka\u4f1a\u5b9a\u671f\u6e05\u7406topic\u91cc\u7684\u6d88\u606f\uff0c\u6700\u540e\u5c31\u4fdd\u7559\u6700\u65b0\u7684 \u90a3\u6761\u6570\u636e \u56e0\u4e3a__consumer_offsets\u53ef\u80fd\u4f1a\u63a5\u6536\u9ad8\u5e76\u53d1\u7684\u8bf7\u6c42\uff0ckafka\u9ed8\u8ba4\u7ed9\u5176\u5206\u914d50\u4e2a\u5206\u533a(\u53ef\u4ee5\u901a\u8fc7 offsets.topic.num.partitions\u8bbe\u7f6e)\uff0c\u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u52a0\u673a\u5668\u7684\u65b9\u5f0f\u6297\u5927\u5e76\u53d1\u3002 \u6d88\u8d39\u8005Rebalance\u673a\u5236 rebalance\u5c31\u662f\u8bf4 \u5982\u679c\u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u6570\u91cf\u6709\u53d8\u5316\u6216\u6d88\u8d39\u7684\u5206\u533a\u6570\u6709\u53d8\u5316\uff0ckafka\u4f1a\u91cd\u65b0\u5206\u914d\u6d88\u8d39\u8005\u4e0e\u6d88\u8d39\u5206\u533a\u7684\u5173\u7cfb \u3002 \u6bd4\u5982consumer group\u4e2d\u67d0\u4e2a\u6d88\u8d39\u8005\u6302\u4e86\uff0c\u6b64\u65f6\u4f1a\u81ea\u52a8\u628a\u5206\u914d\u7ed9\u4ed6\u7684\u5206\u533a\u4ea4\u7ed9\u5176\u4ed6\u7684\u6d88\u8d39\u8005\uff0c\u5982\u679c\u4ed6\u53c8\u91cd\u542f\u4e86\uff0c\u90a3\u4e48\u53c8\u4f1a\u628a\u4e00\u4e9b\u5206\u533a\u91cd\u65b0\u4ea4\u8fd8\u7ed9\u4ed6\u3002 \u6ce8\u610f \uff1arebalance\u53ea\u9488\u5bf9subscribe\u8fd9\u79cd\u4e0d\u6307\u5b9a\u5206\u533a\u6d88\u8d39\u7684\u60c5\u51b5\uff0c\u5982\u679c\u901a\u8fc7assign\u8fd9\u79cd\u6d88\u8d39\u65b9\u5f0f\u6307\u5b9a\u4e86\u5206\u533a\uff0ckafka\u4e0d\u4f1a\u8fdb \u884crebanlance\u3002 \u5982\u4e0b\u60c5\u51b5\u53ef\u80fd\u4f1a\u89e6\u53d1\u6d88\u8d39\u8005rebalance: \u6d88\u8d39\u7ec4\u91cc\u7684consumer\u589e\u52a0\u6216\u51cf\u5c11\u4e86 \u52a8\u6001\u7ed9topic\u589e\u52a0\u4e86\u5206\u533a \u6d88\u8d39\u7ec4\u8ba2\u9605\u4e86\u66f4\u591a\u7684topic rebalance\u8fc7\u7a0b\u4e2d\uff0c\u6d88\u8d39\u8005\u65e0\u6cd5\u4ecekafka\u6d88\u8d39\u6d88\u606f\uff0c\u8fd9\u5bf9kafka\u7684TPS\u4f1a\u6709\u5f71\u54cd\uff0c\u5982\u679ckafka\u96c6\u7fa4\u5185\u8282\u70b9\u8f83\u591a\uff0c\u6bd4\u5982\u6570\u767e \u4e2a\uff0c\u90a3\u91cd\u5e73\u8861\u53ef\u80fd\u4f1a\u8017\u65f6\u6781\u591a\uff0c\u6240\u4ee5\u5e94\u5c3d\u91cf\u907f\u514d\u5728\u7cfb\u7edf\u9ad8\u5cf0\u671f\u7684\u91cd\u5e73\u8861\u53d1\u751f\u3002 Rebalance\u8fc7\u7a0b\u5982\u4e0b \u5f53\u6709\u6d88\u8d39\u8005\u52a0\u5165\u6d88\u8d39\u7ec4\u65f6\uff0c\u6d88\u8d39\u8005\u3001\u6d88\u8d39\u7ec4\u53ca\u7ec4\u534f\u8c03\u5668\u4e4b\u95f4\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u51e0\u4e2a\u9636\u6bb5 \u7b2c\u4e00\u9636\u6bb5\uff1a\u9009\u62e9\u7ec4\u534f\u8c03\u5668 \u7ec4\u534f\u8c03\u5668GroupCoordinator\uff1a\u6bcf\u4e2aconsumer group\u90fd\u4f1a\u9009\u62e9\u4e00\u4e2abroker\u4f5c\u4e3a\u81ea\u5df1\u7684\u7ec4\u534f\u8c03\u5668coordinator\uff0c\u8d1f\u8d23\u76d1\u63a7 \u8fd9\u4e2a\u6d88\u8d39\u7ec4\u91cc\u7684\u6240\u6709\u6d88\u8d39\u8005\u7684\u5fc3\u8df3\uff0c\u4ee5\u53ca\u5224\u65ad\u662f\u5426\u5b95\u673a\uff0c\u7136\u540e\u5f00\u542f\u6d88\u8d39\u8005rebalance\u3002 consumer group\u4e2d\u7684\u6bcf\u4e2aconsumer\u542f\u52a8\u65f6\u4f1a\u5411kafka\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e2a\u8282\u70b9\u53d1\u9001 FindCoordinatorRequest \u8bf7\u6c42\u6765\u67e5\u627e\u5bf9 \u5e94\u7684\u7ec4\u534f\u8c03\u5668GroupCoordinator\uff0c\u5e76\u8ddf\u5176\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002 \u7ec4\u534f\u8c03\u5668\u9009\u62e9\u65b9\u5f0f\uff1a \u901a\u8fc7\u5982\u4e0b\u516c\u5f0f\u53ef\u4ee5\u9009\u51faconsumer\u6d88\u8d39\u7684offset\u8981\u63d0\u4ea4\u5230__consumer_offsets\u7684\u54ea\u4e2a\u5206\u533a\uff0c\u8fd9\u4e2a\u5206\u533aleader\u5bf9\u5e94\u7684broker \u5c31\u662f\u8fd9\u4e2aconsumer group\u7684coordinator \u516c\u5f0f\uff1a hash(consumer group id) % \u5bf9\u5e94\u4e3b\u9898\u7684\u5206\u533a\u6570 \u7b2c\u4e8c\u9636\u6bb5\uff1a\u52a0\u5165\u6d88\u8d39\u7ec4JOIN GROUP \u5728\u6210\u529f\u627e\u5230\u6d88\u8d39\u7ec4\u6240\u5bf9\u5e94\u7684 GroupCoordinator \u4e4b\u540e\u5c31\u8fdb\u5165\u52a0\u5165\u6d88\u8d39\u7ec4\u7684\u9636\u6bb5\uff0c\u5728\u6b64\u9636\u6bb5\u7684\u6d88\u8d39\u8005\u4f1a\u5411 GroupCoordinator \u53d1\u9001 JoinGroupRequest \u8bf7\u6c42\uff0c\u5e76\u5904\u7406\u54cd\u5e94\u3002\u7136\u540eGroupCoordinator \u4ece\u4e00\u4e2aconsumer group\u4e2d \u9009\u62e9\u7b2c\u4e00\u4e2a\u52a0\u5165group\u7684consumer\u4f5c\u4e3aleader(\u6d88\u8d39\u7ec4\u534f\u8c03\u5668)\uff0c\u628aconsumer group\u60c5\u51b5\u53d1\u9001\u7ed9\u8fd9\u4e2aleader\uff0c\u63a5\u7740\u8fd9\u4e2a leader\u4f1a\u8d1f\u8d23\u5236\u5b9a\u5206\u533a\u65b9\u6848\u3002 \u7b2c\u4e09\u9636\u6bb5\uff08 SYNC GROUP) consumer leader\u901a\u8fc7\u7ed9GroupCoordinator\u53d1\u9001SyncGroupRequest\uff0c\u63a5\u7740GroupCoordinator\u5c31\u628a\u5206\u533a\u65b9\u6848\u4e0b\u53d1\u7ed9\u5404 \u4e2aconsumer\uff0c\u4ed6\u4eec\u4f1a\u6839\u636e\u6307\u5b9a\u5206\u533a\u7684leader broker\u8fdb\u884c\u7f51\u7edc\u8fde\u63a5\u4ee5\u53ca\u6d88\u606f\u6d88\u8d39\u3002 \u6d88\u8d39\u8005Rebalance\u5206\u533a\u5206\u914d\u7b56\u7565 \u4e3b\u8981\u6709\u4e09\u79cdrebalance\u7684\u7b56\u7565\uff1a range \u3001 round-robin \u3001 sticky \u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e3arange\u5206\u914d\u7b56\u7565 \u3002 \u5047\u8bbe\u4e00\u4e2a\u4e3b\u9898\u670910\u4e2a\u5206\u533a(0-9)\uff0c\u73b0\u5728\u6709\u4e09\u4e2aconsumer\u6d88\u8d39\uff1a range\u7b56\u7565 \uff1a \u6309\u7167\u5206\u533a\u5e8f\u53f7\u6392\u5e8f\u5206\u914d \uff0c\u5047\u8bbe n\uff1d\u5206\u533a\u6570\uff0f\u6d88\u8d39\u8005\u6570\u91cf = 3\uff0c m\uff1d\u5206\u533a\u6570%\u6d88\u8d39\u8005\u6570\u91cf = 1\uff0c\u90a3\u4e48\u524d m \u4e2a\u6d88 \u8d39\u8005\u6bcf\u4e2a\u5206\u914d n+1 \u4e2a\u5206\u533a\uff0c\u540e\u9762\u7684\uff08\u6d88\u8d39\u8005\u6570\u91cf\uff0dm \uff09\u4e2a\u6d88\u8d39\u8005\u6bcf\u4e2a\u5206\u914d n \u4e2a\u5206\u533a\u3002 \u6bd4\u5982\u5206\u533a0~ 3\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a4~ 6\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a7~9\u7ed9\u4e00\u4e2aconsumer\u3002 round-robin\u7b56\u7565 \uff1a \u8f6e\u8be2\u5206\u914d \uff0c\u6bd4\u5982\u5206\u533a0\u30013\u30016\u30019\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a1\u30014\u30017\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a2\u30015\u3001 8\u7ed9\u4e00\u4e2aconsumer sticky\u7b56\u7565 \uff1a \u521d\u59cb\u65f6\u5206\u914d\u7b56\u7565\u4e0eround-robin\u7c7b\u4f3c\uff0c\u4f46\u662f\u5728rebalance\u7684\u65f6\u5019\uff0c\u9700\u8981\u4fdd\u8bc1\u5982\u4e0b\u4e24\u4e2a\u539f\u5219\u3002 \u5206\u533a\u7684\u5206\u914d\u8981\u5c3d\u53ef\u80fd\u5747\u5300 \u3002 \u5206\u533a\u7684\u5206\u914d\u5c3d\u53ef\u80fd\u4e0e\u4e0a\u6b21\u5206\u914d\u7684\u4fdd\u6301\u76f8\u540c\u3002 \u5f53\u4e24\u8005\u53d1\u751f\u51b2\u7a81\u65f6\uff0c \u7b2c\u4e00\u4e2a\u76ee\u6807\u4f18\u5148\u4e8e\u7b2c\u4e8c\u4e2a\u76ee \u6807 \u3002\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u7ef4\u6301\u539f\u6765\u7684\u5206\u533a\u5206\u914d\u7684\u7b56\u7565\u3002 \u6bd4\u5982\u5bf9\u4e8e\u7b2c\u4e00\u79cdrange\u60c5\u51b5\u7684\u5206\u914d\uff0c\u5982\u679c\u7b2c\u4e09\u4e2aconsumer\u6302\u4e86\uff0c\u90a3\u4e48\u91cd\u65b0\u7528sticky\u7b56\u7565\u5206\u914d\u7684\u7ed3\u679c\u5982\u4e0b\uff1a consumer1\u9664\u4e86\u539f\u6709\u76840~ 3\uff0c\u4f1a\u518d\u5206\u914d\u4e00\u4e2a7 consumer2\u9664\u4e86\u539f\u6709\u76844~ 6\uff0c\u4f1a\u518d\u5206\u914d8\u548c9 producer\u53d1\u5e03\u6d88\u606f\u673a\u5236\u5256\u6790 \u5199\u5165\u65b9\u5f0f producer \u91c7\u7528 push \u6a21\u5f0f\u5c06\u6d88\u606f\u53d1\u5e03\u5230 broker\uff0c\u6bcf\u6761\u6d88\u606f\u90fd\u88ab append \u5230 patition \u4e2d\uff0c\u5c5e\u4e8e\u987a\u5e8f\u5199\u78c1\u76d8\uff08 \u987a\u5e8f\u5199\u78c1\u76d8 \u6bd4 \u968f\u673a\u5199 \u6548\u7387\u8981\u9ad8\uff0c\u4fdd\u969c kafka \u541e\u5410\u7387 \uff09\u3002 \u6d88\u606f\u8def\u7531 producer \u53d1\u9001\u6d88\u606f\u5230 broker \u65f6\uff0c\u4f1a\u6839\u636e\u5206\u533a\u7b97\u6cd5\u9009\u62e9\u5c06\u5176\u5b58\u50a8\u5230\u54ea\u4e00\u4e2a partition\u3002\u5176\u8def\u7531\u673a\u5236\u4e3a\uff1a \u6307\u5b9a\u4e86 patition\uff0c\u5219\u76f4\u63a5\u4f7f\u7528\uff1b \u672a\u6307\u5b9a patition \u4f46\u6307\u5b9a key\uff0c\u901a\u8fc7 hash(key)%\u5206\u533a\u6570 \u7b97\u51fa\u8def\u7531\u7684patition, \u5982\u679cpatition \u548c key \u90fd\u672a\u6307\u5b9a\uff0c\u4f7f\u7528\u8f6e\u8be2\u9009\u51fa\u4e00\u4e2apatition\u3002 \u5199\u5165\u6d41\u7a0b producer \u5148\u4ece zookeeper \u7684 \"/brokers/.../state\" \u8282\u70b9\u627e\u5230\u8be5 partition \u7684 leader producer \u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u8be5 leader leader \u5c06\u6d88\u606f\u5199\u5165\u672c\u5730 log followers \u4ece leader pull \u6d88\u606f\uff0c\u5199\u5165\u672c\u5730 log \u540e \u5411leader \u53d1\u9001 ACK leader \u6536\u5230\u6240\u6709 ISR \u4e2d\u7684 replica \u7684 ACK \u540e\uff0c\u589e\u52a0 HW\uff08high watermark\uff0c\u6700\u540e commit \u7684 offset\uff09 \u5e76\u5411 producer \u53d1\u9001 ACK HW\u4e0eLEO HW\u4fd7\u79f0\u9ad8\u6c34\u4f4d \uff0cHighWatermark\u7684\u7f29\u5199\uff0c\u53d6\u4e00\u4e2apartition\u5bf9\u5e94\u7684ISR\u4e2d\u6700\u5c0f\u7684LEO(log-end-offset)\u4f5c\u4e3aHW\uff0c consumer\u6700\u591a\u53ea\u80fd\u6d88\u8d39\u5230HW\u6240\u5728\u7684\u4f4d\u7f6e\u3002\u53e6\u5916\u6bcf\u4e2areplica\u90fd\u6709HW,leader\u548cfollower\u5404\u81ea\u8d1f\u8d23\u66f4\u65b0\u81ea\u5df1\u7684HW\u7684\u72b6 \u6001\u3002 \u5bf9\u4e8eleader\u65b0\u5199\u5165\u7684\u6d88\u606f\uff0cconsumer\u4e0d\u80fd\u7acb\u523b\u6d88\u8d39\uff0cleader\u4f1a\u7b49\u5f85\u8be5\u6d88\u606f\u88ab\u6240\u6709ISR\u4e2d\u7684replicas\u540c\u6b65\u540e\u66f4\u65b0HW\uff0c \u6b64\u65f6\u6d88\u606f\u624d\u80fd\u88abconsumer\u6d88\u8d39 \u3002 \u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5982\u679cleader\u6240\u5728\u7684broker\u5931\u6548\uff0c\u8be5\u6d88\u606f\u4ecd\u7136\u53ef\u4ee5\u4ece\u65b0\u9009\u4e3e\u7684leader\u4e2d\u83b7\u53d6\u3002\u5bf9\u4e8e\u6765\u81ea\u5185\u90e8broker\u7684\u8bfb\u53d6\u8bf7\u6c42\uff0c\u6ca1\u6709HW\u7684\u9650\u5236\u3002 \u65e5\u5fd7\u5206\u6bb5\u5b58\u50a8 Kafka \u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\u6570\u636e\u5bf9\u5e94\u5b58\u50a8\u5728\u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff0c\u4ee5topic\u540d\u79f0+\u5206\u533a\u53f7\u547d\u540d\uff0c\u6d88\u606f\u5728\u5206\u533a\u5185\u662f\u5206\u6bb5\u5b58\u50a8\u7684\uff0c \u6bcf\u4e2a\u6bb5\u7684\u6d88\u606f\u90fd\u5b58\u50a8\u5728\u4e0d\u4e00\u6837\u7684log\u6587\u4ef6\u91cc\uff0ckafka\u89c4\u5b9a\u4e86\u4e00\u4e2a\u6bb5\u4f4d\u7684 log \u6587 \u4ef6\u6700\u5927\u4e3a 1G\uff0c\u505a\u8fd9\u4e2a\u9650\u5236\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u628a log \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u53bb\u64cd\u4f5c\uff1a 1 # \u90e8\u5206\u6d88\u606f\u7684offset\u7d22\u5f15\u6587\u4ef6\uff0ckafka\u6bcf\u6b21\u5f80\u5206\u533a\u53d14K(\u53ef\u914d\u7f6e)\u6d88\u606f\u5c31\u4f1a\u8bb0\u5f55\u4e00\u6761\u5f53\u524d\u6d88\u606f\u7684offset\u5230index\u6587\u4ef6\uff0c 2 # \u5982\u679c\u8981\u5b9a\u4f4d\u6d88\u606f\u7684offset\u4f1a\u5148\u5728\u8fd9\u4e2a\u6587\u4ef6\u91cc\u5feb\u901f\u5b9a\u4f4d\uff0c\u518d\u53bblog\u6587\u4ef6\u91cc\u627e\u5177\u4f53\u6d88\u606f 3 00000000000000000000.index 4 # \u6d88\u606f\u5b58\u50a8\u6587\u4ef6\uff0c\u4e3b\u8981\u5b58offset\u548c\u6d88\u606f\u4f53 5 00000000000000000000.log 6 # \u6d88\u606f\u7684\u53d1\u9001\u65f6\u95f4\u7d22\u5f15\u6587\u4ef6\uff0ckafka\u6bcf\u6b21\u5f80\u5206\u533a\u53d14K(\u53ef\u914d\u7f6e)\u6d88\u606f\u5c31\u4f1a\u8bb0\u5f55\u4e00\u6761\u5f53\u524d\u6d88\u606f\u7684\u53d1\u9001\u65f6\u95f4\u6233\u4e0e\u5bf9\u5e94\u7684offset\u5230timeindex\u6587\u4ef6\uff0c 7 # \u5982\u679c\u9700\u8981\u6309\u7167\u65f6\u95f4\u6765\u5b9a\u4f4d\u6d88\u606f\u7684offset\uff0c\u4f1a\u5148\u5728\u8fd9\u4e2a\u6587\u4ef6\u91cc\u67e5\u627e 8 00000000000000000000.timeindex 9 10 00000000000005367851.index 11 00000000000005367851.log 12 00000000000005367851.timeindex 13 14 00000000000009936472.index 15 00000000000009936472.log 16 00000000000009936472.timeindex \u590d\u5236\u4ee3\u7801 \u8fd9\u4e2a 9936472 \u4e4b\u7c7b\u7684\u6570\u5b57\uff0c\u5c31\u662f\u4ee3\u8868\u4e86\u8fd9\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\u91cc\u5305\u542b\u7684\u8d77\u59cb Offset\uff0c\u4e5f\u5c31\u8bf4\u660e\u8fd9\u4e2a\u5206\u533a\u91cc\u81f3\u5c11\u90fd\u5199\u5165\u4e86\u63a5\u8fd1 1000 \u4e07\u6761\u6570\u636e\u4e86\u3002 Kafka Broker \u6709\u4e00\u4e2a\u53c2\u6570\uff0clog.segment.bytes\uff0c\u9650\u5b9a\u4e86\u6bcf\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u6700\u5927\u5c31\u662f 1GB\u3002 \u4e00\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\u6ee1\u4e86\uff0c\u5c31\u81ea\u52a8\u5f00\u4e00\u4e2a\u65b0\u7684\u65e5\u5fd7\u6bb5\u6587\u4ef6\u6765\u5199\u5165\uff0c\u907f\u514d\u5355\u4e2a\u6587\u4ef6\u8fc7\u5927\uff0c\u5f71\u54cd\u6587\u4ef6\u7684\u8bfb\u5199\u6027\u80fd\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a log rolling\uff0c\u6b63\u5728\u88ab\u5199\u5165\u7684\u90a3\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\uff0c\u53eb\u505a active log segment\u3002 \u6700\u540e\u9644\u4e00\u5f20zookeeper\u8282\u70b9\u6570\u636e\u56fe MQ\u5e26\u6765\u7684\u4e00\u4e9b\u95ee\u9898\u3001\u53ca\u89e3\u51b3\u65b9\u6848 1. \u5982\u4f55\u4fdd\u8bc1\u987a\u5e8f\u6d88\u8d39\uff1f RabbitMQ : \u4e00\u4e2aQueue\u5bf9\u5e94\u4e00\u4e2aConsumer\u5373\u53ef\u89e3\u51b3\u3002 RocketMQ \u5168\u5c40\u6709\u5e8f\uff1aTopic\u91cc\u9762\u53ea\u6709\u4e00\u4e2aMessageQueue\u5373\u53ef\u3002 \u5c40\u90e8\u6709\u5e8f: \u6839\u636e\u8def\u7531\u7b97\u6cd5\uff0c\u6bd4\u5982 hash(key)%\u961f\u5217\u6570 \u5f97\u5230\u8def\u7531\u7d22\u5f15\uff0c\u4f7f\u5f97\u9700\u8981\u4fdd\u8bc1\u6709\u5e8f\u7684\u6d88\u606f\u90fd\u8def\u7531\u5230\u540c\u4e00\u4e2aMessageQueue\u3002 Kafka : \u5168\u5c40\u6709\u5e8f\uff1aTopic\u91cc\u9762\u53ea\u6709\u4e00\u4e2aPartition\u5373\u53ef\u3002 \u5c40\u90e8\u6709\u5e8f: \u6839\u636e\u8def\u7531\u7b97\u6cd5\uff0c\u6bd4\u5982 hash(key)%\u5206\u533a\u6570 \u5f97\u5230\u8def\u7531\u7d22\u5f15\uff0c\u4f7f\u5f97\u9700\u8981\u4fdd\u8bc1\u6709\u5e8f\u7684\u6d88\u606f\u90fd\u8def\u7531\u5230\u540c\u4e00\u4e2aPartition\u3002 2. \u5982\u4f55\u5b9e\u73b0\u5ef6\u8fdf\u6d88\u8d39\uff1f RabbitMQ : \u4e24\u79cd\u65b9\u6848 \u6b7b\u4fe1\u961f\u5217 + TTL \u5f15\u5165RabbitMQ\u7684\u5ef6\u8fdf\u63d2\u4ef6 RocketMQ \uff1a\u5929\u751f\u652f\u6301\u5ef6\u65f6\u6d88\u606f\u3002 Kafka : \u6b65\u9aa4\u5982\u4e0b \u4e13\u95e8\u4e3a\u8981\u5ef6\u8fdf\u7684\u6d88\u606f\u521b\u5efa\u4e00\u4e2aTopic \u65b0\u5efa\u4e00\u4e2a\u6d88\u8d39\u8005\u53bb\u6d88\u8d39\u8fd9\u4e2aTopic \u6d88\u606f\u6301\u4e45\u5316 \u518d\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u5b9a\u65f6\u53bb\u62c9\u53d6\u6301\u4e45\u5316\u7684\u6d88\u606f\uff0c\u653e\u5165\u5b9e\u9645\u8981\u6d88\u8d39\u7684Topic \u5b9e\u9645\u6d88\u8d39\u7684\u6d88\u8d39\u8005\u4ece\u5b9e\u9645\u8981\u6d88\u8d39\u7684Topic\u62c9\u53d6\u6d88\u606f\u3002 3. \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u7684\u53ef\u9760\u6027\u6295\u9012 RabbitMQ : Broker-->\u6d88\u8d39\u8005 : \u624b\u52a8ACK \u751f\u4ea7\u8005-->Broker: \u4e24\u79cd\u65b9\u6848 1. \u6570\u636e\u5e93\u6301\u4e45\u5316 js 1.\u5c06\u4e1a\u52a1\u8ba2\u5355\u6570\u636e\u548c\u751f\u6210\u7684Message\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\u63d2\u5165\u6570\u636e\u5e93\uff0c\u8fd9\u91cc\u5982\u679c\u5206\u5e93\u7684\u8bdd\u53ef\u80fd\u6d89\u53ca\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\uff09 2.\u5c06Message\u53d1\u9001\u5230Broker\u670d\u52a1\u5668\u4e2d 3.\u901a\u8fc7RabbitMQ\u7684Confirm\u673a\u5236\uff0c\u5728producer\u7aef\uff0c\u76d1\u542c\u670d\u52a1\u5668\u662f\u5426ACK\u3002 4.\u5982\u679cACK\u4e86\uff0c\u5c31\u5c06Message\u8fd9\u6761\u6570\u636e\u72b6\u6001\u66f4\u65b0\u4e3a\u5df2\u53d1\u9001\u3002\u5982\u679c\u5931\u8d25\uff0c\u4fee\u6539\u4e3a\u5931\u8d25\u72b6\u6001\u3002 5.\u5206\u5e03\u5f0f\u5b9a\u65f6\u4efb\u52a1\u67e5\u8be2\u6570\u636e\u5e933\u5206\u949f\uff08\u8fd9\u4e2a\u5177\u4f53\u65f6\u95f4\u5e94\u8be5\u6839\u636e\u7684\u65f6\u6548\u6027\u6765\u5b9a\uff09\u4e4b\u524d\u7684\u53d1\u9001\u5931\u8d25\u7684\u6d88\u606f 6.\u91cd\u65b0\u53d1\u9001\u6d88\u606f\uff0c\u8bb0\u5f55\u53d1\u9001\u6b21\u6570 7.\u5982\u679c\u53d1\u9001\u6b21\u6570\u8fc7\u591a\u4ecd\u7136\u5931\u8d25\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4eba\u5de5\u6392\u67e5\u4e4b\u7c7b\u7684\u64cd\u4f5c\u3002 \u590d\u5236\u4ee3\u7801 \u4f18\u70b9 \uff1a\u80fd\u591f\u4fdd\u8bc1\u6d88\u606f\u767e\u5206\u767e\u4e0d\u4e22\u5931\u3002 \u7f3a\u70b9 \uff1a\u7b2c\u4e00\u6b65\u4f1a\u6d89\u53ca\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\u3002 2. \u6d88\u606f\u7684\u5ef6\u8fdf\u6295\u9012 js \u6d41\u7a0b\u56fe\u4e2d\uff0c\u989c\u8272\u4e0d\u540c\u7684\u4ee3\u8868\u4e0d\u540c\u7684message 1.\u5c06\u4e1a\u52a1\u8ba2\u5355\u6301\u4e45\u5316 2.\u53d1\u9001\u4e00\u6761Message\u5230broker(\u79f0\u4e4b\u4e3a\u4e3bMessage)\uff0c\u518d\u53d1\u9001\u76f8\u540c\u7684\u4e00\u6761\u5230\u4e0d\u540c\u7684\u961f\u5217\u6216\u8005\u4ea4\u6362\u673a(\u8fd9\u6761\u79f0\u4e3a\u786e\u8ba4Message)\u4e2d\u3002 3.\u4e3bMessage\u7531\u5b9e\u9645\u4e1a\u52a1\u5904\u7406\u7aef\u6d88\u8d39\u540e\uff0c\u751f\u6210\u4e00\u6761\u54cd\u5e94Message\u3002\u4e4b\u524d\u7684\u786e\u8ba4Message\u7531Message Service\u5e94\u7528\u5904\u7406\u5165\u5e93\u3002 4~6.\u5b9e\u9645\u4e1a\u52a1\u5904\u7406\u7aef\u53d1\u9001\u7684\u786e\u8ba4Message\u7531Message Service\u63a5\u6536\u540e\uff0c\u5c06\u539fMessage\u72b6\u6001\u4fee\u6539\u3002 7.\u5982\u679c\u8be5\u6761Message\u6ca1\u6709\u88ab\u786e\u8ba4\uff0c\u5219\u901a\u8fc7rpc\u8c03\u7528\u91cd\u65b0\u7531producer\u8fdb\u884c\u5168\u8fc7\u7a0b\u3002 \u590d\u5236\u4ee3\u7801 \u4f18\u70b9 \uff1a\u76f8\u5bf9\u4e8e\u6301\u4e45\u5316\u65b9\u6848\u6765\u8bf4\u54cd\u5e94\u901f\u5ea6\u6709\u6240\u63d0\u5347 \u7f3a\u70b9 \uff1a\u7cfb\u7edf\u590d\u6742\u6027\u6709\u70b9\u9ad8\uff0c\u4e07\u4e00\u4e24\u6761\u6d88\u606f\u90fd\u5931\u8d25\u4e86\uff0c\u6d88\u606f\u5b58\u5728\u4e22\u5931\u60c5\u51b5\uff0c\u4ecd\u9700Confirm\u673a\u5236\u505a\u8865\u507f\u3002 RocketMQ \uff1a \u751f\u4ea7\u8005\u5f04\u4e22\u6570\u636e Producer\u5728\u628aMessage\u53d1\u9001Broker\u7684\u8fc7\u7a0b\u4e2d\uff0c\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\u7b49\u53d1\u751f\u4e22\u5931\uff0c\u6216\u8005Message\u5230\u4e86Broker\uff0c\u4f46\u662f\u51fa\u4e86\u95ee\u9898\uff0c\u6ca1\u6709\u4fdd\u5b58\u4e0b\u6765\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0cRocketMQ\u5bf9Producer\u53d1\u9001\u6d88\u606f\u8bbe\u7f6e\u4e863\u79cd\u65b9\u5f0f\uff1a \u540c\u6b65\u53d1\u9001 \uff1a\u5929\u751f\u4fdd\u8bc1\u4e86\u53ef\u9760\u6027\u6295\u9012 \u5f02\u6b65\u53d1\u9001 \uff1a\u9700\u8981\u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u6839\u636ebroker\u54cd\u5e94\u7684\u7ed3\u679c\u81ea\u5b9a\u4e49\u5b9e\u73b0\u3002 \u5355\u5411\u53d1\u9001 \uff1a\u4fdd\u8bc1\u4e0d\u4e86\u53ef\u9760\u6027\u6295\u9012 Broker\u5f04\u4e22\u6570\u636e Broker\u63a5\u6536\u5230Message\u6682\u5b58\u5230\u5185\u5b58\uff0cConsumer\u8fd8\u6ca1\u6765\u5f97\u53ca\u6d88\u8d39\uff0cBroker\u6302\u6389\u4e86 \u53ef\u4ee5\u901a\u8fc7 \u6301\u4e45\u5316 \u8bbe\u7f6e\u53bb\u89e3\u51b3\uff1a 1. \u521b\u5efaQueue\u7684\u65f6\u5019\u8bbe\u7f6e\u6301\u4e45\u5316\uff0c\u4fdd\u8bc1Broker\u6301\u4e45\u5316Queue\u7684\u5143\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u4f1a\u6301\u4e45\u5316Queue\u91cc\u9762\u7684\u6d88\u606f 2. \u5c06Message\u7684deliveryMode\u8bbe\u7f6e\u4e3a2\uff0c\u53ef\u4ee5\u5c06\u6d88\u606f\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u53ea\u6709Message\u652f\u6301\u5316\u5230\u78c1\u76d8\u4e4b\u540e\u624d\u4f1a\u53d1\u9001\u901a\u77e5Producer ack \u8fd9\u4e24\u6b65\u8fc7\u540e\uff0c\u5373\u4f7fBroker\u6302\u4e86\uff0cProducer\u80af\u5b9a\u6536\u4e0d\u5230ack\u7684\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u91cd\u53d1 \u6d88\u8d39\u8005\u5f04\u4e22\u6570\u636e Consumer\u6709\u6d88\u8d39\u5230Message\uff0c\u4f46\u662f\u5185\u90e8\u51fa\u73b0\u95ee\u9898\uff0cMessage\u8fd8\u6ca1\u5904\u7406\uff0cBroker\u4ee5\u4e3aConsumer\u5904\u7406\u5b8c\u4e86\uff0c\u53ea\u4f1a\u628a\u540e\u7eed\u7684\u6d88\u606f\u53d1\u9001\u3002\u8fd9\u65f6\u5019\uff0c\u5c31\u8981 \u5173\u95edautoack\uff0c\u6d88\u606f\u5904\u7406\u8fc7\u540e\uff0c\u8fdb\u884c\u624b\u52a8ack , \u591a\u6b21\u6d88\u8d39\u5931\u8d25\u7684\u6d88\u606f\uff0c\u4f1a\u8fdb\u5165 \u6b7b\u4fe1\u961f\u5217 \uff0c\u8fd9\u65f6\u5019\u9700\u8981\u4eba\u5de5\u5e72\u9884\u3002 Kafka : \u751f\u4ea7\u8005\u5f04\u4e22\u6570\u636e \u8bbe\u7f6e\u4e86 acks=all \uff0c\u4e00\u5b9a\u4e0d\u4f1a\u4e22\uff0c\u8981\u6c42\u662f\uff0c\u4f60\u7684 leader \u63a5\u6536\u5230\u6d88\u606f\uff0c\u6240\u6709\u7684 follower \u90fd\u540c\u6b65\u5230\u4e86\u6d88\u606f\u4e4b\u540e\uff0c\u624d\u8ba4\u4e3a\u672c\u6b21\u5199\u6210\u529f\u4e86\u3002\u5982\u679c\u6ca1\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\uff0c\u751f\u4ea7\u8005\u4f1a\u81ea\u52a8\u4e0d\u65ad\u7684\u91cd\u8bd5\uff0c\u91cd\u8bd5\u65e0\u9650\u6b21\u3002 Broker\u5f04\u4e22\u6570\u636e Kafka \u67d0\u4e2a broker \u5b95\u673a\uff0c\u7136\u540e\u91cd\u65b0\u9009\u4e3e partition \u7684 leader\u3002\u5927\u5bb6\u60f3\u60f3\uff0c\u8981\u662f\u6b64\u65f6\u5176\u4ed6\u7684 follower \u521a\u597d\u8fd8\u6709\u4e9b\u6570\u636e\u6ca1\u6709\u540c\u6b65\uff0c\u7ed3\u679c\u6b64\u65f6 leader \u6302\u4e86\uff0c\u7136\u540e\u9009\u4e3e\u67d0\u4e2a follower \u6210 leader \u4e4b\u540e\uff0c\u4e0d\u5c31\u5c11\u4e86\u4e00\u4e9b\u6570\u636e\uff1f\u8fd9\u5c31\u4e22\u4e86\u4e00\u4e9b\u6570\u636e\u554a\u3002 \u6b64\u65f6\u4e00\u822c\u662f\u8981\u6c42\u8d77\u7801\u8bbe\u7f6e\u5982\u4e0b 4 \u4e2a\u53c2\u6570\uff1a \u7ed9 topic \u8bbe\u7f6e replication.factor \u53c2\u6570\uff1a\u8fd9\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e 1\uff0c\u8981\u6c42\u6bcf\u4e2a partition \u5fc5\u987b\u6709\u81f3\u5c11 2 \u4e2a\u526f\u672c\u3002 \u5728 Kafka \u670d\u52a1\u7aef\u8bbe\u7f6e min.insync.replicas \u53c2\u6570\uff1a\u8fd9\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e 1\uff0c\u8fd9\u4e2a\u662f\u8981\u6c42\u4e00\u4e2a leader \u81f3\u5c11\u611f\u77e5\u5230\u6709\u81f3\u5c11\u4e00\u4e2a follower \u8fd8\u8ddf\u81ea\u5df1\u4fdd\u6301\u8054\u7cfb\uff0c\u6ca1\u6389\u961f\uff0c\u8fd9\u6837\u624d\u80fd\u786e\u4fdd leader \u6302\u4e86\u8fd8\u6709\u4e00\u4e2a follower \u5427\u3002 \u5728 producer \u7aef\u8bbe\u7f6e acks=all \uff1a\u8fd9\u4e2a\u662f\u8981\u6c42\u6bcf\u6761\u6570\u636e\uff0c\u5fc5\u987b\u662f\u5199\u5165\u6240\u6709 replica \u4e4b\u540e\uff0c\u624d\u80fd\u8ba4\u4e3a\u662f\u5199\u6210\u529f\u4e86\u3002 \u5728 producer \u7aef\u8bbe\u7f6e retries=MAX \uff08\u5f88\u5927\u5f88\u5927\u5f88\u5927\u7684\u4e00\u4e2a\u503c\uff0c\u65e0\u9650\u6b21\u91cd\u8bd5\u7684\u610f\u601d\uff09\uff1a\u8fd9\u4e2a\u662f\u8981\u6c42\u4e00\u65e6\u5199\u5165\u5931\u8d25\uff0c\u5c31\u65e0\u9650\u91cd\u8bd5\uff0c\u5361\u5728\u8fd9\u91cc\u4e86\u3002 \u6211\u4eec\u751f\u4ea7\u73af\u5883\u5c31\u662f\u6309\u7167\u4e0a\u8ff0\u8981\u6c42\u914d\u7f6e\u7684\uff0c\u8fd9\u6837\u914d\u7f6e\u4e4b\u540e\uff0c\u81f3\u5c11\u5728 Kafka broker \u7aef\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5728 leader \u6240\u5728 broker \u53d1\u751f\u6545\u969c\uff0c\u8fdb\u884c leader \u5207\u6362\u65f6\uff0c\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002 \u6d88\u8d39\u8005\u5f04\u4e22\u6570\u636e \u4f60\u6d88\u8d39\u5230\u4e86\u8fd9\u4e2a\u6d88\u606f\uff0c\u7136\u540e\u6d88\u8d39\u8005\u90a3\u8fb9\u81ea\u52a8\u63d0\u4ea4\u4e86 offset\uff0c\u8ba9 Kafka \u4ee5\u4e3a\u4f60\u5df2\u7ecf\u6d88\u8d39\u597d\u4e86\u8fd9\u4e2a\u6d88\u606f\uff0c\u4f46\u5176\u5b9e\u4f60\u624d\u521a\u51c6\u5907\u5904\u7406\u8fd9\u4e2a\u6d88\u606f\uff0c\u4f60\u8fd8\u6ca1\u5904\u7406\uff0c\u4f60\u81ea\u5df1\u5c31\u6302\u4e86\uff0c\u6b64\u65f6\u8fd9\u6761\u6d88\u606f\u5c31\u4e22\u54af\u3002 \u8fd9\u4e0d\u662f\u8ddf RabbitMQ \u5dee\u4e0d\u591a\u5417\uff0c\u5927\u5bb6\u90fd\u77e5\u9053 Kafka \u4f1a\u81ea\u52a8\u63d0\u4ea4 offset\uff0c\u90a3\u4e48\u53ea\u8981 \u5173\u95ed\u81ea\u52a8\u63d0\u4ea4 offset\uff0c\u5728\u5904\u7406\u5b8c\u4e4b\u540e\u81ea\u5df1\u624b\u52a8\u63d0\u4ea4 offset\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u4e22\u3002 \u4f46\u662f\u6b64\u65f6\u786e\u5b9e\u8fd8\u662f\u53ef\u80fd\u4f1a\u6709\u91cd\u590d\u6d88\u8d39\uff0c\u6bd4\u5982\u4f60\u521a\u5904\u7406\u5b8c\uff0c\u8fd8\u6ca1\u63d0\u4ea4 offset\uff0c\u7ed3\u679c\u81ea\u5df1\u6302\u4e86\uff0c\u6b64\u65f6\u80af\u5b9a\u4f1a\u91cd\u590d\u6d88\u8d39\u4e00\u6b21\uff0c\u81ea\u5df1\u4fdd\u8bc1\u5e42\u7b49\u6027\u5c31\u597d\u4e86\u3002 4. \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u7684\u5e42\u7b49\uff1f \u4ee5 RocketMQ \u4e3a\u4f8b\uff0c\u4e0b\u9762\u5217\u51fa\u4e86\u6d88\u606f\u91cd\u590d\u7684\u573a\u666f\uff1a 1.\u53d1\u9001\u65f6\u6d88\u606f\u91cd\u590d \u5f53\u4e00\u6761\u6d88\u606f\u5df2\u88ab\u6210\u529f\u53d1\u9001\u5230\u670d\u52a1\u7aef\u5e76\u5b8c\u6210\u6301\u4e45\u5316\uff0c\u6b64\u65f6\u51fa\u73b0\u4e86\u7f51\u7edc\u95ea\u65ad\u6216\u8005\u5ba2\u6237\u7aef\u5b95\u673a\uff0c\u5bfc\u81f4\u670d\u52a1\u7aef\u5bf9\u5ba2\u6237\u7aef\u5e94\u7b54\u5931\u8d25\u3002\u5982\u679c\u6b64\u65f6\u751f\u4ea7\u8005\u610f\u8bc6\u5230\u6d88\u606f\u53d1\u9001\u5931\u8d25\u5e76\u5c1d\u8bd5\u518d\u6b21\u53d1\u9001\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u540e\u7eed\u4f1a\u6536\u5230\u4e24\u6761\u5185\u5bb9\u76f8\u540c\u5e76\u4e14Message ID\u4e5f\u76f8\u540c\u7684\u6d88\u606f\u3002 2.\u6295\u9012\u65f6\u6d88\u606f\u91cd\u590d \u6d88\u606f\u6d88\u8d39\u7684\u573a\u666f\u4e0b\uff0c\u6d88\u606f\u5df2\u6295\u9012\u5230\u6d88\u8d39\u8005\u5e76\u5b8c\u6210\u4e1a\u52a1\u5904\u7406\uff0c\u5f53\u5ba2\u6237\u7aef\u7ed9\u670d\u52a1\u7aef\u53cd\u9988\u5e94\u7b54\u7684\u65f6\u5019\u7f51\u7edc\u95ea\u65ad\u3002\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u81f3\u5c11\u88ab\u6d88\u8d39\u4e00\u6b21\uff0c\u6d88\u606f\u961f\u5217RocketMQ\u7248\u7684\u670d\u52a1\u7aef\u5c06\u5728\u7f51\u7edc\u6062\u590d\u540e\u518d\u6b21\u5c1d\u8bd5\u6295\u9012\u4e4b\u524d\u5df2\u88ab\u5904\u7406\u8fc7\u7684\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u540e\u7eed\u4f1a\u6536\u5230\u4e24\u6761\u5185\u5bb9\u76f8\u540c\u5e76\u4e14Message ID\u4e5f\u76f8\u540c\u7684\u6d88\u606f\u3002 3. \u8d1f\u8f7d\u5747\u8861\u65f6\u6d88\u606f\u91cd\u590d \uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u7f51\u7edc\u6296\u52a8\u3001Broker\u91cd\u542f\u4ee5\u53ca\u6d88\u8d39\u8005\u5e94\u7528\u91cd\u542f\uff09 \u5f53\u6d88\u606f\u961f\u5217RocketMQ\u7248\u7684Broker\u6216\u5ba2\u6237\u7aef\u91cd\u542f\u3001\u6269\u5bb9\u6216\u7f29\u5bb9\u65f6\uff0c\u4f1a\u89e6\u53d1Rebalance\uff0c\u6b64\u65f6\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u6536\u5230\u91cd\u590d\u6d88\u606f\u3002 \u90a3\u4e48\uff0c\u6709\u4ec0\u4e48\u89e3\u51b3\u65b9\u6848\u5462\uff1f \u76f4\u63a5\u4e0a\u56fe\u3002 5. \u5982\u4f55\u89e3\u51b3\u6d88\u606f\u79ef\u538b\u7684\u95ee\u9898\uff1f \u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u6709\u51e0\u4e2a\u70b9\u9700\u8981\u8003\u8651\uff1a 1. \u5982\u4f55\u5feb\u901f\u8ba9\u79ef\u538b\u7684\u6d88\u606f\u88ab\u6d88\u8d39\u6389\uff1f \u4e34\u65f6\u5199\u4e00\u4e2a\u6d88\u606f\u5206\u53d1\u7684\u6d88\u8d39\u8005\uff0c\u628a\u79ef\u538b\u961f\u5217\u91cc\u7684\u6d88\u606f\u5747\u5300\u5206\u53d1\u5230N\u4e2a\u961f\u5217\u4e2d\uff0c\u540c\u65f6\u4e00\u4e2a\u961f\u5217\u5bf9\u5e94\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u76f8\u5f53\u4e8e\u6d88\u8d39\u901f\u5ea6\u63d0\u9ad8\u4e86N\u500d\u3002 \u4fee\u6539\u524d\uff1a \u4fee\u6539\u540e\uff1a 2. \u79ef\u538b\u65f6\u95f4\u592a\u4e45\uff0c\u5bfc\u81f4\u90e8\u5206\u6d88\u606f\u8fc7\u671f\uff0c\u600e\u4e48\u5904\u7406\uff1f \u6279\u91cf\u91cd\u5bfc\u3002\u5728\u4e1a\u52a1\u4e0d\u7e41\u5fd9\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u51cc\u6668\uff0c\u63d0\u524d\u51c6\u5907\u597d\u7a0b\u5e8f\uff0c\u628a\u4e22\u5931\u7684\u90a3\u6279\u6d88\u606f\u67e5\u51fa\u6765\uff0c\u91cd\u65b0\u5bfc\u5165\u5230MQ\u4e2d\u3002 3. \u6d88\u606f\u5927\u91cf\u79ef\u538b\uff0cMQ\u78c1\u76d8\u88ab\u5199\u6ee1\u4e86\uff0c\u5bfc\u81f4\u65b0\u6d88\u606f\u8fdb\u4e0d\u6765\u4e86\uff0c\u4e22\u6389\u4e86\u5927\u91cf\u6d88\u606f\uff0c\u600e\u4e48\u5904\u7406\uff1f \u8fd9\u4e2a\u6ca1\u529e\u6cd5\u3002\u8c01\u8ba9\u3010\u6d88\u606f\u5206\u53d1\u7684\u6d88\u8d39\u8005\u3011\u5199\u7684\u592a\u6162\u4e86\uff0c\u4f60\u4e34\u65f6\u5199\u7a0b\u5e8f\uff0c\u63a5\u5165\u6570\u636e\u6765\u6d88\u8d39\uff0c\u6d88\u8d39\u4e00\u4e2a\u4e22\u5f03\u4e00\u4e2a\uff0c\u90fd\u4e0d\u8981\u4e86\uff0c\u5feb\u901f\u6d88\u8d39\u6389\u6240\u6709\u7684\u6d88\u606f\u3002\u7136\u540e\u8d70\u7b2c\u4e8c\u4e2a\u65b9\u6848\uff0c\u5230\u4e86\u665a\u4e0a\u518d\u8865\u6570\u636e\u5427\u3002 \u4f5c\u8005\uff1aBoom \u94fe\u63a5\uff1ahttps://juejin.cn/post/7006958043833303048 \u6765\u6e90\uff1a\u6398\u91d1 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002","title":"RocketMQ vs RabbitMQ vs Kafka"},{"location":"knowledge/mqvs/#mq","text":"","title":"\u4e09\u5927\u4e3b\u6d41MQ\u7684\u7ec4\u7ec7\u7ed3\u6784"},{"location":"knowledge/mqvs/#1rabbitmq","text":"","title":"1\u3001RabbitMQ"},{"location":"knowledge/mqvs/#rabbitmq","text":"Broker\uff1a \u4e00\u4e2aRabbitMQ\u5b9e\u4f8b \u5c31\u662f\u4e00\u4e2aBroker Virtual Host\uff1a \u865a\u62df\u4e3b\u673a\u3002 \u76f8\u5f53\u4e8eMysql\u7684DataBase , \u4e00\u4e2aBroker\u4e0a\u53ef\u4ee5\u5b58\u5728\u591a\u4e2avhost\uff0cvhost\u4e4b\u95f4\u76f8\u4e92\u9694\u79bb\u3002\u6bcf\u4e2avhost\u90fd\u62e5\u6709\u81ea\u5df1\u7684\u961f\u5217\u3001\u4ea4\u6362\u673a\u3001\u7ed1\u5b9a\u548c\u6743\u9650\u673a\u5236\u3002vhost\u5fc5\u987b\u5728\u8fde\u63a5\u65f6\u6307\u5b9a\uff0c\u9ed8\u8ba4\u7684vhost\u662f /\u3002 Exchange\uff1a \u4ea4\u6362\u673a\uff0c\u7528\u6765\u63a5\u6536\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u5e76\u5c06\u8fd9\u4e9b\u6d88\u606f\u8def\u7531\u7ed9\u670d\u52a1\u5668\u4e2d\u7684\u961f\u5217\u3002 Queue\uff1a \u6d88\u606f\u961f\u5217\uff0c\u7528\u6765\u4fdd\u5b58\u6d88\u606f\u76f4\u5230\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\u3002 \u5b83\u662f\u6d88\u606f\u7684\u5bb9\u5668 \u3002\u4e00\u4e2a\u6d88\u606f\u53ef\u6295\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u961f\u5217\u3002 Banding\uff1a \u7ed1\u5b9a\u5173\u7cfb\uff0c\u7528\u4e8e \u6d88\u606f\u961f\u5217\u548c\u4ea4\u6362\u673a\u4e4b\u95f4\u7684\u5173\u8054 \u3002\u901a\u8fc7\u8def\u7531\u952e( Routing Key )\u5c06\u4ea4\u6362\u673a\u548c\u6d88\u606f\u961f\u5217\u5173\u8054\u8d77\u6765\u3002 Channel\uff1a \u7ba1\u9053\uff0c\u4e00\u6761 \u53cc\u5411\u6570\u636e\u6d41\u901a\u9053 \u3002\u4e0d\u7ba1\u662f\u53d1\u5e03\u6d88\u606f\u3001\u8ba2\u9605\u961f\u5217\u8fd8\u662f\u63a5\u6536\u6d88\u606f\uff0c\u8fd9\u4e9b\u52a8\u4f5c\u90fd\u662f\u901a\u8fc7\u7ba1\u9053\u5b8c\u6210\u3002\u56e0\u4e3a\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6765\u8bf4\uff0c\u5efa\u7acb\u548c\u9500\u6bc1TCP\u90fd\u662f\u975e\u5e38\u6602\u8d35\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u5f15\u5165\u4e86\u7ba1\u9053\u7684\u6982\u5ff5\uff0c\u4ee5\u590d\u7528\u4e00\u6761TCP\u8fde\u63a5\u3002 Connection\uff1a \u751f\u4ea7\u8005/\u6d88\u8d39\u8005 \u4e0ebroker\u4e4b\u95f4\u7684TCP\u8fde\u63a5\u3002 Publisher\uff1a \u6d88\u606f\u7684\u751f\u4ea7\u8005\u3002 Consumer\uff1a \u6d88\u606f\u7684\u6d88\u8d39\u8005\u3002 Message\uff1a \u6d88\u606f\uff0c\u5b83\u662f\u7531\u6d88\u606f\u5934\u548c\u6d88\u606f\u4f53\u7ec4\u6210\u3002\u6d88\u606f\u5934\u5219\u5305\u62ec Routing-Key \u3001 Priority (\u4f18\u5148\u7ea7)\u7b49\u3002","title":"RabbitMQ\u5404\u7ec4\u4ef6\u7684\u529f\u80fd"},{"location":"knowledge/mqvs/#rabbitmq_1","text":"Exchange \u5206\u53d1\u6d88\u606f\u7ed9 Queue \u65f6\uff0c Exchange \u7684\u7c7b\u578b\u5bf9\u5e94\u4e0d\u540c\u7684\u5206\u53d1\u7b56\u7565\uff0c\u67093\u79cd\u7c7b\u578b\u7684 Exchange \uff1a Direct \u3001 Fanout \u3001 Topic \u3002 Direct \uff1a \u6d88\u606f\u4e2d\u7684 Routing Key \u5982\u679c\u548c Binding \u4e2d\u7684 Routing Key \u5b8c\u5168\u4e00\u81f4\uff0c Exchange \u5c31\u4f1a\u5c06\u6d88\u606f\u5206\u53d1\u5230\u5bf9\u5e94\u7684\u961f\u5217\u4e2d\u3002 Fanout \uff1a \u6bcf\u4e2a\u53d1\u5230 Fanout \u7c7b\u578b\u4ea4\u6362\u673a\u7684\u6d88\u606f\u90fd\u4f1a\u5206\u53d1\u5230\u6240\u6709\u7ed1\u5b9a\u7684\u961f\u5217\u4e0a\u53bb\u3002Fanout\u4ea4\u6362\u673a\u6ca1\u6709 Routing Key \u3002 \u5b83\u5728\u4e09\u79cd\u7c7b\u578b\u7684\u4ea4\u6362\u673a\u4e2d\u8f6c\u53d1\u6d88\u606f\u662f\u6700\u5feb\u7684 \u3002 Topic \uff1a Topic\u4ea4\u6362\u673a\u901a\u8fc7\u6a21\u5f0f\u5339\u914d\u5206\u914d\u6d88\u606f\uff0c\u5c06 Routing Key \u548c\u67d0\u4e2a\u6a21\u5f0f\u8fdb\u884c\u5339\u914d\u3002\u5b83\u53ea\u80fd\u8bc6\u522b\u4e24\u4e2a \u901a\u914d\u7b26 \uff1a \"#\"\u548c\"*\" \u3002 # \u5339\u914d0\u4e2a\u6216\u591a\u4e2a\u5355\u8bcd\uff0c * \u5339\u914d1\u4e2a\u5355\u8bcd\u3002","title":"RabbitMQ\u7684\u591a\u79cd\u4ea4\u6362\u673a\u7c7b\u578b"},{"location":"knowledge/mqvs/#ttl","text":"TTL(Time To Live)\uff1a\u751f\u5b58\u65f6\u95f4\u3002RabbitMQ\u652f\u6301\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4e00\u51712\u79cd\u3002 \u5728\u6d88\u606f\u53d1\u9001\u65f6\u8fdb\u884c\u6307\u5b9a \u3002\u901a\u8fc7\u914d\u7f6e\u6d88\u606f\u4f53\u7684 Properties \uff0c\u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u5728\u521b\u5efaExchange\u65f6\u6307\u5b9a \u3002\u4ece\u8fdb\u5165\u6d88\u606f\u961f\u5217\u5f00\u59cb\u8ba1\u7b97\uff0c\u53ea\u8981\u8d85\u8fc7\u4e86\u961f\u5217\u7684\u8d85\u65f6\u65f6\u95f4\u914d\u7f6e\uff0c\u90a3\u4e48\u6d88\u606f\u4f1a\u81ea\u52a8\u6e05\u9664\u3002","title":"TTL"},{"location":"knowledge/mqvs/#_1","text":"","title":"\u751f\u4ea7\u8005\u7684\u6d88\u606f\u786e\u8ba4\u673a\u5236"},{"location":"knowledge/mqvs/#confirm","text":"\u6d88\u606f\u7684\u786e\u8ba4\uff0c\u662f\u6307\u751f\u4ea7\u8005\u6295\u9012\u6d88\u606f\u540e\uff0c\u5982\u679cBroker\u6536\u5230\u6d88\u606f\uff0c\u5219\u4f1a\u7ed9\u6211\u4eec\u751f\u4ea7\u8005\u4e00\u4e2a\u5e94\u7b54\u3002 \u751f\u4ea7\u8005\u8fdb\u884c\u63a5\u53d7\u5e94\u7b54\uff0c\u7528\u6765\u786e\u8ba4\u8fd9\u6761\u6d88\u606f\u662f\u5426\u6b63\u5e38\u7684\u53d1\u9001\u5230\u4e86Broker\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u662f \u6d88\u606f\u7684\u53ef\u9760\u6027\u6295\u9012\u7684\u6838\u5fc3\u4fdd\u969c\uff01 \u5982\u4f55\u5b9e\u73b0Confirm\u786e\u8ba4\u6d88\u606f\uff1f \u5728channel\u4e0a\u5f00\u542f\u786e\u8ba4\u6a21\u5f0f \uff1a channel.confirmSelect() \u5728channel\u4e0a\u5f00\u542f\u76d1\u542c \uff1a addConfirmListener \uff0c\u76d1\u542c\u6210\u529f\u548c\u5931\u8d25\u7684\u5904\u7406\u7ed3\u679c\uff0c\u6839\u636e\u5177\u4f53\u7684\u7ed3\u679c\u5bf9\u6d88\u606f\u8fdb\u884c\u91cd\u65b0\u53d1\u9001\u6216\u8bb0\u5f55\u65e5\u5fd7\u5904\u7406\u7b49\u540e\u7eed\u64cd\u4f5c\u3002","title":"Confirm\u673a\u5236"},{"location":"knowledge/mqvs/#return","text":"Return Listener \u7528\u4e8e\u5904\u7406\u4e00\u4e9b\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f \u3002 \u6211\u4eec\u7684\u6d88\u606f\u751f\u4ea7\u8005\uff0c\u901a\u8fc7\u6307\u5b9a\u4e00\u4e2aExchange\u548cRouting\uff0c\u628a\u6d88\u606f\u9001\u8fbe\u5230\u67d0\u4e00\u4e2a\u961f\u5217\u4e2d\u53bb\uff0c\u7136\u540e\u6211\u4eec\u7684\u6d88\u8d39\u8005\u76d1\u542c\u961f\u5217\u8fdb\u884c\u6d88\u606f\u7684\u6d88\u8d39\u5904\u7406\u64cd\u4f5c\u3002 \u4f46\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u5728\u53d1\u9001\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5f53\u524d\u7684exchange\u4e0d\u5b58\u5728\u6216\u8005\u6307\u5b9a\u7684\u8def\u7531key\u8def\u7531\u4e0d\u5230\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9700\u8981\u76d1\u542c\u8fd9\u79cd\u4e0d\u53ef\u8fbe\u6d88\u606f\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u5230Returrn Listener\u3002 \u57fa\u7840API\u4e2d\u6709\u4e2a\u5173\u952e\u7684\u914d\u7f6e\u9879 Mandatory \uff1a\u5982\u679c\u4e3atrue\uff0c\u76d1\u542c\u5668\u4f1a\u6536\u5230\u8def\u7531\u4e0d\u53ef\u8fbe\u7684\u6d88\u606f\uff0c\u7136\u540e\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c\u4e3afalse\uff0cbroker\u7aef\u4f1a\u81ea\u52a8\u5220\u9664\u8be5\u6d88\u606f\u3002 \u540c\u6837\uff0c\u901a\u8fc7\u76d1\u542c\u7684\u65b9\u5f0f\uff0c chennel.addReturnListener(ReturnListener rl) \u4f20\u5165\u5df2\u7ecf\u91cd\u5199\u8fc7handleReturn\u65b9\u6cd5\u7684ReturnListener\u3002","title":"Return\u6d88\u606f\u673a\u5236"},{"location":"knowledge/mqvs/#acknack","text":"\u6d88\u8d39\u7aef\u8fdb\u884c\u6d88\u8d39\u7684\u65f6\u5019\uff0c\u5982\u679c\u7531\u4e8e\u4e1a\u52a1\u5f02\u5e38\u53ef\u4ee5\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u8fdb\u884c\u8865\u507f\u3002\u4f46\u662f\u5bf9\u4e8e\u670d\u52a1\u5668\u5b95\u673a\u7b49\u4e25\u91cd\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981 \u624b\u52a8ACK \u4fdd\u969c\u6d88\u8d39\u7aef\u6d88\u8d39\u6210\u529f\u3002 // deliveryTag\uff1a\u6d88\u606f\u5728mq\u4e2d\u7684\u552f\u4e00\u6807\u8bc6 // multiple\uff1a\u662f\u5426\u6279\u91cf(\u548cqos\u8bbe\u7f6e\u7c7b\u4f3c\u7684\u53c2\u6570) // requeue\uff1a\u662f\u5426\u9700\u8981\u91cd\u56de\u961f\u5217\u3002\u6216\u8005\u4e22\u5f03\u6216\u8005\u91cd\u56de\u961f\u9996\u518d\u6b21\u6d88\u8d39\u3002 public void basicNack(long deliveryTag, boolean multiple, boolean requeue) \u590d\u5236\u4ee3\u7801 \u5982\u4e0a\u4ee3\u7801\uff0c\u6d88\u606f\u5728 \u6d88\u8d39\u7aef\u91cd\u56de\u961f\u5217 \u662f\u4e3a\u4e86\u5bf9\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u628a\u6d88\u606f\u91cd\u65b0\u8fd4\u56de\u5230Broker\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u90fd\u4f1a\u5173\u95ed\u91cd\u56de\u961f\u5217( \u907f\u514d\u8fdb\u5165\u6b7b\u5faa\u73af )\uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3afalse\u3002","title":"\u6d88\u8d39\u7aefACK\u4e0eNACK"},{"location":"knowledge/mqvs/#dlx","text":"\u6b7b\u4fe1\u961f\u5217(DLX Dead-Letter-Exchange)\uff1a \u5f53\u6d88\u606f\u5728\u4e00\u4e2a\u961f\u5217\u4e2d\u53d8\u6210\u6b7b\u4fe1\u4e4b\u540e\uff0c\u5b83\u4f1a\u88ab\u91cd\u65b0\u63a8\u9001\u5230\u53e6\u4e00\u4e2a\u961f\u5217\uff0c\u8fd9\u4e2a\u961f\u5217\u5c31\u662f\u6b7b\u4fe1\u961f\u5217\u3002 DLX\u4e5f\u662f\u4e00\u4e2a\u6b63\u5e38\u7684Exchange\uff0c\u548c\u4e00\u822c\u7684Exchange\u6ca1\u6709\u533a\u522b\uff0c\u5b83\u80fd\u5728\u4efb\u4f55\u7684\u961f\u5217\u4e0a\u88ab\u6307\u5b9a\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u8bbe\u7f6e\u67d0\u4e2a\u961f\u5217\u7684\u5c5e\u6027\u3002 \u5f53\u8fd9\u4e2a\u961f\u5217\u4e2d\u6709\u6b7b\u4fe1\u65f6\uff0cRabbitMQ\u5c31\u4f1a\u81ea\u52a8\u7684\u5c06\u8fd9\u4e2a\u6d88\u606f\u91cd\u65b0\u53d1\u5e03\u5230\u8bbe\u7f6e\u7684Exchange\u4e0a\u53bb\uff0c\u8fdb\u800c\u88ab\u8def\u7531\u5230\u53e6\u4e00\u4e2a\u961f\u5217\u3002","title":"\u6b7b\u4fe1\u961f\u5217DLX"},{"location":"knowledge/mqvs/#2rocketmq","text":"\u963f\u91cc\u5df4\u5df4\u53cc\u5341\u4e00\u5b98\u65b9\u6307\u5b9a\u6d88\u606f\u4ea7\u54c1\uff0c\u652f\u6491\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u6240\u6709\u7684\u6d88\u606f\u670d\u52a1\uff0c\u5386\u7ecf\u5341\u4f59\u5e74\u9ad8\u53ef\u7528\u4e0e\u9ad8\u53ef\u9760\u7684\u4e25\u82db\u8003\u9a8c\uff0c\u662f\u963f\u91cc\u5df4\u5df4\u4ea4\u6613\u94fe\u8def\u7684\u6838\u5fc3\u4ea7\u54c1\uff1b Rocket\uff1a\u706b\u7bad\u7684\u610f\u601d\u3002","title":"2\u3001RocketMQ"},{"location":"knowledge/mqvs/#rocketmq","text":"\u4ed6\u6709\u4ee5\u4e0b\u6838\u5fc3\u6982\u5ff5\uff1a Broker \u3001 Topic \u3001 Tag \u3001 MessageQueue \u3001 NameServer \u3001 Group \u3001 Offset \u3001 Producer \u4ee5\u53ca Consumer \u3002 \u4e0b\u9762\u6765\u8be6\u7ec6\u4ecb\u7ecd\u3002 Broker \uff1a\u6d88\u606f\u4e2d\u8f6c\u89d2\u8272\uff0c\u8d1f\u8d23 \u5b58\u50a8\u6d88\u606f \uff0c\u8f6c\u53d1\u6d88\u606f\u3002 Broker \u662f\u5177\u4f53\u63d0\u4f9b\u4e1a\u52a1\u7684\u670d\u52a1\u5668\uff0c\u5355\u4e2aBroker\u8282\u70b9\u4e0e\u6240\u6709\u7684NameServer\u8282\u70b9\u4fdd\u6301\u957f\u8fde\u63a5\u53ca\u5fc3\u8df3\uff0c\u5e76\u4f1a\u5b9a\u65f6\u5c06 Topic \u4fe1\u606f\u6ce8\u518c\u5230NameServer\uff0c\u987a\u5e26\u4e00\u63d0\u5e95\u5c42\u7684\u901a\u4fe1\u548c\u8fde\u63a5\u90fd\u662f \u57fa\u4e8eNetty\u5b9e\u73b0 \u7684\u3002 Broker \u8d1f\u8d23\u6d88\u606f\u5b58\u50a8\uff0c\u4ee5Topic\u4e3a\u7eac\u5ea6\u652f\u6301\u8f7b\u91cf\u7ea7\u7684\u961f\u5217\uff0c\u5355\u673a\u53ef\u4ee5\u652f\u6491\u4e0a\u4e07\u961f\u5217\u89c4\u6a21\uff0c\u652f\u6301\u6d88\u606f\u63a8\u62c9\u6a21\u578b\u3002 \u5b98\u7f51\u4e0a\u6709\u6570\u636e\u663e\u793a\uff1a\u5177\u6709 \u4e0a\u4ebf\u7ea7\u6d88\u606f\u5806\u79ef\u80fd\u529b \uff0c\u540c\u65f6\u53ef \u4e25\u683c\u4fdd\u8bc1\u6d88\u606f\u7684\u6709\u5e8f\u6027 \u3002 Topic \uff1a\u4e3b\u9898\uff01\u5b83\u662f\u6d88\u606f\u7684\u7b2c\u4e00\u7ea7\u7c7b\u578b\u3002\u6bd4\u5982\u4e00\u4e2a\u7535\u5546\u7cfb\u7edf\u53ef\u4ee5\u5206\u4e3a\uff1a\u4ea4\u6613\u6d88\u606f\u3001\u7269\u6d41\u6d88\u606f\u7b49\uff0c\u4e00\u6761\u6d88\u606f\u5fc5\u987b\u6709\u4e00\u4e2a Topic \u3002 Topic \u4e0e\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7684\u5173\u7cfb\u975e\u5e38\u677e\u6563\uff0c\u4e00\u4e2a Topic \u53ef\u4ee5\u67090\u4e2a\u30011\u4e2a\u3001\u591a\u4e2a\u751f\u4ea7\u8005\u5411\u5176\u53d1\u9001\u6d88\u606f\uff0c\u4e00\u4e2a\u751f\u4ea7\u8005\u4e5f\u53ef\u4ee5\u540c\u65f6\u5411\u4e0d\u540c\u7684 Topic \u53d1\u9001\u6d88\u606f\u3002\u4e00\u4e2a Topic \u4e5f\u53ef\u4ee5\u88ab 0\u4e2a\u30011\u4e2a\u3001\u591a\u4e2a\u6d88\u8d39\u8005\u8ba2\u9605\u3002 Tag \uff1a\u6807\u7b7e\uff01\u53ef\u4ee5\u770b\u4f5c\u5b50\u4e3b\u9898\uff0c\u5b83\u662f\u6d88\u606f\u7684\u7b2c\u4e8c\u7ea7\u7c7b\u578b\uff0c\u7528\u4e8e\u4e3a\u7528\u6237\u63d0\u4f9b\u989d\u5916\u7684\u7075\u6d3b\u6027\u3002\u4f7f\u7528\u6807\u7b7e\uff0c\u540c\u4e00\u4e1a\u52a1\u6a21\u5757\u4e0d\u540c\u76ee\u7684\u7684\u6d88\u606f\u5c31\u53ef\u4ee5\u7528\u76f8\u540c Topic \u800c\u4e0d\u540c\u7684 Tag \u6765\u6807\u8bc6\u3002\u6bd4\u5982\u4ea4\u6613\u6d88\u606f\u53c8\u53ef\u4ee5\u5206\u4e3a\uff1a\u4ea4\u6613\u521b\u5efa\u6d88\u606f\u3001\u4ea4\u6613\u5b8c\u6210\u6d88\u606f\u7b49\uff0c\u4e00\u6761\u6d88\u606f\u53ef\u4ee5\u6ca1\u6709 Tag \u3002\u6807\u7b7e\u6709\u52a9\u4e8e\u4fdd\u6301\u60a8\u7684\u4ee3\u7801\u5e72\u51c0\u548c\u8fde\u8d2f\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u4e3a RocketMQ \u63d0\u4f9b\u7684\u67e5\u8be2\u7cfb\u7edf\u63d0\u4f9b\u5e2e\u52a9\u3002 MessageQueue \uff1a\u4e00\u4e2a Topic \u4e0b\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u53d1\u9001\u6d88\u606f\u65f6\u6267\u884c\u8be5\u6d88\u606f\u7684 Topic \uff0cRocketMQ \u4f1a\u8f6e\u8be2\u8be5 Topic \u4e0b\u7684\u6240\u6709\u961f\u5217\u5c06\u6d88\u606f\u53d1\u51fa\u53bb\u3002\u6d88\u606f\u7684\u7269\u7406\u7ba1\u7406\u5355\u4f4d\u3002\u4e00\u4e2aTopic\u4e0b\u53ef\u4ee5\u6709\u591a\u4e2aQueue\uff0cQueue\u7684\u5f15\u5165\u4f7f\u5f97\u6d88\u606f\u7684\u5b58\u50a8\u53ef\u4ee5\u5206\u5e03\u5f0f\u96c6\u7fa4\u5316\uff0c\u5177\u6709\u4e86\u6c34\u5e73\u6269\u5c55\u80fd\u529b\u3002 NameServer \uff1a\u7c7b\u4f3cKafka\u4e2d\u7684Zookeeper, \u4f46NameServer\u96c6\u7fa4\u4e4b\u95f4\u662f \u6ca1\u6709\u901a\u4fe1 \u7684\uff0c\u76f8\u5bf9ZK\u6765\u8bf4\u66f4\u52a0 \u8f7b\u91cf \u3002 \u5b83\u4e3b\u8981\u8d1f\u8d23\u5bf9\u4e8e\u6e90\u6570\u636e\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u4e86\u5bf9\u4e8e Topic \u548c\u8def\u7531\u4fe1\u606f\u7684\u7ba1\u7406\u3002\u6bcf\u4e2a Broker \u5728\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u5230 NameServer \u6ce8\u518c\uff0cProducer \u5728\u53d1\u9001\u6d88\u606f\u524d\u4f1a\u6839\u636e Topic \u53bb NameServer \u83b7\u53d6\u5bf9\u5e94 Broker \u7684\u8def\u7531\u4fe1\u606f \uff0cConsumer \u4e5f\u4f1a\u5b9a\u65f6\u83b7\u53d6 Topic \u7684\u8def\u7531\u4fe1\u606f\u3002 Producer \uff1a \u751f\u4ea7\u8005\uff0c\u652f\u6301\u4e09\u79cd\u65b9\u5f0f\u53d1\u9001\u6d88\u606f\uff1a \u540c\u6b65\u3001\u5f02\u6b65\u548c\u5355\u5411 \u5355\u5411\u53d1\u9001 \uff1a\u6d88\u606f\u53d1\u51fa\u53bb\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u6761\u6d88\u606f\u6216\u6267\u884c\u4e1a\u52a1\u4ee3\u7801\uff0c\u4e0d\u7b49\u5f85\u670d\u52a1\u5668\u56de\u5e94\uff0c\u4e14 \u6ca1\u6709\u56de\u8c03\u51fd\u6570 \u3002 \u5f02\u6b65\u53d1\u9001 \uff1a\u6d88\u606f\u53d1\u51fa\u53bb\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u6761\u6d88\u606f\u6216\u6267\u884c\u4e1a\u52a1\u4ee3\u7801\uff0c\u4e0d\u7b49\u5f85\u670d\u52a1\u5668\u56de\u5e94\uff0c \u6709\u56de\u8c03\u51fd\u6570 \u3002 \u540c\u6b65\u53d1\u9001 \uff1a\u6d88\u606f\u53d1\u51fa\u53bb\u540e\uff0c\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\u6210\u529f\u6216\u5931\u8d25\uff0c\u624d\u80fd\u7ee7\u7eed\u540e\u9762\u7684\u64cd\u4f5c\u3002 Consumer \uff1a\u6d88\u8d39\u8005\uff0c\u652f\u6301 PUSH \u548c PULL \u4e24\u79cd\u6d88\u8d39\u6a21\u5f0f\uff0c\u652f\u6301 \u96c6\u7fa4\u6d88\u8d39 \u548c \u5e7f\u64ad\u6d88\u8d39 \u96c6\u7fa4\u6d88\u8d39 : \u8be5\u6a21\u5f0f\u4e0b\u4e00\u4e2a\u6d88\u8d39\u8005\u96c6\u7fa4\u5171\u540c\u6d88\u8d39\u4e00\u4e2a\u4e3b\u9898\u7684\u591a\u4e2a\u961f\u5217\uff0c\u4e00\u4e2a\u961f\u5217\u53ea\u4f1a\u88ab\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff0c\u5982\u679c\u67d0\u4e2a\u6d88\u8d39\u8005\u6302\u6389\uff0c\u5206\u7ec4\u5185\u5176\u5b83\u6d88\u8d39\u8005\u4f1a\u63a5\u66ff\u6302\u6389\u7684\u6d88\u8d39\u8005\u7ee7\u7eed\u6d88\u8d39\u3002 \u5e7f\u64ad\u6d88\u8d39 : \u4f1a\u53d1\u7ed9\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u8fdb\u884c\u6d88\u8d39\u3002\u76f8\u5f53\u4e8e RabbitMQ \u7684\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u3002 Group \uff1a\u5206\u7ec4\uff0c\u4e00\u4e2a\u7ec4\u53ef\u4ee5\u8ba2\u9605\u591a\u4e2aTopic\u3002\u5206\u4e3a ProducerGroup\uff0cConsumerGroup\uff0c\u4ee3\u8868\u67d0\u4e00\u7c7b\u7684\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\uff0c\u4e00\u822c\u6765\u8bf4\u540c\u4e00\u4e2a\u670d\u52a1\u53ef\u4ee5\u4f5c\u4e3aGroup\uff0c\u540c\u4e00\u4e2aGroup\u4e00\u822c\u6765\u8bf4\u53d1\u9001\u548c\u6d88\u8d39\u7684\u6d88\u606f\u90fd\u662f\u4e00\u6837\u7684 Offset \uff1a\u5728 RocketMQ \u4e2d\uff0c\u6240\u6709\u6d88\u606f\u961f\u5217\u90fd\u662f\u6301\u4e45\u5316\uff0c\u957f\u5ea6\u65e0\u9650\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6240\u8c13\u957f\u5ea6\u65e0\u9650\u662f\u6307\u961f\u5217\u4e2d\u7684\u6bcf\u4e2a\u5b58\u50a8\u5355\u5143\u90fd\u662f\u5b9a\u957f\uff0c\u8bbf\u95ee\u5176\u4e2d\u7684\u5b58\u50a8\u5355\u5143\u4f7f\u7528Offset \u6765\u8bbf\u95ee\uff0cOffset \u4e3a java long \u7c7b\u578b\uff0c64 \u4f4d\uff0c\u7406\u8bba\u4e0a\u5728 100\u5e74\u5185\u4e0d\u4f1a\u6ea2\u51fa\uff0c\u6240\u4ee5\u8ba4\u4e3a\u662f\u957f\u5ea6\u65e0\u9650\u3002\u4e5f\u53ef\u4ee5\u8ba4\u4e3a Message Queue \u662f\u4e00\u4e2a\u957f\u5ea6\u65e0\u9650\u7684\u6570\u7ec4\uff0c Offset \u5c31\u662f\u4e0b\u6807\u3002","title":"RocketMQ\u7684\u6838\u5fc3\u6982\u5ff5"},{"location":"knowledge/mqvs/#_2","text":"\u5f00\u6e90\u7248\u7684RocketMQ\u4e0d\u652f\u6301\u4efb\u610f\u65f6\u95f4\u7cbe\u5ea6\uff0c\u4ec5\u652f\u6301\u7279\u5b9a\u7684 level\uff0c\u4f8b\u5982\u5b9a\u65f6 5s\uff0c 10s\uff0c 1min \u7b49\u3002\u5176\u4e2d\uff0clevel=0 \u7ea7\u8868\u793a\u4e0d\u5ef6\u65f6\uff0clevel=1 \u8868\u793a 1 \u7ea7\u5ef6\u65f6\uff0clevel=2 \u8868\u793a 2 \u7ea7\u5ef6\u65f6\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u5ef6\u65f6\u7b49\u7ea7\u5982\u4e0b\uff1a messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h \u590d\u5236\u4ee3\u7801","title":"\u5ef6\u65f6\u6d88\u606f"},{"location":"knowledge/mqvs/#_3","text":"\u6d88\u606f\u6709\u5e8f\u6307\u7684\u662f\u53ef\u4ee5\u6309\u7167\u6d88\u606f\u7684\u53d1\u9001\u987a\u5e8f\u6765\u6d88\u8d39\uff08FIFO\uff09\u3002RocketMQ\u53ef\u4ee5\u4e25\u683c\u7684\u4fdd\u8bc1\u6d88\u606f\u6709\u5e8f\uff0c\u53ef\u4ee5\u5206\u4e3a \u5206\u533a\u6709\u5e8f \u6216\u8005 \u5168\u5c40\u6709\u5e8f \u3002","title":"\u987a\u5e8f\u6d88\u606f"},{"location":"knowledge/mqvs/#_4","text":"\u6d88\u606f\u961f\u5217 MQ \u63d0\u4f9b\u7c7b\u4f3c X/Open XA \u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u529f\u80fd\uff0c\u901a\u8fc7\u6d88\u606f\u961f\u5217 MQ \u4e8b\u52a1\u6d88\u606f\u80fd\u8fbe\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6700\u7ec8\u4e00\u81f4\u3002\u4e0a\u56fe\u8bf4\u660e\u4e86\u4e8b\u52a1\u6d88\u606f\u7684\u5927\u81f4\u6d41\u7a0b\uff1a\u6b63\u5e38\u4e8b\u52a1\u6d88\u606f\u7684\u53d1\u9001\u548c\u63d0\u4ea4\u3001\u4e8b\u52a1\u6d88\u606f\u7684\u8865\u507f\u6d41\u7a0b\u3002 \u4e8b\u52a1\u6d88\u606f\u53d1\u9001\u53ca\u63d0\u4ea4 \uff1a \u53d1\u9001half\u6d88\u606f \u670d\u52a1\u7aef\u54cd\u5e94\u6d88\u606f\u5199\u5165\u7ed3\u679c \u6839\u636e\u53d1\u9001\u7ed3\u679c\u6267\u884c\u672c\u5730\u4e8b\u52a1\uff08\u5982\u679c\u5199\u5165\u5931\u8d25\uff0c\u6b64\u65f6half\u6d88\u606f\u5bf9\u4e1a\u52a1\u4e0d\u53ef\u89c1\uff0c\u672c\u5730\u903b\u8f91\u4e0d\u6267\u884c\uff09\uff1b \u6839\u636e\u672c\u5730\u4e8b\u52a1\u72b6\u6001\u6267\u884cCommit\u6216Rollback\uff08Commit\u64cd\u4f5c\u751f\u6210\u6d88\u606f\u7d22\u5f15\uff0c\u6d88\u606f\u5bf9\u6d88\u8d39\u8005\u53ef\u89c1\uff09\u3002 \u4e8b\u52a1\u6d88\u606f\u7684\u8865\u507f\u6d41\u7a0b \uff1a \u5bf9\u6ca1\u6709Commit/Rollback\u7684\u4e8b\u52a1\u6d88\u606f\uff08pending\u72b6\u6001\u7684\u6d88\u606f\uff09\uff0c\u4ece\u670d\u52a1\u7aef\u53d1\u8d77\u4e00\u6b21\u201c\u56de\u67e5\u201d\uff1b Producer\u6536\u5230\u56de\u67e5\u6d88\u606f\uff0c\u68c0\u67e5\u56de\u67e5\u6d88\u606f\u5bf9\u5e94\u7684\u672c\u5730\u4e8b\u52a1\u7684\u72b6\u6001\u3002 \u6839\u636e\u672c\u5730\u4e8b\u52a1\u72b6\u6001\uff0c\u91cd\u65b0Commit\u6216RollBack \u5176\u4e2d\uff0c\u8865\u507f\u9636\u6bb5\u7528\u4e8e\u89e3\u51b3\u6d88\u606fCommit\u6216Rollback\u53d1\u751f\u8d85\u65f6\u6216\u8005\u5931\u8d25\u7684\u60c5\u51b5\u3002 \u4e8b\u52a1\u6d88\u606f\u72b6\u6001 \uff1a \u4e8b\u52a1\u6d88\u606f\u5171\u6709\u4e09\u79cd\u72b6\u6001\uff1a\u63d0\u4ea4\u72b6\u6001\u3001\u56de\u6eda\u72b6\u6001\u3001\u4e2d\u95f4\u72b6\u6001\uff1a TransactionStatus.CommitTransaction\uff1a\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5b83\u5141\u8bb8\u6d88\u8d39\u8005\u6d88\u8d39\u6b64\u6d88\u606f\u3002 TransactionStatus.RollbackTransaction\uff1a\u56de\u6eda\u4e8b\u52a1\uff0c\u5b83\u4ee3\u8868\u8be5\u6d88\u606f\u5c06\u88ab\u5220\u9664\uff0c\u4e0d\u5141\u8bb8\u88ab\u6d88\u8d39\u3002 TransactionStatus.Unkonwn\uff1a\u4e2d\u95f4\u72b6\u6001\uff0c\u5b83\u4ee3\u8868\u9700\u8981\u68c0\u67e5\u6d88\u606f\u961f\u5217\u6765\u786e\u5b9a\u6d88\u606f\u72b6\u6001\u3002","title":"\u4e8b\u52a1\u6d88\u606f"},{"location":"knowledge/mqvs/#rocketmq_1","text":"RocketMQ\u662f\u5929\u751f\u652f\u6301\u5206\u5e03\u5f0f\u7684\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e3b\u4ece\u4ee5\u53ca\u6c34\u5e73\u6269\u5c55 Master\u89d2\u8272\u7684Broker\u652f\u6301\u8bfb\u548c\u5199\uff0cSlave\u89d2\u8272\u7684Broker\u4ec5\u652f\u6301\u8bfb\uff0c\u4e5f\u5c31\u662f Producer\u53ea\u80fd\u548cMaster\u89d2\u8272\u7684Broker\u8fde\u63a5\u5199\u5165\u6d88\u606f\uff1bConsumer\u53ef\u4ee5\u8fde\u63a5 Master\u89d2\u8272\u7684Broker\uff0c\u4e5f\u53ef\u4ee5\u8fde\u63a5Slave\u89d2\u8272\u7684Broker\u6765\u8bfb\u53d6\u6d88\u606f\u3002","title":"RocketMQ\u7684\u9ad8\u53ef\u7528\u673a\u5236"},{"location":"knowledge/mqvs/#_5","text":"\u5728Consumer\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5e76\u4e0d\u9700\u8981\u8bbe\u7f6e\u662f\u4eceMaster\u8bfb\u8fd8\u662f\u4eceSlave \u8bfb\uff0c\u5f53Master\u4e0d\u53ef\u7528\u6216\u8005\u7e41\u5fd9\u7684\u65f6\u5019\uff0cConsumer\u4f1a\u88ab\u81ea\u52a8\u5207\u6362\u5230\u4eceSlave \u8bfb\u3002\u6709\u4e86\u81ea\u52a8\u5207\u6362Consumer\u8fd9\u79cd\u673a\u5236\uff0c\u5f53\u4e00\u4e2aMaster\u89d2\u8272\u7684\u673a\u5668\u51fa\u73b0\u6545\u969c\u540e\uff0cConsumer\u4ecd\u7136\u53ef\u4ee5\u4eceSlave\u8bfb\u53d6\u6d88\u606f\uff0c\u4e0d\u5f71\u54cdConsumer\u7a0b\u5e8f\u3002\u8fd9\u5c31\u8fbe\u5230\u4e86\u6d88\u8d39\u7aef\u7684\u9ad8\u53ef\u7528\u6027\u3002 RocketMQ\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\u628aSlave\u81ea\u52a8\u8f6c\u6210Master \uff0c\u5982\u679c\u673a\u5668\u8d44\u6e90\u4e0d\u8db3\uff0c\u9700\u8981\u628aSlave\u8f6c\u6210Master\uff0c\u5219\u8981\u624b\u52a8\u505c\u6b62Slave\u89d2\u8272\u7684Broker\uff0c\u66f4\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u542f\u52a8Broker\u3002","title":"\u6d88\u606f\u6d88\u8d39\u7684\u9ad8\u53ef\u7528\uff08\u4e3b\u4ece\uff09"},{"location":"knowledge/mqvs/#_6","text":"\u5728\u521b\u5efaTopic\u7684\u65f6\u5019\uff0c\u628aTopic\u7684\u591a\u4e2aMessage Queue\u521b\u5efa\u5728\u591a\u4e2aBroker\u7ec4\u4e0a\uff08\u76f8\u540cBroker\u540d\u79f0\uff0c\u4e0d\u540c brokerId\u7684\u673a\u5668\u7ec4\u6210\u4e00\u4e2aBroker\u7ec4\uff09\uff0c\u8fd9\u6837\u5f53\u4e00\u4e2aBroker\u7ec4\u7684Master\u4e0d\u53ef\u7528\u540e\uff0c\u5176\u4ed6\u7ec4\u7684Master\u4ecd\u7136\u53ef\u7528\uff0cProducer\u4ecd\u7136\u53ef\u4ee5\u53d1\u9001\u6d88\u606f\u3002","title":"\u6d88\u606f\u53d1\u9001\u9ad8\u53ef\u7528\uff08\u914d\u7f6e\u591a\u4e2a\u4e3b\u8282\u70b9\uff09"},{"location":"knowledge/mqvs/#_7","text":"\u5982\u679c\u4e00\u4e2aBroker\u7ec4\u6709Master\u548cSlave\uff0c\u6d88\u606f\u9700\u8981\u4eceMaster\u590d\u5236\u5230Slave \u4e0a\uff0c\u6709\u540c\u6b65\u548c\u5f02\u6b65\u4e24\u79cd\u590d\u5236\u65b9\u5f0f\u3002 \u540c\u6b65\u590d\u5236 \uff1a\u540c\u6b65\u590d\u5236\u65b9\u5f0f\u662f\u7b49Master\u548cSlave\u5747\u5199\u6210\u529f\u540e\u624d\u53cd\u9988\u7ed9\u5ba2\u6237\u7aef\u5199\u6210\u529f\u72b6\u6001\u3002\u5982\u679cMaster\u51fa\u6545\u969c\uff0c Slave\u4e0a\u6709\u5168\u90e8\u7684\u5907\u4efd\u6570\u636e\uff0c\u5bb9\u6613\u6062\u590d\u540c\u6b65\u590d\u5236\u4f1a\u589e\u5927\u6570\u636e\u5199\u5165\u5ef6\u8fdf\uff0c\u964d\u4f4e\u7cfb\u7edf\u541e\u5410\u91cf\u3002 \u5f02\u6b65\u590d\u5236 \uff1a\u5f02\u6b65\u590d\u5236\u65b9\u5f0f\u662f\u53ea\u8981Master\u5199\u6210\u529f \u5373\u53ef\u53cd\u9988\u7ed9\u5ba2\u6237\u7aef\u5199\u6210\u529f\u72b6\u6001\u3002\u5728\u5f02\u6b65\u590d\u5236\u65b9\u5f0f\u4e0b\uff0c\u7cfb\u7edf\u62e5\u6709\u8f83\u4f4e\u7684\u5ef6\u8fdf\u548c\u8f83\u9ad8\u7684\u541e\u5410\u91cf\uff0c\u4f46\u662f\u5982\u679cMaster\u51fa\u4e86\u6545\u969c\uff0c\u6709\u4e9b\u6570\u636e\u56e0\u4e3a\u6ca1\u6709\u88ab\u5199 \u5165Slave\uff0c\u6709\u53ef\u80fd\u4f1a\u4e22\u5931 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u628aMaster\u548cSave\u914d\u7f6e\u6210\u540c\u6b65\u5237\u76d8\u65b9\u5f0f\uff0c\u4e3b\u4ece\u4e4b\u95f4\u914d\u7f6e\u6210\u5f02\u6b65\u7684\u590d\u5236\u65b9\u5f0f\uff0c\u8fd9\u6837\u5373\u4f7f\u6709\u4e00\u53f0\u673a\u5668\u51fa\u6545\u969c\uff0c\u4ecd\u7136\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\uff0c\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002","title":"\u4e3b\u4ece\u590d\u5236"},{"location":"knowledge/mqvs/#_8","text":"","title":"\u8d1f\u8f7d\u5747\u8861"},{"location":"knowledge/mqvs/#producer","text":"Producer\u7aef\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5728\u53d1\u6d88\u606f\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u4f1a \u8f6e\u8be2 \u6240\u6709\u7684message queue\u53d1\u9001\uff0c\u4ee5\u8fbe\u5230\u8ba9\u6d88\u606f\u5e73\u5747\u843d\u5728\u4e0d\u540c\u7684queue\u4e0a\u3002\u800c\u7531\u4e8equeue\u53ef\u4ee5\u6563\u843d\u5728\u4e0d\u540c\u7684broker\uff0c\u6240\u4ee5\u6d88\u606f\u5c31\u53d1\u9001\u5230\u4e0d\u540c\u7684broker\u4e0b\uff0c\u5982\u4e0b\u56fe\uff1a","title":"Producer\u8d1f\u8f7d\u5747\u8861"},{"location":"knowledge/mqvs/#consumer","text":"\u5982\u679cconsumer\u5b9e\u4f8b\u7684\u6570\u91cf\u6bd4message queue\u7684\u603b\u6570\u91cf\u8fd8\u591a\u7684\u8bdd\uff0c \u591a\u51fa\u6765\u7684consumer\u5b9e\u4f8b\u5c06\u65e0\u6cd5\u5206\u5230queue \uff0c\u4e5f\u5c31\u65e0\u6cd5\u6d88\u8d39\u5230\u6d88\u606f\uff0c\u4e5f\u5c31\u65e0\u6cd5\u8d77\u5230\u5206\u644a\u8d1f\u8f7d\u7684\u4f5c\u7528\u4e86\u3002\u6240\u4ee5\u9700\u8981\u63a7\u5236\u8ba9queue\u7684\u603b\u6570\u91cf\u5927\u4e8e\u7b49\u4e8econsumer\u7684\u6570\u91cf\u3002 \u6d88\u8d39\u8005\u7684\u96c6\u7fa4\u6a21\u5f0f\u2013\u542f\u52a8\u591a\u4e2a\u6d88\u8d39\u8005\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6d88\u8d39\u8005\u7684\u8d1f\u8f7d\u5747\u8861\uff08\u5747\u644a\u961f\u5217\uff09 \u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u5747\u644a\u961f\u5217 \uff1a\u4f1a\u6309\u7167queue\u7684\u6570\u91cf\u548c\u5b9e\u4f8b\u7684\u6570\u91cf\u5e73\u5747\u5206\u914dqueue\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\uff0c\u8fd9\u6837\u6bcf\u4e2a\u6d88\u8d39\u8005\u53ef\u4ee5\u5747\u644a\u6d88\u8d39\u7684\u961f\u5217\uff0c\u5982\u4e0b\u56fe\u6240\u793a6\u4e2a\u961f\u5217\u548c\u4e09\u4e2a\u751f\u4ea7\u8005\u3002 \u53e6\u5916\u4e00\u79cd\u5e73\u5747\u7684\u7b97\u6cd5 \u73af\u72b6\u8f6e\u6d41\u5206queue \u7684\u5f62\u5f0f\uff0c\u6bcf\u4e2a\u6d88\u8d39\u8005\uff0c\u5747\u644a\u4e0d\u540c\u4e3b\u8282\u70b9\u7684\u4e00\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5bf9\u4e8e\u5e7f\u64ad\u6a21\u5f0f\u5e76\u4e0d\u662f\u8d1f\u8f7d\u5747\u8861\u7684\uff0c\u8981\u6c42\u4e00\u6761\u6d88\u606f\u9700\u8981\u6295\u9012\u5230\u4e00\u4e2a\u6d88\u8d39\u7ec4\u4e0b\u9762\u6240\u6709\u7684\u6d88\u8d39\u8005\u5b9e\u4f8b\uff0c\u6240\u4ee5\u4e5f\u5c31\u6ca1\u6709\u6d88\u606f\u88ab\u5206\u644a\u6d88\u8d39\u7684\u8bf4\u6cd5\u3002","title":"Consumer\u8d1f\u8f7d\u5747\u8861"},{"location":"knowledge/mqvs/#_9","text":"\u5f53\u4e00\u6761\u6d88\u606f\u6d88\u8d39\u5931\u8d25\uff0cRocketMQ\u5c31\u4f1a\u81ea\u52a8\u8fdb\u884c\u6d88\u606f\u91cd\u8bd5\u3002\u800c\u5982\u679c\u6d88\u606f\u8d85\u8fc7\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0cRocketMQ\u5c31\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u6d88\u606f\u6709\u95ee\u9898\u3002\u4f46\u662f\u6b64\u65f6\uff0cRocketMQ\u4e0d\u4f1a\u7acb\u523b\u5c06\u8fd9\u4e2a\u6709\u95ee\u9898\u7684\u6d88\u606f\u4e22\u5f03\uff0c\u800c\u4f1a\u5c06\u5176\u53d1\u9001\u5230\u8fd9\u4e2a\u6d88\u8d39\u8005\u7ec4\u5bf9\u5e94\u7684\u4e00\u79cd\u7279\u6b8a\u961f\u5217\uff1a\u6b7b\u4fe1\u961f\u5217\u3002\u6b7b\u4fe1\u961f\u5217\u7684\u540d\u79f0\u662f %DLQ%+ConsumGroup \u6b7b\u4fe1\u961f\u5217\u5177\u6709\u4ee5\u4e0b\u7279\u6027 \uff1a \u4e00\u4e2a\u6b7b\u4fe1\u961f\u5217\u5bf9\u5e94\u4e00\u4e2a Group ID\uff0c \u800c\u4e0d\u662f\u5bf9\u5e94\u5355\u4e2a\u6d88\u8d39\u8005\u5b9e\u4f8b\u3002 \u5982\u679c\u4e00\u4e2a Group ID \u672a\u4ea7\u751f\u6b7b\u4fe1\u6d88\u606f\uff0c\u6d88\u606f\u961f\u5217 RocketMQ \u4e0d\u4f1a\u4e3a\u5176\u521b\u5efa\u76f8\u5e94\u7684\u6b7b\u4fe1\u961f\u5217\u3002 \u4e00\u4e2a\u6b7b\u4fe1\u961f\u5217\u5305\u542b\u4e86\u5bf9\u5e94 Group ID \u4ea7\u751f\u7684\u6240\u6709\u6b7b\u4fe1\u6d88\u606f\uff0c\u4e0d\u8bba\u8be5\u6d88\u606f\u5c5e\u4e8e\u54ea\u4e2a Topic\u3002","title":"\u6b7b\u4fe1\u961f\u5217"},{"location":"knowledge/mqvs/#3kafka","text":"Kafka\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u3001\u652f\u6301\u5206\u533a\u7684\u3001\u591a\u526f\u672c\u7684\uff0c \u57fa\u4e8eZookeeper \u534f\u8c03\u7684\u5206\u5e03\u5f0f\u6d88\u606f\u7cfb\u7edf\u3002 \u5b83\u6700\u5927\u7684\u7279\u6027\u5c31\u662f\u53ef\u4ee5\u5b9e\u65f6\u7684\u5904\u7406\u5927\u91cf\u6570\u636e\u4ee5\u6ee1\u8db3\u5404\u79cd\u9700\u6c42\u573a\u666f\uff1a\u6bd4\u5982\u57fa\u4e8ehadoop\u7684\u6279\u5904\u7406\u7cfb\u7edf\u3001\u4f4e\u5ef6\u8fdf\u7684\u5b9e\u65f6\u7cfb\u7edf\u3001Storm/Spark\u6d41\u5f0f\u5904\u7406\u5f15\u64ce\uff0cWeb/Nginx\u65e5\u5fd7\u3001\u8bbf\u95ee\u65e5\u5fd7\uff0c\u6d88\u606f\u670d\u52a1\u7b49\u7b49\uff0c\u7528 Scala\u8bed\u8a00\u7f16\u5199 \u3002\u5c5e\u4e8eApache\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\u3002 \u5148\u770b\u4e00\u4e0bKafka\u7684\u67b6\u6784\u56fe","title":"3\u3001Kafka"},{"location":"knowledge/mqvs/#kafka","text":"\u5728Kafka\u4e2d\u6709\u51e0\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a Broker \u3001 Topic \u3001 Producer \u3001 Consumer \u3001 ConsumerGroup \u3001 Partition \u3001 Leader \u3001 Follower \u3001 Offset \u3002 Broker : \u6d88\u606f\u4e2d\u95f4\u4ef6\u5904\u7406\u8282\u70b9\uff0c\u4e00\u4e2aKafka\u8282\u70b9\u5c31\u662f\u4e00\u4e2abroker\uff0c\u4e00\u4e2a\u6216\u8005\u591a\u4e2aBroker\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2aKafka\u96c6\u7fa4 Topic : Kafka\u6839\u636etopic\u5bf9\u6d88\u606f\u8fdb\u884c\u5f52\u7c7b\uff0c\u53d1\u5e03\u5230Kafka\u96c6\u7fa4\u7684\u6bcf\u6761\u6d88\u606f\u90fd\u9700\u8981\u6307\u5b9a\u4e00\u4e2a topic Producer : \u6d88\u606f\u751f\u4ea7\u8005\uff0c\u5411Broker\u53d1\u9001\u6d88\u606f\u7684\u5ba2\u6237\u7aef Consumer : \u6d88\u606f\u6d88\u8d39\u8005\uff0c\u4eceBroker\u8bfb\u53d6\u6d88\u606f\u7684\u5ba2\u6237\u7aef ConsumerGroup : \u6bcf\u4e2aConsumer\u5c5e\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684ConsumerGroup\uff0c\u4e00\u6761\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u4e0d\u540c\u7684ConsumerGroup\u6d88\u8d39\uff0c\u4f46\u662f\u4e00\u4e2aConsumerGroup\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2aConsumer\u80fd\u591f\u6d88\u8d39\u8be5\u6d88\u606f Partition : \u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u4e00\u4e2atopic\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2apartition\uff0c\u6bcf\u4e2apartition\u5185\u90e8\u6d88\u606f\u662f\u6709\u5e8f\u7684 Leader : \u6bcf\u4e2apartition\u6709\u591a\u4e2a\u526f\u672c\uff0c\u5176\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u4f5c\u4e3aLeader\uff0cLeader\u662f\u8d1f\u8d23\u6570\u636e\u8bfb\u5199\u7684partition\u3002 Follower : Follower\u8ddf\u968fLeader\uff0c\u6240\u6709\u5199\u8bf7\u6c42\u90fd\u901a\u8fc7Leader\u8def\u7531\uff0c\u6570\u636e\u53d8\u66f4\u4f1a\u5e7f\u64ad\u7ed9\u6240\u6709Follower\uff0cFollower\u4e0eLeader\u4fdd\u6301\u6570\u636e\u540c\u6b65\u3002\u5982\u679cLeader\u5931\u6548\uff0c\u5219\u4eceFollower\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684Leader\u3002\u5f53Follower\u4e0eLeader\u6302\u6389\u3001\u5361\u4f4f\u6216\u8005\u540c\u6b65\u592a\u6162\uff0cleader\u4f1a\u628a\u8fd9\u4e2afollower\u4ece ISR\u5217\u8868 \u4e2d\u5220\u9664\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u4e2aFollower\u3002 Offset : \u504f\u79fb\u91cf\u3002kafka\u7684\u5b58\u50a8\u6587\u4ef6\u90fd\u662f\u6309\u7167offset.kafka\u6765\u547d\u540d\uff0c\u7528offset\u505a\u540d\u5b57\u7684\u597d\u5904\u662f\u65b9\u4fbf\u67e5\u627e\u3002\u4f8b\u5982\u4f60\u60f3\u627e\u4f4d\u4e8e2049\u7684\u4f4d\u7f6e\uff0c\u53ea\u8981\u627e\u52302048.kafka\u7684\u6587\u4ef6\u5373\u53ef \u53ef\u4ee5\u8fd9\u4e48\u6765\u7406\u89e3Topic\uff0cPartition\u548cBroker\uff1a \u4e00\u4e2aTopic\uff0c\u4ee3\u8868\u903b\u8f91\u4e0a\u7684\u4e00\u4e2a\u4e1a\u52a1\u6570\u636e\u96c6\uff0c\u6bd4\u5982\u8ba2\u5355\u76f8\u5173\u64cd\u4f5c\u6d88\u606f\u653e\u5165\u8ba2\u5355Topic\uff0c\u7528\u6237\u76f8\u5173\u64cd\u4f5c\u6d88\u606f\u653e\u5165\u7528\u6237Topic\uff0c\u5bf9\u4e8e\u5927\u578b\u7f51\u7ad9\u6765\u8bf4\uff0c\u540e\u7aef\u6570\u636e\u90fd\u662f\u6d77\u91cf\u7684\uff0c\u8ba2\u5355\u6d88\u606f\u5f88\u53ef\u80fd\u662f\u975e\u5e38\u5de8\u91cf\u7684\uff0c\u6bd4\u5982\u6709\u51e0\u767e\u4e2aG\u751a\u81f3\u8fbe\u5230TB\u7ea7\u522b\uff0c\u5982\u679c\u628a\u8fd9\u4e48\u591a\u6570\u636e\u90fd\u653e\u5728\u4e00\u53f0\u673a\u5668\u4e0a\u53ef\u5b9a\u4f1a\u6709\u5bb9\u91cf\u9650\u5236\u95ee\u9898\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728Topic\u5185\u90e8\u5212\u5206\u591a\u4e2aPartition\u6765\u5206\u7247\u5b58\u50a8\u6570\u636e\uff0c\u4e0d\u540c\u7684Partition\u53ef\u4ee5\u4f4d\u4e8e\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u76f8\u5f53\u4e8e \u5206\u5e03\u5f0f\u5b58\u50a8 \u3002\u6bcf\u53f0\u673a\u5668\u4e0a\u90fd\u8fd0\u884c\u4e00\u4e2aKafka\u7684\u8fdb\u7a0bBroker\u3002","title":"Kafka\u7684\u6838\u5fc3\u6982\u5ff5"},{"location":"knowledge/mqvs/#kafkacontroller","text":"\u5728Kafka\u96c6\u7fa4\u4e2d\u4f1a\u6709\u4e00\u4e2a\u6216\u8005\u591a\u4e2abroker\uff0c\u5176\u4e2d\u6709\u4e00\u4e2abroker\u4f1a\u88ab\u9009\u4e3e\u4e3a\u63a7\u5236\u5668\uff08Kafka Controller\uff09\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a Broker-Leader , \u5b83\u8d1f\u8d23\u7ba1\u7406\u6574\u4e2a \u96c6\u7fa4\u4e2d\u6240\u6709\u5206\u533a\u548c\u526f\u672c\u7684\u72b6\u6001\u3002 \u5f53\u67d0\u4e2a Partition-Leader \u526f\u672c\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u7531\u63a7\u5236\u5668\u8d1f\u8d23\u4e3a\u8be5\u5206\u533a\u9009\u4e3e\u65b0\u7684Leader\u526f\u672c\u3002 \u5f53\u68c0\u6d4b\u5230\u67d0\u4e2a\u5206\u533a\u7684ISR\u96c6\u5408\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u7531\u63a7\u5236\u5668\u8d1f\u8d23\u901a\u77e5\u6240\u6709broker\u66f4\u65b0\u5176\u5143\u6570\u636e\u4fe1\u606f\u3002 \u5f53\u4e3a\u67d0\u4e2atopic\u589e\u52a0\u5206\u533a\u6570\u91cf\u65f6\uff0c\u540c\u6837\u8fd8\u662f\u7531\u63a7\u5236\u5668\u8d1f\u8d23\u8ba9\u65b0\u5206\u533a\u88ab\u5176\u4ed6\u8282\u70b9\u611f\u77e5\u5230\u3002","title":"Kafka\u6838\u5fc3\u603b\u63a7\u5236\u5668Controller"},{"location":"knowledge/mqvs/#controller","text":"\u5728kafka\u96c6\u7fa4\u542f\u52a8\u7684\u65f6\u5019\uff0c \u9009\u4e3e\u7684\u8fc7\u7a0b\u662f\u96c6\u7fa4\u4e2d\u6bcf\u4e2abroker\u90fd\u4f1a \u5c1d\u8bd5\u5728zookeeper\u4e0a\u521b\u5efa\u4e00\u4e2a /controller \u4e34\u65f6\u8282\u70b9\uff0czookeeper\u4f1a\u4fdd\u8bc1\u6709\u4e14\u4ec5\u6709\u4e00\u4e2abroker\u80fd\u521b\u5efa\u6210\u529f \uff0c\u8fd9\u4e2abroker \u5c31\u4f1a\u6210\u4e3a\u96c6\u7fa4\u7684\u603b\u63a7\u5668controller\u3002 \u5f53\u8fd9\u4e2acontroller\u89d2\u8272\u7684broker\u5b95\u673a\u4e86\uff0c\u6b64\u65f6zookeeper\u4e34\u65f6\u8282\u70b9\u4f1a\u6d88\u5931\uff0c\u96c6\u7fa4\u91cc\u5176\u4ed6broker\u4f1a\u4e00\u76f4\u76d1\u542c\u8fd9\u4e2a\u4e34\u65f6\u8282 \u70b9\uff0c\u53d1\u73b0\u4e34\u65f6\u8282\u70b9\u6d88\u5931\u4e86\uff0c\u5c31\u7ade\u4e89\u518d\u6b21\u521b\u5efa\u4e34\u65f6\u8282\u70b9\uff0c\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u8bf4\u7684\u9009\u4e3e\u673a\u5236\uff0czookeeper\u53c8\u4f1a\u4fdd\u8bc1\u6709\u4e00\u4e2abroker \u6210\u4e3a\u65b0\u7684controller\u3002 \u5177\u5907\u63a7\u5236\u5668\u8eab\u4efd\u7684broker\u9700\u8981\u6bd4\u5176\u4ed6\u666e\u901a\u7684broker\u591a\u4e00\u4efd\u804c\u8d23\uff0c\u5177\u4f53\u7ec6\u8282\u5982\u4e0b\uff1a \u76d1\u542cbroker\u76f8\u5173\u7684\u53d8\u5316 \u3002\u4e3aZookeeper\u4e2d\u7684/brokers/ids/\u8282\u70b9\u6dfb\u52a0BrokerChangeListener\uff0c\u7528\u6765\u5904\u7406broker \u589e\u51cf\u7684\u53d8\u5316\u3002 \u76d1\u542ctopic\u76f8\u5173\u7684\u53d8\u5316 \u3002\u4e3aZookeeper\u4e2d\u7684/brokers/topics\u8282\u70b9\u6dfb\u52a0TopicChangeListener\uff0c\u7528\u6765\u5904\u7406topic\u589e\u51cf \u7684\u53d8\u5316\uff1b\u4e3aZookeeper\u4e2d\u7684/admin/delete_topics\u8282\u70b9\u6dfb\u52a0TopicDeletionListener\uff0c\u7528\u6765\u5904\u7406\u5220\u9664topic\u7684\u52a8\u4f5c\u3002 \u4eceZookeeper\u4e2d\u8bfb\u53d6\u83b7\u53d6\u5f53\u524d\u6240\u6709\u4e0etopic\u3001partition\u4ee5\u53cabroker\u6709\u5173\u7684\u4fe1\u606f\u5e76\u8fdb\u884c\u76f8\u5e94\u7684\u7ba1\u7406 \u3002\u5bf9\u4e8e\u6240\u6709topic \u6240\u5bf9\u5e94\u7684Zookeeper\u4e2d\u7684/brokers/topics/\u8282\u70b9\u6dfb\u52a0PartitionModificationsListener\uff0c\u7528\u6765\u76d1\u542ctopic\u4e2d\u7684\u5206\u533a\u5206\u914d\u53d8\u5316\u3002 \u66f4\u65b0\u96c6\u7fa4\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u540c\u6b65\u5230\u5176\u4ed6\u666e\u901a\u7684broker\u8282\u70b9\u4e2d","title":"Controller\u9009\u4e3e\u673a\u5236"},{"location":"knowledge/mqvs/#partitionleader","text":"controller\u611f\u77e5\u5230\u5206\u533aLeader\u6240\u5728\u7684broker\u6302\u4e86\uff0ccontroller\u4f1a\u4ece ISR\u5217\u8868(\u53c2\u6570unclean.leader.election.enable=false\u7684\u524d\u63d0\u4e0b)\u91cc\u6311\u7b2c\u4e00\u4e2abroker\u4f5c\u4e3aleader(\u7b2c\u4e00\u4e2abroker\u6700\u5148\u653e\u8fdbISR \u5217\u8868\uff0c\u53ef\u80fd\u662f\u540c\u6b65\u6570\u636e\u6700\u591a\u7684\u526f\u672c)\uff0c\u5982\u679c\u53c2\u6570unclean.leader.election.enable\u4e3atrue\uff0c\u4ee3\u8868\u5728ISR\u5217\u8868\u91cc\u6240\u6709\u526f\u672c\u90fd\u6302 \u4e86\u7684\u65f6\u5019\u53ef\u4ee5\u5728ISR\u5217\u8868\u4ee5\u5916\u7684\u526f\u672c\u4e2d\u9009leader\uff0c\u8fd9\u79cd\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u63d0\u9ad8\u53ef\u7528\u6027\uff0c\u4f46\u662f\u9009\u51fa\u7684\u65b0leader\u6709\u53ef\u80fd\u6570\u636e\u5c11\u5f88\u591a\u3002 \u526f\u672c\u8fdb\u5165ISR\u5217\u8868\u6709\u4e24\u4e2a\u6761\u4ef6\uff1a \u526f\u672c\u8282\u70b9\u4e0d\u80fd\u4ea7\u751f\u5206\u533a\uff0c\u5fc5\u987b\u80fd\u4e0ezookeeper\u4fdd\u6301\u4f1a\u8bdd\u4ee5\u53ca\u8ddfleader\u526f\u672c\u7f51\u7edc\u8fde\u901a \u526f\u672c\u80fd\u590d\u5236leader\u4e0a\u7684\u6240\u6709\u5199\u64cd\u4f5c\uff0c\u5e76\u4e14\u4e0d\u80fd\u843d\u540e\u592a\u591a\u3002(\u4e0eleader\u526f\u672c\u540c\u6b65\u6ede\u540e\u7684\u526f\u672c\uff0c\u662f\u7531 replica.lag.time.max.ms \u914d\u7f6e\u51b3\u5b9a\u7684\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\u90fd\u6ca1\u6709\u8ddfleader\u540c\u6b65\u8fc7\u7684\u4e00\u6b21\u7684\u526f\u672c\u4f1a\u88ab\u79fb\u51faISR\u5217\u8868)","title":"Partition\u526f\u672c\u9009\u4e3eLeader\u673a\u5236"},{"location":"knowledge/mqvs/#offset","text":"\u6bcf\u4e2aconsumer\u4f1a\u5b9a\u671f\u5c06\u81ea\u5df1\u6d88\u8d39\u5206\u533a\u7684offset\u63d0\u4ea4\u7ed9kafka\u5185\u90e8topic\uff1aconsumer_offsets\uff0c\u63d0\u4ea4\u8fc7\u53bb\u7684\u65f6\u5019\uff0ckey\u662f consumerGroupId+topic+\u5206\u533a\u53f7\uff0cvalue\u5c31\u662f\u5f53\u524doffset\u7684\u503c\uff0ckafka\u4f1a\u5b9a\u671f\u6e05\u7406topic\u91cc\u7684\u6d88\u606f\uff0c\u6700\u540e\u5c31\u4fdd\u7559\u6700\u65b0\u7684 \u90a3\u6761\u6570\u636e \u56e0\u4e3a__consumer_offsets\u53ef\u80fd\u4f1a\u63a5\u6536\u9ad8\u5e76\u53d1\u7684\u8bf7\u6c42\uff0ckafka\u9ed8\u8ba4\u7ed9\u5176\u5206\u914d50\u4e2a\u5206\u533a(\u53ef\u4ee5\u901a\u8fc7 offsets.topic.num.partitions\u8bbe\u7f6e)\uff0c\u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u52a0\u673a\u5668\u7684\u65b9\u5f0f\u6297\u5927\u5e76\u53d1\u3002","title":"\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u7684offset\u8bb0\u5f55\u673a\u5236"},{"location":"knowledge/mqvs/#rebalance","text":"rebalance\u5c31\u662f\u8bf4 \u5982\u679c\u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u6570\u91cf\u6709\u53d8\u5316\u6216\u6d88\u8d39\u7684\u5206\u533a\u6570\u6709\u53d8\u5316\uff0ckafka\u4f1a\u91cd\u65b0\u5206\u914d\u6d88\u8d39\u8005\u4e0e\u6d88\u8d39\u5206\u533a\u7684\u5173\u7cfb \u3002 \u6bd4\u5982consumer group\u4e2d\u67d0\u4e2a\u6d88\u8d39\u8005\u6302\u4e86\uff0c\u6b64\u65f6\u4f1a\u81ea\u52a8\u628a\u5206\u914d\u7ed9\u4ed6\u7684\u5206\u533a\u4ea4\u7ed9\u5176\u4ed6\u7684\u6d88\u8d39\u8005\uff0c\u5982\u679c\u4ed6\u53c8\u91cd\u542f\u4e86\uff0c\u90a3\u4e48\u53c8\u4f1a\u628a\u4e00\u4e9b\u5206\u533a\u91cd\u65b0\u4ea4\u8fd8\u7ed9\u4ed6\u3002 \u6ce8\u610f \uff1arebalance\u53ea\u9488\u5bf9subscribe\u8fd9\u79cd\u4e0d\u6307\u5b9a\u5206\u533a\u6d88\u8d39\u7684\u60c5\u51b5\uff0c\u5982\u679c\u901a\u8fc7assign\u8fd9\u79cd\u6d88\u8d39\u65b9\u5f0f\u6307\u5b9a\u4e86\u5206\u533a\uff0ckafka\u4e0d\u4f1a\u8fdb \u884crebanlance\u3002 \u5982\u4e0b\u60c5\u51b5\u53ef\u80fd\u4f1a\u89e6\u53d1\u6d88\u8d39\u8005rebalance: \u6d88\u8d39\u7ec4\u91cc\u7684consumer\u589e\u52a0\u6216\u51cf\u5c11\u4e86 \u52a8\u6001\u7ed9topic\u589e\u52a0\u4e86\u5206\u533a \u6d88\u8d39\u7ec4\u8ba2\u9605\u4e86\u66f4\u591a\u7684topic rebalance\u8fc7\u7a0b\u4e2d\uff0c\u6d88\u8d39\u8005\u65e0\u6cd5\u4ecekafka\u6d88\u8d39\u6d88\u606f\uff0c\u8fd9\u5bf9kafka\u7684TPS\u4f1a\u6709\u5f71\u54cd\uff0c\u5982\u679ckafka\u96c6\u7fa4\u5185\u8282\u70b9\u8f83\u591a\uff0c\u6bd4\u5982\u6570\u767e \u4e2a\uff0c\u90a3\u91cd\u5e73\u8861\u53ef\u80fd\u4f1a\u8017\u65f6\u6781\u591a\uff0c\u6240\u4ee5\u5e94\u5c3d\u91cf\u907f\u514d\u5728\u7cfb\u7edf\u9ad8\u5cf0\u671f\u7684\u91cd\u5e73\u8861\u53d1\u751f\u3002","title":"\u6d88\u8d39\u8005Rebalance\u673a\u5236"},{"location":"knowledge/mqvs/#rebalance_1","text":"\u5f53\u6709\u6d88\u8d39\u8005\u52a0\u5165\u6d88\u8d39\u7ec4\u65f6\uff0c\u6d88\u8d39\u8005\u3001\u6d88\u8d39\u7ec4\u53ca\u7ec4\u534f\u8c03\u5668\u4e4b\u95f4\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u51e0\u4e2a\u9636\u6bb5","title":"Rebalance\u8fc7\u7a0b\u5982\u4e0b"},{"location":"knowledge/mqvs/#_10","text":"\u7ec4\u534f\u8c03\u5668GroupCoordinator\uff1a\u6bcf\u4e2aconsumer group\u90fd\u4f1a\u9009\u62e9\u4e00\u4e2abroker\u4f5c\u4e3a\u81ea\u5df1\u7684\u7ec4\u534f\u8c03\u5668coordinator\uff0c\u8d1f\u8d23\u76d1\u63a7 \u8fd9\u4e2a\u6d88\u8d39\u7ec4\u91cc\u7684\u6240\u6709\u6d88\u8d39\u8005\u7684\u5fc3\u8df3\uff0c\u4ee5\u53ca\u5224\u65ad\u662f\u5426\u5b95\u673a\uff0c\u7136\u540e\u5f00\u542f\u6d88\u8d39\u8005rebalance\u3002 consumer group\u4e2d\u7684\u6bcf\u4e2aconsumer\u542f\u52a8\u65f6\u4f1a\u5411kafka\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e2a\u8282\u70b9\u53d1\u9001 FindCoordinatorRequest \u8bf7\u6c42\u6765\u67e5\u627e\u5bf9 \u5e94\u7684\u7ec4\u534f\u8c03\u5668GroupCoordinator\uff0c\u5e76\u8ddf\u5176\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002 \u7ec4\u534f\u8c03\u5668\u9009\u62e9\u65b9\u5f0f\uff1a \u901a\u8fc7\u5982\u4e0b\u516c\u5f0f\u53ef\u4ee5\u9009\u51faconsumer\u6d88\u8d39\u7684offset\u8981\u63d0\u4ea4\u5230__consumer_offsets\u7684\u54ea\u4e2a\u5206\u533a\uff0c\u8fd9\u4e2a\u5206\u533aleader\u5bf9\u5e94\u7684broker \u5c31\u662f\u8fd9\u4e2aconsumer group\u7684coordinator \u516c\u5f0f\uff1a hash(consumer group id) % \u5bf9\u5e94\u4e3b\u9898\u7684\u5206\u533a\u6570","title":"\u7b2c\u4e00\u9636\u6bb5\uff1a\u9009\u62e9\u7ec4\u534f\u8c03\u5668"},{"location":"knowledge/mqvs/#join-group","text":"\u5728\u6210\u529f\u627e\u5230\u6d88\u8d39\u7ec4\u6240\u5bf9\u5e94\u7684 GroupCoordinator \u4e4b\u540e\u5c31\u8fdb\u5165\u52a0\u5165\u6d88\u8d39\u7ec4\u7684\u9636\u6bb5\uff0c\u5728\u6b64\u9636\u6bb5\u7684\u6d88\u8d39\u8005\u4f1a\u5411 GroupCoordinator \u53d1\u9001 JoinGroupRequest \u8bf7\u6c42\uff0c\u5e76\u5904\u7406\u54cd\u5e94\u3002\u7136\u540eGroupCoordinator \u4ece\u4e00\u4e2aconsumer group\u4e2d \u9009\u62e9\u7b2c\u4e00\u4e2a\u52a0\u5165group\u7684consumer\u4f5c\u4e3aleader(\u6d88\u8d39\u7ec4\u534f\u8c03\u5668)\uff0c\u628aconsumer group\u60c5\u51b5\u53d1\u9001\u7ed9\u8fd9\u4e2aleader\uff0c\u63a5\u7740\u8fd9\u4e2a leader\u4f1a\u8d1f\u8d23\u5236\u5b9a\u5206\u533a\u65b9\u6848\u3002","title":"\u7b2c\u4e8c\u9636\u6bb5\uff1a\u52a0\u5165\u6d88\u8d39\u7ec4JOIN GROUP"},{"location":"knowledge/mqvs/#sync-group","text":"consumer leader\u901a\u8fc7\u7ed9GroupCoordinator\u53d1\u9001SyncGroupRequest\uff0c\u63a5\u7740GroupCoordinator\u5c31\u628a\u5206\u533a\u65b9\u6848\u4e0b\u53d1\u7ed9\u5404 \u4e2aconsumer\uff0c\u4ed6\u4eec\u4f1a\u6839\u636e\u6307\u5b9a\u5206\u533a\u7684leader broker\u8fdb\u884c\u7f51\u7edc\u8fde\u63a5\u4ee5\u53ca\u6d88\u606f\u6d88\u8d39\u3002","title":"\u7b2c\u4e09\u9636\u6bb5\uff08 SYNC GROUP)"},{"location":"knowledge/mqvs/#rebalance_2","text":"\u4e3b\u8981\u6709\u4e09\u79cdrebalance\u7684\u7b56\u7565\uff1a range \u3001 round-robin \u3001 sticky \u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e3arange\u5206\u914d\u7b56\u7565 \u3002 \u5047\u8bbe\u4e00\u4e2a\u4e3b\u9898\u670910\u4e2a\u5206\u533a(0-9)\uff0c\u73b0\u5728\u6709\u4e09\u4e2aconsumer\u6d88\u8d39\uff1a range\u7b56\u7565 \uff1a \u6309\u7167\u5206\u533a\u5e8f\u53f7\u6392\u5e8f\u5206\u914d \uff0c\u5047\u8bbe n\uff1d\u5206\u533a\u6570\uff0f\u6d88\u8d39\u8005\u6570\u91cf = 3\uff0c m\uff1d\u5206\u533a\u6570%\u6d88\u8d39\u8005\u6570\u91cf = 1\uff0c\u90a3\u4e48\u524d m \u4e2a\u6d88 \u8d39\u8005\u6bcf\u4e2a\u5206\u914d n+1 \u4e2a\u5206\u533a\uff0c\u540e\u9762\u7684\uff08\u6d88\u8d39\u8005\u6570\u91cf\uff0dm \uff09\u4e2a\u6d88\u8d39\u8005\u6bcf\u4e2a\u5206\u914d n \u4e2a\u5206\u533a\u3002 \u6bd4\u5982\u5206\u533a0~ 3\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a4~ 6\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a7~9\u7ed9\u4e00\u4e2aconsumer\u3002 round-robin\u7b56\u7565 \uff1a \u8f6e\u8be2\u5206\u914d \uff0c\u6bd4\u5982\u5206\u533a0\u30013\u30016\u30019\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a1\u30014\u30017\u7ed9\u4e00\u4e2aconsumer\uff0c\u5206\u533a2\u30015\u3001 8\u7ed9\u4e00\u4e2aconsumer sticky\u7b56\u7565 \uff1a \u521d\u59cb\u65f6\u5206\u914d\u7b56\u7565\u4e0eround-robin\u7c7b\u4f3c\uff0c\u4f46\u662f\u5728rebalance\u7684\u65f6\u5019\uff0c\u9700\u8981\u4fdd\u8bc1\u5982\u4e0b\u4e24\u4e2a\u539f\u5219\u3002 \u5206\u533a\u7684\u5206\u914d\u8981\u5c3d\u53ef\u80fd\u5747\u5300 \u3002 \u5206\u533a\u7684\u5206\u914d\u5c3d\u53ef\u80fd\u4e0e\u4e0a\u6b21\u5206\u914d\u7684\u4fdd\u6301\u76f8\u540c\u3002 \u5f53\u4e24\u8005\u53d1\u751f\u51b2\u7a81\u65f6\uff0c \u7b2c\u4e00\u4e2a\u76ee\u6807\u4f18\u5148\u4e8e\u7b2c\u4e8c\u4e2a\u76ee \u6807 \u3002\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u7ef4\u6301\u539f\u6765\u7684\u5206\u533a\u5206\u914d\u7684\u7b56\u7565\u3002 \u6bd4\u5982\u5bf9\u4e8e\u7b2c\u4e00\u79cdrange\u60c5\u51b5\u7684\u5206\u914d\uff0c\u5982\u679c\u7b2c\u4e09\u4e2aconsumer\u6302\u4e86\uff0c\u90a3\u4e48\u91cd\u65b0\u7528sticky\u7b56\u7565\u5206\u914d\u7684\u7ed3\u679c\u5982\u4e0b\uff1a consumer1\u9664\u4e86\u539f\u6709\u76840~ 3\uff0c\u4f1a\u518d\u5206\u914d\u4e00\u4e2a7 consumer2\u9664\u4e86\u539f\u6709\u76844~ 6\uff0c\u4f1a\u518d\u5206\u914d8\u548c9","title":"\u6d88\u8d39\u8005Rebalance\u5206\u533a\u5206\u914d\u7b56\u7565"},{"location":"knowledge/mqvs/#producer_1","text":"\u5199\u5165\u65b9\u5f0f producer \u91c7\u7528 push \u6a21\u5f0f\u5c06\u6d88\u606f\u53d1\u5e03\u5230 broker\uff0c\u6bcf\u6761\u6d88\u606f\u90fd\u88ab append \u5230 patition \u4e2d\uff0c\u5c5e\u4e8e\u987a\u5e8f\u5199\u78c1\u76d8\uff08 \u987a\u5e8f\u5199\u78c1\u76d8 \u6bd4 \u968f\u673a\u5199 \u6548\u7387\u8981\u9ad8\uff0c\u4fdd\u969c kafka \u541e\u5410\u7387 \uff09\u3002 \u6d88\u606f\u8def\u7531 producer \u53d1\u9001\u6d88\u606f\u5230 broker \u65f6\uff0c\u4f1a\u6839\u636e\u5206\u533a\u7b97\u6cd5\u9009\u62e9\u5c06\u5176\u5b58\u50a8\u5230\u54ea\u4e00\u4e2a partition\u3002\u5176\u8def\u7531\u673a\u5236\u4e3a\uff1a \u6307\u5b9a\u4e86 patition\uff0c\u5219\u76f4\u63a5\u4f7f\u7528\uff1b \u672a\u6307\u5b9a patition \u4f46\u6307\u5b9a key\uff0c\u901a\u8fc7 hash(key)%\u5206\u533a\u6570 \u7b97\u51fa\u8def\u7531\u7684patition, \u5982\u679cpatition \u548c key \u90fd\u672a\u6307\u5b9a\uff0c\u4f7f\u7528\u8f6e\u8be2\u9009\u51fa\u4e00\u4e2apatition\u3002 \u5199\u5165\u6d41\u7a0b producer \u5148\u4ece zookeeper \u7684 \"/brokers/.../state\" \u8282\u70b9\u627e\u5230\u8be5 partition \u7684 leader producer \u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u8be5 leader leader \u5c06\u6d88\u606f\u5199\u5165\u672c\u5730 log followers \u4ece leader pull \u6d88\u606f\uff0c\u5199\u5165\u672c\u5730 log \u540e \u5411leader \u53d1\u9001 ACK leader \u6536\u5230\u6240\u6709 ISR \u4e2d\u7684 replica \u7684 ACK \u540e\uff0c\u589e\u52a0 HW\uff08high watermark\uff0c\u6700\u540e commit \u7684 offset\uff09 \u5e76\u5411 producer \u53d1\u9001 ACK","title":"producer\u53d1\u5e03\u6d88\u606f\u673a\u5236\u5256\u6790"},{"location":"knowledge/mqvs/#hwleo","text":"HW\u4fd7\u79f0\u9ad8\u6c34\u4f4d \uff0cHighWatermark\u7684\u7f29\u5199\uff0c\u53d6\u4e00\u4e2apartition\u5bf9\u5e94\u7684ISR\u4e2d\u6700\u5c0f\u7684LEO(log-end-offset)\u4f5c\u4e3aHW\uff0c consumer\u6700\u591a\u53ea\u80fd\u6d88\u8d39\u5230HW\u6240\u5728\u7684\u4f4d\u7f6e\u3002\u53e6\u5916\u6bcf\u4e2areplica\u90fd\u6709HW,leader\u548cfollower\u5404\u81ea\u8d1f\u8d23\u66f4\u65b0\u81ea\u5df1\u7684HW\u7684\u72b6 \u6001\u3002 \u5bf9\u4e8eleader\u65b0\u5199\u5165\u7684\u6d88\u606f\uff0cconsumer\u4e0d\u80fd\u7acb\u523b\u6d88\u8d39\uff0cleader\u4f1a\u7b49\u5f85\u8be5\u6d88\u606f\u88ab\u6240\u6709ISR\u4e2d\u7684replicas\u540c\u6b65\u540e\u66f4\u65b0HW\uff0c \u6b64\u65f6\u6d88\u606f\u624d\u80fd\u88abconsumer\u6d88\u8d39 \u3002 \u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5982\u679cleader\u6240\u5728\u7684broker\u5931\u6548\uff0c\u8be5\u6d88\u606f\u4ecd\u7136\u53ef\u4ee5\u4ece\u65b0\u9009\u4e3e\u7684leader\u4e2d\u83b7\u53d6\u3002\u5bf9\u4e8e\u6765\u81ea\u5185\u90e8broker\u7684\u8bfb\u53d6\u8bf7\u6c42\uff0c\u6ca1\u6709HW\u7684\u9650\u5236\u3002","title":"HW\u4e0eLEO"},{"location":"knowledge/mqvs/#_11","text":"Kafka \u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\u6570\u636e\u5bf9\u5e94\u5b58\u50a8\u5728\u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff0c\u4ee5topic\u540d\u79f0+\u5206\u533a\u53f7\u547d\u540d\uff0c\u6d88\u606f\u5728\u5206\u533a\u5185\u662f\u5206\u6bb5\u5b58\u50a8\u7684\uff0c \u6bcf\u4e2a\u6bb5\u7684\u6d88\u606f\u90fd\u5b58\u50a8\u5728\u4e0d\u4e00\u6837\u7684log\u6587\u4ef6\u91cc\uff0ckafka\u89c4\u5b9a\u4e86\u4e00\u4e2a\u6bb5\u4f4d\u7684 log \u6587 \u4ef6\u6700\u5927\u4e3a 1G\uff0c\u505a\u8fd9\u4e2a\u9650\u5236\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u628a log \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u53bb\u64cd\u4f5c\uff1a 1 # \u90e8\u5206\u6d88\u606f\u7684offset\u7d22\u5f15\u6587\u4ef6\uff0ckafka\u6bcf\u6b21\u5f80\u5206\u533a\u53d14K(\u53ef\u914d\u7f6e)\u6d88\u606f\u5c31\u4f1a\u8bb0\u5f55\u4e00\u6761\u5f53\u524d\u6d88\u606f\u7684offset\u5230index\u6587\u4ef6\uff0c 2 # \u5982\u679c\u8981\u5b9a\u4f4d\u6d88\u606f\u7684offset\u4f1a\u5148\u5728\u8fd9\u4e2a\u6587\u4ef6\u91cc\u5feb\u901f\u5b9a\u4f4d\uff0c\u518d\u53bblog\u6587\u4ef6\u91cc\u627e\u5177\u4f53\u6d88\u606f 3 00000000000000000000.index 4 # \u6d88\u606f\u5b58\u50a8\u6587\u4ef6\uff0c\u4e3b\u8981\u5b58offset\u548c\u6d88\u606f\u4f53 5 00000000000000000000.log 6 # \u6d88\u606f\u7684\u53d1\u9001\u65f6\u95f4\u7d22\u5f15\u6587\u4ef6\uff0ckafka\u6bcf\u6b21\u5f80\u5206\u533a\u53d14K(\u53ef\u914d\u7f6e)\u6d88\u606f\u5c31\u4f1a\u8bb0\u5f55\u4e00\u6761\u5f53\u524d\u6d88\u606f\u7684\u53d1\u9001\u65f6\u95f4\u6233\u4e0e\u5bf9\u5e94\u7684offset\u5230timeindex\u6587\u4ef6\uff0c 7 # \u5982\u679c\u9700\u8981\u6309\u7167\u65f6\u95f4\u6765\u5b9a\u4f4d\u6d88\u606f\u7684offset\uff0c\u4f1a\u5148\u5728\u8fd9\u4e2a\u6587\u4ef6\u91cc\u67e5\u627e 8 00000000000000000000.timeindex 9 10 00000000000005367851.index 11 00000000000005367851.log 12 00000000000005367851.timeindex 13 14 00000000000009936472.index 15 00000000000009936472.log 16 00000000000009936472.timeindex \u590d\u5236\u4ee3\u7801 \u8fd9\u4e2a 9936472 \u4e4b\u7c7b\u7684\u6570\u5b57\uff0c\u5c31\u662f\u4ee3\u8868\u4e86\u8fd9\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\u91cc\u5305\u542b\u7684\u8d77\u59cb Offset\uff0c\u4e5f\u5c31\u8bf4\u660e\u8fd9\u4e2a\u5206\u533a\u91cc\u81f3\u5c11\u90fd\u5199\u5165\u4e86\u63a5\u8fd1 1000 \u4e07\u6761\u6570\u636e\u4e86\u3002 Kafka Broker \u6709\u4e00\u4e2a\u53c2\u6570\uff0clog.segment.bytes\uff0c\u9650\u5b9a\u4e86\u6bcf\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u6700\u5927\u5c31\u662f 1GB\u3002 \u4e00\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\u6ee1\u4e86\uff0c\u5c31\u81ea\u52a8\u5f00\u4e00\u4e2a\u65b0\u7684\u65e5\u5fd7\u6bb5\u6587\u4ef6\u6765\u5199\u5165\uff0c\u907f\u514d\u5355\u4e2a\u6587\u4ef6\u8fc7\u5927\uff0c\u5f71\u54cd\u6587\u4ef6\u7684\u8bfb\u5199\u6027\u80fd\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a log rolling\uff0c\u6b63\u5728\u88ab\u5199\u5165\u7684\u90a3\u4e2a\u65e5\u5fd7\u6bb5\u6587\u4ef6\uff0c\u53eb\u505a active log segment\u3002","title":"\u65e5\u5fd7\u5206\u6bb5\u5b58\u50a8"},{"location":"knowledge/mqvs/#zookeeper","text":"","title":"\u6700\u540e\u9644\u4e00\u5f20zookeeper\u8282\u70b9\u6570\u636e\u56fe"},{"location":"knowledge/mqvs/#mq_1","text":"","title":"MQ\u5e26\u6765\u7684\u4e00\u4e9b\u95ee\u9898\u3001\u53ca\u89e3\u51b3\u65b9\u6848"},{"location":"knowledge/mqvs/#1","text":"RabbitMQ : \u4e00\u4e2aQueue\u5bf9\u5e94\u4e00\u4e2aConsumer\u5373\u53ef\u89e3\u51b3\u3002 RocketMQ \u5168\u5c40\u6709\u5e8f\uff1aTopic\u91cc\u9762\u53ea\u6709\u4e00\u4e2aMessageQueue\u5373\u53ef\u3002 \u5c40\u90e8\u6709\u5e8f: \u6839\u636e\u8def\u7531\u7b97\u6cd5\uff0c\u6bd4\u5982 hash(key)%\u961f\u5217\u6570 \u5f97\u5230\u8def\u7531\u7d22\u5f15\uff0c\u4f7f\u5f97\u9700\u8981\u4fdd\u8bc1\u6709\u5e8f\u7684\u6d88\u606f\u90fd\u8def\u7531\u5230\u540c\u4e00\u4e2aMessageQueue\u3002 Kafka : \u5168\u5c40\u6709\u5e8f\uff1aTopic\u91cc\u9762\u53ea\u6709\u4e00\u4e2aPartition\u5373\u53ef\u3002 \u5c40\u90e8\u6709\u5e8f: \u6839\u636e\u8def\u7531\u7b97\u6cd5\uff0c\u6bd4\u5982 hash(key)%\u5206\u533a\u6570 \u5f97\u5230\u8def\u7531\u7d22\u5f15\uff0c\u4f7f\u5f97\u9700\u8981\u4fdd\u8bc1\u6709\u5e8f\u7684\u6d88\u606f\u90fd\u8def\u7531\u5230\u540c\u4e00\u4e2aPartition\u3002","title":"1. \u5982\u4f55\u4fdd\u8bc1\u987a\u5e8f\u6d88\u8d39\uff1f"},{"location":"knowledge/mqvs/#2","text":"RabbitMQ : \u4e24\u79cd\u65b9\u6848 \u6b7b\u4fe1\u961f\u5217 + TTL \u5f15\u5165RabbitMQ\u7684\u5ef6\u8fdf\u63d2\u4ef6 RocketMQ \uff1a\u5929\u751f\u652f\u6301\u5ef6\u65f6\u6d88\u606f\u3002 Kafka : \u6b65\u9aa4\u5982\u4e0b \u4e13\u95e8\u4e3a\u8981\u5ef6\u8fdf\u7684\u6d88\u606f\u521b\u5efa\u4e00\u4e2aTopic \u65b0\u5efa\u4e00\u4e2a\u6d88\u8d39\u8005\u53bb\u6d88\u8d39\u8fd9\u4e2aTopic \u6d88\u606f\u6301\u4e45\u5316 \u518d\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u5b9a\u65f6\u53bb\u62c9\u53d6\u6301\u4e45\u5316\u7684\u6d88\u606f\uff0c\u653e\u5165\u5b9e\u9645\u8981\u6d88\u8d39\u7684Topic \u5b9e\u9645\u6d88\u8d39\u7684\u6d88\u8d39\u8005\u4ece\u5b9e\u9645\u8981\u6d88\u8d39\u7684Topic\u62c9\u53d6\u6d88\u606f\u3002","title":"2. \u5982\u4f55\u5b9e\u73b0\u5ef6\u8fdf\u6d88\u8d39\uff1f"},{"location":"knowledge/mqvs/#3","text":"RabbitMQ : Broker-->\u6d88\u8d39\u8005 : \u624b\u52a8ACK \u751f\u4ea7\u8005-->Broker: \u4e24\u79cd\u65b9\u6848 1. \u6570\u636e\u5e93\u6301\u4e45\u5316 js 1.\u5c06\u4e1a\u52a1\u8ba2\u5355\u6570\u636e\u548c\u751f\u6210\u7684Message\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\u63d2\u5165\u6570\u636e\u5e93\uff0c\u8fd9\u91cc\u5982\u679c\u5206\u5e93\u7684\u8bdd\u53ef\u80fd\u6d89\u53ca\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\uff09 2.\u5c06Message\u53d1\u9001\u5230Broker\u670d\u52a1\u5668\u4e2d 3.\u901a\u8fc7RabbitMQ\u7684Confirm\u673a\u5236\uff0c\u5728producer\u7aef\uff0c\u76d1\u542c\u670d\u52a1\u5668\u662f\u5426ACK\u3002 4.\u5982\u679cACK\u4e86\uff0c\u5c31\u5c06Message\u8fd9\u6761\u6570\u636e\u72b6\u6001\u66f4\u65b0\u4e3a\u5df2\u53d1\u9001\u3002\u5982\u679c\u5931\u8d25\uff0c\u4fee\u6539\u4e3a\u5931\u8d25\u72b6\u6001\u3002 5.\u5206\u5e03\u5f0f\u5b9a\u65f6\u4efb\u52a1\u67e5\u8be2\u6570\u636e\u5e933\u5206\u949f\uff08\u8fd9\u4e2a\u5177\u4f53\u65f6\u95f4\u5e94\u8be5\u6839\u636e\u7684\u65f6\u6548\u6027\u6765\u5b9a\uff09\u4e4b\u524d\u7684\u53d1\u9001\u5931\u8d25\u7684\u6d88\u606f 6.\u91cd\u65b0\u53d1\u9001\u6d88\u606f\uff0c\u8bb0\u5f55\u53d1\u9001\u6b21\u6570 7.\u5982\u679c\u53d1\u9001\u6b21\u6570\u8fc7\u591a\u4ecd\u7136\u5931\u8d25\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4eba\u5de5\u6392\u67e5\u4e4b\u7c7b\u7684\u64cd\u4f5c\u3002 \u590d\u5236\u4ee3\u7801 \u4f18\u70b9 \uff1a\u80fd\u591f\u4fdd\u8bc1\u6d88\u606f\u767e\u5206\u767e\u4e0d\u4e22\u5931\u3002 \u7f3a\u70b9 \uff1a\u7b2c\u4e00\u6b65\u4f1a\u6d89\u53ca\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\u3002 2. \u6d88\u606f\u7684\u5ef6\u8fdf\u6295\u9012 js \u6d41\u7a0b\u56fe\u4e2d\uff0c\u989c\u8272\u4e0d\u540c\u7684\u4ee3\u8868\u4e0d\u540c\u7684message 1.\u5c06\u4e1a\u52a1\u8ba2\u5355\u6301\u4e45\u5316 2.\u53d1\u9001\u4e00\u6761Message\u5230broker(\u79f0\u4e4b\u4e3a\u4e3bMessage)\uff0c\u518d\u53d1\u9001\u76f8\u540c\u7684\u4e00\u6761\u5230\u4e0d\u540c\u7684\u961f\u5217\u6216\u8005\u4ea4\u6362\u673a(\u8fd9\u6761\u79f0\u4e3a\u786e\u8ba4Message)\u4e2d\u3002 3.\u4e3bMessage\u7531\u5b9e\u9645\u4e1a\u52a1\u5904\u7406\u7aef\u6d88\u8d39\u540e\uff0c\u751f\u6210\u4e00\u6761\u54cd\u5e94Message\u3002\u4e4b\u524d\u7684\u786e\u8ba4Message\u7531Message Service\u5e94\u7528\u5904\u7406\u5165\u5e93\u3002 4~6.\u5b9e\u9645\u4e1a\u52a1\u5904\u7406\u7aef\u53d1\u9001\u7684\u786e\u8ba4Message\u7531Message Service\u63a5\u6536\u540e\uff0c\u5c06\u539fMessage\u72b6\u6001\u4fee\u6539\u3002 7.\u5982\u679c\u8be5\u6761Message\u6ca1\u6709\u88ab\u786e\u8ba4\uff0c\u5219\u901a\u8fc7rpc\u8c03\u7528\u91cd\u65b0\u7531producer\u8fdb\u884c\u5168\u8fc7\u7a0b\u3002 \u590d\u5236\u4ee3\u7801 \u4f18\u70b9 \uff1a\u76f8\u5bf9\u4e8e\u6301\u4e45\u5316\u65b9\u6848\u6765\u8bf4\u54cd\u5e94\u901f\u5ea6\u6709\u6240\u63d0\u5347 \u7f3a\u70b9 \uff1a\u7cfb\u7edf\u590d\u6742\u6027\u6709\u70b9\u9ad8\uff0c\u4e07\u4e00\u4e24\u6761\u6d88\u606f\u90fd\u5931\u8d25\u4e86\uff0c\u6d88\u606f\u5b58\u5728\u4e22\u5931\u60c5\u51b5\uff0c\u4ecd\u9700Confirm\u673a\u5236\u505a\u8865\u507f\u3002 RocketMQ \uff1a \u751f\u4ea7\u8005\u5f04\u4e22\u6570\u636e Producer\u5728\u628aMessage\u53d1\u9001Broker\u7684\u8fc7\u7a0b\u4e2d\uff0c\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\u7b49\u53d1\u751f\u4e22\u5931\uff0c\u6216\u8005Message\u5230\u4e86Broker\uff0c\u4f46\u662f\u51fa\u4e86\u95ee\u9898\uff0c\u6ca1\u6709\u4fdd\u5b58\u4e0b\u6765\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0cRocketMQ\u5bf9Producer\u53d1\u9001\u6d88\u606f\u8bbe\u7f6e\u4e863\u79cd\u65b9\u5f0f\uff1a \u540c\u6b65\u53d1\u9001 \uff1a\u5929\u751f\u4fdd\u8bc1\u4e86\u53ef\u9760\u6027\u6295\u9012 \u5f02\u6b65\u53d1\u9001 \uff1a\u9700\u8981\u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u6839\u636ebroker\u54cd\u5e94\u7684\u7ed3\u679c\u81ea\u5b9a\u4e49\u5b9e\u73b0\u3002 \u5355\u5411\u53d1\u9001 \uff1a\u4fdd\u8bc1\u4e0d\u4e86\u53ef\u9760\u6027\u6295\u9012 Broker\u5f04\u4e22\u6570\u636e Broker\u63a5\u6536\u5230Message\u6682\u5b58\u5230\u5185\u5b58\uff0cConsumer\u8fd8\u6ca1\u6765\u5f97\u53ca\u6d88\u8d39\uff0cBroker\u6302\u6389\u4e86 \u53ef\u4ee5\u901a\u8fc7 \u6301\u4e45\u5316 \u8bbe\u7f6e\u53bb\u89e3\u51b3\uff1a 1. \u521b\u5efaQueue\u7684\u65f6\u5019\u8bbe\u7f6e\u6301\u4e45\u5316\uff0c\u4fdd\u8bc1Broker\u6301\u4e45\u5316Queue\u7684\u5143\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u4f1a\u6301\u4e45\u5316Queue\u91cc\u9762\u7684\u6d88\u606f 2. \u5c06Message\u7684deliveryMode\u8bbe\u7f6e\u4e3a2\uff0c\u53ef\u4ee5\u5c06\u6d88\u606f\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u53ea\u6709Message\u652f\u6301\u5316\u5230\u78c1\u76d8\u4e4b\u540e\u624d\u4f1a\u53d1\u9001\u901a\u77e5Producer ack \u8fd9\u4e24\u6b65\u8fc7\u540e\uff0c\u5373\u4f7fBroker\u6302\u4e86\uff0cProducer\u80af\u5b9a\u6536\u4e0d\u5230ack\u7684\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u91cd\u53d1 \u6d88\u8d39\u8005\u5f04\u4e22\u6570\u636e Consumer\u6709\u6d88\u8d39\u5230Message\uff0c\u4f46\u662f\u5185\u90e8\u51fa\u73b0\u95ee\u9898\uff0cMessage\u8fd8\u6ca1\u5904\u7406\uff0cBroker\u4ee5\u4e3aConsumer\u5904\u7406\u5b8c\u4e86\uff0c\u53ea\u4f1a\u628a\u540e\u7eed\u7684\u6d88\u606f\u53d1\u9001\u3002\u8fd9\u65f6\u5019\uff0c\u5c31\u8981 \u5173\u95edautoack\uff0c\u6d88\u606f\u5904\u7406\u8fc7\u540e\uff0c\u8fdb\u884c\u624b\u52a8ack , \u591a\u6b21\u6d88\u8d39\u5931\u8d25\u7684\u6d88\u606f\uff0c\u4f1a\u8fdb\u5165 \u6b7b\u4fe1\u961f\u5217 \uff0c\u8fd9\u65f6\u5019\u9700\u8981\u4eba\u5de5\u5e72\u9884\u3002 Kafka : \u751f\u4ea7\u8005\u5f04\u4e22\u6570\u636e \u8bbe\u7f6e\u4e86 acks=all \uff0c\u4e00\u5b9a\u4e0d\u4f1a\u4e22\uff0c\u8981\u6c42\u662f\uff0c\u4f60\u7684 leader \u63a5\u6536\u5230\u6d88\u606f\uff0c\u6240\u6709\u7684 follower \u90fd\u540c\u6b65\u5230\u4e86\u6d88\u606f\u4e4b\u540e\uff0c\u624d\u8ba4\u4e3a\u672c\u6b21\u5199\u6210\u529f\u4e86\u3002\u5982\u679c\u6ca1\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\uff0c\u751f\u4ea7\u8005\u4f1a\u81ea\u52a8\u4e0d\u65ad\u7684\u91cd\u8bd5\uff0c\u91cd\u8bd5\u65e0\u9650\u6b21\u3002 Broker\u5f04\u4e22\u6570\u636e Kafka \u67d0\u4e2a broker \u5b95\u673a\uff0c\u7136\u540e\u91cd\u65b0\u9009\u4e3e partition \u7684 leader\u3002\u5927\u5bb6\u60f3\u60f3\uff0c\u8981\u662f\u6b64\u65f6\u5176\u4ed6\u7684 follower \u521a\u597d\u8fd8\u6709\u4e9b\u6570\u636e\u6ca1\u6709\u540c\u6b65\uff0c\u7ed3\u679c\u6b64\u65f6 leader \u6302\u4e86\uff0c\u7136\u540e\u9009\u4e3e\u67d0\u4e2a follower \u6210 leader \u4e4b\u540e\uff0c\u4e0d\u5c31\u5c11\u4e86\u4e00\u4e9b\u6570\u636e\uff1f\u8fd9\u5c31\u4e22\u4e86\u4e00\u4e9b\u6570\u636e\u554a\u3002 \u6b64\u65f6\u4e00\u822c\u662f\u8981\u6c42\u8d77\u7801\u8bbe\u7f6e\u5982\u4e0b 4 \u4e2a\u53c2\u6570\uff1a \u7ed9 topic \u8bbe\u7f6e replication.factor \u53c2\u6570\uff1a\u8fd9\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e 1\uff0c\u8981\u6c42\u6bcf\u4e2a partition \u5fc5\u987b\u6709\u81f3\u5c11 2 \u4e2a\u526f\u672c\u3002 \u5728 Kafka \u670d\u52a1\u7aef\u8bbe\u7f6e min.insync.replicas \u53c2\u6570\uff1a\u8fd9\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e 1\uff0c\u8fd9\u4e2a\u662f\u8981\u6c42\u4e00\u4e2a leader \u81f3\u5c11\u611f\u77e5\u5230\u6709\u81f3\u5c11\u4e00\u4e2a follower \u8fd8\u8ddf\u81ea\u5df1\u4fdd\u6301\u8054\u7cfb\uff0c\u6ca1\u6389\u961f\uff0c\u8fd9\u6837\u624d\u80fd\u786e\u4fdd leader \u6302\u4e86\u8fd8\u6709\u4e00\u4e2a follower \u5427\u3002 \u5728 producer \u7aef\u8bbe\u7f6e acks=all \uff1a\u8fd9\u4e2a\u662f\u8981\u6c42\u6bcf\u6761\u6570\u636e\uff0c\u5fc5\u987b\u662f\u5199\u5165\u6240\u6709 replica \u4e4b\u540e\uff0c\u624d\u80fd\u8ba4\u4e3a\u662f\u5199\u6210\u529f\u4e86\u3002 \u5728 producer \u7aef\u8bbe\u7f6e retries=MAX \uff08\u5f88\u5927\u5f88\u5927\u5f88\u5927\u7684\u4e00\u4e2a\u503c\uff0c\u65e0\u9650\u6b21\u91cd\u8bd5\u7684\u610f\u601d\uff09\uff1a\u8fd9\u4e2a\u662f\u8981\u6c42\u4e00\u65e6\u5199\u5165\u5931\u8d25\uff0c\u5c31\u65e0\u9650\u91cd\u8bd5\uff0c\u5361\u5728\u8fd9\u91cc\u4e86\u3002 \u6211\u4eec\u751f\u4ea7\u73af\u5883\u5c31\u662f\u6309\u7167\u4e0a\u8ff0\u8981\u6c42\u914d\u7f6e\u7684\uff0c\u8fd9\u6837\u914d\u7f6e\u4e4b\u540e\uff0c\u81f3\u5c11\u5728 Kafka broker \u7aef\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5728 leader \u6240\u5728 broker \u53d1\u751f\u6545\u969c\uff0c\u8fdb\u884c leader \u5207\u6362\u65f6\uff0c\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002 \u6d88\u8d39\u8005\u5f04\u4e22\u6570\u636e \u4f60\u6d88\u8d39\u5230\u4e86\u8fd9\u4e2a\u6d88\u606f\uff0c\u7136\u540e\u6d88\u8d39\u8005\u90a3\u8fb9\u81ea\u52a8\u63d0\u4ea4\u4e86 offset\uff0c\u8ba9 Kafka \u4ee5\u4e3a\u4f60\u5df2\u7ecf\u6d88\u8d39\u597d\u4e86\u8fd9\u4e2a\u6d88\u606f\uff0c\u4f46\u5176\u5b9e\u4f60\u624d\u521a\u51c6\u5907\u5904\u7406\u8fd9\u4e2a\u6d88\u606f\uff0c\u4f60\u8fd8\u6ca1\u5904\u7406\uff0c\u4f60\u81ea\u5df1\u5c31\u6302\u4e86\uff0c\u6b64\u65f6\u8fd9\u6761\u6d88\u606f\u5c31\u4e22\u54af\u3002 \u8fd9\u4e0d\u662f\u8ddf RabbitMQ \u5dee\u4e0d\u591a\u5417\uff0c\u5927\u5bb6\u90fd\u77e5\u9053 Kafka \u4f1a\u81ea\u52a8\u63d0\u4ea4 offset\uff0c\u90a3\u4e48\u53ea\u8981 \u5173\u95ed\u81ea\u52a8\u63d0\u4ea4 offset\uff0c\u5728\u5904\u7406\u5b8c\u4e4b\u540e\u81ea\u5df1\u624b\u52a8\u63d0\u4ea4 offset\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u4e22\u3002 \u4f46\u662f\u6b64\u65f6\u786e\u5b9e\u8fd8\u662f\u53ef\u80fd\u4f1a\u6709\u91cd\u590d\u6d88\u8d39\uff0c\u6bd4\u5982\u4f60\u521a\u5904\u7406\u5b8c\uff0c\u8fd8\u6ca1\u63d0\u4ea4 offset\uff0c\u7ed3\u679c\u81ea\u5df1\u6302\u4e86\uff0c\u6b64\u65f6\u80af\u5b9a\u4f1a\u91cd\u590d\u6d88\u8d39\u4e00\u6b21\uff0c\u81ea\u5df1\u4fdd\u8bc1\u5e42\u7b49\u6027\u5c31\u597d\u4e86\u3002","title":"3. \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u7684\u53ef\u9760\u6027\u6295\u9012"},{"location":"knowledge/mqvs/#4","text":"\u4ee5 RocketMQ \u4e3a\u4f8b\uff0c\u4e0b\u9762\u5217\u51fa\u4e86\u6d88\u606f\u91cd\u590d\u7684\u573a\u666f\uff1a 1.\u53d1\u9001\u65f6\u6d88\u606f\u91cd\u590d \u5f53\u4e00\u6761\u6d88\u606f\u5df2\u88ab\u6210\u529f\u53d1\u9001\u5230\u670d\u52a1\u7aef\u5e76\u5b8c\u6210\u6301\u4e45\u5316\uff0c\u6b64\u65f6\u51fa\u73b0\u4e86\u7f51\u7edc\u95ea\u65ad\u6216\u8005\u5ba2\u6237\u7aef\u5b95\u673a\uff0c\u5bfc\u81f4\u670d\u52a1\u7aef\u5bf9\u5ba2\u6237\u7aef\u5e94\u7b54\u5931\u8d25\u3002\u5982\u679c\u6b64\u65f6\u751f\u4ea7\u8005\u610f\u8bc6\u5230\u6d88\u606f\u53d1\u9001\u5931\u8d25\u5e76\u5c1d\u8bd5\u518d\u6b21\u53d1\u9001\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u540e\u7eed\u4f1a\u6536\u5230\u4e24\u6761\u5185\u5bb9\u76f8\u540c\u5e76\u4e14Message ID\u4e5f\u76f8\u540c\u7684\u6d88\u606f\u3002 2.\u6295\u9012\u65f6\u6d88\u606f\u91cd\u590d \u6d88\u606f\u6d88\u8d39\u7684\u573a\u666f\u4e0b\uff0c\u6d88\u606f\u5df2\u6295\u9012\u5230\u6d88\u8d39\u8005\u5e76\u5b8c\u6210\u4e1a\u52a1\u5904\u7406\uff0c\u5f53\u5ba2\u6237\u7aef\u7ed9\u670d\u52a1\u7aef\u53cd\u9988\u5e94\u7b54\u7684\u65f6\u5019\u7f51\u7edc\u95ea\u65ad\u3002\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u81f3\u5c11\u88ab\u6d88\u8d39\u4e00\u6b21\uff0c\u6d88\u606f\u961f\u5217RocketMQ\u7248\u7684\u670d\u52a1\u7aef\u5c06\u5728\u7f51\u7edc\u6062\u590d\u540e\u518d\u6b21\u5c1d\u8bd5\u6295\u9012\u4e4b\u524d\u5df2\u88ab\u5904\u7406\u8fc7\u7684\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u540e\u7eed\u4f1a\u6536\u5230\u4e24\u6761\u5185\u5bb9\u76f8\u540c\u5e76\u4e14Message ID\u4e5f\u76f8\u540c\u7684\u6d88\u606f\u3002 3. \u8d1f\u8f7d\u5747\u8861\u65f6\u6d88\u606f\u91cd\u590d \uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u7f51\u7edc\u6296\u52a8\u3001Broker\u91cd\u542f\u4ee5\u53ca\u6d88\u8d39\u8005\u5e94\u7528\u91cd\u542f\uff09 \u5f53\u6d88\u606f\u961f\u5217RocketMQ\u7248\u7684Broker\u6216\u5ba2\u6237\u7aef\u91cd\u542f\u3001\u6269\u5bb9\u6216\u7f29\u5bb9\u65f6\uff0c\u4f1a\u89e6\u53d1Rebalance\uff0c\u6b64\u65f6\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u6536\u5230\u91cd\u590d\u6d88\u606f\u3002 \u90a3\u4e48\uff0c\u6709\u4ec0\u4e48\u89e3\u51b3\u65b9\u6848\u5462\uff1f \u76f4\u63a5\u4e0a\u56fe\u3002","title":"4. \u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u7684\u5e42\u7b49\uff1f"},{"location":"knowledge/mqvs/#5","text":"\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u6709\u51e0\u4e2a\u70b9\u9700\u8981\u8003\u8651\uff1a 1. \u5982\u4f55\u5feb\u901f\u8ba9\u79ef\u538b\u7684\u6d88\u606f\u88ab\u6d88\u8d39\u6389\uff1f \u4e34\u65f6\u5199\u4e00\u4e2a\u6d88\u606f\u5206\u53d1\u7684\u6d88\u8d39\u8005\uff0c\u628a\u79ef\u538b\u961f\u5217\u91cc\u7684\u6d88\u606f\u5747\u5300\u5206\u53d1\u5230N\u4e2a\u961f\u5217\u4e2d\uff0c\u540c\u65f6\u4e00\u4e2a\u961f\u5217\u5bf9\u5e94\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u76f8\u5f53\u4e8e\u6d88\u8d39\u901f\u5ea6\u63d0\u9ad8\u4e86N\u500d\u3002 \u4fee\u6539\u524d\uff1a \u4fee\u6539\u540e\uff1a 2. \u79ef\u538b\u65f6\u95f4\u592a\u4e45\uff0c\u5bfc\u81f4\u90e8\u5206\u6d88\u606f\u8fc7\u671f\uff0c\u600e\u4e48\u5904\u7406\uff1f \u6279\u91cf\u91cd\u5bfc\u3002\u5728\u4e1a\u52a1\u4e0d\u7e41\u5fd9\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u51cc\u6668\uff0c\u63d0\u524d\u51c6\u5907\u597d\u7a0b\u5e8f\uff0c\u628a\u4e22\u5931\u7684\u90a3\u6279\u6d88\u606f\u67e5\u51fa\u6765\uff0c\u91cd\u65b0\u5bfc\u5165\u5230MQ\u4e2d\u3002 3. \u6d88\u606f\u5927\u91cf\u79ef\u538b\uff0cMQ\u78c1\u76d8\u88ab\u5199\u6ee1\u4e86\uff0c\u5bfc\u81f4\u65b0\u6d88\u606f\u8fdb\u4e0d\u6765\u4e86\uff0c\u4e22\u6389\u4e86\u5927\u91cf\u6d88\u606f\uff0c\u600e\u4e48\u5904\u7406\uff1f \u8fd9\u4e2a\u6ca1\u529e\u6cd5\u3002\u8c01\u8ba9\u3010\u6d88\u606f\u5206\u53d1\u7684\u6d88\u8d39\u8005\u3011\u5199\u7684\u592a\u6162\u4e86\uff0c\u4f60\u4e34\u65f6\u5199\u7a0b\u5e8f\uff0c\u63a5\u5165\u6570\u636e\u6765\u6d88\u8d39\uff0c\u6d88\u8d39\u4e00\u4e2a\u4e22\u5f03\u4e00\u4e2a\uff0c\u90fd\u4e0d\u8981\u4e86\uff0c\u5feb\u901f\u6d88\u8d39\u6389\u6240\u6709\u7684\u6d88\u606f\u3002\u7136\u540e\u8d70\u7b2c\u4e8c\u4e2a\u65b9\u6848\uff0c\u5230\u4e86\u665a\u4e0a\u518d\u8865\u6570\u636e\u5427\u3002 \u4f5c\u8005\uff1aBoom \u94fe\u63a5\uff1ahttps://juejin.cn/post/7006958043833303048 \u6765\u6e90\uff1a\u6398\u91d1 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002","title":"5. \u5982\u4f55\u89e3\u51b3\u6d88\u606f\u79ef\u538b\u7684\u95ee\u9898\uff1f"},{"location":"knowledge/nginx/","text":"\u524d\u8a00 \u672c\u6587\u5df2\u53c2\u4e0e\u3010 \u8bf7\u67e5\u6536\uff5c\u4f60\u6709\u4e00\u6b21\u514d\u8d39\u7533\u8bf7\u6398\u91d1\u5468\u8fb9\u793c\u7269\u7684\u673a\u4f1a \u3011\u6d3b\u52a8\u3002 \u53c2\u4e0e\u8bc4\u8bba\uff0c\u6709\u673a\u4f1a\u83b7\u5f97\u6398\u91d1\u5b98\u65b9\u63d0\u4f9b\u7684 2 \u679a\u65b0\u7248\u5fbd\u7ae0\uff0c\u5177\u4f53\u7684\u62bd\u5956\u7ec6\u8282\u8bf7\u770b\u6587\u672b\u3002 \u5bf9\u4e8e\u521d\u7ea7\u5f00\u53d1\u3001\u7279\u522b\u662f\u662f\u5c0f\u767d\u540c\u5b66\uff0c\u5e0c\u671b\u5c0f\u4f19\u4f34\u4eec\u8ba4\u771f\u770b\u5b8c\uff0c\u6211\u76f8\u4fe1\u4f60\u4f1a\u6709\u6536\u83b7\u7684\u3002 \u521b\u4f5c\u4e0d\u6613\uff0c\u8bb0\u5f97 \u70b9\u8d5e\u3001\u5173\u6ce8\u3001\u6536\u85cf \u54df\u3002 Nginx\u6982\u5ff5 Nginx \u662f\u4e00\u4e2a \u9ad8\u6027\u80fd\u7684 HTTP \u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1 \u3002\u5176\u7279\u70b9\u662f\u5360\u6709\u5185\u5b58\u5c11\uff0c\u5e76\u53d1\u80fd\u529b\u5f3a\uff0c\u4e8b\u5b9e\u4e0anginx\u7684\u5e76\u53d1\u80fd\u529b\u5728\u540c\u7c7b\u578b\u7684\u7f51\u9875\u670d\u52a1\u5668\u4e2d\u8868\u73b0\u8f83\u597d\u3002 Nginx \u4e13\u4e3a\u6027\u80fd\u4f18\u5316\u800c\u5f00\u53d1\uff0c\u6027\u80fd\u662f\u5176\u6700\u91cd\u8981\u7684\u8003\u91cf\u6307\u6807\uff0c\u5b9e\u73b0\u4e0a\u975e\u5e38\u6ce8\u91cd\u6548\u7387\uff0c\u80fd\u7ecf\u53d7\u4f4f\u9ad8\u8d1f\u8f7d\u7684\u8003\u9a8c\uff0c\u6709\u62a5\u544a\u8868\u660e\u80fd\u652f\u6301\u9ad8\u8fbe50000\u4e2a\u5e76\u53d1\u8fde\u63a5\u6570\u3002 \u5728\u8fde\u63a5\u9ad8\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0cNginx \u662f Apache \u670d\u52a1\u4e0d\u9519\u7684\u66ff\u4ee3\u54c1\uff1aNginx \u5728\u7f8e\u56fd\u662f\u505a\u865a\u62df\u4e3b\u673a\u751f\u610f\u7684\u8001\u677f\u4eec\u7ecf\u5e38\u9009\u62e9\u7684\u8f6f\u4ef6\u5e73\u53f0\u4e4b\u4e00\u3002 \u53cd\u5411\u4ee3\u7406 \u5728\u8bf4\u53cd\u5411\u4ee3\u7406\u4e4b\u524d\uff0c\u5148\u6765\u8bf4\u8bf4\u4ec0\u4e48\u662f\u4ee3\u7406\u548c\u6b63\u5411\u4ee3\u7406\u3002 \u4ee3\u7406 \u4ee3\u7406\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u4e2d\u4ecb\uff0cA\u548cB\u672c\u6765\u53ef\u4ee5\u76f4\u8fde\uff0c\u4e2d\u95f4\u63d2\u5165\u4e00\u4e2aC\uff0cC\u5c31\u662f\u4e2d\u4ecb\u3002\u521a\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u4ee3\u7406\u591a\u6570\u662f\u5e2e\u52a9 \u5185\u7f51client \uff08\u5c40\u57df\u7f51\uff09\u8bbf\u95ee \u5916\u7f51server \u7528\u7684\u3002 \u540e\u6765\u51fa\u73b0\u4e86\u53cd\u5411\u4ee3\u7406\uff0c \u53cd\u5411 \u8fd9\u4e2a\u8bcd\u5728\u8fd9\u513f\u7684\u610f\u601d\u5176\u5b9e\u662f\u6307\u65b9\u5411\u76f8\u53cd\uff0c\u5373\u4ee3\u7406\u5c06\u6765\u81ea\u5916\u7f51\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u5185\u7f51\u670d\u52a1\u5668\uff0c\u4ece\u5916\u5230\u5185\u3002 \u6b63\u5411\u4ee3\u7406 \u6b63\u5411\u4ee3\u7406\u5373\u662f\u5ba2\u6237\u7aef\u4ee3\u7406\uff0c\u4ee3\u7406\u5ba2\u6237\u7aef\uff0c\u670d\u52a1\u7aef\u4e0d\u77e5\u9053\u5b9e\u9645\u53d1\u8d77\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002 \u6b63\u5411\u4ee3\u7406\u7c7b\u4f3c\u4e00\u4e2a\u8df3\u677f\u673a\uff0c\u4ee3\u7406\u8bbf\u95ee\u5916\u90e8\u8d44\u6e90\u3002 \u6bd4\u5982\u6211\u4eec\u56fd\u5185\u8bbf\u95ee\u8c37\u6b4c\uff0c\u76f4\u63a5\u8bbf\u95ee\u8bbf\u95ee\u4e0d\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u6b63\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u53d1\u5230\u4ee3\u7406\u670d\u670d\u52a1\u4e0a\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u80fd\u591f\u8bbf\u95ee\u8c37\u6b4c\uff0c\u8fd9\u6837\u7531\u4ee3\u7406\u53bb\u8bbf\u95ee\u8c37\u6b4c\u53d6\u5230\u8fd4\u56de\u6570\u636e\uff0c\u518d\u8fd4\u56de\u7ed9\u6211\u4eec\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u8bbf\u95ee\u8c37\u6b4c\u4e86\u3002 \u53cd\u5411\u4ee3\u7406 \u53cd\u5411\u4ee3\u7406\u5373\u662f\u670d\u52a1\u7aef\u4ee3\u7406\uff0c\u4ee3\u7406\u670d\u52a1\u7aef\uff0c\u5ba2\u6237\u7aef\u4e0d\u77e5\u9053\u5b9e\u9645\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u7aef\u3002 \u5ba2\u6237\u7aef\u662f\u611f\u77e5\u4e0d\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u5b58\u5728\u3002 \u662f\u6307\u4ee5\u4ee3\u7406\u670d\u52a1\u5668\u6765\u63a5\u53d7 Internet \u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5185\u90e8\u7f51\u7edc\u4e0a\u7684\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u4ece\u670d\u52a1\u5668\u4e0a\u5f97\u5230\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9 Internet \u4e0a\u8bf7\u6c42\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u4ee3\u7406\u670d\u52a1\u5668\u5bf9\u5916\u5c31\u8868\u73b0\u4e3a\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002 \u8d1f\u8f7d\u5747\u8861 \u5173\u4e8e\u8d1f\u8f7d\u5747\u8861\uff0c\u5148\u6765\u4e3e\u4e2a\u4f8b\u5b50\uff1a \u5730\u94c1\u5927\u5bb6\u5e94\u8be5\u90fd\u5750\u8fc7\u5427\uff0c\u6211\u4eec\u4e00\u822c\u5728\u65e9\u9ad8\u5cf0\u4e58\u5730\u94c1\u65f6\u5019\uff0c\u603b\u6709\u90a3\u4e48\u4e00\u4e2a\u5730\u94c1\u53e3\u4eba\u6700\u62e5\u6324\uff0c\u8fd9\u65f6\u5019\uff0c\u4e00\u822c\u4f1a\u6709\u4e2a\u5730\u94c1\u5de5\u4f5c\u4eba\u5458A\u62ff\u4e2a\u5927\u5587\u53ed\u5728\u558a\u201c \u7740\u6025\u7684\u4eba\u5458\u8bf7\u8d70B\u53e3\uff0cB\u53e3\u4eba\u5c11\u8f66\u7a7a \u201d\u3002\u800c\u8fd9\u4e2a\u5730\u94c1\u5de5\u4f5c\u4eba\u5458A\u5c31\u662f\u8d1f\u8d23\u8d1f\u8f7d\u5747\u8861\u7684\u3002 \u4e3a\u4e86\u63d0\u5347\u7f51\u7ad9\u7684\u5404\u65b9\u9762\u80fd\u529b\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u628a\u591a\u53f0\u673a\u5668\u7ec4\u6210\u4e00\u4e2a\u96c6\u7fa4\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u7136\u800c\uff0c\u6211\u4eec\u7684\u7f51\u7ad9\u5bf9\u5916\u63d0\u4f9b\u7684\u8bbf\u95ee\u5165\u53e3\u90fd\u662f\u4e00\u4e2a\u7684\uff0c\u6bd4\u5982 www.taobao.com \u3002\u90a3\u4e48\u5f53\u7528\u6237\u5728\u6d4f\u89c8\u5668\u8f93\u5165 www.taobao.com \u7684\u65f6\u5019\u5982\u4f55\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u5206\u53d1\u5230\u96c6\u7fa4\u4e2d\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u5462\uff0c\u8fd9\u5c31\u662f\u8d1f\u8f7d\u5747\u8861\u5728\u505a\u7684\u4e8b\u60c5\u3002 \u8d1f\u8f7d\u5747\u8861\uff08Load Balance\uff09\uff0c\u610f\u601d\u662f\u5c06\u8d1f\u8f7d\uff08\u5de5\u4f5c\u4efb\u52a1\uff0c\u8bbf\u95ee\u8bf7\u6c42\uff09\u8fdb\u884c\u5e73\u8861\u3001\u5206\u644a\u5230\u591a\u4e2a\u64cd\u4f5c\u5355\u5143\uff08\u670d\u52a1\u5668\uff0c\u7ec4\u4ef6\uff09\u4e0a\u8fdb\u884c\u6267\u884c\u3002\u662f\u89e3\u51b3\u9ad8\u6027\u80fd\uff0c\u5355\u70b9\u6545\u969c\uff08\u9ad8\u53ef\u7528\uff09\uff0c\u6269\u5c55\u6027\uff08\u6c34\u5e73\u4f38\u7f29\uff09\u7684\u7ec8\u6781\u89e3\u51b3\u65b9\u6848\u3002 Nginx\u63d0\u4f9b\u7684\u8d1f\u8f7d\u5747\u8861\u4e3b\u8981\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a\u8f6e\u8be2\uff0c\u52a0\u6743\u8f6e\u8be2\uff0cIp hash\u3002 \u8f6e\u8be2 nginx\u9ed8\u8ba4\u5c31\u662f\u8f6e\u8be2\u5176\u6743\u91cd\u90fd\u9ed8\u8ba4\u4e3a1\uff0c\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u7684\u987a\u5e8f\uff1aABCABCABCABC.... upstream mysvr { server 192.168.8.1:7070; server 192.168.8.2:7071; server 192.168.8.3:7072; } \u590d\u5236\u4ee3\u7801 \u52a0\u6743\u8f6e\u8be2 \u6839\u636e\u914d\u7f6e\u7684\u6743\u91cd\u7684\u5927\u5c0f\u800c\u5206\u53d1\u7ed9\u4e0d\u540c\u670d\u52a1\u5668\u4e0d\u540c\u6570\u91cf\u7684\u8bf7\u6c42\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5219\u9ed8\u8ba4\u4e3a1\u3002\u4e0b\u9762\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u987a\u5e8f\u4e3a\uff1aABBCCCABBCCC.... upstream mysvr { server 192.168.8.1:7070 weight=1; server 192.168.8.2:7071 weight=2; server 192.168.8.3:7072 weight=3; } \u590d\u5236\u4ee3\u7801 ip_hash iphash\u5bf9\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684ip\u8fdb\u884chash\u64cd\u4f5c\uff0c\u7136\u540e\u6839\u636ehash\u7ed3\u679c\u5c06\u540c\u4e00\u4e2a\u5ba2\u6237\u7aefip\u7684\u8bf7\u6c42\u5206\u53d1\u7ed9\u540c\u4e00\u53f0\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406\uff0c\u53ef\u4ee5\u89e3\u51b3session\u4e0d\u5171\u4eab\u7684\u95ee\u9898\u3002 upstream mysvr { server 192.168.8.1:7070; server 192.168.8.2:7071; server 192.168.8.3:7072; ip_hash; } \u590d\u5236\u4ee3\u7801 \u52a8\u9759\u5206\u79bb \u52a8\u6001\u4e0e\u9759\u6001\u9875\u9762\u533a\u522b \u9759\u6001\u8d44\u6e90\uff1a \u5f53\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u8d44\u6e90\uff0c\u8d44\u6e90\u7684\u6e90\u4ee3\u7801\u6c38\u8fdc\u4e0d\u4f1a\u6539\u53d8\u7684\u8d44\u6e90\uff08\u5982\uff1aHTML\uff0cJavaScript\uff0cCSS\uff0cimg\u7b49\u6587\u4ef6\uff09\u3002 \u52a8\u6001\u8d44\u6e90\uff1a\u5f53\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u8d44\u6e90\uff0c\u8d44\u6e90\u7684\u6e90\u4ee3\u7801\u53ef\u80fd\u4f1a\u53d1\u9001\u6539\u53d8\uff08\u5982\uff1a.jsp\u3001servlet \u7b49\uff09\u3002 \u4ec0\u4e48\u662f\u52a8\u9759\u5206\u79bb \u52a8\u9759\u5206\u79bb\u662f\u8ba9\u52a8\u6001\u7f51\u7ad9\u91cc\u7684\u52a8\u6001\u7f51\u9875\u6839\u636e\u4e00\u5b9a\u89c4\u5219\u628a\u4e0d\u53d8\u7684\u8d44\u6e90\u548c\u7ecf\u5e38\u53d8\u7684\u8d44\u6e90\u533a\u5206\u5f00\u6765\uff0c\u52a8\u9759\u8d44\u6e90\u505a\u597d\u4e86\u62c6\u5206\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u9759\u6001\u8d44\u6e90\u7684\u7279\u70b9\u5c06\u5176\u505a\u7f13\u5b58\u64cd\u4f5c\uff0c\u8fd9\u5c31\u662f\u7f51\u7ad9\u9759\u6001\u5316\u5904\u7406\u7684\u6838\u5fc3\u601d\u8def\u3002 \u52a8\u9759\u5206\u79bb\u7b80\u5355\u7684\u6982\u62ec\u662f\uff1a\u52a8\u6001\u6587\u4ef6\u4e0e\u9759\u6001\u6587\u4ef6\u7684\u5206\u79bb\u3002 \u4e3a\u4ec0\u4e48\u8981\u7528\u52a8\u9759\u5206\u79bb \u4e3a\u4e86\u52a0\u5feb\u7f51\u7ad9\u7684\u89e3\u6790\u901f\u5ea6\uff0c\u53ef\u4ee5\u628a\u52a8\u6001\u8d44\u6e90\u548c\u9759\u6001\u8d44\u6e90\u7528\u4e0d\u540c\u7684\u670d\u52a1\u5668\u6765\u89e3\u6790\uff0c\u52a0\u5feb\u89e3\u6790\u901f\u5ea6\u3002\u964d\u4f4e\u5355\u4e2a\u670d\u52a1\u5668\u7684\u538b\u529b\u3002 Nginx\u5b89\u88c5 windows\u4e0b\u5b89\u88c5 1\u3001\u4e0b\u8f7dnginx nginx.org/en/download\u2026 \u4e0b\u8f7d\u7a33\u5b9a\u7248\u672c\u3002\u4ee5nginx/Windows-1.20.1\u4e3a\u4f8b\uff0c\u76f4\u63a5\u4e0b\u8f7d nginx-1.20.1.zip\u3002 \u4e0b\u8f7d\u540e\u89e3\u538b\uff0c\u89e3\u538b\u540e\u5982\u4e0b\uff1a 2\u3001\u542f\u52a8nginx \u76f4\u63a5\u53cc\u51fbnginx.exe\uff0c\u53cc\u51fb\u540e\u4e00\u4e2a\u9ed1\u8272\u7684\u5f39\u7a97\u4e00\u95ea\u800c\u8fc7 \u6253\u5f00cmd\u547d\u4ee4\u7a97\u53e3\uff0c\u5207\u6362\u5230nginx\u89e3\u538b\u76ee\u5f55\u4e0b\uff0c\u8f93\u5165\u547d\u4ee4 nginx.exe \uff0c\u56de\u8f66\u5373\u53ef 3\u3001\u68c0\u67e5nginx\u662f\u5426\u542f\u52a8\u6210\u529f \u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u8f93\u5165\u7f51\u5740 http://localhost:80 \u56de\u8f66\uff0c\u51fa\u73b0\u4ee5\u4e0b\u9875\u9762\u8bf4\u660e\u542f\u52a8\u6210\u529f\uff01 Docker\u5b89\u88c5nginx \u6211\u4e4b\u524d\u7684\u6587\u7ae0\u4e5f\u8bb2\u8fc7Linux\u4e0b\u5b89\u88c5\u7684\u6b65\u9aa4\uff0c\u6211\u91c7\u7528\u7684\u662fdocker\u5b89\u88c5\u7684\uff0c\u5f88\u7b80\u5355\u3002 \u76f8\u5173\u94fe\u63a5\u5982\u4e0b\uff1a Docker\uff08\u4e09\uff09\uff1aDocker\u90e8\u7f72Nginx\u548cTomcat 1\u3001\u67e5\u770b\u6240\u6709\u672c\u5730\u7684\u4e3b\u673a\u4e0a\u7684\u955c\u50cf \uff0c\u4f7f\u7528\u547d\u4ee4 docker images 2\u3001\u521b\u5efa nginx \u5bb9\u5668 \u5e76\u542f\u52a8\u5bb9\u5668 \uff0c\u4f7f\u7528\u547d\u4ee4 docker run -d --name nginx01 -p 3344:80 nginx 3\u3001\u67e5\u770b\u5df2\u542f\u52a8\u7684\u5bb9\u5668 \uff0c\u4f7f\u7528\u547d\u4ee4 docker ps \u6d4f\u89c8\u5668\u8bbf\u95ee \u670d\u52a1\u5668ip:3344 \uff0c\u5982\u4e0b\uff0c\u8bf4\u660e\u5b89\u88c5\u542f\u52a8\u6210\u529f\u3002 \u6ce8\u610f \uff1a\u5982\u4f55\u8fde\u63a5\u4e0d\u4e0a\uff0c\u68c0\u67e5\u963f\u91cc\u4e91\u5b89\u5168\u7ec4\u662f\u5426\u5f00\u653e\u7aef\u53e3\uff0c\u6216\u8005\u670d\u52a1\u5668\u9632\u706b\u5899\u662f\u5426\u5f00\u653e\u7aef\u53e3\uff01 linux\u4e0b\u5b89\u88c5 1\u3001\u5b89\u88c5gcc \u5b89\u88c5 nginx \u9700\u8981\u5148\u5c06\u5b98\u7f51\u4e0b\u8f7d\u7684\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\uff0c\u7f16\u8bd1\u4f9d\u8d56 gcc \u73af\u5883\uff0c\u5982\u679c\u6ca1\u6709 gcc \u73af\u5883\uff0c\u5219\u9700\u8981\u5b89\u88c5\uff1a yum install gcc-c++ \u590d\u5236\u4ee3\u7801 2\u3001PCRE pcre-devel \u5b89\u88c5 PCRE(Perl Compatible Regular Expressions) \u662f\u4e00\u4e2aPerl\u5e93\uff0c\u5305\u62ec perl \u517c\u5bb9\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5e93\u3002nginx \u7684 http \u6a21\u5757\u4f7f\u7528 pcre \u6765\u89e3\u6790\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u5728 linux \u4e0a\u5b89\u88c5 pcre \u5e93\uff0cpcre-devel \u662f\u4f7f\u7528 pcre \u5f00\u53d1\u7684\u4e00\u4e2a\u4e8c\u6b21\u5f00\u53d1\u5e93\u3002nginx\u4e5f\u9700\u8981\u6b64\u5e93\u3002\u547d\u4ee4\uff1a yum install -y pcre pcre-devel \u590d\u5236\u4ee3\u7801 3\u3001zlib \u5b89\u88c5 zlib \u5e93\u63d0\u4f9b\u4e86\u5f88\u591a\u79cd\u538b\u7f29\u548c\u89e3\u538b\u7f29\u7684\u65b9\u5f0f\uff0c nginx \u4f7f\u7528 zlib \u5bf9 http \u5305\u7684\u5185\u5bb9\u8fdb\u884c gzip \uff0c\u6240\u4ee5\u9700\u8981\u5728 Centos \u4e0a\u5b89\u88c5 zlib \u5e93\u3002 yum install -y zlib zlib-devel \u590d\u5236\u4ee3\u7801 4\u3001OpenSSL \u5b89\u88c5 OpenSSL \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u5b89\u5168\u5957\u63a5\u5b57\u5c42\u5bc6\u7801\u5e93\uff0c\u56ca\u62ec\u4e3b\u8981\u7684\u5bc6\u7801\u7b97\u6cd5\u3001\u5e38\u7528\u7684\u5bc6\u94a5\u548c\u8bc1\u4e66\u5c01\u88c5\u7ba1\u7406\u529f\u80fd\u53ca SSL \u534f\u8bae\uff0c\u5e76\u63d0\u4f9b\u4e30\u5bcc\u7684\u5e94\u7528\u7a0b\u5e8f\u4f9b\u6d4b\u8bd5\u6216\u5176\u5b83\u76ee\u7684\u4f7f\u7528\u3002 nginx \u4e0d\u4ec5\u652f\u6301 http \u534f\u8bae\uff0c\u8fd8\u652f\u6301 https\uff08\u5373\u5728ssl\u534f\u8bae\u4e0a\u4f20\u8f93http\uff09\uff0c\u6240\u4ee5\u9700\u8981\u5728 Centos \u5b89\u88c5 OpenSSL \u5e93\u3002 yum install -y openssl openssl-devel \u590d\u5236\u4ee3\u7801 5\u3001\u4e0b\u8f7d\u5b89\u88c5\u5305 \u624b\u52a8\u4e0b\u8f7d.tar.gz\u5b89\u88c5\u5305\uff0c\u5730\u5740\uff1a nginx.org/en/download\u2026 \u4e0b\u8f7d\u5b8c\u6bd5\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u4e0a /root 6\u3001\u89e3\u538b tar -zxvf nginx-1.20.1.tar.gz cd nginx-1.20.1 \u590d\u5236\u4ee3\u7801 7\u3001\u914d\u7f6e \u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5728nginx\u6839\u76ee\u5f55\u4e0b\u6267\u884c ./configue make make install \u590d\u5236\u4ee3\u7801 \u67e5\u627e\u5b89\u88c5\u8def\u5f84\uff1a whereis nginx 8\u3001\u542f\u52a8 nginx ./nginx \u590d\u5236\u4ee3\u7801 \u542f\u52a8\u6210\u529f\uff0c\u8bbf\u95ee\u9875\u9762\uff1aip:80 Nginx\u5e38\u7528\u547d\u4ee4 \u6ce8\u610f`\uff1a\u4f7f\u7528Nginx\u64cd\u4f5c\u547d\u4ee4\u524d\u63d0\uff0c\u5fc5\u987b\u8fdb\u5165\u5230Nginx\u76ee\u5f55 `/usr/local/nginx/sbin 1\u3001\u67e5\u770bNginx\u7248\u672c\u53f7\uff1a ./nginx -v 2\u3001\u542f\u52a8 Nginx\uff1a ./nginx 3\u3001\u505c\u6b62 Nginx\uff1a ./nginx -s stop \u6216\u8005 ./nginx -s quit 4\u3001\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff1a ./nginx -s reload 5\u3001\u67e5\u770bnginx\u8fdb\u7a0b\uff1a ps -ef|grep nginx Nginx\u914d\u7f6e\u6587\u4ef6 Nginx\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff1a /usr/local/nginx/conf/nginx.conf Nginx\u914d\u7f6e\u6587\u4ef6\u67093\u90e8\u5206\u7ec4\u6210\uff1a 1\u3001\u5168\u5c40\u5757 \u4ece\u914d\u7f6e\u6587\u4ef6\u5f00\u59cb\u5230 events \u5757\u4e4b\u95f4\u7684\u5185\u5bb9\uff0c\u4e3b\u8981\u4f1a\u8bbe\u7f6e\u4e00\u4e9b\u5f71\u54cd nginx \u670d\u52a1\u5668\u6574\u4f53\u8fd0\u884c\u7684\u914d\u7f6e\u6307\u4ee4\uff0c\u6bd4\u5982\uff1a worker_processes 1 \u3002 \u8fd9\u662f Nginx \u670d\u52a1\u5668\u5e76\u53d1\u5904\u7406\u670d\u52a1\u7684\u5173\u952e\u914d\u7f6e\uff0cworker_processes \u503c\u8d8a\u5927\uff0c\u53ef\u4ee5\u652f\u6301\u7684\u5e76\u53d1\u5904\u7406\u91cf\u4e5f\u8d8a\u591a\uff0c\u4f46\u662f\u4f1a\u53d7\u5230\u786c\u4ef6\u3001\u8f6f\u4ef6\u7b49\u8bbe\u5907\u7684\u5236\u7ea6\u3002\u4e00\u822c\u8bbe\u7f6e\u503c\u548cCPU\u6838\u5fc3\u6570\u4e00\u81f4\u3002 2\u3001events\u5757 events \u5757\u6d89\u53ca\u7684\u6307\u4ee4\u4e3b\u8981\u5f71\u54cd Nginx \u670d\u52a1\u5668\u4e0e\u7528\u6237\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u6bd4\u5982\uff1a worker_connections 1024 \u8868\u793a\u6bcf\u4e2a work process \u652f\u6301\u7684\u6700\u5927\u8fde\u63a5\u6570\u4e3a 1024\uff0c\u8fd9\u90e8\u5206\u7684\u914d\u7f6e\u5bf9 Nginx \u7684\u6027\u80fd\u5f71\u54cd\u8f83\u5927\uff0c\u5728\u5b9e\u9645\u4e2d\u5e94\u8be5\u7075\u6d3b\u914d\u7f6e\u3002 3\u3001http\u5757 http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80;#\u76d1\u542c\u7aef\u53e3 server_name localhost;#\u57df\u540d location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } \u590d\u5236\u4ee3\u7801 \u8fd9\u7b97\u662f Nginx \u670d\u52a1\u5668\u914d\u7f6e\u4e2d\u6700\u9891\u7e41\u7684\u90e8\u5206\u3002 \u6f14\u793a\u793a\u4f8b \u53cd\u5411\u4ee3\u7406/\u8d1f\u8f7d\u5747\u8861 \u6211\u4eec\u5728windows\u4e0b\u6f14\u793a\uff0c\u9996\u5148\u6211\u4eec\u521b\u5efa\u4e24\u4e2aspringboot\u9879\u76ee\uff0c\u7aef\u53e3\u662f9001\u548c9002\uff0c\u5982\u4e0b\uff1a \u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5c06 localhost:80 \u4ee3\u7406 localhost:9001 \u548c localhost:9002 \u8fd9\u4e24\u4e2a\u670d\u52a1\uff0c\u5e76\u4e14\u8ba9\u8f6e\u8be2\u8bbf\u95ee\u8fd9\u4e24\u4e2a\u670d\u52a1\u3002 nginx\u914d\u7f6e\u5982\u4e0b\uff1a worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream jiangwang { server 127.0.0.1:9001 weight=1;//\u8f6e\u8be2\u5176\u6743\u91cd\u90fd\u9ed8\u8ba4\u4e3a1 server 127.0.0.1:9002 weight=1; } server { listen 80; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / { root html; index index.html index.htm; proxy_pass http://jiangwang; } } } \u590d\u5236\u4ee3\u7801 \u6211\u4eec\u5148\u5c06\u9879\u76ee\u6253\u6210jar\u5305\uff0c\u7136\u540e\u547d\u4ee4\u884c\u542f\u52a8\u9879\u76ee\uff0c\u7136\u540e\u5728\u6d4f\u89c8\u5668\u4e0a\u8bbf\u95ee localhost \u6765\u8bbf\u95ee\u8fd9\u4e24\u4e2a\u9879\u76ee\uff0c\u6211\u4e5f\u5728\u9879\u76ee\u4e2d\u6253\u5370\u4e86\u65e5\u5fd7\uff0c\u64cd\u4f5c\u4e00\u4e0b\u6765\u770b\u770b\u7ed3\u679c\uff0c\u662f\u4e0d\u662f\u4e24\u4e2a\u9879\u76ee\u8f6e\u8be2\u88ab\u8bbf\u95ee\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u8bbf\u95ee localhost \uff0c\u8fd9\u4e24\u4e2a\u9879\u76ee\u8f6e\u8be2\u88ab\u8bbf\u95ee\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u6743\u91cd\u6539\u4e3a\u5982\u4e0b\u8bbe\u7f6e\uff1a upstream jiangwang { server 127.0.0.1:9001 weight=1; server 127.0.0.1:9002 weight=3; } \u590d\u5236\u4ee3\u7801 \u91cd\u65b0\u52a0\u8f7d\u4e00\u4e2anginx\u7684\u914d\u7f6e\u6587\u4ef6\uff1a nginx -s reload \u52a0\u8f7d\u5b8c\u6bd5\uff0c\u6211\u4eec\u518d\u8bbf\u95ee\u5176 localhost \uff0c\u89c2\u5bdf\u5176\u8bbf\u95ee\u7684\u6bd4\u4f8b\uff1a \u7ed3\u679c\u663e\u793a\uff0c9002\u7aef\u53e3\u7684\u8bbf\u95ee\u6b21\u6570\u4e0e9001\u8bbf\u95ee\u7684\u6b21\u6570\u57fa\u672c\u4e0a\u662f 3:1 \u3002 \u52a8\u9759\u5206\u79bb 1\u3001\u5c06\u9759\u6001\u8d44\u6e90\u653e\u5165\u672c\u5730\u65b0\u5efa\u7684\u6587\u4ef6\u91cc\u9762\uff0c\u4f8b\u5982\uff1a\u5728D\u76d8\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6data\uff0c\u7136\u540e\u518ddata\u6587\u4ef6\u5939\u91cc\u9762\u5728\u65b0\u5efa\u4e24\u4e2a\u6587\u4ef6\u5939\uff0c\u4e00\u4e2aimg\u6587\u4ef6\u5939\uff0c\u5b58\u653e\u56fe\u7247\uff1b\u4e00\u4e2ahtml\u6587\u4ef6\u5939\uff0c\u5b58\u653ehtml\u6587\u4ef6\uff1b\u5982\u4e0b\u56fe\uff1a 2\u3001\u5728html\u6587\u4ef6\u5939\u91cc\u9762\u65b0\u5efa\u4e00\u4e2a a.html \u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <!DOCTYPE html> <html> <head> <meta charset=\"utf-8\"> <title>Html\u6587\u4ef6</title> </head> <body> <p>Hello World</p> </body> </html> \u590d\u5236\u4ee3\u7801 3\u3001\u5728img\u6587\u4ef6\u5939\u91cc\u9762\u653e\u5165\u4e00\u5f20\u7167\u7247\uff0c\u5982\u4e0b\uff1a 4\u3001\u914d\u7f6enginx\u4e2d nginx.conf \u6587\u4ef6\uff1a location /html/ { root D:/data/; index index.html index.htm; } location /img/ { root D:/data/; autoindex on;#\u8868\u793a\u5217\u51fa\u5f53\u524d\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u5185\u5bb9 } \u590d\u5236\u4ee3\u7801 5\u3001\u542f\u52a8nginx\uff0c\u8bbf\u95ee\u5176\u6587\u4ef6\u8def\u5f84\uff0c\u5728\u6d4f\u89c8\u5668\u8f93\u5165 http://localhost/html/a.html \uff0c\u5982\u4e0b\uff1a 6\u3001\u5728\u6d4f\u89c8\u5668\u8f93\u5165 http://localhost/img/ Nginx\u5de5\u4f5c\u539f\u7406 mater&worker master\u63a5\u6536\u4fe1\u53f7\u540e\u5c06\u4efb\u52a1\u5206\u914d\u7ed9worker\u8fdb\u884c\u6267\u884c\uff0cworker\u53ef\u6709\u591a\u4e2a\u3002 worker\u5982\u4f55\u5de5\u4f5c \u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u5230master\u540e\uff0cworker\u83b7\u53d6\u4efb\u52a1\u7684\u673a\u5236\u4e0d\u662f\u76f4\u63a5\u5206\u914d\u4e5f\u4e0d\u662f\u8f6e\u8be2\uff0c\u800c\u662f\u4e00\u79cd\u4e89\u62a2\u7684\u673a\u5236\uff0c\u201c\u62a2\u201d\u5230\u4efb\u52a1\u540e\u518d\u6267\u884c\u4efb\u52a1\uff0c\u5373\u9009\u62e9\u76ee\u6807\u670d\u52a1\u5668tomcat\u7b49\uff0c\u7136\u540e\u8fd4\u56de\u7ed3\u679c\u3002 worker_connection \u53d1\u9001\u8bf7\u6c42\u5360\u7528\u4e86woker\u4e24\u4e2a\u6216\u56db\u4e2a\u8fde\u63a5\u6570\u3002 \u666e\u901a\u7684\u9759\u6001\u8bbf\u95ee\u6700\u5927\u5e76\u53d1\u6570\u662f\uff1a worker_connections * worker_processes/ 2 \uff0c\u82e5\u662f HTTP \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u6765\u8bf4\uff0c\u6700\u5927\u5e76\u53d1\u6570\u91cf\u5e94\u8be5\u662f worker_connections * worker_processes/ 4 \u3002\u5f53\u7136\u4e86\uff0cworker\u6570\u4e5f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0cworker\u6570\u548c\u670d\u52a1\u5668\u7684CPU\u6570\u76f8\u7b49\u65f6\u6700\u9002\u5b9c\u7684\u3002 \u4f18\u70b9 \u53ef\u4ee5\u4f7f\u7528 nginx \u2013s reload \u70ed\u90e8\u7f72\uff0c\u5229\u7528 nginx \u8fdb\u884c\u70ed\u90e8\u7f72\u64cd\u4f5c\u6bcf\u4e2a woker \u662f\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u82e5\u5176\u4e2d\u4e00\u4e2awoker\u51fa\u73b0\u95ee\u9898\uff0c\u5176\u4ed6\u7ee7\u7eed\u8fdb\u884c\u4e89\u62a2\uff0c\u5b9e\u73b0\u8bf7\u6c42\u8fc7\u7a0b\uff0c\u4e0d\u4f1a\u9020\u6210\u670d\u52a1\u4e2d\u65ad\u3002 \u603b\u7ed3 \u5173\u4e8e Nginx \u7684\u57fa\u672c\u6982\u5ff5\u3001\u5b89\u88c5\u6559\u7a0b\u3001\u914d\u7f6e\u3001\u4f7f\u7528\u5b9e\u4f8b\u4ee5\u53ca\u5de5\u4f5c\u539f\u7406\uff0c\u672c\u6587\u90fd\u505a\u4e86\u8be6\u7ec6\u9610\u8ff0\u3002\u5e0c\u671b\u672c\u6587\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002 \u62bd\u5956\u7ec6\u5219 \u9996\u5148\u4f60\u8981\u53c2\u4e0e\u8bc4\u8bba\uff0c\u6211\u5e0c\u671b\u4f60\u80fd\u770b\u5b8c\u6587\u7ae0\uff0c\u4e0d\u8981\u53ea\u6253\u4e2a\u8868\u60c5\u7b26\u53f7\u4e4b\u7c7b\u7684\u3002 \u8bb0\u5f97 \u70b9\u8d5e\u3001\u5173\u6ce8 \uff0c\u52a8\u52a8\u4f60\u7684\u5c0f\u624b\u6307\uff0c\u8c22\u8c22\uff01 \u81f3\u4e8e\u600e\u4e48\u516c\u5e73\uff0c\u6211\u4e5f\u60f3\u4e86\u4e00\u4e0b\uff0c\u6211\u4f1a\u521b\u5efa\u4e00\u4e2a\u62bd\u5956\u7fa4\uff0c\u6211\u53d1\u7ea2\u5305\uff0c\u4f60\u4eec\u62a2\uff0c\u91d1\u989d\u6700\u5c11\u7684\u83b7\u5f97\u5956\u54c1\u3002\u6216\u8005\u4f60\u4eec\u6709\u66f4\u597d\u7684\u65b9\u5f0f\u8bc4\u8bba\u533a\u544a\u8bc9\u6211\u3002\u5982\u679c\u6211\u89c9\u5f97\u66f4\u597d\uff0c\u6211\u4f1a\u91c7\u7eb3\u3002 \u5982\u679c\u6211\u7684\u8bc4\u8bba\u533a\u70ed\u5ea6\u5728Top 1-5 \u540d\uff0c\u83b7\u5f97\u7684 \u65b0\u7248\u5fbd\u7ae01\u5957 \u6216 \u6398\u91d1\u65b0\u7248IPT\u60641\u4ef6\uff0c\u6211\u4e5f\u4f1a\u9001\u7ed9\u8bc4\u8bba\u533a\u7684\u5c0f\u4f19\u4f34\uff0c\u524d\u63d0\u4f60\u5173\u6ce8\u6211\u7684\u6211\u7684\u516c\u4f17\u53f7\uff1a\u5fae\u4fe1\u641c\u3010\u521d\u5ff5\u521d\u604b\u3011\u3002","title":"nginx\u77e5\u8bc6\u68b3\u7406"},{"location":"knowledge/nginx/#_1","text":"\u672c\u6587\u5df2\u53c2\u4e0e\u3010 \u8bf7\u67e5\u6536\uff5c\u4f60\u6709\u4e00\u6b21\u514d\u8d39\u7533\u8bf7\u6398\u91d1\u5468\u8fb9\u793c\u7269\u7684\u673a\u4f1a \u3011\u6d3b\u52a8\u3002 \u53c2\u4e0e\u8bc4\u8bba\uff0c\u6709\u673a\u4f1a\u83b7\u5f97\u6398\u91d1\u5b98\u65b9\u63d0\u4f9b\u7684 2 \u679a\u65b0\u7248\u5fbd\u7ae0\uff0c\u5177\u4f53\u7684\u62bd\u5956\u7ec6\u8282\u8bf7\u770b\u6587\u672b\u3002 \u5bf9\u4e8e\u521d\u7ea7\u5f00\u53d1\u3001\u7279\u522b\u662f\u662f\u5c0f\u767d\u540c\u5b66\uff0c\u5e0c\u671b\u5c0f\u4f19\u4f34\u4eec\u8ba4\u771f\u770b\u5b8c\uff0c\u6211\u76f8\u4fe1\u4f60\u4f1a\u6709\u6536\u83b7\u7684\u3002 \u521b\u4f5c\u4e0d\u6613\uff0c\u8bb0\u5f97 \u70b9\u8d5e\u3001\u5173\u6ce8\u3001\u6536\u85cf \u54df\u3002","title":"\u524d\u8a00"},{"location":"knowledge/nginx/#nginx","text":"Nginx \u662f\u4e00\u4e2a \u9ad8\u6027\u80fd\u7684 HTTP \u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1 \u3002\u5176\u7279\u70b9\u662f\u5360\u6709\u5185\u5b58\u5c11\uff0c\u5e76\u53d1\u80fd\u529b\u5f3a\uff0c\u4e8b\u5b9e\u4e0anginx\u7684\u5e76\u53d1\u80fd\u529b\u5728\u540c\u7c7b\u578b\u7684\u7f51\u9875\u670d\u52a1\u5668\u4e2d\u8868\u73b0\u8f83\u597d\u3002 Nginx \u4e13\u4e3a\u6027\u80fd\u4f18\u5316\u800c\u5f00\u53d1\uff0c\u6027\u80fd\u662f\u5176\u6700\u91cd\u8981\u7684\u8003\u91cf\u6307\u6807\uff0c\u5b9e\u73b0\u4e0a\u975e\u5e38\u6ce8\u91cd\u6548\u7387\uff0c\u80fd\u7ecf\u53d7\u4f4f\u9ad8\u8d1f\u8f7d\u7684\u8003\u9a8c\uff0c\u6709\u62a5\u544a\u8868\u660e\u80fd\u652f\u6301\u9ad8\u8fbe50000\u4e2a\u5e76\u53d1\u8fde\u63a5\u6570\u3002 \u5728\u8fde\u63a5\u9ad8\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0cNginx \u662f Apache \u670d\u52a1\u4e0d\u9519\u7684\u66ff\u4ee3\u54c1\uff1aNginx \u5728\u7f8e\u56fd\u662f\u505a\u865a\u62df\u4e3b\u673a\u751f\u610f\u7684\u8001\u677f\u4eec\u7ecf\u5e38\u9009\u62e9\u7684\u8f6f\u4ef6\u5e73\u53f0\u4e4b\u4e00\u3002","title":"Nginx\u6982\u5ff5"},{"location":"knowledge/nginx/#_2","text":"\u5728\u8bf4\u53cd\u5411\u4ee3\u7406\u4e4b\u524d\uff0c\u5148\u6765\u8bf4\u8bf4\u4ec0\u4e48\u662f\u4ee3\u7406\u548c\u6b63\u5411\u4ee3\u7406\u3002","title":"\u53cd\u5411\u4ee3\u7406"},{"location":"knowledge/nginx/#_3","text":"\u4ee3\u7406\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u4e2d\u4ecb\uff0cA\u548cB\u672c\u6765\u53ef\u4ee5\u76f4\u8fde\uff0c\u4e2d\u95f4\u63d2\u5165\u4e00\u4e2aC\uff0cC\u5c31\u662f\u4e2d\u4ecb\u3002\u521a\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u4ee3\u7406\u591a\u6570\u662f\u5e2e\u52a9 \u5185\u7f51client \uff08\u5c40\u57df\u7f51\uff09\u8bbf\u95ee \u5916\u7f51server \u7528\u7684\u3002 \u540e\u6765\u51fa\u73b0\u4e86\u53cd\u5411\u4ee3\u7406\uff0c \u53cd\u5411 \u8fd9\u4e2a\u8bcd\u5728\u8fd9\u513f\u7684\u610f\u601d\u5176\u5b9e\u662f\u6307\u65b9\u5411\u76f8\u53cd\uff0c\u5373\u4ee3\u7406\u5c06\u6765\u81ea\u5916\u7f51\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u5185\u7f51\u670d\u52a1\u5668\uff0c\u4ece\u5916\u5230\u5185\u3002","title":"\u4ee3\u7406"},{"location":"knowledge/nginx/#_4","text":"\u6b63\u5411\u4ee3\u7406\u5373\u662f\u5ba2\u6237\u7aef\u4ee3\u7406\uff0c\u4ee3\u7406\u5ba2\u6237\u7aef\uff0c\u670d\u52a1\u7aef\u4e0d\u77e5\u9053\u5b9e\u9645\u53d1\u8d77\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002 \u6b63\u5411\u4ee3\u7406\u7c7b\u4f3c\u4e00\u4e2a\u8df3\u677f\u673a\uff0c\u4ee3\u7406\u8bbf\u95ee\u5916\u90e8\u8d44\u6e90\u3002 \u6bd4\u5982\u6211\u4eec\u56fd\u5185\u8bbf\u95ee\u8c37\u6b4c\uff0c\u76f4\u63a5\u8bbf\u95ee\u8bbf\u95ee\u4e0d\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u6b63\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u53d1\u5230\u4ee3\u7406\u670d\u670d\u52a1\u4e0a\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u80fd\u591f\u8bbf\u95ee\u8c37\u6b4c\uff0c\u8fd9\u6837\u7531\u4ee3\u7406\u53bb\u8bbf\u95ee\u8c37\u6b4c\u53d6\u5230\u8fd4\u56de\u6570\u636e\uff0c\u518d\u8fd4\u56de\u7ed9\u6211\u4eec\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u8bbf\u95ee\u8c37\u6b4c\u4e86\u3002","title":"\u6b63\u5411\u4ee3\u7406"},{"location":"knowledge/nginx/#_5","text":"\u53cd\u5411\u4ee3\u7406\u5373\u662f\u670d\u52a1\u7aef\u4ee3\u7406\uff0c\u4ee3\u7406\u670d\u52a1\u7aef\uff0c\u5ba2\u6237\u7aef\u4e0d\u77e5\u9053\u5b9e\u9645\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u7aef\u3002 \u5ba2\u6237\u7aef\u662f\u611f\u77e5\u4e0d\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u5b58\u5728\u3002 \u662f\u6307\u4ee5\u4ee3\u7406\u670d\u52a1\u5668\u6765\u63a5\u53d7 Internet \u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5185\u90e8\u7f51\u7edc\u4e0a\u7684\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u4ece\u670d\u52a1\u5668\u4e0a\u5f97\u5230\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9 Internet \u4e0a\u8bf7\u6c42\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u4ee3\u7406\u670d\u52a1\u5668\u5bf9\u5916\u5c31\u8868\u73b0\u4e3a\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002","title":"\u53cd\u5411\u4ee3\u7406"},{"location":"knowledge/nginx/#_6","text":"\u5173\u4e8e\u8d1f\u8f7d\u5747\u8861\uff0c\u5148\u6765\u4e3e\u4e2a\u4f8b\u5b50\uff1a \u5730\u94c1\u5927\u5bb6\u5e94\u8be5\u90fd\u5750\u8fc7\u5427\uff0c\u6211\u4eec\u4e00\u822c\u5728\u65e9\u9ad8\u5cf0\u4e58\u5730\u94c1\u65f6\u5019\uff0c\u603b\u6709\u90a3\u4e48\u4e00\u4e2a\u5730\u94c1\u53e3\u4eba\u6700\u62e5\u6324\uff0c\u8fd9\u65f6\u5019\uff0c\u4e00\u822c\u4f1a\u6709\u4e2a\u5730\u94c1\u5de5\u4f5c\u4eba\u5458A\u62ff\u4e2a\u5927\u5587\u53ed\u5728\u558a\u201c \u7740\u6025\u7684\u4eba\u5458\u8bf7\u8d70B\u53e3\uff0cB\u53e3\u4eba\u5c11\u8f66\u7a7a \u201d\u3002\u800c\u8fd9\u4e2a\u5730\u94c1\u5de5\u4f5c\u4eba\u5458A\u5c31\u662f\u8d1f\u8d23\u8d1f\u8f7d\u5747\u8861\u7684\u3002 \u4e3a\u4e86\u63d0\u5347\u7f51\u7ad9\u7684\u5404\u65b9\u9762\u80fd\u529b\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u628a\u591a\u53f0\u673a\u5668\u7ec4\u6210\u4e00\u4e2a\u96c6\u7fa4\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u7136\u800c\uff0c\u6211\u4eec\u7684\u7f51\u7ad9\u5bf9\u5916\u63d0\u4f9b\u7684\u8bbf\u95ee\u5165\u53e3\u90fd\u662f\u4e00\u4e2a\u7684\uff0c\u6bd4\u5982 www.taobao.com \u3002\u90a3\u4e48\u5f53\u7528\u6237\u5728\u6d4f\u89c8\u5668\u8f93\u5165 www.taobao.com \u7684\u65f6\u5019\u5982\u4f55\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u5206\u53d1\u5230\u96c6\u7fa4\u4e2d\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u5462\uff0c\u8fd9\u5c31\u662f\u8d1f\u8f7d\u5747\u8861\u5728\u505a\u7684\u4e8b\u60c5\u3002 \u8d1f\u8f7d\u5747\u8861\uff08Load Balance\uff09\uff0c\u610f\u601d\u662f\u5c06\u8d1f\u8f7d\uff08\u5de5\u4f5c\u4efb\u52a1\uff0c\u8bbf\u95ee\u8bf7\u6c42\uff09\u8fdb\u884c\u5e73\u8861\u3001\u5206\u644a\u5230\u591a\u4e2a\u64cd\u4f5c\u5355\u5143\uff08\u670d\u52a1\u5668\uff0c\u7ec4\u4ef6\uff09\u4e0a\u8fdb\u884c\u6267\u884c\u3002\u662f\u89e3\u51b3\u9ad8\u6027\u80fd\uff0c\u5355\u70b9\u6545\u969c\uff08\u9ad8\u53ef\u7528\uff09\uff0c\u6269\u5c55\u6027\uff08\u6c34\u5e73\u4f38\u7f29\uff09\u7684\u7ec8\u6781\u89e3\u51b3\u65b9\u6848\u3002 Nginx\u63d0\u4f9b\u7684\u8d1f\u8f7d\u5747\u8861\u4e3b\u8981\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a\u8f6e\u8be2\uff0c\u52a0\u6743\u8f6e\u8be2\uff0cIp hash\u3002","title":"\u8d1f\u8f7d\u5747\u8861"},{"location":"knowledge/nginx/#_7","text":"nginx\u9ed8\u8ba4\u5c31\u662f\u8f6e\u8be2\u5176\u6743\u91cd\u90fd\u9ed8\u8ba4\u4e3a1\uff0c\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u7684\u987a\u5e8f\uff1aABCABCABCABC.... upstream mysvr { server 192.168.8.1:7070; server 192.168.8.2:7071; server 192.168.8.3:7072; } \u590d\u5236\u4ee3\u7801","title":"\u8f6e\u8be2"},{"location":"knowledge/nginx/#_8","text":"\u6839\u636e\u914d\u7f6e\u7684\u6743\u91cd\u7684\u5927\u5c0f\u800c\u5206\u53d1\u7ed9\u4e0d\u540c\u670d\u52a1\u5668\u4e0d\u540c\u6570\u91cf\u7684\u8bf7\u6c42\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5219\u9ed8\u8ba4\u4e3a1\u3002\u4e0b\u9762\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u987a\u5e8f\u4e3a\uff1aABBCCCABBCCC.... upstream mysvr { server 192.168.8.1:7070 weight=1; server 192.168.8.2:7071 weight=2; server 192.168.8.3:7072 weight=3; } \u590d\u5236\u4ee3\u7801","title":"\u52a0\u6743\u8f6e\u8be2"},{"location":"knowledge/nginx/#ip_hash","text":"iphash\u5bf9\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684ip\u8fdb\u884chash\u64cd\u4f5c\uff0c\u7136\u540e\u6839\u636ehash\u7ed3\u679c\u5c06\u540c\u4e00\u4e2a\u5ba2\u6237\u7aefip\u7684\u8bf7\u6c42\u5206\u53d1\u7ed9\u540c\u4e00\u53f0\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406\uff0c\u53ef\u4ee5\u89e3\u51b3session\u4e0d\u5171\u4eab\u7684\u95ee\u9898\u3002 upstream mysvr { server 192.168.8.1:7070; server 192.168.8.2:7071; server 192.168.8.3:7072; ip_hash; } \u590d\u5236\u4ee3\u7801","title":"ip_hash"},{"location":"knowledge/nginx/#_9","text":"","title":"\u52a8\u9759\u5206\u79bb"},{"location":"knowledge/nginx/#_10","text":"\u9759\u6001\u8d44\u6e90\uff1a \u5f53\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u8d44\u6e90\uff0c\u8d44\u6e90\u7684\u6e90\u4ee3\u7801\u6c38\u8fdc\u4e0d\u4f1a\u6539\u53d8\u7684\u8d44\u6e90\uff08\u5982\uff1aHTML\uff0cJavaScript\uff0cCSS\uff0cimg\u7b49\u6587\u4ef6\uff09\u3002 \u52a8\u6001\u8d44\u6e90\uff1a\u5f53\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8fd9\u4e2a\u8d44\u6e90\uff0c\u8d44\u6e90\u7684\u6e90\u4ee3\u7801\u53ef\u80fd\u4f1a\u53d1\u9001\u6539\u53d8\uff08\u5982\uff1a.jsp\u3001servlet \u7b49\uff09\u3002","title":"\u52a8\u6001\u4e0e\u9759\u6001\u9875\u9762\u533a\u522b"},{"location":"knowledge/nginx/#_11","text":"\u52a8\u9759\u5206\u79bb\u662f\u8ba9\u52a8\u6001\u7f51\u7ad9\u91cc\u7684\u52a8\u6001\u7f51\u9875\u6839\u636e\u4e00\u5b9a\u89c4\u5219\u628a\u4e0d\u53d8\u7684\u8d44\u6e90\u548c\u7ecf\u5e38\u53d8\u7684\u8d44\u6e90\u533a\u5206\u5f00\u6765\uff0c\u52a8\u9759\u8d44\u6e90\u505a\u597d\u4e86\u62c6\u5206\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u9759\u6001\u8d44\u6e90\u7684\u7279\u70b9\u5c06\u5176\u505a\u7f13\u5b58\u64cd\u4f5c\uff0c\u8fd9\u5c31\u662f\u7f51\u7ad9\u9759\u6001\u5316\u5904\u7406\u7684\u6838\u5fc3\u601d\u8def\u3002 \u52a8\u9759\u5206\u79bb\u7b80\u5355\u7684\u6982\u62ec\u662f\uff1a\u52a8\u6001\u6587\u4ef6\u4e0e\u9759\u6001\u6587\u4ef6\u7684\u5206\u79bb\u3002","title":"\u4ec0\u4e48\u662f\u52a8\u9759\u5206\u79bb"},{"location":"knowledge/nginx/#_12","text":"\u4e3a\u4e86\u52a0\u5feb\u7f51\u7ad9\u7684\u89e3\u6790\u901f\u5ea6\uff0c\u53ef\u4ee5\u628a\u52a8\u6001\u8d44\u6e90\u548c\u9759\u6001\u8d44\u6e90\u7528\u4e0d\u540c\u7684\u670d\u52a1\u5668\u6765\u89e3\u6790\uff0c\u52a0\u5feb\u89e3\u6790\u901f\u5ea6\u3002\u964d\u4f4e\u5355\u4e2a\u670d\u52a1\u5668\u7684\u538b\u529b\u3002","title":"\u4e3a\u4ec0\u4e48\u8981\u7528\u52a8\u9759\u5206\u79bb"},{"location":"knowledge/nginx/#nginx_1","text":"","title":"Nginx\u5b89\u88c5"},{"location":"knowledge/nginx/#windows","text":"1\u3001\u4e0b\u8f7dnginx nginx.org/en/download\u2026 \u4e0b\u8f7d\u7a33\u5b9a\u7248\u672c\u3002\u4ee5nginx/Windows-1.20.1\u4e3a\u4f8b\uff0c\u76f4\u63a5\u4e0b\u8f7d nginx-1.20.1.zip\u3002 \u4e0b\u8f7d\u540e\u89e3\u538b\uff0c\u89e3\u538b\u540e\u5982\u4e0b\uff1a 2\u3001\u542f\u52a8nginx \u76f4\u63a5\u53cc\u51fbnginx.exe\uff0c\u53cc\u51fb\u540e\u4e00\u4e2a\u9ed1\u8272\u7684\u5f39\u7a97\u4e00\u95ea\u800c\u8fc7 \u6253\u5f00cmd\u547d\u4ee4\u7a97\u53e3\uff0c\u5207\u6362\u5230nginx\u89e3\u538b\u76ee\u5f55\u4e0b\uff0c\u8f93\u5165\u547d\u4ee4 nginx.exe \uff0c\u56de\u8f66\u5373\u53ef 3\u3001\u68c0\u67e5nginx\u662f\u5426\u542f\u52a8\u6210\u529f \u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u8f93\u5165\u7f51\u5740 http://localhost:80 \u56de\u8f66\uff0c\u51fa\u73b0\u4ee5\u4e0b\u9875\u9762\u8bf4\u660e\u542f\u52a8\u6210\u529f\uff01","title":"windows\u4e0b\u5b89\u88c5"},{"location":"knowledge/nginx/#dockernginx","text":"\u6211\u4e4b\u524d\u7684\u6587\u7ae0\u4e5f\u8bb2\u8fc7Linux\u4e0b\u5b89\u88c5\u7684\u6b65\u9aa4\uff0c\u6211\u91c7\u7528\u7684\u662fdocker\u5b89\u88c5\u7684\uff0c\u5f88\u7b80\u5355\u3002 \u76f8\u5173\u94fe\u63a5\u5982\u4e0b\uff1a Docker\uff08\u4e09\uff09\uff1aDocker\u90e8\u7f72Nginx\u548cTomcat 1\u3001\u67e5\u770b\u6240\u6709\u672c\u5730\u7684\u4e3b\u673a\u4e0a\u7684\u955c\u50cf \uff0c\u4f7f\u7528\u547d\u4ee4 docker images 2\u3001\u521b\u5efa nginx \u5bb9\u5668 \u5e76\u542f\u52a8\u5bb9\u5668 \uff0c\u4f7f\u7528\u547d\u4ee4 docker run -d --name nginx01 -p 3344:80 nginx 3\u3001\u67e5\u770b\u5df2\u542f\u52a8\u7684\u5bb9\u5668 \uff0c\u4f7f\u7528\u547d\u4ee4 docker ps \u6d4f\u89c8\u5668\u8bbf\u95ee \u670d\u52a1\u5668ip:3344 \uff0c\u5982\u4e0b\uff0c\u8bf4\u660e\u5b89\u88c5\u542f\u52a8\u6210\u529f\u3002 \u6ce8\u610f \uff1a\u5982\u4f55\u8fde\u63a5\u4e0d\u4e0a\uff0c\u68c0\u67e5\u963f\u91cc\u4e91\u5b89\u5168\u7ec4\u662f\u5426\u5f00\u653e\u7aef\u53e3\uff0c\u6216\u8005\u670d\u52a1\u5668\u9632\u706b\u5899\u662f\u5426\u5f00\u653e\u7aef\u53e3\uff01","title":"Docker\u5b89\u88c5nginx"},{"location":"knowledge/nginx/#linux","text":"1\u3001\u5b89\u88c5gcc \u5b89\u88c5 nginx \u9700\u8981\u5148\u5c06\u5b98\u7f51\u4e0b\u8f7d\u7684\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\uff0c\u7f16\u8bd1\u4f9d\u8d56 gcc \u73af\u5883\uff0c\u5982\u679c\u6ca1\u6709 gcc \u73af\u5883\uff0c\u5219\u9700\u8981\u5b89\u88c5\uff1a yum install gcc-c++ \u590d\u5236\u4ee3\u7801 2\u3001PCRE pcre-devel \u5b89\u88c5 PCRE(Perl Compatible Regular Expressions) \u662f\u4e00\u4e2aPerl\u5e93\uff0c\u5305\u62ec perl \u517c\u5bb9\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5e93\u3002nginx \u7684 http \u6a21\u5757\u4f7f\u7528 pcre \u6765\u89e3\u6790\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u5728 linux \u4e0a\u5b89\u88c5 pcre \u5e93\uff0cpcre-devel \u662f\u4f7f\u7528 pcre \u5f00\u53d1\u7684\u4e00\u4e2a\u4e8c\u6b21\u5f00\u53d1\u5e93\u3002nginx\u4e5f\u9700\u8981\u6b64\u5e93\u3002\u547d\u4ee4\uff1a yum install -y pcre pcre-devel \u590d\u5236\u4ee3\u7801 3\u3001zlib \u5b89\u88c5 zlib \u5e93\u63d0\u4f9b\u4e86\u5f88\u591a\u79cd\u538b\u7f29\u548c\u89e3\u538b\u7f29\u7684\u65b9\u5f0f\uff0c nginx \u4f7f\u7528 zlib \u5bf9 http \u5305\u7684\u5185\u5bb9\u8fdb\u884c gzip \uff0c\u6240\u4ee5\u9700\u8981\u5728 Centos \u4e0a\u5b89\u88c5 zlib \u5e93\u3002 yum install -y zlib zlib-devel \u590d\u5236\u4ee3\u7801 4\u3001OpenSSL \u5b89\u88c5 OpenSSL \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u5b89\u5168\u5957\u63a5\u5b57\u5c42\u5bc6\u7801\u5e93\uff0c\u56ca\u62ec\u4e3b\u8981\u7684\u5bc6\u7801\u7b97\u6cd5\u3001\u5e38\u7528\u7684\u5bc6\u94a5\u548c\u8bc1\u4e66\u5c01\u88c5\u7ba1\u7406\u529f\u80fd\u53ca SSL \u534f\u8bae\uff0c\u5e76\u63d0\u4f9b\u4e30\u5bcc\u7684\u5e94\u7528\u7a0b\u5e8f\u4f9b\u6d4b\u8bd5\u6216\u5176\u5b83\u76ee\u7684\u4f7f\u7528\u3002 nginx \u4e0d\u4ec5\u652f\u6301 http \u534f\u8bae\uff0c\u8fd8\u652f\u6301 https\uff08\u5373\u5728ssl\u534f\u8bae\u4e0a\u4f20\u8f93http\uff09\uff0c\u6240\u4ee5\u9700\u8981\u5728 Centos \u5b89\u88c5 OpenSSL \u5e93\u3002 yum install -y openssl openssl-devel \u590d\u5236\u4ee3\u7801 5\u3001\u4e0b\u8f7d\u5b89\u88c5\u5305 \u624b\u52a8\u4e0b\u8f7d.tar.gz\u5b89\u88c5\u5305\uff0c\u5730\u5740\uff1a nginx.org/en/download\u2026 \u4e0b\u8f7d\u5b8c\u6bd5\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u4e0a /root 6\u3001\u89e3\u538b tar -zxvf nginx-1.20.1.tar.gz cd nginx-1.20.1 \u590d\u5236\u4ee3\u7801 7\u3001\u914d\u7f6e \u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5728nginx\u6839\u76ee\u5f55\u4e0b\u6267\u884c ./configue make make install \u590d\u5236\u4ee3\u7801 \u67e5\u627e\u5b89\u88c5\u8def\u5f84\uff1a whereis nginx 8\u3001\u542f\u52a8 nginx ./nginx \u590d\u5236\u4ee3\u7801 \u542f\u52a8\u6210\u529f\uff0c\u8bbf\u95ee\u9875\u9762\uff1aip:80","title":"linux\u4e0b\u5b89\u88c5"},{"location":"knowledge/nginx/#nginx_2","text":"\u6ce8\u610f`\uff1a\u4f7f\u7528Nginx\u64cd\u4f5c\u547d\u4ee4\u524d\u63d0\uff0c\u5fc5\u987b\u8fdb\u5165\u5230Nginx\u76ee\u5f55 `/usr/local/nginx/sbin 1\u3001\u67e5\u770bNginx\u7248\u672c\u53f7\uff1a ./nginx -v 2\u3001\u542f\u52a8 Nginx\uff1a ./nginx 3\u3001\u505c\u6b62 Nginx\uff1a ./nginx -s stop \u6216\u8005 ./nginx -s quit 4\u3001\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff1a ./nginx -s reload 5\u3001\u67e5\u770bnginx\u8fdb\u7a0b\uff1a ps -ef|grep nginx","title":"Nginx\u5e38\u7528\u547d\u4ee4"},{"location":"knowledge/nginx/#nginx_3","text":"Nginx\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff1a /usr/local/nginx/conf/nginx.conf Nginx\u914d\u7f6e\u6587\u4ef6\u67093\u90e8\u5206\u7ec4\u6210\uff1a 1\u3001\u5168\u5c40\u5757 \u4ece\u914d\u7f6e\u6587\u4ef6\u5f00\u59cb\u5230 events \u5757\u4e4b\u95f4\u7684\u5185\u5bb9\uff0c\u4e3b\u8981\u4f1a\u8bbe\u7f6e\u4e00\u4e9b\u5f71\u54cd nginx \u670d\u52a1\u5668\u6574\u4f53\u8fd0\u884c\u7684\u914d\u7f6e\u6307\u4ee4\uff0c\u6bd4\u5982\uff1a worker_processes 1 \u3002 \u8fd9\u662f Nginx \u670d\u52a1\u5668\u5e76\u53d1\u5904\u7406\u670d\u52a1\u7684\u5173\u952e\u914d\u7f6e\uff0cworker_processes \u503c\u8d8a\u5927\uff0c\u53ef\u4ee5\u652f\u6301\u7684\u5e76\u53d1\u5904\u7406\u91cf\u4e5f\u8d8a\u591a\uff0c\u4f46\u662f\u4f1a\u53d7\u5230\u786c\u4ef6\u3001\u8f6f\u4ef6\u7b49\u8bbe\u5907\u7684\u5236\u7ea6\u3002\u4e00\u822c\u8bbe\u7f6e\u503c\u548cCPU\u6838\u5fc3\u6570\u4e00\u81f4\u3002 2\u3001events\u5757 events \u5757\u6d89\u53ca\u7684\u6307\u4ee4\u4e3b\u8981\u5f71\u54cd Nginx \u670d\u52a1\u5668\u4e0e\u7528\u6237\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u6bd4\u5982\uff1a worker_connections 1024 \u8868\u793a\u6bcf\u4e2a work process \u652f\u6301\u7684\u6700\u5927\u8fde\u63a5\u6570\u4e3a 1024\uff0c\u8fd9\u90e8\u5206\u7684\u914d\u7f6e\u5bf9 Nginx \u7684\u6027\u80fd\u5f71\u54cd\u8f83\u5927\uff0c\u5728\u5b9e\u9645\u4e2d\u5e94\u8be5\u7075\u6d3b\u914d\u7f6e\u3002 3\u3001http\u5757 http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80;#\u76d1\u542c\u7aef\u53e3 server_name localhost;#\u57df\u540d location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } \u590d\u5236\u4ee3\u7801 \u8fd9\u7b97\u662f Nginx \u670d\u52a1\u5668\u914d\u7f6e\u4e2d\u6700\u9891\u7e41\u7684\u90e8\u5206\u3002","title":"Nginx\u914d\u7f6e\u6587\u4ef6"},{"location":"knowledge/nginx/#_13","text":"","title":"\u6f14\u793a\u793a\u4f8b"},{"location":"knowledge/nginx/#_14","text":"\u6211\u4eec\u5728windows\u4e0b\u6f14\u793a\uff0c\u9996\u5148\u6211\u4eec\u521b\u5efa\u4e24\u4e2aspringboot\u9879\u76ee\uff0c\u7aef\u53e3\u662f9001\u548c9002\uff0c\u5982\u4e0b\uff1a \u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5c06 localhost:80 \u4ee3\u7406 localhost:9001 \u548c localhost:9002 \u8fd9\u4e24\u4e2a\u670d\u52a1\uff0c\u5e76\u4e14\u8ba9\u8f6e\u8be2\u8bbf\u95ee\u8fd9\u4e24\u4e2a\u670d\u52a1\u3002 nginx\u914d\u7f6e\u5982\u4e0b\uff1a worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream jiangwang { server 127.0.0.1:9001 weight=1;//\u8f6e\u8be2\u5176\u6743\u91cd\u90fd\u9ed8\u8ba4\u4e3a1 server 127.0.0.1:9002 weight=1; } server { listen 80; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / { root html; index index.html index.htm; proxy_pass http://jiangwang; } } } \u590d\u5236\u4ee3\u7801 \u6211\u4eec\u5148\u5c06\u9879\u76ee\u6253\u6210jar\u5305\uff0c\u7136\u540e\u547d\u4ee4\u884c\u542f\u52a8\u9879\u76ee\uff0c\u7136\u540e\u5728\u6d4f\u89c8\u5668\u4e0a\u8bbf\u95ee localhost \u6765\u8bbf\u95ee\u8fd9\u4e24\u4e2a\u9879\u76ee\uff0c\u6211\u4e5f\u5728\u9879\u76ee\u4e2d\u6253\u5370\u4e86\u65e5\u5fd7\uff0c\u64cd\u4f5c\u4e00\u4e0b\u6765\u770b\u770b\u7ed3\u679c\uff0c\u662f\u4e0d\u662f\u4e24\u4e2a\u9879\u76ee\u8f6e\u8be2\u88ab\u8bbf\u95ee\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u8bbf\u95ee localhost \uff0c\u8fd9\u4e24\u4e2a\u9879\u76ee\u8f6e\u8be2\u88ab\u8bbf\u95ee\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u6743\u91cd\u6539\u4e3a\u5982\u4e0b\u8bbe\u7f6e\uff1a upstream jiangwang { server 127.0.0.1:9001 weight=1; server 127.0.0.1:9002 weight=3; } \u590d\u5236\u4ee3\u7801 \u91cd\u65b0\u52a0\u8f7d\u4e00\u4e2anginx\u7684\u914d\u7f6e\u6587\u4ef6\uff1a nginx -s reload \u52a0\u8f7d\u5b8c\u6bd5\uff0c\u6211\u4eec\u518d\u8bbf\u95ee\u5176 localhost \uff0c\u89c2\u5bdf\u5176\u8bbf\u95ee\u7684\u6bd4\u4f8b\uff1a \u7ed3\u679c\u663e\u793a\uff0c9002\u7aef\u53e3\u7684\u8bbf\u95ee\u6b21\u6570\u4e0e9001\u8bbf\u95ee\u7684\u6b21\u6570\u57fa\u672c\u4e0a\u662f 3:1 \u3002","title":"\u53cd\u5411\u4ee3\u7406/\u8d1f\u8f7d\u5747\u8861"},{"location":"knowledge/nginx/#_15","text":"1\u3001\u5c06\u9759\u6001\u8d44\u6e90\u653e\u5165\u672c\u5730\u65b0\u5efa\u7684\u6587\u4ef6\u91cc\u9762\uff0c\u4f8b\u5982\uff1a\u5728D\u76d8\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6data\uff0c\u7136\u540e\u518ddata\u6587\u4ef6\u5939\u91cc\u9762\u5728\u65b0\u5efa\u4e24\u4e2a\u6587\u4ef6\u5939\uff0c\u4e00\u4e2aimg\u6587\u4ef6\u5939\uff0c\u5b58\u653e\u56fe\u7247\uff1b\u4e00\u4e2ahtml\u6587\u4ef6\u5939\uff0c\u5b58\u653ehtml\u6587\u4ef6\uff1b\u5982\u4e0b\u56fe\uff1a 2\u3001\u5728html\u6587\u4ef6\u5939\u91cc\u9762\u65b0\u5efa\u4e00\u4e2a a.html \u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <!DOCTYPE html> <html> <head> <meta charset=\"utf-8\"> <title>Html\u6587\u4ef6</title> </head> <body> <p>Hello World</p> </body> </html> \u590d\u5236\u4ee3\u7801 3\u3001\u5728img\u6587\u4ef6\u5939\u91cc\u9762\u653e\u5165\u4e00\u5f20\u7167\u7247\uff0c\u5982\u4e0b\uff1a 4\u3001\u914d\u7f6enginx\u4e2d nginx.conf \u6587\u4ef6\uff1a location /html/ { root D:/data/; index index.html index.htm; } location /img/ { root D:/data/; autoindex on;#\u8868\u793a\u5217\u51fa\u5f53\u524d\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u5185\u5bb9 } \u590d\u5236\u4ee3\u7801 5\u3001\u542f\u52a8nginx\uff0c\u8bbf\u95ee\u5176\u6587\u4ef6\u8def\u5f84\uff0c\u5728\u6d4f\u89c8\u5668\u8f93\u5165 http://localhost/html/a.html \uff0c\u5982\u4e0b\uff1a 6\u3001\u5728\u6d4f\u89c8\u5668\u8f93\u5165 http://localhost/img/","title":"\u52a8\u9759\u5206\u79bb"},{"location":"knowledge/nginx/#nginx_4","text":"","title":"Nginx\u5de5\u4f5c\u539f\u7406"},{"location":"knowledge/nginx/#materworker","text":"master\u63a5\u6536\u4fe1\u53f7\u540e\u5c06\u4efb\u52a1\u5206\u914d\u7ed9worker\u8fdb\u884c\u6267\u884c\uff0cworker\u53ef\u6709\u591a\u4e2a\u3002","title":"mater&amp;worker"},{"location":"knowledge/nginx/#worker","text":"\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u5230master\u540e\uff0cworker\u83b7\u53d6\u4efb\u52a1\u7684\u673a\u5236\u4e0d\u662f\u76f4\u63a5\u5206\u914d\u4e5f\u4e0d\u662f\u8f6e\u8be2\uff0c\u800c\u662f\u4e00\u79cd\u4e89\u62a2\u7684\u673a\u5236\uff0c\u201c\u62a2\u201d\u5230\u4efb\u52a1\u540e\u518d\u6267\u884c\u4efb\u52a1\uff0c\u5373\u9009\u62e9\u76ee\u6807\u670d\u52a1\u5668tomcat\u7b49\uff0c\u7136\u540e\u8fd4\u56de\u7ed3\u679c\u3002","title":"worker\u5982\u4f55\u5de5\u4f5c"},{"location":"knowledge/nginx/#worker_connection","text":"\u53d1\u9001\u8bf7\u6c42\u5360\u7528\u4e86woker\u4e24\u4e2a\u6216\u56db\u4e2a\u8fde\u63a5\u6570\u3002 \u666e\u901a\u7684\u9759\u6001\u8bbf\u95ee\u6700\u5927\u5e76\u53d1\u6570\u662f\uff1a worker_connections * worker_processes/ 2 \uff0c\u82e5\u662f HTTP \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u6765\u8bf4\uff0c\u6700\u5927\u5e76\u53d1\u6570\u91cf\u5e94\u8be5\u662f worker_connections * worker_processes/ 4 \u3002\u5f53\u7136\u4e86\uff0cworker\u6570\u4e5f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0cworker\u6570\u548c\u670d\u52a1\u5668\u7684CPU\u6570\u76f8\u7b49\u65f6\u6700\u9002\u5b9c\u7684\u3002","title":"worker_connection"},{"location":"knowledge/nginx/#_16","text":"\u53ef\u4ee5\u4f7f\u7528 nginx \u2013s reload \u70ed\u90e8\u7f72\uff0c\u5229\u7528 nginx \u8fdb\u884c\u70ed\u90e8\u7f72\u64cd\u4f5c\u6bcf\u4e2a woker \u662f\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u82e5\u5176\u4e2d\u4e00\u4e2awoker\u51fa\u73b0\u95ee\u9898\uff0c\u5176\u4ed6\u7ee7\u7eed\u8fdb\u884c\u4e89\u62a2\uff0c\u5b9e\u73b0\u8bf7\u6c42\u8fc7\u7a0b\uff0c\u4e0d\u4f1a\u9020\u6210\u670d\u52a1\u4e2d\u65ad\u3002","title":"\u4f18\u70b9"},{"location":"knowledge/nginx/#_17","text":"\u5173\u4e8e Nginx \u7684\u57fa\u672c\u6982\u5ff5\u3001\u5b89\u88c5\u6559\u7a0b\u3001\u914d\u7f6e\u3001\u4f7f\u7528\u5b9e\u4f8b\u4ee5\u53ca\u5de5\u4f5c\u539f\u7406\uff0c\u672c\u6587\u90fd\u505a\u4e86\u8be6\u7ec6\u9610\u8ff0\u3002\u5e0c\u671b\u672c\u6587\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002","title":"\u603b\u7ed3"},{"location":"knowledge/nginx/#_18","text":"\u9996\u5148\u4f60\u8981\u53c2\u4e0e\u8bc4\u8bba\uff0c\u6211\u5e0c\u671b\u4f60\u80fd\u770b\u5b8c\u6587\u7ae0\uff0c\u4e0d\u8981\u53ea\u6253\u4e2a\u8868\u60c5\u7b26\u53f7\u4e4b\u7c7b\u7684\u3002 \u8bb0\u5f97 \u70b9\u8d5e\u3001\u5173\u6ce8 \uff0c\u52a8\u52a8\u4f60\u7684\u5c0f\u624b\u6307\uff0c\u8c22\u8c22\uff01 \u81f3\u4e8e\u600e\u4e48\u516c\u5e73\uff0c\u6211\u4e5f\u60f3\u4e86\u4e00\u4e0b\uff0c\u6211\u4f1a\u521b\u5efa\u4e00\u4e2a\u62bd\u5956\u7fa4\uff0c\u6211\u53d1\u7ea2\u5305\uff0c\u4f60\u4eec\u62a2\uff0c\u91d1\u989d\u6700\u5c11\u7684\u83b7\u5f97\u5956\u54c1\u3002\u6216\u8005\u4f60\u4eec\u6709\u66f4\u597d\u7684\u65b9\u5f0f\u8bc4\u8bba\u533a\u544a\u8bc9\u6211\u3002\u5982\u679c\u6211\u89c9\u5f97\u66f4\u597d\uff0c\u6211\u4f1a\u91c7\u7eb3\u3002 \u5982\u679c\u6211\u7684\u8bc4\u8bba\u533a\u70ed\u5ea6\u5728Top 1-5 \u540d\uff0c\u83b7\u5f97\u7684 \u65b0\u7248\u5fbd\u7ae01\u5957 \u6216 \u6398\u91d1\u65b0\u7248IPT\u60641\u4ef6\uff0c\u6211\u4e5f\u4f1a\u9001\u7ed9\u8bc4\u8bba\u533a\u7684\u5c0f\u4f19\u4f34\uff0c\u524d\u63d0\u4f60\u5173\u6ce8\u6211\u7684\u6211\u7684\u516c\u4f17\u53f7\uff1a\u5fae\u4fe1\u641c\u3010\u521d\u5ff5\u521d\u604b\u3011\u3002","title":"\u62bd\u5956\u7ec6\u5219"},{"location":"knowledge/woshou/","text":"https://blog.csdn.net/hyg0811/article/details/102366854 \u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u662f\u5404\u4e2a\u516c\u53f8\u5e38\u89c1\u7684\u8003\u70b9\uff0c\u4e5f\u5177\u6709\u4e00\u5b9a\u7684\u6c34\u5e73\u533a\u5206\u5ea6\uff0c\u4e5f\u88ab\u4e00\u4e9b\u9762\u8bd5\u5b98\u4f5c\u4e3a\u70ed\u8eab\u9898\u3002\u5f88\u591a\u5c0f\u4f19\u4f34\u8bf4\u8fd9\u4e2a\u95ee\u9898\u521a\u5f00\u59cb\u56de\u7b54\u7684\u633a\u597d\uff0c\u4f46\u662f\u540e\u9762\u8d8a\u56de\u7b54\u8d8a\u5192\u51b7\u6c57\uff0c\u6700\u540e\u5c31\u6b47\u83dc\u4e86\u3002 \u89c1\u8fc7\u6bd4\u8f83\u5178\u578b\u7684\u9762\u8bd5\u573a\u666f\u662f\u8fd9\u6837\u7684: \u9762\u8bd5\u5b98\uff1a\u8bf7\u4ecb\u7ecd\u4e0b\u4e09\u6b21\u63e1\u624b \u6c42\u804c\u8005\uff1a\u7b2c\u4e00\u6b21\u63e1\u624b\u5c31\u662f\u5ba2\u6237\u7aef\u7ed9\u670d\u52a1\u5668\u7aef\u53d1\u9001\u4e00\u4e2a\u62a5\u6587\uff0c\u7b2c\u4e8c\u6b21\u5c31\u662f\u670d\u52a1\u5668\u6536\u5230\u62a5\u6587\u4e4b\u540e\uff0c\u4f1a\u5e94\u7b54\u4e00\u4e2a\u62a5\u6587\u7ed9\u5ba2\u6237\u7aef\uff0c\u7b2c\u4e09\u6b21\u63e1\u624b\u5c31\u662f\u5ba2\u6237\u7aef\u6536\u5230\u62a5\u6587\u540e\u518d\u7ed9\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2a\u62a5\u6587\uff0c\u4e09\u6b21\u63e1\u624b\u5c31\u6210\u529f\u4e86\u3002 \u9762\u8bd5\u5b98\uff1a\u7136\u540e\u5462\uff1f \u6c42\u804c\u8005\uff1a\u8fd9\u5c31\u662f\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\uff0c\u5f88\u7b80\u5355\u7684\u3002 \u9762\u8bd5\u5b98\uff1a\u3002\u3002\u3002\u3002\u3002\u3002 \uff08\u756a\u5916\u7bc7\uff1a\u4e00\u9996\u51c9\u51c9\u9001\u7ed9\u4f60\uff09 \u8bb0\u4f4f\u733f\u4eba\u8c37\u4e00\u53e5\u8bdd\uff1a\u9762\u8bd5\u65f6\u8d8a\u7b80\u5355\u7684\u95ee\u9898\uff0c\u4e00\u822c\u5c31\u662f\u9690\u85cf\u7740\u6bd4\u8f83\u5927\u7684\u5751\uff0c\u4e00\u822c\u90fd\u662f\u9700\u8981\u5c06\u95ee\u9898\u6269\u5c55\u7684\u3002\u4e0a\u9762\u6c42\u804c\u8005\u7684\u56de\u7b54\u4e0d\u5bf9\u5417\uff1f\u5f53\u7136\u5bf9\uff0c\u4f46\u8ddd\u79bb\u9762\u8bd5\u5b98\u7684\u671f\u671b\u53ef\u80fd\u8fd8\u6709\u70b9\u8ddd\u79bb\u3002 \u5e0c\u671b\u5927\u5bb6\u80fd\u5e26\u7740\u5982\u4e0b\u95ee\u9898\u8fdb\u884c\u9605\u8bfb\uff0c\u6536\u83b7\u4f1a\u66f4\u5927\u3002 \u8bf7\u753b\u51fa\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u7684\u793a\u610f\u56fe \u4e3a\u4ec0\u4e48\u8fde\u63a5\u7684\u65f6\u5019\u662f\u4e09\u6b21\u63e1\u624b\uff1f \u4ec0\u4e48\u662f\u534a\u8fde\u63a5\u961f\u5217\uff1f ISN(Initial Sequence Number)\u662f\u56fa\u5b9a\u7684\u5417\uff1f \u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u5417\uff1f \u5982\u679c\u7b2c\u4e09\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u5ba2\u6237\u7aef\u670d\u52a1\u7aef\u4f1a\u5982\u4f55\u5904\u7406\uff1f SYN\u653b\u51fb\u662f\u4ec0\u4e48\uff1f \u6325\u624b\u4e3a\u4ec0\u4e48\u9700\u8981\u56db\u6b21\uff1f \u56db\u6b21\u6325\u624b\u91ca\u653e\u8fde\u63a5\u65f6\uff0c\u7b49\u5f852MSL\u7684\u610f\u4e49? \u4e09\u6b21\u63e1\u624b \u4e09\u6b21\u63e1\u624b\uff08Three-way Handshake\uff09\u5176\u5b9e\u5c31\u662f\u6307\u5efa\u7acb\u4e00\u4e2aTCP\u8fde\u63a5\u65f6\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u603b\u5171\u53d1\u90013\u4e2a\u5305\u3002\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u7684\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u4e3a\u4e86\u786e\u8ba4\u53cc\u65b9\u7684\u63a5\u6536\u80fd\u529b\u548c\u53d1\u9001\u80fd\u529b\u662f\u5426\u6b63\u5e38\u3001\u6307\u5b9a\u81ea\u5df1\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u4e3a\u540e\u9762\u7684\u53ef\u9760\u6027\u4f20\u9001\u505a\u51c6\u5907\u3002\u5b9e\u8d28\u4e0a\u5176\u5b9e\u5c31\u662f\u8fde\u63a5\u670d\u52a1\u5668\u6307\u5b9a\u7aef\u53e3\uff0c\u5efa\u7acbTCP\u8fde\u63a5\uff0c\u5e76\u540c\u6b65\u8fde\u63a5\u53cc\u65b9\u7684\u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\uff0c\u4ea4\u6362TCP\u7a97\u53e3\u5927\u5c0f\u4fe1\u606f\u3002 \u521a\u5f00\u59cb\u5ba2\u6237\u7aef\u5904\u4e8e Closed \u7684\u72b6\u6001\uff0c\u670d\u52a1\u7aef\u5904\u4e8e Listen \u72b6\u6001\u3002 \u8fdb\u884c\u4e09\u6b21\u63e1\u624b\uff1a \u7b2c\u4e00\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u7ed9\u670d\u52a1\u7aef\u53d1\u4e00\u4e2a SYN \u62a5\u6587\uff0c\u5e76\u6307\u660e\u5ba2\u6237\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7 ISN\u3002\u6b64\u65f6\u5ba2\u6237\u7aef\u5904\u4e8e SYN_SENT \u72b6\u6001\u3002 \u9996\u90e8\u7684\u540c\u6b65\u4f4dSYN=1\uff0c\u521d\u59cb\u5e8f\u53f7seq=x\uff0cSYN=1\u7684\u62a5\u6587\u6bb5\u4e0d\u80fd\u643a\u5e26\u6570\u636e\uff0c\u4f46\u8981\u6d88\u8017\u6389\u4e00\u4e2a\u5e8f\u53f7\u3002 \u7b2c\u4e8c\u6b21\u63e1\u624b\uff1a\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u4e4b\u540e\uff0c\u4f1a\u4ee5\u81ea\u5df1\u7684 SYN \u62a5\u6587\u4f5c\u4e3a\u5e94\u7b54\uff0c\u5e76\u4e14\u4e5f\u662f\u6307\u5b9a\u4e86\u81ea\u5df1\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7 ISN(s)\u3002\u540c\u65f6\u4f1a\u628a\u5ba2\u6237\u7aef\u7684 ISN + 1 \u4f5c\u4e3aACK \u7684\u503c\uff0c\u8868\u793a\u81ea\u5df1\u5df2\u7ecf\u6536\u5230\u4e86\u5ba2\u6237\u7aef\u7684 SYN\uff0c\u6b64\u65f6\u670d\u52a1\u5668\u5904\u4e8e SYN_RCVD \u7684\u72b6\u6001\u3002 \u5728\u786e\u8ba4\u62a5\u6587\u6bb5\u4e2dSYN=1\uff0cACK=1\uff0c\u786e\u8ba4\u53f7ack=x+1\uff0c\u521d\u59cb\u5e8f\u53f7seq=y\u3002 \u7b2c\u4e09\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u6536\u5230 SYN \u62a5\u6587\u4e4b\u540e\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a ACK \u62a5\u6587\uff0c\u5f53\u7136\uff0c\u4e5f\u662f\u4e00\u6837\u628a\u670d\u52a1\u5668\u7684 ISN + 1 \u4f5c\u4e3a ACK \u7684\u503c\uff0c\u8868\u793a\u5df2\u7ecf\u6536\u5230\u4e86\u670d\u52a1\u7aef\u7684 SYN \u62a5\u6587\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5904\u4e8e ESTABLISHED \u72b6\u6001\u3002\u670d\u52a1\u5668\u6536\u5230 ACK \u62a5\u6587\u4e4b\u540e\uff0c\u4e5f\u5904\u4e8e ESTABLISHED \u72b6\u6001\uff0c\u6b64\u65f6\uff0c\u53cc\u65b9\u5df2\u5efa\u7acb\u8d77\u4e86\u8fde\u63a5\u3002 \u786e\u8ba4\u62a5\u6587\u6bb5ACK=1\uff0c\u786e\u8ba4\u53f7ack=y+1\uff0c\u5e8f\u53f7seq=x+1\uff08\u521d\u59cb\u4e3aseq=x\uff0c\u7b2c\u4e8c\u4e2a\u62a5\u6587\u6bb5\u6240\u4ee5\u8981+1\uff09\uff0cACK\u62a5\u6587\u6bb5\u53ef\u4ee5\u643a\u5e26\u6570\u636e\uff0c\u4e0d\u643a\u5e26\u6570\u636e\u5219\u4e0d\u6d88\u8017\u5e8f\u53f7\u3002 \u53d1\u9001\u7b2c\u4e00\u4e2aSYN\u7684\u4e00\u7aef\u5c06\u6267\u884c\u4e3b\u52a8\u6253\u5f00\uff08active open\uff09\uff0c\u63a5\u6536\u8fd9\u4e2aSYN\u5e76\u53d1\u56de\u4e0b\u4e00\u4e2aSYN\u7684\u53e6\u4e00\u7aef\u6267\u884c\u88ab\u52a8\u6253\u5f00\uff08passive open\uff09\u3002 \u5728socket\u7f16\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u6267\u884cconnect()\u65f6\uff0c\u5c06\u89e6\u53d1\u4e09\u6b21\u63e1\u624b\u3002 1.1 \u4e3a\u4ec0\u4e48\u9700\u8981\u4e09\u6b21\u63e1\u624b\uff0c\u4e24\u6b21\u4e0d\u884c\u5417\uff1f \u5f04\u6e05\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u5148\u5f04\u660e\u767d\u4e09\u6b21\u63e1\u624b\u7684\u76ee\u7684\u662f\u4ec0\u4e48\uff0c\u80fd\u4e0d\u80fd\u53ea\u7528\u4e24\u6b21\u63e1\u624b\u6765\u8fbe\u5230\u540c\u6837\u7684\u76ee\u7684\u3002 \u7b2c\u4e00\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u7f51\u7edc\u5305\uff0c\u670d\u52a1\u7aef\u6536\u5230\u4e86\u3002 \u8fd9\u6837\u670d\u52a1\u7aef\u5c31\u80fd\u5f97\u51fa\u7ed3\u8bba\uff1a\u5ba2\u6237\u7aef\u7684\u53d1\u9001\u80fd\u529b\u3001\u670d\u52a1\u7aef\u7684\u63a5\u6536\u80fd\u529b\u662f\u6b63\u5e38\u7684\u3002 \u7b2c\u4e8c\u6b21\u63e1\u624b\uff1a\u670d\u52a1\u7aef\u53d1\u5305\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u4e86\u3002 \u8fd9\u6837\u5ba2\u6237\u7aef\u5c31\u80fd\u5f97\u51fa\u7ed3\u8bba\uff1a\u670d\u52a1\u7aef\u7684\u63a5\u6536\u3001\u53d1\u9001\u80fd\u529b\uff0c\u5ba2\u6237\u7aef\u7684\u63a5\u6536\u3001\u53d1\u9001\u80fd\u529b\u662f\u6b63\u5e38\u7684\u3002\u4e0d\u8fc7\u6b64\u65f6\u670d\u52a1\u5668\u5e76\u4e0d\u80fd\u786e\u8ba4\u5ba2\u6237\u7aef\u7684\u63a5\u6536\u80fd\u529b\u662f\u5426\u6b63\u5e38\u3002 \u7b2c\u4e09\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u53d1\u5305\uff0c\u670d\u52a1\u7aef\u6536\u5230\u4e86\u3002 \u8fd9\u6837\u670d\u52a1\u7aef\u5c31\u80fd\u5f97\u51fa\u7ed3\u8bba\uff1a\u5ba2\u6237\u7aef\u7684\u63a5\u6536\u3001\u53d1\u9001\u80fd\u529b\u6b63\u5e38\uff0c\u670d\u52a1\u5668\u81ea\u5df1\u7684\u53d1\u9001\u3001\u63a5\u6536\u80fd\u529b\u4e5f\u6b63\u5e38\u3002 \u56e0\u6b64\uff0c\u9700\u8981\u4e09\u6b21\u63e1\u624b\u624d\u80fd\u786e\u8ba4\u53cc\u65b9\u7684\u63a5\u6536\u4e0e\u53d1\u9001\u80fd\u529b\u662f\u5426\u6b63\u5e38\u3002 \u8bd5\u60f3\u5982\u679c\u662f\u7528\u4e24\u6b21\u63e1\u624b\uff0c\u5219\u4f1a\u51fa\u73b0\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5\uff1a \u5982\u5ba2\u6237\u7aef\u53d1\u51fa\u8fde\u63a5\u8bf7\u6c42\uff0c\u4f46\u56e0\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\u4e22\u5931\u800c\u672a\u6536\u5230\u786e\u8ba4\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u518d\u91cd\u4f20\u4e00\u6b21\u8fde\u63a5\u8bf7\u6c42\u3002\u540e\u6765\u6536\u5230\u4e86\u786e\u8ba4\uff0c\u5efa\u7acb\u4e86\u8fde\u63a5\u3002\u6570\u636e\u4f20\u8f93\u5b8c\u6bd5\u540e\uff0c\u5c31\u91ca\u653e\u4e86\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u5171\u53d1\u51fa\u4e86\u4e24\u4e2a\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\u6bb5\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u4e22\u5931\uff0c\u7b2c\u4e8c\u4e2a\u5230\u8fbe\u4e86\u670d\u52a1\u7aef\uff0c\u4f46\u662f\u7b2c\u4e00\u4e2a\u4e22\u5931\u7684\u62a5\u6587\u6bb5\u53ea\u662f\u5728\u67d0\u4e9b\u7f51\u7edc\u7ed3\u70b9\u957f\u65f6\u95f4\u6ede\u7559\u4e86\uff0c\u5ef6\u8bef\u5230\u8fde\u63a5\u91ca\u653e\u4ee5\u540e\u7684\u67d0\u4e2a\u65f6\u95f4\u624d\u5230\u8fbe\u670d\u52a1\u7aef\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u8bef\u8ba4\u4e3a\u5ba2\u6237\u7aef\u53c8\u53d1\u51fa\u4e00\u6b21\u65b0\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u4e8e\u662f\u5c31\u5411\u5ba2\u6237\u7aef\u53d1\u51fa\u786e\u8ba4\u62a5\u6587\u6bb5\uff0c\u540c\u610f\u5efa\u7acb\u8fde\u63a5\uff0c\u4e0d\u91c7\u7528\u4e09\u6b21\u63e1\u624b\uff0c\u53ea\u8981\u670d\u52a1\u7aef\u53d1\u51fa\u786e\u8ba4\uff0c\u5c31\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u4e86\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5ffd\u7565\u670d\u52a1\u7aef\u53d1\u6765\u7684\u786e\u8ba4\uff0c\u4e5f\u4e0d\u53d1\u9001\u6570\u636e\uff0c\u5219\u670d\u52a1\u7aef\u4e00\u81f4\u7b49\u5f85\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\uff0c\u6d6a\u8d39\u8d44\u6e90\u3002 1.2 \u4ec0\u4e48\u662f\u534a\u8fde\u63a5\u961f\u5217\uff1f \u670d\u52a1\u5668\u7b2c\u4e00\u6b21\u6536\u5230\u5ba2\u6237\u7aef\u7684 SYN \u4e4b\u540e\uff0c\u5c31\u4f1a\u5904\u4e8e SYN_RCVD \u72b6\u6001\uff0c\u6b64\u65f6\u53cc\u65b9\u8fd8\u6ca1\u6709\u5b8c\u5168\u5efa\u7acb\u5176\u8fde\u63a5\uff0c\u670d\u52a1\u5668\u4f1a\u628a\u6b64\u79cd\u72b6\u6001\u4e0b\u8bf7\u6c42\u8fde\u63a5\u653e\u5728\u4e00\u4e2a\u961f\u5217\u91cc\uff0c\u6211\u4eec\u628a\u8fd9\u79cd\u961f\u5217\u79f0\u4e4b\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u3002 \u5f53\u7136\u8fd8\u6709\u4e00\u4e2a\u5168\u8fde\u63a5\u961f\u5217\uff0c\u5c31\u662f\u5df2\u7ecf\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\uff0c\u5efa\u7acb\u8d77\u8fde\u63a5\u7684\u5c31\u4f1a\u653e\u5728\u5168\u8fde\u63a5\u961f\u5217\u4e2d\u3002\u5982\u679c\u961f\u5217\u6ee1\u4e86\u5c31\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e22\u5305\u73b0\u8c61\u3002 \u8fd9\u91cc\u5728\u8865\u5145\u4e00\u70b9\u5173\u4e8eSYN-ACK \u91cd\u4f20\u6b21\u6570\u7684\u95ee\u9898\uff1a \u670d\u52a1\u5668\u53d1\u9001\u5b8cSYN-ACK\u5305\uff0c\u5982\u679c\u672a\u6536\u5230\u5ba2\u6237\u786e\u8ba4\u5305\uff0c\u670d\u52a1\u5668\u8fdb\u884c\u9996\u6b21\u91cd\u4f20\uff0c\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u4ecd\u672a\u6536\u5230\u5ba2\u6237\u786e\u8ba4\u5305\uff0c\u8fdb\u884c\u7b2c\u4e8c\u6b21\u91cd\u4f20\u3002\u5982\u679c\u91cd\u4f20\u6b21\u6570\u8d85\u8fc7\u7cfb\u7edf\u89c4\u5b9a\u7684\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u7cfb\u7edf\u5c06\u8be5\u8fde\u63a5\u4fe1\u606f\u4ece\u534a\u8fde\u63a5\u961f\u5217\u4e2d\u5220\u9664\u3002 \u6ce8\u610f\uff0c\u6bcf\u6b21\u91cd\u4f20\u7b49\u5f85\u7684\u65f6\u95f4\u4e0d\u4e00\u5b9a\u76f8\u540c\uff0c\u4e00\u822c\u4f1a\u662f\u6307\u6570\u589e\u957f\uff0c\u4f8b\u5982\u95f4\u9694\u65f6\u95f4\u4e3a 1s\uff0c2s\uff0c4s\uff0c8s\u2026 1.3 ISN(Initial Sequence Number)\u662f\u56fa\u5b9a\u7684\u5417\uff1f \u5f53\u4e00\u7aef\u4e3a\u5efa\u7acb\u8fde\u63a5\u800c\u53d1\u9001\u5b83\u7684SYN\u65f6\uff0c\u5b83\u4e3a\u8fde\u63a5\u9009\u62e9\u4e00\u4e2a\u521d\u59cb\u5e8f\u53f7\u3002ISN\u968f\u65f6\u95f4\u800c\u53d8\u5316\uff0c\u56e0\u6b64\u6bcf\u4e2a\u8fde\u63a5\u90fd\u5c06\u5177\u6709\u4e0d\u540c\u7684ISN\u3002ISN\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a32\u6bd4\u7279\u7684\u8ba1\u6570\u5668\uff0c\u6bcf4ms\u52a01 \u3002\u8fd9\u6837\u9009\u62e9\u5e8f\u53f7\u7684\u76ee\u7684\u5728\u4e8e\u9632\u6b62\u5728\u7f51\u7edc\u4e2d\u88ab\u5ef6\u8fdf\u7684\u5206\u7ec4\u5728\u4ee5\u540e\u53c8\u88ab\u4f20\u9001\uff0c\u800c\u5bfc\u81f4\u67d0\u4e2a\u8fde\u63a5\u7684\u4e00\u65b9\u5bf9\u5b83\u505a\u9519\u8bef\u7684\u89e3\u91ca\u3002 \u4e09\u6b21\u63e1\u624b\u7684\u5176\u4e2d\u4e00\u4e2a\u91cd\u8981\u529f\u80fd\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4ea4\u6362 ISN(Initial Sequence Number)\uff0c\u4ee5\u4fbf\u8ba9\u5bf9\u65b9\u77e5\u9053\u63a5\u4e0b\u6765\u63a5\u6536\u6570\u636e\u7684\u65f6\u5019\u5982\u4f55\u6309\u5e8f\u5217\u53f7\u7ec4\u88c5\u6570\u636e\u3002\u5982\u679c ISN \u662f\u56fa\u5b9a\u7684\uff0c\u653b\u51fb\u8005\u5f88\u5bb9\u6613\u731c\u51fa\u540e\u7eed\u7684\u786e\u8ba4\u53f7\uff0c\u56e0\u6b64 ISN \u662f\u52a8\u6001\u751f\u6210\u7684\u3002 1.4 \u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u5417\uff1f \u5176\u5b9e\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0c\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\u3002\u4f46\u662f\uff0c\u7b2c\u4e00\u6b21\u3001\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e0d\u53ef\u4ee5\u643a\u5e26\u6570\u636e \u4e3a\u4ec0\u4e48\u8fd9\u6837\u5462?\u5927\u5bb6\u53ef\u4ee5\u60f3\u4e00\u4e2a\u95ee\u9898\uff0c\u5047\u5982\u7b2c\u4e00\u6b21\u63e1\u624b\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\u8bdd\uff0c\u5982\u679c\u6709\u4eba\u8981\u6076\u610f\u653b\u51fb\u670d\u52a1\u5668\uff0c\u90a3\u4ed6\u6bcf\u6b21\u90fd\u5728\u7b2c\u4e00\u6b21\u63e1\u624b\u4e2d\u7684 SYN \u62a5\u6587\u4e2d\u653e\u5165\u5927\u91cf\u7684\u6570\u636e\u3002\u56e0\u4e3a\u653b\u51fb\u8005\u6839\u672c\u5c31\u4e0d\u7406\u670d\u52a1\u5668\u7684\u63a5\u6536\u3001\u53d1\u9001\u80fd\u529b\u662f\u5426\u6b63\u5e38\uff0c\u7136\u540e\u75af\u72c2\u7740\u91cd\u590d\u53d1 SYN \u62a5\u6587\u7684\u8bdd\uff0c\u8fd9\u4f1a\u8ba9\u670d\u52a1\u5668\u82b1\u8d39\u5f88\u591a\u65f6\u95f4\u3001\u5185\u5b58\u7a7a\u95f4\u6765\u63a5\u6536\u8fd9\u4e9b\u62a5\u6587\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u7b2c\u4e00\u6b21\u63e1\u624b\u4e0d\u53ef\u4ee5\u653e\u6570\u636e\uff0c\u5176\u4e2d\u4e00\u4e2a\u7b80\u5355\u7684\u539f\u56e0\u5c31\u662f\u4f1a\u8ba9\u670d\u52a1\u5668\u66f4\u52a0\u5bb9\u6613\u53d7\u5230\u653b\u51fb\u4e86\u3002\u800c\u5bf9\u4e8e\u7b2c\u4e09\u6b21\u7684\u8bdd\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5df2\u7ecf\u5904\u4e8e ESTABLISHED \u72b6\u6001\u3002\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u4ed6\u5df2\u7ecf\u5efa\u7acb\u8d77\u8fde\u63a5\u4e86\uff0c\u5e76\u4e14\u4e5f\u5df2\u7ecf\u77e5\u9053\u670d\u52a1\u5668\u7684\u63a5\u6536\u3001\u53d1\u9001\u80fd\u529b\u662f\u6b63\u5e38\u7684\u4e86\uff0c\u6240\u4ee5\u80fd\u643a\u5e26\u6570\u636e\u4e5f\u6ca1\u5565\u6bdb\u75c5\u3002 1.5 SYN\u653b\u51fb\u662f\u4ec0\u4e48\uff1f \u670d\u52a1\u5668\u7aef\u7684\u8d44\u6e90\u5206\u914d\u662f\u5728\u4e8c\u6b21\u63e1\u624b\u65f6\u5206\u914d\u7684\uff0c\u800c\u5ba2\u6237\u7aef\u7684\u8d44\u6e90\u662f\u5728\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u65f6\u5206\u914d\u7684\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u5bb9\u6613\u53d7\u5230SYN\u6d2a\u6cdb\u653b\u51fb\u3002SYN\u653b\u51fb\u5c31\u662fClient\u5728\u77ed\u65f6\u95f4\u5185\u4f2a\u9020\u5927\u91cf\u4e0d\u5b58\u5728\u7684IP\u5730\u5740\uff0c\u5e76\u5411Server\u4e0d\u65ad\u5730\u53d1\u9001SYN\u5305\uff0cServer\u5219\u56de\u590d\u786e\u8ba4\u5305\uff0c\u5e76\u7b49\u5f85Client\u786e\u8ba4\uff0c\u7531\u4e8e\u6e90\u5730\u5740\u4e0d\u5b58\u5728\uff0c\u56e0\u6b64Server\u9700\u8981\u4e0d\u65ad\u91cd\u53d1\u76f4\u81f3\u8d85\u65f6\uff0c\u8fd9\u4e9b\u4f2a\u9020\u7684SYN\u5305\u5c06\u957f\u65f6\u95f4\u5360\u7528\u672a\u8fde\u63a5\u961f\u5217\uff0c\u5bfc\u81f4\u6b63\u5e38\u7684SYN\u8bf7\u6c42\u56e0\u4e3a\u961f\u5217\u6ee1\u800c\u88ab\u4e22\u5f03\uff0c\u4ece\u800c\u5f15\u8d77\u7f51\u7edc\u62e5\u585e\u751a\u81f3\u7cfb\u7edf\u762b\u75ea\u3002SYN \u653b\u51fb\u662f\u4e00\u79cd\u5178\u578b\u7684 DoS/DDoS \u653b\u51fb\u3002 \u68c0\u6d4b SYN \u653b\u51fb\u975e\u5e38\u7684\u65b9\u4fbf\uff0c\u5f53\u4f60\u5728\u670d\u52a1\u5668\u4e0a\u770b\u5230\u5927\u91cf\u7684\u534a\u8fde\u63a5\u72b6\u6001\u65f6\uff0c\u7279\u522b\u662f\u6e90IP\u5730\u5740\u662f\u968f\u673a\u7684\uff0c\u57fa\u672c\u4e0a\u53ef\u4ee5\u65ad\u5b9a\u8fd9\u662f\u4e00\u6b21SYN\u653b\u51fb\u3002\u5728 Linux/Unix \u4e0a\u53ef\u4ee5\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684 netstat \u547d\u4ee4\u6765\u68c0\u6d4b SYN \u653b\u51fb\u3002 netstat -n -p TCP | grep SYN_RECV 1 \u5e38\u89c1\u7684\u9632\u5fa1 SYN \u653b\u51fb\u7684\u65b9\u6cd5\u6709\u5982\u4e0b\u51e0\u79cd\uff1a \u7f29\u77ed\u8d85\u65f6\uff08SYN Timeout\uff09\u65f6\u95f4 \u589e\u52a0\u6700\u5927\u534a\u8fde\u63a5\u6570 \u8fc7\u6ee4\u7f51\u5173\u9632\u62a4 SYN cookies\u6280\u672f 2. \u56db\u6b21\u6325\u624b \u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u9700\u8981\u4e09\u6b21\u63e1\u624b\uff0c\u800c\u7ec8\u6b62\u4e00\u4e2a\u8fde\u63a5\u8981\u7ecf\u8fc7\u56db\u6b21\u6325\u624b\uff08\u4e5f\u6709\u5c06\u56db\u6b21\u6325\u624b\u53eb\u505a\u56db\u6b21\u63e1\u624b\u7684\uff09\u3002\u8fd9\u7531TCP\u7684\u534a\u5173\u95ed\uff08half-close\uff09\u9020\u6210\u7684\u3002\u6240\u8c13\u7684\u534a\u5173\u95ed\uff0c\u5176\u5b9e\u5c31\u662fTCP\u63d0\u4f9b\u4e86\u8fde\u63a5\u7684\u4e00\u7aef\u5728\u7ed3\u675f\u5b83\u7684\u53d1\u9001\u540e\u8fd8\u80fd\u63a5\u6536\u6765\u81ea\u53e6\u4e00\u7aef\u6570\u636e\u7684\u80fd\u529b\u3002 TCP \u8fde\u63a5\u7684\u62c6\u9664\u9700\u8981\u53d1\u9001\u56db\u4e2a\u5305\uff0c\u56e0\u6b64\u79f0\u4e3a\u56db\u6b21\u6325\u624b(Four-way handshake)\uff0c\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u7aef\u5747\u53ef\u4e3b\u52a8\u53d1\u8d77\u6325\u624b\u52a8\u4f5c\u3002 \u521a\u5f00\u59cb\u53cc\u65b9\u90fd\u5904\u4e8eESTABLISHED \u72b6\u6001\uff0c\u5047\u5982\u662f\u5ba2\u6237\u7aef\u5148\u53d1\u8d77\u5173\u95ed\u8bf7\u6c42\u3002\u56db\u6b21\u6325\u624b\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a \u7b2c\u4e00\u6b21\u6325\u624b\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a FIN \u62a5\u6587\uff0c\u62a5\u6587\u4e2d\u4f1a\u6307\u5b9a\u4e00\u4e2a\u5e8f\u5217\u53f7\u3002\u6b64\u65f6\u5ba2\u6237\u7aef\u5904\u4e8e FIN_WAIT1 \u72b6\u6001\u3002 \u5373\u53d1\u51fa\u8fde\u63a5\u91ca\u653e\u62a5\u6587\u6bb5\uff08FIN=1\uff0c\u5e8f\u53f7seq=u\uff09\uff0c\u5e76\u505c\u6b62\u518d\u53d1\u9001\u6570\u636e\uff0c\u4e3b\u52a8\u5173\u95edTCP\u8fde\u63a5\uff0c\u8fdb\u5165FIN_WAIT1\uff08\u7ec8\u6b62\u7b49\u5f851\uff09\u72b6\u6001\uff0c\u7b49\u5f85\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u3002 \u7b2c\u4e8c\u6b21\u6325\u624b\uff1a\u670d\u52a1\u7aef\u6536\u5230 FIN \u4e4b\u540e\uff0c\u4f1a\u53d1\u9001 ACK \u62a5\u6587\uff0c\u4e14\u628a\u5ba2\u6237\u7aef\u7684\u5e8f\u5217\u53f7\u503c +1 \u4f5c\u4e3a ACK \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u503c\uff0c\u8868\u660e\u5df2\u7ecf\u6536\u5230\u5ba2\u6237\u7aef\u7684\u62a5\u6587\u4e86\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u5904\u4e8e CLOSE_WAIT \u72b6\u6001\u3002 \u5373\u670d\u52a1\u7aef\u6536\u5230\u8fde\u63a5\u91ca\u653e\u62a5\u6587\u6bb5\u540e\u5373\u53d1\u51fa\u786e\u8ba4\u62a5\u6587\u6bb5\uff08ACK=1\uff0c\u786e\u8ba4\u53f7ack=u+1\uff0c\u5e8f\u53f7seq=v\uff09\uff0c\u670d\u52a1\u7aef\u8fdb\u5165CLOSE_WAIT\uff08\u5173\u95ed\u7b49\u5f85\uff09\u72b6\u6001\uff0c\u6b64\u65f6\u7684TCP\u5904\u4e8e\u534a\u5173\u95ed\u72b6\u6001\uff0c\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u8fde\u63a5\u91ca\u653e\u3002\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u540e\uff0c\u8fdb\u5165FIN_WAIT2\uff08\u7ec8\u6b62\u7b49\u5f852\uff09\u72b6\u6001\uff0c\u7b49\u5f85\u670d\u52a1\u7aef\u53d1\u51fa\u7684\u8fde\u63a5\u91ca\u653e\u62a5\u6587\u6bb5\u3002 \u7b2c\u4e09\u6b21\u6325\u624b\uff1a\u5982\u679c\u670d\u52a1\u7aef\u4e5f\u60f3\u65ad\u5f00\u8fde\u63a5\u4e86\uff0c\u548c\u5ba2\u6237\u7aef\u7684\u7b2c\u4e00\u6b21\u6325\u624b\u4e00\u6837\uff0c\u53d1\u7ed9 FIN \u62a5\u6587\uff0c\u4e14\u6307\u5b9a\u4e00\u4e2a\u5e8f\u5217\u53f7\u3002\u6b64\u65f6\u670d\u52a1\u7aef\u5904\u4e8e LAST_ACK \u7684\u72b6\u6001\u3002 \u5373\u670d\u52a1\u7aef\u6ca1\u6709\u8981\u5411\u5ba2\u6237\u7aef\u53d1\u51fa\u7684\u6570\u636e\uff0c\u670d\u52a1\u7aef\u53d1\u51fa\u8fde\u63a5\u91ca\u653e\u62a5\u6587\u6bb5\uff08FIN=1\uff0cACK=1\uff0c\u5e8f\u53f7seq=w\uff0c\u786e\u8ba4\u53f7ack=u+1\uff09\uff0c\u670d\u52a1\u7aef\u8fdb\u5165LAST_ACK\uff08\u6700\u540e\u786e\u8ba4\uff09\u72b6\u6001\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u786e\u8ba4\u3002 \u7b2c\u56db\u6b21\u6325\u624b\uff1a\u5ba2\u6237\u7aef\u6536\u5230 FIN \u4e4b\u540e\uff0c\u4e00\u6837\u53d1\u9001\u4e00\u4e2a ACK \u62a5\u6587\u4f5c\u4e3a\u5e94\u7b54\uff0c\u4e14\u628a\u670d\u52a1\u7aef\u7684\u5e8f\u5217\u53f7\u503c +1 \u4f5c\u4e3a\u81ea\u5df1 ACK \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u503c\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5904\u4e8e TIME_WAIT \u72b6\u6001\u3002\u9700\u8981\u8fc7\u4e00\u9635\u5b50\u4ee5\u786e\u4fdd\u670d\u52a1\u7aef\u6536\u5230\u81ea\u5df1\u7684 ACK \u62a5\u6587\u4e4b\u540e\u624d\u4f1a\u8fdb\u5165 CLOSED \u72b6\u6001\uff0c\u670d\u52a1\u7aef\u6536\u5230 ACK \u62a5\u6587\u4e4b\u540e\uff0c\u5c31\u5904\u4e8e\u5173\u95ed\u8fde\u63a5\u4e86\uff0c\u5904\u4e8e CLOSED \u72b6\u6001\u3002 \u5373\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684\u8fde\u63a5\u91ca\u653e\u62a5\u6587\u6bb5\u540e\uff0c\u5bf9\u6b64\u53d1\u51fa\u786e\u8ba4\u62a5\u6587\u6bb5\uff08ACK=1\uff0cseq=u+1\uff0cack=w+1\uff09\uff0c\u5ba2\u6237\u7aef\u8fdb\u5165TIME_WAIT\uff08\u65f6\u95f4\u7b49\u5f85\uff09\u72b6\u6001\u3002\u6b64\u65f6TCP\u672a\u91ca\u653e\u6389\uff0c\u9700\u8981\u7ecf\u8fc7\u65f6\u95f4\u7b49\u5f85\u8ba1\u65f6\u5668\u8bbe\u7f6e\u7684\u65f6\u95f42MSL\u540e\uff0c\u5ba2\u6237\u7aef\u624d\u8fdb\u5165CLOSED\u72b6\u6001\u3002 \u6536\u5230\u4e00\u4e2aFIN\u53ea\u610f\u5473\u7740\u5728\u8fd9\u4e00\u65b9\u5411\u4e0a\u6ca1\u6709\u6570\u636e\u6d41\u52a8\u3002\u5ba2\u6237\u7aef\u6267\u884c\u4e3b\u52a8\u5173\u95ed\u5e76\u8fdb\u5165TIME_WAIT\u662f\u6b63\u5e38\u7684\uff0c\u670d\u52a1\u7aef\u901a\u5e38\u6267\u884c\u88ab\u52a8\u5173\u95ed\uff0c\u4e0d\u4f1a\u8fdb\u5165TIME_WAIT\u72b6\u6001\u3002 \u5728socket\u7f16\u7a0b\u4e2d\uff0c\u4efb\u4f55\u4e00\u65b9\u6267\u884cclose()\u64cd\u4f5c\u5373\u53ef\u4ea7\u751f\u6325\u624b\u64cd\u4f5c\u3002 2.1 \u6325\u624b\u4e3a\u4ec0\u4e48\u9700\u8981\u56db\u6b21\uff1f \u56e0\u4e3a\u5f53\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684SYN\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u53d1\u9001SYN+ACK\u62a5\u6587\u3002\u5176\u4e2dACK\u62a5\u6587\u662f\u7528\u6765\u5e94\u7b54\u7684\uff0cSYN\u62a5\u6587\u662f\u7528\u6765\u540c\u6b65\u7684\u3002\u4f46\u662f\u5173\u95ed\u8fde\u63a5\u65f6\uff0c\u5f53\u670d\u52a1\u7aef\u6536\u5230FIN\u62a5\u6587\u65f6\uff0c\u5f88\u53ef\u80fd\u5e76\u4e0d\u4f1a\u7acb\u5373\u5173\u95edSOCKET\uff0c\u6240\u4ee5\u53ea\u80fd\u5148\u56de\u590d\u4e00\u4e2aACK\u62a5\u6587\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u201c\u4f60\u53d1\u7684FIN\u62a5\u6587\u6211\u6536\u5230\u4e86\u201d\u3002\u53ea\u6709\u7b49\u5230\u6211\u670d\u52a1\u7aef\u6240\u6709\u7684\u62a5\u6587\u90fd\u53d1\u9001\u5b8c\u4e86\uff0c\u6211\u624d\u80fd\u53d1\u9001FIN\u62a5\u6587\uff0c\u56e0\u6b64\u4e0d\u80fd\u4e00\u8d77\u53d1\u9001\u3002\u6545\u9700\u8981\u56db\u6b21\u6325\u624b\u3002 2.2 2MSL\u7b49\u5f85\u72b6\u6001 TIME_WAIT\u72b6\u6001\u4e5f\u6210\u4e3a2MSL\u7b49\u5f85\u72b6\u6001\u3002\u6bcf\u4e2a\u5177\u4f53TCP\u5b9e\u73b0\u5fc5\u987b\u9009\u62e9\u4e00\u4e2a\u62a5\u6587\u6bb5\u6700\u5927\u751f\u5b58\u65f6\u95f4MSL\uff08Maximum Segment Lifetime\uff09\uff0c\u5b83\u662f\u4efb\u4f55\u62a5\u6587\u6bb5\u88ab\u4e22\u5f03\u524d\u5728\u7f51\u7edc\u5185\u7684\u6700\u957f\u65f6\u95f4\u3002\u8fd9\u4e2a\u65f6\u95f4\u662f\u6709\u9650\u7684\uff0c\u56e0\u4e3aTCP\u62a5\u6587\u6bb5\u4ee5IP\u6570\u636e\u62a5\u5728\u7f51\u7edc\u5185\u4f20\u8f93\uff0c\u800cIP\u6570\u636e\u62a5\u5219\u6709\u9650\u5236\u5176\u751f\u5b58\u65f6\u95f4\u7684TTL\u5b57\u6bb5\u3002 \u5bf9\u4e00\u4e2a\u5177\u4f53\u5b9e\u73b0\u6240\u7ed9\u5b9a\u7684MSL\u503c\uff0c\u5904\u7406\u7684\u539f\u5219\u662f\uff1a\u5f53TCP\u6267\u884c\u4e00\u4e2a\u4e3b\u52a8\u5173\u95ed\uff0c\u5e76\u53d1\u56de\u6700\u540e\u4e00\u4e2aACK\uff0c\u8be5\u8fde\u63a5\u5fc5\u987b\u5728TIME_WAIT\u72b6\u6001\u505c\u7559\u7684\u65f6\u95f4\u4e3a2\u500d\u7684MSL\u3002\u8fd9\u6837\u53ef\u8ba9TCP\u518d\u6b21\u53d1\u9001\u6700\u540e\u7684ACK\u4ee5\u9632\u8fd9\u4e2aACK\u4e22\u5931\uff08\u53e6\u4e00\u7aef\u8d85\u65f6\u5e76\u91cd\u53d1\u6700\u540e\u7684FIN\uff09\u3002 \u8fd9\u79cd2MSL\u7b49\u5f85\u7684\u53e6\u4e00\u4e2a\u7ed3\u679c\u662f\u8fd9\u4e2aTCP\u8fde\u63a5\u57282MSL\u7b49\u5f85\u671f\u95f4\uff0c\u5b9a\u4e49\u8fd9\u4e2a\u8fde\u63a5\u7684\u63d2\u53e3\uff08\u5ba2\u6237\u7684IP\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u670d\u52a1\u5668\u7684IP\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff09\u4e0d\u80fd\u518d\u88ab\u4f7f\u7528\u3002\u8fd9\u4e2a\u8fde\u63a5\u53ea\u80fd\u57282MSL\u7ed3\u675f\u540e\u624d\u80fd\u518d\u88ab\u4f7f\u7528\u3002 2.3 \u56db\u6b21\u6325\u624b\u91ca\u653e\u8fde\u63a5\u65f6\uff0c\u7b49\u5f852MSL\u7684\u610f\u4e49? MSL\u662fMaximum Segment Lifetime\u7684\u82f1\u6587\u7f29\u5199\uff0c\u53ef\u8bd1\u4e3a\u201c\u6700\u957f\u62a5\u6587\u6bb5\u5bff\u547d\u201d\uff0c\u5b83\u662f\u4efb\u4f55\u62a5\u6587\u5728\u7f51\u7edc\u4e0a\u5b58\u5728\u7684\u6700\u957f\u65f6\u95f4\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\u62a5\u6587\u5c06\u88ab\u4e22\u5f03\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2aACK\u62a5\u6587\u6bb5\u80fd\u591f\u5230\u8fbe\u670d\u52a1\u5668\u3002\u56e0\u4e3a\u8fd9\u4e2aACK\u6709\u53ef\u80fd\u4e22\u5931\uff0c\u4ece\u800c\u5bfc\u81f4\u5904\u5728LAST-ACK\u72b6\u6001\u7684\u670d\u52a1\u5668\u6536\u4e0d\u5230\u5bf9FIN-ACK\u7684\u786e\u8ba4\u62a5\u6587\u3002\u670d\u52a1\u5668\u4f1a\u8d85\u65f6\u91cd\u4f20\u8fd9\u4e2aFIN-ACK\uff0c\u63a5\u7740\u5ba2\u6237\u7aef\u518d\u91cd\u4f20\u4e00\u6b21\u786e\u8ba4\uff0c\u91cd\u65b0\u542f\u52a8\u65f6\u95f4\u7b49\u5f85\u8ba1\u65f6\u5668\u3002\u6700\u540e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u90fd\u80fd\u6b63\u5e38\u7684\u5173\u95ed\u3002\u5047\u8bbe\u5ba2\u6237\u7aef\u4e0d\u7b49\u5f852MSL\uff0c\u800c\u662f\u5728\u53d1\u9001\u5b8cACK\u4e4b\u540e\u76f4\u63a5\u91ca\u653e\u5173\u95ed\uff0c\u4e00\u4f46\u8fd9\u4e2aACK\u4e22\u5931\u7684\u8bdd\uff0c\u670d\u52a1\u5668\u5c31\u65e0\u6cd5\u6b63\u5e38\u7684\u8fdb\u5165\u5173\u95ed\u8fde\u63a5\u72b6\u6001\u3002 \u4e24\u4e2a\u7406\u7531\uff1a \u4fdd\u8bc1\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2aACK\u62a5\u6587\u6bb5\u80fd\u591f\u5230\u8fbe\u670d\u52a1\u7aef\u3002 \u8fd9\u4e2aACK\u62a5\u6587\u6bb5\u6709\u53ef\u80fd\u4e22\u5931\uff0c\u4f7f\u5f97\u5904\u4e8eLAST-ACK\u72b6\u6001\u7684B\u6536\u4e0d\u5230\u5bf9\u5df2\u53d1\u9001\u7684FIN+ACK\u62a5\u6587\u6bb5\u7684\u786e\u8ba4\uff0c\u670d\u52a1\u7aef\u8d85\u65f6\u91cd\u4f20FIN+ACK\u62a5\u6587\u6bb5\uff0c\u800c\u5ba2\u6237\u7aef\u80fd\u57282MSL\u65f6\u95f4\u5185\u6536\u5230\u8fd9\u4e2a\u91cd\u4f20\u7684FIN+ACK\u62a5\u6587\u6bb5\uff0c\u63a5\u7740\u5ba2\u6237\u7aef\u91cd\u4f20\u4e00\u6b21\u786e\u8ba4\uff0c\u91cd\u65b0\u542f\u52a82MSL\u8ba1\u65f6\u5668\uff0c\u6700\u540e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u8fdb\u5165\u5230CLOSED\u72b6\u6001\uff0c\u82e5\u5ba2\u6237\u7aef\u5728TIME-WAIT\u72b6\u6001\u4e0d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u800c\u662f\u53d1\u9001\u5b8cACK\u62a5\u6587\u6bb5\u540e\u7acb\u5373\u91ca\u653e\u8fde\u63a5\uff0c\u5219\u65e0\u6cd5\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684FIN+ACK\u62a5\u6587\u6bb5\uff0c\u6240\u4ee5\u4e0d\u4f1a\u518d\u53d1\u9001\u4e00\u6b21\u786e\u8ba4\u62a5\u6587\u6bb5\uff0c\u5219\u670d\u52a1\u7aef\u65e0\u6cd5\u6b63\u5e38\u8fdb\u5165\u5230CLOSED\u72b6\u6001\u3002 \u9632\u6b62\u201c\u5df2\u5931\u6548\u7684\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\u6bb5\u201d\u51fa\u73b0\u5728\u672c\u8fde\u63a5\u4e2d\u3002 \u5ba2\u6237\u7aef\u5728\u53d1\u9001\u5b8c\u6700\u540e\u4e00\u4e2aACK\u62a5\u6587\u6bb5\u540e\uff0c\u518d\u7ecf\u8fc72MSL\uff0c\u5c31\u53ef\u4ee5\u4f7f\u672c\u8fde\u63a5\u6301\u7eed\u7684\u65f6\u95f4\u5185\u6240\u4ea7\u751f\u7684\u6240\u6709\u62a5\u6587\u6bb5\u90fd\u4ece\u7f51\u7edc\u4e2d\u6d88\u5931\uff0c\u4f7f\u4e0b\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u65e7\u7684\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\u6bb5\u3002 2.4 \u4e3a\u4ec0\u4e48TIME_WAIT\u72b6\u6001\u9700\u8981\u7ecf\u8fc72MSL\u624d\u80fd\u8fd4\u56de\u5230CLOSE\u72b6\u6001\uff1f \u7406\u8bba\u4e0a\uff0c\u56db\u4e2a\u62a5\u6587\u90fd\u53d1\u9001\u5b8c\u6bd5\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165CLOSE\u72b6\u6001\u4e86\uff0c\u4f46\u662f\u53ef\u80fd\u7f51\u7edc\u662f\u4e0d\u53ef\u9760\u7684\uff0c\u6709\u53ef\u80fd\u6700\u540e\u4e00\u4e2aACK\u4e22\u5931\u3002\u6240\u4ee5TIME_WAIT\u72b6\u6001\u5c31\u662f\u7528\u6765\u91cd\u53d1\u53ef\u80fd\u4e22\u5931\u7684ACK\u62a5\u6587\u3002 \u603b\u7ed3 \u300aTCP/IP\u8be6\u89e3 \u53771:\u534f\u8bae\u300b\u6709\u4e00\u5f20TCP\u72b6\u6001\u53d8\u8fc1\u56fe\uff0c\u5f88\u5177\u6709\u4ee3\u8868\u6027\uff0c\u6709\u52a9\u4e8e\u5927\u5bb6\u7406\u89e3\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u7684\u72b6\u6001\u53d8\u5316\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7c97\u7684\u5b9e\u7ebf\u7bad\u5934\u8868\u793a\u6b63\u5e38\u7684\u5ba2\u6237\u7aef\u72b6\u6001\u53d8\u8fc1\uff0c\u7c97\u7684\u865a\u7ebf\u7bad\u5934\u8868\u793a\u6b63\u5e38\u7684\u670d\u52a1\u5668\u72b6\u6001\u53d8\u8fc1\u3002","title":"\u4e09\u6b21\u63e1\u624b\u56db\u6b21\u6325\u624b"},{"location":"knowledge/auth/","text":"JWT for stateless authentication Oauth2 for stateless authentication * JWT for stateless authentication Oauth2 for stateless authentication JWT for stateless authentication Oauth2 for stateless authentication","title":"Index"},{"location":"knowledge/auth/jwt/","text":"\u4ec0\u4e48\u662fJWT Json web token (JWT), \u662f\u4e3a\u4e86\u5728\u7f51\u7edc\u5e94\u7528\u73af\u5883\u95f4\u4f20\u9012\u58f0\u660e\u800c\u6267\u884c\u7684\u4e00\u79cd\u57fa\u4e8eJSON\u7684\u5f00\u653e\u6807\u51c6\uff08 (RFC 7519 ).\u8be5token\u88ab\u8bbe\u8ba1\u4e3a\u7d27\u51d1\u4e14\u5b89\u5168\u7684\uff0c\u7279\u522b\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7ad9\u70b9\u7684\u5355\u70b9\u767b\u5f55\uff08SSO\uff09\u573a\u666f\u3002JWT\u7684\u58f0\u660e\u4e00\u822c\u88ab\u7528\u6765\u5728\u8eab\u4efd\u63d0\u4f9b\u8005\u548c\u670d\u52a1\u63d0\u4f9b\u8005\u95f4\u4f20\u9012\u88ab\u8ba4\u8bc1\u7684\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u4ece\u8d44\u6e90\u670d\u52a1\u5668\u83b7\u53d6\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u589e\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u5176\u5b83\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u987b\u7684\u58f0\u660e\u4fe1\u606f\uff0c\u8be5token\u4e5f\u53ef\u76f4\u63a5\u88ab\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u88ab\u52a0\u5bc6\u3002 \u8d77\u6e90 \u8bf4\u8d77JWT\uff0c\u6211\u4eec\u5e94\u8be5\u6765\u8c08\u4e00\u8c08\u57fa\u4e8etoken\u7684\u8ba4\u8bc1\u548c\u4f20\u7edf\u7684session\u8ba4\u8bc1\u7684\u533a\u522b\u3002 \u4f20\u7edf\u7684session\u8ba4\u8bc1 \u6211\u4eec\u77e5\u9053\uff0chttp\u534f\u8bae\u672c\u8eab\u662f\u4e00\u79cd\u65e0\u72b6\u6001\u7684\u534f\u8bae\uff0c\u800c\u8fd9\u5c31\u610f\u5473\u7740\u5982\u679c\u7528\u6237\u5411\u6211\u4eec\u7684\u5e94\u7528\u63d0\u4f9b\u4e86\u7528\u6237\u540d\u548c\u5bc6\u7801\u6765\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b21\u8bf7\u6c42\u65f6\uff0c\u7528\u6237\u8fd8\u8981\u518d\u4e00\u6b21\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\u624d\u884c\uff0c\u56e0\u4e3a\u6839\u636ehttp\u534f\u8bae\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u77e5\u9053\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u6211\u4eec\u7684\u5e94\u7528\u80fd\u8bc6\u522b\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u53ea\u80fd\u5728\u670d\u52a1\u5668\u5b58\u50a8\u4e00\u4efd\u7528\u6237\u767b\u5f55\u7684\u4fe1\u606f\uff0c\u8fd9\u4efd\u767b\u5f55\u4fe1\u606f\u4f1a\u5728\u54cd\u5e94\u65f6\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668\uff0c\u544a\u8bc9\u5176\u4fdd\u5b58\u4e3acookie,\u4ee5\u4fbf\u4e0b\u6b21\u8bf7\u6c42\u65f6\u53d1\u9001\u7ed9\u6211\u4eec\u7684\u5e94\u7528\uff0c\u8fd9\u6837\u6211\u4eec\u7684\u5e94\u7528\u5c31\u80fd\u8bc6\u522b\u8bf7\u6c42\u6765\u81ea\u54ea\u4e2a\u7528\u6237\u4e86,\u8fd9\u5c31\u662f\u4f20\u7edf\u7684\u57fa\u4e8esession\u8ba4\u8bc1\u3002 \u4f46\u662f\u8fd9\u79cd\u57fa\u4e8esession\u7684\u8ba4\u8bc1\u4f7f\u5e94\u7528\u672c\u8eab\u5f88\u96be\u5f97\u5230\u6269\u5c55\uff0c\u968f\u7740\u4e0d\u540c\u5ba2\u6237\u7aef\u7528\u6237\u7684\u589e\u52a0\uff0c\u72ec\u7acb\u7684\u670d\u52a1\u5668\u5df2\u65e0\u6cd5\u627f\u8f7d\u66f4\u591a\u7684\u7528\u6237\uff0c\u800c\u8fd9\u65f6\u5019\u57fa\u4e8esession\u8ba4\u8bc1\u5e94\u7528\u7684\u95ee\u9898\u5c31\u4f1a\u66b4\u9732\u51fa\u6765. \u57fa\u4e8esession\u8ba4\u8bc1\u6240\u663e\u9732\u7684\u95ee\u9898 Session : \u6bcf\u4e2a\u7528\u6237\u7ecf\u8fc7\u6211\u4eec\u7684\u5e94\u7528\u8ba4\u8bc1\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u5e94\u7528\u90fd\u8981\u5728\u670d\u52a1\u7aef\u505a\u4e00\u6b21\u8bb0\u5f55\uff0c\u4ee5\u65b9\u4fbf\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u7684\u9274\u522b\uff0c\u901a\u5e38\u800c\u8a00session\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u968f\u7740\u8ba4\u8bc1\u7528\u6237\u7684\u589e\u591a\uff0c\u670d\u52a1\u7aef\u7684\u5f00\u9500\u4f1a\u660e\u663e\u589e\u5927\u3002 \u6269\u5c55\u6027 : \u7528\u6237\u8ba4\u8bc1\u4e4b\u540e\uff0c\u670d\u52a1\u7aef\u505a\u8ba4\u8bc1\u8bb0\u5f55\uff0c\u5982\u679c\u8ba4\u8bc1\u7684\u8bb0\u5f55\u88ab\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u8bdd\uff0c\u8fd9\u610f\u5473\u7740\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u8fd8\u5fc5\u987b\u8981\u8bf7\u6c42\u5728\u8fd9\u53f0\u670d\u52a1\u5668\u4e0a,\u8fd9\u6837\u624d\u80fd\u62ff\u5230\u6388\u6743\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u5728\u5206\u5e03\u5f0f\u7684\u5e94\u7528\u4e0a\uff0c\u76f8\u5e94\u7684\u9650\u5236\u4e86\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u80fd\u529b\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u9650\u5236\u4e86\u5e94\u7528\u7684\u6269\u5c55\u80fd\u529b\u3002 CSRF : \u56e0\u4e3a\u662f\u57fa\u4e8ecookie\u6765\u8fdb\u884c\u7528\u6237\u8bc6\u522b\u7684, cookie\u5982\u679c\u88ab\u622a\u83b7\uff0c\u7528\u6237\u5c31\u4f1a\u5f88\u5bb9\u6613\u53d7\u5230\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u7684\u653b\u51fb\u3002 \u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236 \u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236\u7c7b\u4f3c\u4e8ehttp\u534f\u8bae\u4e5f\u662f\u65e0\u72b6\u6001\u7684\uff0c\u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u53bb\u4fdd\u7559\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\u6216\u8005\u4f1a\u8bdd\u4fe1\u606f\u3002\u8fd9\u5c31\u610f\u5473\u7740\u57fa\u4e8etoken\u8ba4\u8bc1\u673a\u5236\u7684\u5e94\u7528\u4e0d\u9700\u8981\u53bb\u8003\u8651\u7528\u6237\u5728\u54ea\u4e00\u53f0\u670d\u52a1\u5668\u767b\u5f55\u4e86\uff0c\u8fd9\u5c31\u4e3a\u5e94\u7528\u7684\u6269\u5c55\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002 \u6d41\u7a0b\u4e0a\u662f\u8fd9\u6837\u7684\uff1a \u7528\u6237\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u6765\u8bf7\u6c42\u670d\u52a1\u5668 \u670d\u52a1\u5668\u8fdb\u884c\u9a8c\u8bc1\u7528\u6237\u7684\u4fe1\u606f \u670d\u52a1\u5668\u901a\u8fc7\u9a8c\u8bc1\u53d1\u9001\u7ed9\u7528\u6237\u4e00\u4e2atoken \u5ba2\u6237\u7aef\u5b58\u50a8token\uff0c\u5e76\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u9644\u9001\u4e0a\u8fd9\u4e2atoken\u503c \u670d\u52a1\u7aef\u9a8c\u8bc1token\u503c\uff0c\u5e76\u8fd4\u56de\u6570\u636e \u8fd9\u4e2atoken\u5fc5\u987b\u8981\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u5b83\u5e94\u8be5\u4fdd\u5b58\u5728\u8bf7\u6c42\u5934\u91cc\uff0c \u53e6\u5916\uff0c\u670d\u52a1\u7aef\u8981\u652f\u6301 CORS(\u8de8\u6765\u6e90\u8d44\u6e90\u5171\u4eab) \u7b56\u7565\uff0c\u4e00\u822c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u8fd9\u4e48\u505a\u5c31\u53ef\u4ee5\u4e86 Access-Control-Allow-Origin: * \u3002 \u90a3\u4e48\u6211\u4eec\u73b0\u5728\u56de\u5230JWT\u7684\u4e3b\u9898\u4e0a\u3002 JWT\u957f\u4ec0\u4e48\u6837\uff1f JWT\u662f\u7531\u4e09\u6bb5\u4fe1\u606f\u6784\u6210\u7684\uff0c\u5c06\u8fd9\u4e09\u6bb5\u4fe1\u606f\u6587\u672c\u7528 . \u94fe\u63a5\u4e00\u8d77\u5c31\u6784\u6210\u4e86Jwt\u5b57\u7b26\u4e32\u3002\u5c31\u50cf\u8fd9\u6837: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ JWT\u7684\u6784\u6210 \u7b2c\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u5b83\u4e3a\u5934\u90e8\uff08header),\u7b2c\u4e8c\u90e8\u5206\u6211\u4eec\u79f0\u5176\u4e3a\u8f7d\u8377\uff08payload, \u7c7b\u4f3c\u4e8e\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u7269\u54c1)\uff0c\u7b2c\u4e09\u90e8\u5206\u662f\u7b7e\u8bc1\uff08signature). header jwt\u7684\u5934\u90e8\u627f\u8f7d\u4e24\u90e8\u5206\u4fe1\u606f\uff1a \u58f0\u660e\u7c7b\u578b\uff0c\u8fd9\u91cc\u662fjwt \u58f0\u660e\u52a0\u5bc6\u7684\u7b97\u6cd5 \u901a\u5e38\u76f4\u63a5\u4f7f\u7528 HMAC SHA256 \u5b8c\u6574\u7684\u5934\u90e8\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u7684JSON\uff1a { 'typ': 'JWT', 'alg': 'HS256' } \u7136\u540e\u5c06\u5934\u90e8\u8fdb\u884cbase64\u52a0\u5bc6\uff08\u8be5\u52a0\u5bc6\u662f\u53ef\u4ee5\u5bf9\u79f0\u89e3\u5bc6\u7684),\u6784\u6210\u4e86\u7b2c\u4e00\u90e8\u5206. eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9 playload \u8f7d\u8377\u5c31\u662f\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\u3002\u8fd9\u4e2a\u540d\u5b57\u50cf\u662f\u7279\u6307\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u8d27\u54c1\uff0c\u8fd9\u4e9b\u6709\u6548\u4fe1\u606f\u5305\u542b\u4e09\u4e2a\u90e8\u5206 \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e \u516c\u5171\u7684\u58f0\u660e \u79c1\u6709\u7684\u58f0\u660e \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e (\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) \uff1a iss : jwt\u7b7e\u53d1\u8005 sub : jwt\u6240\u9762\u5411\u7684\u7528\u6237 aud : \u63a5\u6536jwt\u7684\u4e00\u65b9 exp : jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4 nbf : \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684. iat : jwt\u7684\u7b7e\u53d1\u65f6\u95f4 jti : jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002 \u516c\u5171\u7684\u58f0\u660e \uff1a \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6. \u79c1\u6709\u7684\u58f0\u660e \uff1a \u79c1\u6709\u58f0\u660e\u662f\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3abase64\u662f\u5bf9\u79f0\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002 \u5b9a\u4e49\u4e00\u4e2apayload: { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"admin\": true } \u7136\u540e\u5c06\u5176\u8fdb\u884cbase64\u52a0\u5bc6\uff0c\u5f97\u5230Jwt\u7684\u7b2c\u4e8c\u90e8\u5206\u3002 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 signature jwt\u7684\u7b2c\u4e09\u90e8\u5206\u662f\u4e00\u4e2a\u7b7e\u8bc1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u7b7e\u8bc1\u4fe1\u606f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a header (base64\u540e\u7684) payload (base64\u540e\u7684) secret \u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528 . \u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0 secret \u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002 // javascript var encodedString = base64UrlEncode(header) + '.' + base64UrlEncode(payload); var signature = HMACSHA256(encodedString, 'secret'); // TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u5c06\u8fd9\u4e09\u90e8\u5206\u7528 . \u8fde\u63a5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5b57\u7b26\u4e32,\u6784\u6210\u4e86\u6700\u7ec8\u7684jwt: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u6ce8\u610f\uff1asecret\u662f\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0cjwt\u7684\u7b7e\u53d1\u751f\u6210\u4e5f\u662f\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0csecret\u5c31\u662f\u7528\u6765\u8fdb\u884cjwt\u7684\u7b7e\u53d1\u548cjwt\u7684\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5b83\u5c31\u662f\u4f60\u670d\u52a1\u7aef\u7684\u79c1\u94a5\uff0c\u5728\u4efb\u4f55\u573a\u666f\u90fd\u4e0d\u5e94\u8be5\u6d41\u9732\u51fa\u53bb\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u5f97\u77e5\u8fd9\u4e2asecret, \u90a3\u5c31\u610f\u5473\u7740\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u6211\u7b7e\u53d1jwt\u4e86\u3002 \u5982\u4f55\u5e94\u7528 \u4e00\u822c\u662f\u5728\u8bf7\u6c42\u5934\u91cc\u52a0\u5165 Authorization \uff0c\u5e76\u52a0\u4e0a Bearer \u6807\u6ce8\uff1a fetch('api/user/1', { headers: { 'Authorization': 'Bearer ' + token } }) \u670d\u52a1\u7aef\u4f1a\u9a8c\u8bc1token\uff0c\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\u5c31\u4f1a\u8fd4\u56de\u76f8\u5e94\u7684\u8d44\u6e90\u3002\u6574\u4e2a\u6d41\u7a0b\u5c31\u662f\u8fd9\u6837\u7684: jwt-diagram \u603b\u7ed3 \u4f18\u70b9 \u56e0\u4e3ajson\u7684\u901a\u7528\u6027\uff0c\u6240\u4ee5JWT\u662f\u53ef\u4ee5\u8fdb\u884c\u8de8\u8bed\u8a00\u652f\u6301\u7684\uff0c\u50cfJAVA,JavaScript,NodeJS,PHP\u7b49\u5f88\u591a\u8bed\u8a00\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 \u56e0\u4e3a\u6709\u4e86payload\u90e8\u5206\uff0c\u6240\u4ee5JWT\u53ef\u4ee5\u5728\u81ea\u8eab\u5b58\u50a8\u4e00\u4e9b\u5176\u4ed6\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u8981\u7684\u975e\u654f\u611f\u4fe1\u606f\u3002 \u4fbf\u4e8e\u4f20\u8f93\uff0cjwt\u7684\u6784\u6210\u975e\u5e38\u7b80\u5355\uff0c\u5b57\u8282\u5360\u7528\u5f88\u5c0f\uff0c\u6240\u4ee5\u5b83\u662f\u975e\u5e38\u4fbf\u4e8e\u4f20\u8f93\u7684\u3002 \u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u4fdd\u5b58\u4f1a\u8bdd\u4fe1\u606f, \u6240\u4ee5\u5b83\u6613\u4e8e\u5e94\u7528\u7684\u6269\u5c55 \u5b89\u5168\u76f8\u5173 \u4e0d\u5e94\u8be5\u5728jwt\u7684payload\u90e8\u5206\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u662f\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6\u7684\u90e8\u5206\u3002 \u4fdd\u62a4\u597dsecret\u79c1\u94a5\uff0c\u8be5\u79c1\u94a5\u975e\u5e38\u91cd\u8981\u3002 \u5982\u679c\u53ef\u4ee5\uff0c\u8bf7\u4f7f\u7528https\u534f\u8bae \u4f5c\u8005\uff1aDearmadman \u94fe\u63a5\uff1ahttps://www.jianshu.com/p/576dbf44b2ae \u6765\u6e90\uff1a\u7b80\u4e66 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002","title":"JWT for stateless authentication"},{"location":"knowledge/auth/jwt/#jwt","text":"Json web token (JWT), \u662f\u4e3a\u4e86\u5728\u7f51\u7edc\u5e94\u7528\u73af\u5883\u95f4\u4f20\u9012\u58f0\u660e\u800c\u6267\u884c\u7684\u4e00\u79cd\u57fa\u4e8eJSON\u7684\u5f00\u653e\u6807\u51c6\uff08 (RFC 7519 ).\u8be5token\u88ab\u8bbe\u8ba1\u4e3a\u7d27\u51d1\u4e14\u5b89\u5168\u7684\uff0c\u7279\u522b\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7ad9\u70b9\u7684\u5355\u70b9\u767b\u5f55\uff08SSO\uff09\u573a\u666f\u3002JWT\u7684\u58f0\u660e\u4e00\u822c\u88ab\u7528\u6765\u5728\u8eab\u4efd\u63d0\u4f9b\u8005\u548c\u670d\u52a1\u63d0\u4f9b\u8005\u95f4\u4f20\u9012\u88ab\u8ba4\u8bc1\u7684\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u4ece\u8d44\u6e90\u670d\u52a1\u5668\u83b7\u53d6\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u589e\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u5176\u5b83\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u987b\u7684\u58f0\u660e\u4fe1\u606f\uff0c\u8be5token\u4e5f\u53ef\u76f4\u63a5\u88ab\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u88ab\u52a0\u5bc6\u3002","title":"\u4ec0\u4e48\u662fJWT"},{"location":"knowledge/auth/jwt/#_1","text":"\u8bf4\u8d77JWT\uff0c\u6211\u4eec\u5e94\u8be5\u6765\u8c08\u4e00\u8c08\u57fa\u4e8etoken\u7684\u8ba4\u8bc1\u548c\u4f20\u7edf\u7684session\u8ba4\u8bc1\u7684\u533a\u522b\u3002","title":"\u8d77\u6e90"},{"location":"knowledge/auth/jwt/#session","text":"\u6211\u4eec\u77e5\u9053\uff0chttp\u534f\u8bae\u672c\u8eab\u662f\u4e00\u79cd\u65e0\u72b6\u6001\u7684\u534f\u8bae\uff0c\u800c\u8fd9\u5c31\u610f\u5473\u7740\u5982\u679c\u7528\u6237\u5411\u6211\u4eec\u7684\u5e94\u7528\u63d0\u4f9b\u4e86\u7528\u6237\u540d\u548c\u5bc6\u7801\u6765\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b21\u8bf7\u6c42\u65f6\uff0c\u7528\u6237\u8fd8\u8981\u518d\u4e00\u6b21\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\u624d\u884c\uff0c\u56e0\u4e3a\u6839\u636ehttp\u534f\u8bae\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u77e5\u9053\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u6211\u4eec\u7684\u5e94\u7528\u80fd\u8bc6\u522b\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u53ea\u80fd\u5728\u670d\u52a1\u5668\u5b58\u50a8\u4e00\u4efd\u7528\u6237\u767b\u5f55\u7684\u4fe1\u606f\uff0c\u8fd9\u4efd\u767b\u5f55\u4fe1\u606f\u4f1a\u5728\u54cd\u5e94\u65f6\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668\uff0c\u544a\u8bc9\u5176\u4fdd\u5b58\u4e3acookie,\u4ee5\u4fbf\u4e0b\u6b21\u8bf7\u6c42\u65f6\u53d1\u9001\u7ed9\u6211\u4eec\u7684\u5e94\u7528\uff0c\u8fd9\u6837\u6211\u4eec\u7684\u5e94\u7528\u5c31\u80fd\u8bc6\u522b\u8bf7\u6c42\u6765\u81ea\u54ea\u4e2a\u7528\u6237\u4e86,\u8fd9\u5c31\u662f\u4f20\u7edf\u7684\u57fa\u4e8esession\u8ba4\u8bc1\u3002 \u4f46\u662f\u8fd9\u79cd\u57fa\u4e8esession\u7684\u8ba4\u8bc1\u4f7f\u5e94\u7528\u672c\u8eab\u5f88\u96be\u5f97\u5230\u6269\u5c55\uff0c\u968f\u7740\u4e0d\u540c\u5ba2\u6237\u7aef\u7528\u6237\u7684\u589e\u52a0\uff0c\u72ec\u7acb\u7684\u670d\u52a1\u5668\u5df2\u65e0\u6cd5\u627f\u8f7d\u66f4\u591a\u7684\u7528\u6237\uff0c\u800c\u8fd9\u65f6\u5019\u57fa\u4e8esession\u8ba4\u8bc1\u5e94\u7528\u7684\u95ee\u9898\u5c31\u4f1a\u66b4\u9732\u51fa\u6765.","title":"\u4f20\u7edf\u7684session\u8ba4\u8bc1"},{"location":"knowledge/auth/jwt/#session_1","text":"Session : \u6bcf\u4e2a\u7528\u6237\u7ecf\u8fc7\u6211\u4eec\u7684\u5e94\u7528\u8ba4\u8bc1\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u5e94\u7528\u90fd\u8981\u5728\u670d\u52a1\u7aef\u505a\u4e00\u6b21\u8bb0\u5f55\uff0c\u4ee5\u65b9\u4fbf\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u7684\u9274\u522b\uff0c\u901a\u5e38\u800c\u8a00session\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u968f\u7740\u8ba4\u8bc1\u7528\u6237\u7684\u589e\u591a\uff0c\u670d\u52a1\u7aef\u7684\u5f00\u9500\u4f1a\u660e\u663e\u589e\u5927\u3002 \u6269\u5c55\u6027 : \u7528\u6237\u8ba4\u8bc1\u4e4b\u540e\uff0c\u670d\u52a1\u7aef\u505a\u8ba4\u8bc1\u8bb0\u5f55\uff0c\u5982\u679c\u8ba4\u8bc1\u7684\u8bb0\u5f55\u88ab\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u8bdd\uff0c\u8fd9\u610f\u5473\u7740\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u8fd8\u5fc5\u987b\u8981\u8bf7\u6c42\u5728\u8fd9\u53f0\u670d\u52a1\u5668\u4e0a,\u8fd9\u6837\u624d\u80fd\u62ff\u5230\u6388\u6743\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u5728\u5206\u5e03\u5f0f\u7684\u5e94\u7528\u4e0a\uff0c\u76f8\u5e94\u7684\u9650\u5236\u4e86\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u80fd\u529b\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u9650\u5236\u4e86\u5e94\u7528\u7684\u6269\u5c55\u80fd\u529b\u3002 CSRF : \u56e0\u4e3a\u662f\u57fa\u4e8ecookie\u6765\u8fdb\u884c\u7528\u6237\u8bc6\u522b\u7684, cookie\u5982\u679c\u88ab\u622a\u83b7\uff0c\u7528\u6237\u5c31\u4f1a\u5f88\u5bb9\u6613\u53d7\u5230\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u7684\u653b\u51fb\u3002","title":"\u57fa\u4e8esession\u8ba4\u8bc1\u6240\u663e\u9732\u7684\u95ee\u9898"},{"location":"knowledge/auth/jwt/#token","text":"\u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236\u7c7b\u4f3c\u4e8ehttp\u534f\u8bae\u4e5f\u662f\u65e0\u72b6\u6001\u7684\uff0c\u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u53bb\u4fdd\u7559\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\u6216\u8005\u4f1a\u8bdd\u4fe1\u606f\u3002\u8fd9\u5c31\u610f\u5473\u7740\u57fa\u4e8etoken\u8ba4\u8bc1\u673a\u5236\u7684\u5e94\u7528\u4e0d\u9700\u8981\u53bb\u8003\u8651\u7528\u6237\u5728\u54ea\u4e00\u53f0\u670d\u52a1\u5668\u767b\u5f55\u4e86\uff0c\u8fd9\u5c31\u4e3a\u5e94\u7528\u7684\u6269\u5c55\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002 \u6d41\u7a0b\u4e0a\u662f\u8fd9\u6837\u7684\uff1a \u7528\u6237\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u6765\u8bf7\u6c42\u670d\u52a1\u5668 \u670d\u52a1\u5668\u8fdb\u884c\u9a8c\u8bc1\u7528\u6237\u7684\u4fe1\u606f \u670d\u52a1\u5668\u901a\u8fc7\u9a8c\u8bc1\u53d1\u9001\u7ed9\u7528\u6237\u4e00\u4e2atoken \u5ba2\u6237\u7aef\u5b58\u50a8token\uff0c\u5e76\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u9644\u9001\u4e0a\u8fd9\u4e2atoken\u503c \u670d\u52a1\u7aef\u9a8c\u8bc1token\u503c\uff0c\u5e76\u8fd4\u56de\u6570\u636e \u8fd9\u4e2atoken\u5fc5\u987b\u8981\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u5b83\u5e94\u8be5\u4fdd\u5b58\u5728\u8bf7\u6c42\u5934\u91cc\uff0c \u53e6\u5916\uff0c\u670d\u52a1\u7aef\u8981\u652f\u6301 CORS(\u8de8\u6765\u6e90\u8d44\u6e90\u5171\u4eab) \u7b56\u7565\uff0c\u4e00\u822c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u8fd9\u4e48\u505a\u5c31\u53ef\u4ee5\u4e86 Access-Control-Allow-Origin: * \u3002 \u90a3\u4e48\u6211\u4eec\u73b0\u5728\u56de\u5230JWT\u7684\u4e3b\u9898\u4e0a\u3002","title":"\u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236"},{"location":"knowledge/auth/jwt/#jwt_1","text":"JWT\u662f\u7531\u4e09\u6bb5\u4fe1\u606f\u6784\u6210\u7684\uff0c\u5c06\u8fd9\u4e09\u6bb5\u4fe1\u606f\u6587\u672c\u7528 . \u94fe\u63a5\u4e00\u8d77\u5c31\u6784\u6210\u4e86Jwt\u5b57\u7b26\u4e32\u3002\u5c31\u50cf\u8fd9\u6837: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ","title":"JWT\u957f\u4ec0\u4e48\u6837\uff1f"},{"location":"knowledge/auth/jwt/#jwt_2","text":"\u7b2c\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u5b83\u4e3a\u5934\u90e8\uff08header),\u7b2c\u4e8c\u90e8\u5206\u6211\u4eec\u79f0\u5176\u4e3a\u8f7d\u8377\uff08payload, \u7c7b\u4f3c\u4e8e\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u7269\u54c1)\uff0c\u7b2c\u4e09\u90e8\u5206\u662f\u7b7e\u8bc1\uff08signature).","title":"JWT\u7684\u6784\u6210"},{"location":"knowledge/auth/jwt/#header","text":"jwt\u7684\u5934\u90e8\u627f\u8f7d\u4e24\u90e8\u5206\u4fe1\u606f\uff1a \u58f0\u660e\u7c7b\u578b\uff0c\u8fd9\u91cc\u662fjwt \u58f0\u660e\u52a0\u5bc6\u7684\u7b97\u6cd5 \u901a\u5e38\u76f4\u63a5\u4f7f\u7528 HMAC SHA256 \u5b8c\u6574\u7684\u5934\u90e8\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u7684JSON\uff1a { 'typ': 'JWT', 'alg': 'HS256' } \u7136\u540e\u5c06\u5934\u90e8\u8fdb\u884cbase64\u52a0\u5bc6\uff08\u8be5\u52a0\u5bc6\u662f\u53ef\u4ee5\u5bf9\u79f0\u89e3\u5bc6\u7684),\u6784\u6210\u4e86\u7b2c\u4e00\u90e8\u5206. eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9","title":"header"},{"location":"knowledge/auth/jwt/#playload","text":"\u8f7d\u8377\u5c31\u662f\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\u3002\u8fd9\u4e2a\u540d\u5b57\u50cf\u662f\u7279\u6307\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u8d27\u54c1\uff0c\u8fd9\u4e9b\u6709\u6548\u4fe1\u606f\u5305\u542b\u4e09\u4e2a\u90e8\u5206 \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e \u516c\u5171\u7684\u58f0\u660e \u79c1\u6709\u7684\u58f0\u660e \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e (\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) \uff1a iss : jwt\u7b7e\u53d1\u8005 sub : jwt\u6240\u9762\u5411\u7684\u7528\u6237 aud : \u63a5\u6536jwt\u7684\u4e00\u65b9 exp : jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4 nbf : \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684. iat : jwt\u7684\u7b7e\u53d1\u65f6\u95f4 jti : jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002 \u516c\u5171\u7684\u58f0\u660e \uff1a \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6. \u79c1\u6709\u7684\u58f0\u660e \uff1a \u79c1\u6709\u58f0\u660e\u662f\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3abase64\u662f\u5bf9\u79f0\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002 \u5b9a\u4e49\u4e00\u4e2apayload: { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"admin\": true } \u7136\u540e\u5c06\u5176\u8fdb\u884cbase64\u52a0\u5bc6\uff0c\u5f97\u5230Jwt\u7684\u7b2c\u4e8c\u90e8\u5206\u3002 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9","title":"playload"},{"location":"knowledge/auth/jwt/#signature","text":"jwt\u7684\u7b2c\u4e09\u90e8\u5206\u662f\u4e00\u4e2a\u7b7e\u8bc1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u7b7e\u8bc1\u4fe1\u606f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a header (base64\u540e\u7684) payload (base64\u540e\u7684) secret \u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528 . \u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0 secret \u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002 // javascript var encodedString = base64UrlEncode(header) + '.' + base64UrlEncode(payload); var signature = HMACSHA256(encodedString, 'secret'); // TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u5c06\u8fd9\u4e09\u90e8\u5206\u7528 . \u8fde\u63a5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5b57\u7b26\u4e32,\u6784\u6210\u4e86\u6700\u7ec8\u7684jwt: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u6ce8\u610f\uff1asecret\u662f\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0cjwt\u7684\u7b7e\u53d1\u751f\u6210\u4e5f\u662f\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0csecret\u5c31\u662f\u7528\u6765\u8fdb\u884cjwt\u7684\u7b7e\u53d1\u548cjwt\u7684\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5b83\u5c31\u662f\u4f60\u670d\u52a1\u7aef\u7684\u79c1\u94a5\uff0c\u5728\u4efb\u4f55\u573a\u666f\u90fd\u4e0d\u5e94\u8be5\u6d41\u9732\u51fa\u53bb\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u5f97\u77e5\u8fd9\u4e2asecret, \u90a3\u5c31\u610f\u5473\u7740\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u6211\u7b7e\u53d1jwt\u4e86\u3002","title":"signature"},{"location":"knowledge/auth/jwt/#_2","text":"\u4e00\u822c\u662f\u5728\u8bf7\u6c42\u5934\u91cc\u52a0\u5165 Authorization \uff0c\u5e76\u52a0\u4e0a Bearer \u6807\u6ce8\uff1a fetch('api/user/1', { headers: { 'Authorization': 'Bearer ' + token } }) \u670d\u52a1\u7aef\u4f1a\u9a8c\u8bc1token\uff0c\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\u5c31\u4f1a\u8fd4\u56de\u76f8\u5e94\u7684\u8d44\u6e90\u3002\u6574\u4e2a\u6d41\u7a0b\u5c31\u662f\u8fd9\u6837\u7684: jwt-diagram","title":"\u5982\u4f55\u5e94\u7528"},{"location":"knowledge/auth/jwt/#_3","text":"","title":"\u603b\u7ed3"},{"location":"knowledge/auth/jwt/#_4","text":"\u56e0\u4e3ajson\u7684\u901a\u7528\u6027\uff0c\u6240\u4ee5JWT\u662f\u53ef\u4ee5\u8fdb\u884c\u8de8\u8bed\u8a00\u652f\u6301\u7684\uff0c\u50cfJAVA,JavaScript,NodeJS,PHP\u7b49\u5f88\u591a\u8bed\u8a00\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 \u56e0\u4e3a\u6709\u4e86payload\u90e8\u5206\uff0c\u6240\u4ee5JWT\u53ef\u4ee5\u5728\u81ea\u8eab\u5b58\u50a8\u4e00\u4e9b\u5176\u4ed6\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u8981\u7684\u975e\u654f\u611f\u4fe1\u606f\u3002 \u4fbf\u4e8e\u4f20\u8f93\uff0cjwt\u7684\u6784\u6210\u975e\u5e38\u7b80\u5355\uff0c\u5b57\u8282\u5360\u7528\u5f88\u5c0f\uff0c\u6240\u4ee5\u5b83\u662f\u975e\u5e38\u4fbf\u4e8e\u4f20\u8f93\u7684\u3002 \u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u4fdd\u5b58\u4f1a\u8bdd\u4fe1\u606f, \u6240\u4ee5\u5b83\u6613\u4e8e\u5e94\u7528\u7684\u6269\u5c55","title":"\u4f18\u70b9"},{"location":"knowledge/auth/jwt/#_5","text":"\u4e0d\u5e94\u8be5\u5728jwt\u7684payload\u90e8\u5206\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u662f\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6\u7684\u90e8\u5206\u3002 \u4fdd\u62a4\u597dsecret\u79c1\u94a5\uff0c\u8be5\u79c1\u94a5\u975e\u5e38\u91cd\u8981\u3002 \u5982\u679c\u53ef\u4ee5\uff0c\u8bf7\u4f7f\u7528https\u534f\u8bae \u4f5c\u8005\uff1aDearmadman \u94fe\u63a5\uff1ahttps://www.jianshu.com/p/576dbf44b2ae \u6765\u6e90\uff1a\u7b80\u4e66 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002","title":"\u5b89\u5168\u76f8\u5173"},{"location":"knowledge/auth/oauth/","text":"","title":"Oauth2 for stateless authentication"},{"location":"knowledge/rokcetmq/","text":"1 2 1 2 1 2 1 2","title":"Index"},{"location":"knowledge/rokcetmq/1/","text":"","title":"1"},{"location":"knowledge/rokcetmq/2/","text":"","title":"2"},{"location":"language/","text":"golang java \u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor node \u56fd\u5185node\u5404\u79cd\u955c\u50cf\u6e90\u8bbe\u7f6e rust Cross compiling Rust from Linux to macOS todo java \u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor node \u56fd\u5185node\u5404\u79cd\u955c\u50cf\u6e90\u8bbe\u7f6e rust Cross compiling Rust from Linux to macOS todo","title":"\u7f16\u7a0b\u8bed\u8a00"},{"location":"language/java/","text":"\u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor \u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor \u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor \u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor","title":"Index"},{"location":"language/java/disruptor/","text":"\u80cc\u666f Disruptor\u662f\u82f1\u56fd\u5916\u6c47\u4ea4\u6613\u516c\u53f8LMAX\u5f00\u53d1\u7684\u4e00\u4e2a\u9ad8\u6027\u80fd\u961f\u5217\uff0c\u7814\u53d1\u7684\u521d\u8877\u662f\u89e3\u51b3\u5185\u5b58\u961f\u5217\u7684\u5ef6\u8fdf\u95ee\u9898\uff08\u5728\u6027\u80fd\u6d4b\u8bd5\u4e2d\u53d1\u73b0\u7adf\u7136\u4e0eI/O\u64cd\u4f5c\u5904\u4e8e\u540c\u6837\u7684\u6570\u91cf\u7ea7\uff09\u3002\u57fa\u4e8eDisruptor\u5f00\u53d1\u7684\u7cfb\u7edf\u5355\u7ebf\u7a0b\u80fd\u652f\u6491\u6bcf\u79d2600\u4e07\u8ba2\u5355\uff0c2010\u5e74\u5728QCon\u6f14\u8bb2\u540e\uff0c\u83b7\u5f97\u4e86\u4e1a\u754c\u5173\u6ce8\u30022011\u5e74\uff0c\u4f01\u4e1a\u5e94\u7528\u8f6f\u4ef6\u4e13\u5bb6Martin Fowler\u4e13\u95e8\u64b0\u5199\u957f\u6587\u4ecb\u7ecd\u3002\u540c\u5e74\u5b83\u8fd8\u83b7\u5f97\u4e86Oracle\u5b98\u65b9\u7684Duke\u5927\u5956\u3002 \u76ee\u524d\uff0c\u5305\u62ecApache Storm\u3001Camel\u3001Log4j 2\u5728\u5185\u7684\u5f88\u591a\u77e5\u540d\u9879\u76ee\u90fd\u5e94\u7528\u4e86Disruptor\u4ee5\u83b7\u53d6\u9ad8\u6027\u80fd\u3002\u5728\u7f8e\u56e2\u6280\u672f\u56e2\u961f\u5b83\u4e5f\u6709\u4e0d\u5c11\u5e94\u7528\uff0c\u6709\u7684\u9879\u76ee\u67b6\u6784\u501f\u9274\u4e86\u5b83\u7684\u8bbe\u8ba1\u673a\u5236\u3002\u672c\u6587\u4ece\u5b9e\u6218\u89d2\u5ea6\u5256\u6790\u4e86Disruptor\u7684\u5b9e\u73b0\u539f\u7406\u3002 \u9700\u8981\u7279\u522b\u6307\u51fa\u7684\u662f\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u961f\u5217\u662f\u7cfb\u7edf\u5185\u90e8\u7684\u5185\u5b58\u961f\u5217\uff0c\u800c\u4e0d\u662fKafka\u8fd9\u6837\u7684\u5206\u5e03\u5f0f\u961f\u5217\u3002\u53e6\u5916\uff0c\u672c\u6587\u6240\u63cf\u8ff0\u7684Disruptor\u7279\u6027\u9650\u4e8e3.3.4\u3002 Java\u5185\u7f6e\u961f\u5217 \u4ecb\u7ecdDisruptor\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u770b\u5e38\u7528\u7684\u7ebf\u7a0b\u5b89\u5168\u7684\u5185\u7f6e\u961f\u5217\u6709\u4ec0\u4e48\u95ee\u9898\u3002Java\u7684\u5185\u7f6e\u961f\u5217\u5982\u4e0b\u8868\u6240\u793a\u3002 \u961f\u5217 \u6709\u754c\u6027 \u9501 \u6570\u636e\u7ed3\u6784 ArrayBlockingQueue bounded \u52a0\u9501 arraylist LinkedBlockingQueue optionally-bounded \u52a0\u9501 linkedlist ConcurrentLinkedQueue unbounded \u65e0\u9501 linkedlist LinkedTransferQueue unbounded \u65e0\u9501 linkedlist PriorityBlockingQueue unbounded \u52a0\u9501 heap DelayQueue unbounded \u52a0\u9501 heap \u961f\u5217\u7684\u5e95\u5c42\u4e00\u822c\u5206\u6210\u4e09\u79cd\uff1a\u6570\u7ec4\u3001\u94fe\u8868\u548c\u5806\u3002\u5176\u4e2d\uff0c\u5806\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u4e3a\u4e86\u5b9e\u73b0\u5e26\u6709\u4f18\u5148\u7ea7\u7279\u6027\u7684\u961f\u5217\uff0c\u6682\u4e14\u4e0d\u8003\u8651\u3002 \u6211\u4eec\u5c31\u4ece\u6570\u7ec4\u548c\u94fe\u8868\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u6765\u770b\uff0c\u57fa\u4e8e\u6570\u7ec4\u7ebf\u7a0b\u5b89\u5168\u7684\u961f\u5217\uff0c\u6bd4\u8f83\u5178\u578b\u7684\u662fArrayBlockingQueue\uff0c\u5b83\u4e3b\u8981\u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1b\u57fa\u4e8e\u94fe\u8868\u7684\u7ebf\u7a0b\u5b89\u5168\u961f\u5217\u5206\u6210LinkedBlockingQueue\u548cConcurrentLinkedQueue\u4e24\u5927\u7c7b\uff0c\u524d\u8005\u4e5f\u901a\u8fc7\u9501\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\uff0c\u800c\u540e\u8005\u4ee5\u53ca\u4e0a\u9762\u8868\u683c\u4e2d\u7684LinkedTransferQueue\u90fd\u662f\u901a\u8fc7\u539f\u5b50\u53d8\u91cfcompare and swap\uff08\u4ee5\u4e0b\u7b80\u79f0\u201cCAS\u201d\uff09\u8fd9\u79cd\u4e0d\u52a0\u9501\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684\u3002 \u901a\u8fc7\u4e0d\u52a0\u9501\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u961f\u5217\u90fd\u662f\u65e0\u754c\u7684\uff08\u65e0\u6cd5\u4fdd\u8bc1\u961f\u5217\u7684\u957f\u5ea6\u5728\u786e\u5b9a\u7684\u8303\u56f4\u5185\uff09\uff1b\u800c\u52a0\u9501\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6709\u754c\u961f\u5217\u3002\u5728\u7a33\u5b9a\u6027\u8981\u6c42\u7279\u522b\u9ad8\u7684\u7cfb\u7edf\u4e2d\uff0c\u4e3a\u4e86\u9632\u6b62\u751f\u4ea7\u8005\u901f\u5ea6\u8fc7\u5feb\uff0c\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff0c\u53ea\u80fd\u9009\u62e9\u6709\u754c\u961f\u5217\uff1b\u540c\u65f6\uff0c\u4e3a\u4e86\u51cf\u5c11Java\u7684\u5783\u573e\u56de\u6536\u5bf9\u7cfb\u7edf\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4f1a\u5c3d\u91cf\u9009\u62e9array/heap\u683c\u5f0f\u7684\u6570\u636e\u7ed3\u6784\u3002\u8fd9\u6837\u7b5b\u9009\u4e0b\u6765\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u961f\u5217\u5c31\u53ea\u6709ArrayBlockingQueue\u3002 ArrayBlockingQueue\u7684\u95ee\u9898 ArrayBlockingQueue\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u56e0\u4e3a\u52a0\u9501\u548c\u4f2a\u5171\u4eab\u7b49\u51fa\u73b0\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898\uff0c\u6211\u4eec\u4e0b\u9762\u6765\u5206\u6790\u4e00\u4e0b\u3002 \u52a0\u9501 \u73b0\u5b9e\u7f16\u7a0b\u8fc7\u7a0b\u4e2d\uff0c\u52a0\u9501\u901a\u5e38\u4f1a\u4e25\u91cd\u5730\u5f71\u54cd\u6027\u80fd\u3002\u7ebf\u7a0b\u4f1a\u56e0\u4e3a\u7ade\u4e89\u4e0d\u5230\u9501\u800c\u88ab\u6302\u8d77\uff0c\u7b49\u9501\u88ab\u91ca\u653e\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u53c8\u4f1a\u88ab\u6062\u590d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5b58\u5728\u7740\u5f88\u5927\u7684\u5f00\u9500\uff0c\u5e76\u4e14\u901a\u5e38\u4f1a\u6709\u8f83\u957f\u65f6\u95f4\u7684\u4e2d\u65ad\uff0c\u56e0\u4e3a\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u9501\u65f6\uff0c\u5b83\u4e0d\u80fd\u505a\u4efb\u4f55\u5176\u4ed6\u4e8b\u60c5\u3002\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u5728\u6301\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u88ab\u5ef6\u8fdf\u6267\u884c\uff0c\u4f8b\u5982\u53d1\u751f\u4e86\u7f3a\u9875\u9519\u8bef\u3001\u8c03\u5ea6\u5ef6\u8fdf\u6216\u8005\u5176\u5b83\u7c7b\u4f3c\u60c5\u51b5\uff0c\u90a3\u4e48\u6240\u6709\u9700\u8981\u8fd9\u4e2a\u9501\u7684\u7ebf\u7a0b\u90fd\u65e0\u6cd5\u6267\u884c\u4e0b\u53bb\u3002\u5982\u679c\u88ab\u963b\u585e\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u8f83\u9ad8\uff0c\u800c\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u4f18\u5148\u7ea7\u8f83\u4f4e\uff0c\u5c31\u4f1a\u53d1\u751f\u4f18\u5148\u7ea7\u53cd\u8f6c\u3002 Disruptor\u8bba\u6587\u4e2d\u8bb2\u8ff0\u4e86\u4e00\u4e2a\u5b9e\u9a8c\uff1a \u8fd9\u4e2a\u6d4b\u8bd5\u7a0b\u5e8f\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f1a\u5bf9\u4e00\u4e2a64\u4f4d\u7684\u8ba1\u6570\u5668\u5faa\u73af\u81ea\u589e5\u4ebf\u6b21\u3002 \u673a\u5668\u73af\u5883\uff1a2.4G 6\u6838 \u8fd0\u7b97\uff1a 64\u4f4d\u7684\u8ba1\u6570\u5668\u7d2f\u52a05\u4ebf\u6b21 Method Time (ms) \u2014 \u2014 Single thread 300 Single thread with CAS 5,700 Single thread with lock 10,000 Single thread with volatile write 4,700 Two threads with CAS 30,000 Two threads with lock 224,000 CAS\u64cd\u4f5c\u6bd4\u5355\u7ebf\u7a0b\u65e0\u9501\u6162\u4e861\u4e2a\u6570\u91cf\u7ea7\uff1b\u6709\u9501\u4e14\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0c\u901f\u5ea6\u6bd4\u5355\u7ebf\u7a0b\u65e0\u9501\u61623\u4e2a\u6570\u91cf\u7ea7\u3002\u53ef\u89c1\u65e0\u9501\u901f\u5ea6\u6700\u5feb\u3002 \u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u4e0d\u52a0\u9501\u7684\u6027\u80fd > CAS\u64cd\u4f5c\u7684\u6027\u80fd > \u52a0\u9501\u7684\u6027\u80fd\u3002 \u5728\u591a\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u5fc5\u987b\u4f7f\u7528CAS\u6216\u9501\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cCAS\u7684\u6027\u80fd\u8d85\u8fc7\u9501\u7684\u6027\u80fd\uff0c\u524d\u8005\u5927\u7ea6\u662f\u540e\u8005\u76848\u500d\u3002 \u7efc\u4e0a\u53ef\u77e5\uff0c\u52a0\u9501\u7684\u6027\u80fd\u662f\u6700\u5dee\u7684\u3002 \u5173\u4e8e\u9501\u548cCAS \u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u4e00\u822c\u5206\u6210\u4e24\u79cd\u65b9\u5f0f\uff1a\u9501\u548c\u539f\u5b50\u53d8\u91cf\u3002 \u9501 \u56fe1 \u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168 \u91c7\u53d6\u52a0\u9501\u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u7ebf\u7a0b\u4f1a\u51b2\u7a81\uff0c\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u5148\u52a0\u4e0a\u9501\u518d\u8bbf\u95ee\uff0c\u8bbf\u95ee\u4e4b\u540e\u518d\u89e3\u9501\u3002\u901a\u8fc7\u9501\u754c\u5b9a\u4e00\u4e2a\u4e34\u754c\u533a\uff0c\u540c\u65f6\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0cThread2\u8bbf\u95eeEntry\u7684\u65f6\u5019\uff0c\u52a0\u4e86\u9501\uff0cThread1\u5c31\u4e0d\u80fd\u518d\u6267\u884c\u8bbf\u95eeEntry\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002 \u4e0b\u9762\u662fArrayBlockingQueue\u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684offer\u65b9\u6cd5\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002 public boolean offer(E e) { checkNotNull(e); final ReentrantLock lock = this.lock; lock.lock(); try { if (count == items.length) return false; else { insert(e); return true; } } finally { lock.unlock(); } } \u539f\u5b50\u53d8\u91cf \u539f\u5b50\u53d8\u91cf\u80fd\u591f\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\u64cd\u4f5c\uff0c\u610f\u601d\u662f\u67d0\u4e2a\u4efb\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u56de\u6eda\uff0c\u6062\u590d\u5230\u6267\u884c\u4e4b\u524d\u7684\u521d\u6001\uff0c\u4e0d\u5b58\u5728\u521d\u6001\u548c\u6210\u529f\u4e4b\u95f4\u7684\u4e2d\u95f4\u72b6\u6001\u3002\u4f8b\u5982CAS\u64cd\u4f5c\uff0c\u8981\u4e48\u6bd4\u8f83\u5e76\u4ea4\u6362\u6210\u529f\uff0c\u8981\u4e48\u6bd4\u8f83\u5e76\u4ea4\u6362\u5931\u8d25\u3002\u7531CPU\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 \u901a\u8fc7\u539f\u5b50\u53d8\u91cf\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u3002\u6267\u884c\u67d0\u4e2a\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u5148\u5047\u5b9a\u4e0d\u4f1a\u6709\u51b2\u7a81\uff0c\u82e5\u4e0d\u53d1\u751f\u51b2\u7a81\uff0c\u5219\u76f4\u63a5\u6267\u884c\u6210\u529f\uff1b\u5f53\u53d1\u751f\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u5219\u6267\u884c\u5931\u8d25\uff0c\u56de\u6eda\u518d\u91cd\u65b0\u64cd\u4f5c\uff0c\u76f4\u5230\u4e0d\u53d1\u751f\u51b2\u7a81\u3002 \u56fe2 \u901a\u8fc7\u539f\u5b50\u53d8\u91cfCAS\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168 \u5982\u56fe\u6240\u793a\uff0cThread1\u548cThread2\u90fd\u8981\u628aEntry\u52a01\u3002\u82e5\u4e0d\u52a0\u9501\uff0c\u4e5f\u4e0d\u4f7f\u7528CAS\uff0c\u6709\u53ef\u80fdThread1\u53d6\u5230\u4e86myValue=1\uff0cThread2\u4e5f\u53d6\u5230\u4e86myValue=1\uff0c\u7136\u540e\u76f8\u52a0\uff0cEntry\u4e2d\u7684value\u503c\u4e3a2\u3002\u8fd9\u4e0e\u9884\u671f\u4e0d\u76f8\u7b26\uff0c\u6211\u4eec\u9884\u671f\u7684\u662fEntry\u7684\u503c\u7ecf\u8fc7\u4e24\u6b21\u76f8\u52a0\u540e\u7b49\u4e8e3\u3002 CAS\u4f1a\u5148\u628aEntry\u73b0\u5728\u7684value\u8ddf\u7ebf\u7a0b\u5f53\u521d\u8bfb\u51fa\u7684\u503c\u76f8\u6bd4\u8f83\uff0c\u82e5\u76f8\u540c\uff0c\u5219\u8d4b\u503c\uff1b\u82e5\u4e0d\u76f8\u540c\uff0c\u5219\u8d4b\u503c\u6267\u884c\u5931\u8d25\u3002\u4e00\u822c\u4f1a\u901a\u8fc7while/for\u5faa\u73af\u6765\u91cd\u65b0\u6267\u884c\uff0c\u76f4\u5230\u8d4b\u503c\u6210\u529f\u3002 \u4ee3\u7801\u793a\u4f8b\u662fAtomicInteger\u7684getAndAdd\u65b9\u6cd5\u3002CAS\u662fCPU\u7684\u4e00\u4e2a\u6307\u4ee4\uff0c\u7531CPU\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 /** * Atomically adds the given value to the current value. * * @param delta the value to add * @return the previous value */ public final int getAndAdd(int delta) { for (;;) { int current = get(); int next = current + delta; if (compareAndSet(current, next)) return current; } } /** * Atomically sets the value to the given updated value * if the current value {@code ==} the expected value. * * @param expect the expected value * @param update the new value * @return true if successful. False return indicates that * the actual value was not equal to the expected value. */ public final boolean compareAndSet(int expect, int update) { return unsafe.compareAndSwapInt(this, valueOffset, expect, update); } \u5728\u9ad8\u5ea6\u7ade\u4e89\u7684\u60c5\u51b5\u4e0b\uff0c\u9501\u7684\u6027\u80fd\u5c06\u8d85\u8fc7\u539f\u5b50\u53d8\u91cf\u7684\u6027\u80fd\uff0c\u4f46\u662f\u66f4\u771f\u5b9e\u7684\u7ade\u4e89\u60c5\u51b5\u4e0b\uff0c\u539f\u5b50\u53d8\u91cf\u7684\u6027\u80fd\u5c06\u8d85\u8fc7\u9501\u7684\u6027\u80fd\u3002\u540c\u65f6\u539f\u5b50\u53d8\u91cf\u4e0d\u4f1a\u6709\u6b7b\u9501\u7b49\u6d3b\u8dc3\u6027\u95ee\u9898\u3002 \u4f2a\u5171\u4eab \u4ec0\u4e48\u662f\u5171\u4eab \u4e0b\u56fe\u662f\u8ba1\u7b97\u7684\u57fa\u672c\u7ed3\u6784\u3002L1\u3001L2\u3001L3\u5206\u522b\u8868\u793a\u4e00\u7ea7\u7f13\u5b58\u3001\u4e8c\u7ea7\u7f13\u5b58\u3001\u4e09\u7ea7\u7f13\u5b58\uff0c\u8d8a\u9760\u8fd1CPU\u7684\u7f13\u5b58\uff0c\u901f\u5ea6\u8d8a\u5feb\uff0c\u5bb9\u91cf\u4e5f\u8d8a\u5c0f\u3002\u6240\u4ee5L1\u7f13\u5b58\u5f88\u5c0f\u4f46\u5f88\u5feb\uff0c\u5e76\u4e14\u7d27\u9760\u7740\u5728\u4f7f\u7528\u5b83\u7684CPU\u5185\u6838\uff1bL2\u5927\u4e00\u4e9b\uff0c\u4e5f\u6162\u4e00\u4e9b\uff0c\u5e76\u4e14\u4ecd\u7136\u53ea\u80fd\u88ab\u4e00\u4e2a\u5355\u72ec\u7684CPU\u6838\u4f7f\u7528\uff1bL3\u66f4\u5927\u3001\u66f4\u6162\uff0c\u5e76\u4e14\u88ab\u5355\u4e2a\u63d2\u69fd\u4e0a\u7684\u6240\u6709CPU\u6838\u5171\u4eab\uff1b\u6700\u540e\u662f\u4e3b\u5b58\uff0c\u7531\u5168\u90e8\u63d2\u69fd\u4e0a\u7684\u6240\u6709CPU\u6838\u5171\u4eab\u3002 \u56fe3 \u8ba1\u7b97\u673aCPU\u4e0e\u7f13\u5b58\u793a\u610f\u56fe \u5f53CPU\u6267\u884c\u8fd0\u7b97\u7684\u65f6\u5019\uff0c\u5b83\u5148\u53bbL1\u67e5\u627e\u6240\u9700\u7684\u6570\u636e\u3001\u518d\u53bbL2\u3001\u7136\u540e\u662fL3\uff0c\u5982\u679c\u6700\u540e\u8fd9\u4e9b\u7f13\u5b58\u4e2d\u90fd\u6ca1\u6709\uff0c\u6240\u9700\u7684\u6570\u636e\u5c31\u8981\u53bb\u4e3b\u5185\u5b58\u62ff\u3002\u8d70\u5f97\u8d8a\u8fdc\uff0c\u8fd0\u7b97\u8017\u8d39\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\u3002\u6240\u4ee5\u5982\u679c\u4f60\u5728\u505a\u4e00\u4e9b\u5f88\u9891\u7e41\u7684\u4e8b\uff0c\u4f60\u8981\u5c3d\u91cf\u786e\u4fdd\u6570\u636e\u5728L1\u7f13\u5b58\u4e2d\u3002 \u53e6\u5916\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u4e00\u4efd\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u4e00\u4e2a\u7ebf\u7a0b\u628a\u6570\u636e\u5199\u56de\u4e3b\u5b58\uff0c\u800c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u4e3b\u5b58\u4e2d\u76f8\u5e94\u7684\u6570\u636e\u3002 \u4e0b\u9762\u662f\u4eceCPU\u8bbf\u95ee\u4e0d\u540c\u5c42\u7ea7\u6570\u636e\u7684\u65f6\u95f4\u6982\u5ff5: \u4eceCPU\u5230 \u5927\u7ea6\u9700\u8981\u7684CPU\u5468\u671f \u5927\u7ea6\u9700\u8981\u7684\u65f6\u95f4 \u4e3b\u5b58 - \u7ea660-80ns QPI \u603b\u7ebf\u4f20\u8f93(between sockets, not drawn) - \u7ea620ns L3 cache \u7ea640-45 cycles \u7ea615ns L2 cache \u7ea610 cycles \u7ea63ns L1 cache \u7ea63-4 cycles \u7ea61ns \u5bc4\u5b58\u5668 1 cycle - \u53ef\u89c1CPU\u8bfb\u53d6\u4e3b\u5b58\u4e2d\u7684\u6570\u636e\u4f1a\u6bd4\u4eceL1\u4e2d\u8bfb\u53d6\u6162\u4e86\u8fd12\u4e2a\u6570\u91cf\u7ea7\u3002 \u7f13\u5b58\u884c Cache\u662f\u7531\u5f88\u591a\u4e2acache line\u7ec4\u6210\u7684\u3002\u6bcf\u4e2acache line\u901a\u5e38\u662f64\u5b57\u8282\uff0c\u5e76\u4e14\u5b83\u6709\u6548\u5730\u5f15\u7528\u4e3b\u5185\u5b58\u4e2d\u7684\u4e00\u5757\u513f\u5730\u5740\u3002\u4e00\u4e2aJava\u7684long\u7c7b\u578b\u53d8\u91cf\u662f8\u5b57\u8282\uff0c\u56e0\u6b64\u5728\u4e00\u4e2a\u7f13\u5b58\u884c\u4e2d\u53ef\u4ee5\u5b588\u4e2along\u7c7b\u578b\u7684\u53d8\u91cf\u3002 CPU\u6bcf\u6b21\u4ece\u4e3b\u5b58\u4e2d\u62c9\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u628a\u76f8\u90bb\u7684\u6570\u636e\u4e5f\u5b58\u5165\u540c\u4e00\u4e2acache line\u3002 \u5728\u8bbf\u95ee\u4e00\u4e2along\u6570\u7ec4\u7684\u65f6\u5019\uff0c\u5982\u679c\u6570\u7ec4\u4e2d\u7684\u4e00\u4e2a\u503c\u88ab\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff0c\u5b83\u4f1a\u81ea\u52a8\u52a0\u8f7d\u53e6\u59167\u4e2a\u3002\u56e0\u6b64\u4f60\u80fd\u975e\u5e38\u5feb\u7684\u904d\u5386\u8fd9\u4e2a\u6570\u7ec4\u3002\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u53ef\u4ee5\u975e\u5e38\u5feb\u901f\u7684\u904d\u5386\u5728\u8fde\u7eed\u5185\u5b58\u5757\u4e2d\u5206\u914d\u7684\u4efb\u610f\u6570\u636e\u7ed3\u6784\u3002 \u4e0b\u9762\u7684\u4f8b\u5b50\u662f\u6d4b\u8bd5\u5229\u7528cache line\u7684\u7279\u6027\u548c\u4e0d\u5229\u7528cache line\u7684\u7279\u6027\u7684\u6548\u679c\u5bf9\u6bd4\u3002 package com.meituan.FalseSharing; /** * @author gongming * @description * @date 16/6/4 */ public class CacheLineEffect { //\u8003\u8651\u4e00\u822c\u7f13\u5b58\u884c\u5927\u5c0f\u662f64\u5b57\u8282\uff0c\u4e00\u4e2a long \u7c7b\u578b\u53608\u5b57\u8282 static long[][] arr; public static void main(String[] args) { arr = new long[1024 * 1024][]; for (int i = 0; i < 1024 * 1024; i++) { arr[i] = new long[8]; for (int j = 0; j < 8; j++) { arr[i][j] = 0L; } } long sum = 0L; long marked = System.currentTimeMillis(); for (int i = 0; i < 1024 * 1024; i+=1) { for(int j =0; j< 8;j++){ sum = arr[i][j]; } } System.out.println(\"Loop times:\" + (System.currentTimeMillis() - marked) + \"ms\"); marked = System.currentTimeMillis(); for (int i = 0; i < 8; i+=1) { for(int j =0; j< 1024 * 1024;j++){ sum = arr[j][i]; } } System.out.println(\"Loop times:\" + (System.currentTimeMillis() - marked) + \"ms\"); } } \u57282G Hz\u30012\u6838\u30018G\u5185\u5b58\u7684\u8fd0\u884c\u73af\u5883\u4e2d\u6d4b\u8bd5\uff0c\u901f\u5ea6\u5dee\u4e00\u500d\u3002 \u7ed3\u679c\uff1a Loop times:30ms Loop times:65ms \u4ec0\u4e48\u662f\u4f2a\u5171\u4eab ArrayBlockingQueue\u6709\u4e09\u4e2a\u6210\u5458\u53d8\u91cf\uff1a - takeIndex\uff1a\u9700\u8981\u88ab\u53d6\u8d70\u7684\u5143\u7d20\u4e0b\u6807 - putIndex\uff1a\u53ef\u88ab\u5143\u7d20\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u6807 - count\uff1a\u961f\u5217\u4e2d\u5143\u7d20\u7684\u6570\u91cf \u8fd9\u4e09\u4e2a\u53d8\u91cf\u5f88\u5bb9\u6613\u653e\u5230\u4e00\u4e2a\u7f13\u5b58\u884c\u4e2d\uff0c\u4f46\u662f\u4e4b\u95f4\u4fee\u6539\u6ca1\u6709\u592a\u591a\u7684\u5173\u8054\u3002\u6240\u4ee5\u6bcf\u6b21\u4fee\u6539\uff0c\u90fd\u4f1a\u4f7f\u4e4b\u524d\u7f13\u5b58\u7684\u6570\u636e\u5931\u6548\uff0c\u4ece\u800c\u4e0d\u80fd\u5b8c\u5168\u8fbe\u5230\u5171\u4eab\u7684\u6548\u679c\u3002 \u56fe4 ArrayBlockingQueue\u4f2a\u5171\u4eab\u793a\u610f\u56fe \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5f53\u751f\u4ea7\u8005\u7ebf\u7a0bput\u4e00\u4e2a\u5143\u7d20\u5230ArrayBlockingQueue\u65f6\uff0cputIndex\u4f1a\u4fee\u6539\uff0c\u4ece\u800c\u5bfc\u81f4\u6d88\u8d39\u8005\u7ebf\u7a0b\u7684\u7f13\u5b58\u4e2d\u7684\u7f13\u5b58\u884c\u65e0\u6548\uff0c\u9700\u8981\u4ece\u4e3b\u5b58\u4e2d\u91cd\u65b0\u8bfb\u53d6\u3002 \u8fd9\u79cd\u65e0\u6cd5\u5145\u5206\u4f7f\u7528\u7f13\u5b58\u884c\u7279\u6027\u7684\u73b0\u8c61\uff0c\u79f0\u4e3a\u4f2a\u5171\u4eab\u3002 \u5bf9\u4e8e\u4f2a\u5171\u4eab\uff0c\u4e00\u822c\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u589e\u5927\u6570\u7ec4\u5143\u7d20\u7684\u95f4\u9694\u4f7f\u5f97\u7531\u4e0d\u540c\u7ebf\u7a0b\u5b58\u53d6\u7684\u5143\u7d20\u4f4d\u4e8e\u4e0d\u540c\u7684\u7f13\u5b58\u884c\u4e0a\uff0c\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u3002 package com.meituan.FalseSharing; public class FalseSharing implements Runnable{ public final static long ITERATIONS = 500L * 1000L * 100L; private int arrayIndex = 0; private static ValuePadding[] longs; public FalseSharing(final int arrayIndex) { this.arrayIndex = arrayIndex; } public static void main(final String[] args) throws Exception { for(int i=1;i<10;i++){ System.gc(); final long start = System.currentTimeMillis(); runTest(i); System.out.println(\"Thread num \"+i+\" duration = \" + (System.currentTimeMillis() - start)); } } private static void runTest(int NUM_THREADS) throws InterruptedException { Thread[] threads = new Thread[NUM_THREADS]; longs = new ValuePadding[NUM_THREADS]; for (int i = 0; i < longs.length; i++) { longs[i] = new ValuePadding(); } for (int i = 0; i < threads.length; i++) { threads[i] = new Thread(new FalseSharing(i)); } for (Thread t : threads) { t.start(); } for (Thread t : threads) { t.join(); } } public void run() { long i = ITERATIONS + 1; while (0 != --i) { longs[arrayIndex].value = 0L; } } public final static class ValuePadding { protected long p1, p2, p3, p4, p5, p6, p7; protected volatile long value = 0L; protected long p9, p10, p11, p12, p13, p14; protected long p15; } public final static class ValueNoPadding { // protected long p1, p2, p3, p4, p5, p6, p7; protected volatile long value = 0L; // protected long p9, p10, p11, p12, p13, p14, p15; } } \u57282G Hz\uff0c2\u6838\uff0c8G\u5185\u5b58, jdk 1.7.0_45 \u7684\u8fd0\u884c\u73af\u5883\u4e0b\uff0c\u4f7f\u7528\u4e86\u5171\u4eab\u673a\u5236\u6bd4\u6ca1\u6709\u4f7f\u7528\u5171\u4eab\u673a\u5236\uff0c\u901f\u5ea6\u5feb\u4e864\u500d\u5de6\u53f3\u3002 \u7ed3\u679c\uff1a Thread num 1 duration = 447 Thread num 2 duration = 463 Thread num 3 duration = 454 Thread num 4 duration = 464 Thread num 5 duration = 561 Thread num 6 duration = 606 Thread num 7 duration = 684 Thread num 8 duration = 870 Thread num 9 duration = 823 \u628a\u4ee3\u7801\u4e2dValuePadding\u90fd\u66ff\u6362\u4e3aValueNoPadding\u540e\u7684\u7ed3\u679c\uff1a Thread num 1 duration = 446 Thread num 2 duration = 2549 Thread num 3 duration = 2898 Thread num 4 duration = 3931 Thread num 5 duration = 4716 Thread num 6 duration = 5424 Thread num 7 duration = 4868 Thread num 8 duration = 4595 Thread num 9 duration = 4540 \u5907\u6ce8\uff1a\u5728jdk1.8\u4e2d\uff0c\u6709\u4e13\u95e8\u7684\u6ce8\u89e3@Contended\u6765\u907f\u514d\u4f2a\u5171\u4eab\uff0c\u66f4\u4f18\u96c5\u5730\u89e3\u51b3\u95ee\u9898\u3002 Disruptor\u7684\u8bbe\u8ba1\u65b9\u6848 Disruptor\u901a\u8fc7\u4ee5\u4e0b\u8bbe\u8ba1\u6765\u89e3\u51b3\u961f\u5217\u901f\u5ea6\u6162\u7684\u95ee\u9898\uff1a \u73af\u5f62\u6570\u7ec4\u7ed3\u6784 \u4e3a\u4e86\u907f\u514d\u5783\u573e\u56de\u6536\uff0c\u91c7\u7528\u6570\u7ec4\u800c\u975e\u94fe\u8868\u3002\u540c\u65f6\uff0c\u6570\u7ec4\u5bf9\u5904\u7406\u5668\u7684\u7f13\u5b58\u673a\u5236\u66f4\u52a0\u53cb\u597d\u3002 \u5143\u7d20\u4f4d\u7f6e\u5b9a\u4f4d \u6570\u7ec4\u957f\u5ea62^n\uff0c\u901a\u8fc7\u4f4d\u8fd0\u7b97\uff0c\u52a0\u5feb\u5b9a\u4f4d\u7684\u901f\u5ea6\u3002\u4e0b\u6807\u91c7\u53d6\u9012\u589e\u7684\u5f62\u5f0f\u3002\u4e0d\u7528\u62c5\u5fc3index\u6ea2\u51fa\u7684\u95ee\u9898\u3002index\u662flong\u7c7b\u578b\uff0c\u5373\u4f7f100\u4e07QPS\u7684\u5904\u7406\u901f\u5ea6\uff0c\u4e5f\u9700\u898130\u4e07\u5e74\u624d\u80fd\u7528\u5b8c\u3002 \u65e0\u9501\u8bbe\u8ba1 \u6bcf\u4e2a\u751f\u4ea7\u8005\u6216\u8005\u6d88\u8d39\u8005\u7ebf\u7a0b\uff0c\u4f1a\u5148\u7533\u8bf7\u53ef\u4ee5\u64cd\u4f5c\u7684\u5143\u7d20\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u7533\u8bf7\u5230\u4e4b\u540e\uff0c\u76f4\u63a5\u5728\u8be5\u4f4d\u7f6e\u5199\u5165\u6216\u8005\u8bfb\u53d6\u6570\u636e\u3002 \u4e0b\u9762\u5ffd\u7565\u6570\u7ec4\u7684\u73af\u5f62\u7ed3\u6784\uff0c\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u5b9e\u73b0\u65e0\u9501\u8bbe\u8ba1\u3002\u6574\u4e2a\u8fc7\u7a0b\u901a\u8fc7\u539f\u5b50\u53d8\u91cfCAS\uff0c\u4fdd\u8bc1\u64cd\u4f5c\u7684\u7ebf\u7a0b\u5b89\u5168\u3002 \u4e00\u4e2a\u751f\u4ea7\u8005 \u5199\u6570\u636e \u751f\u4ea7\u8005\u5355\u7ebf\u7a0b\u5199\u6570\u636e\u7684\u6d41\u7a0b\u6bd4\u8f83\u7b80\u5355\uff1a \u7533\u8bf7\u5199\u5165m\u4e2a\u5143\u7d20\uff1b \u82e5\u662f\u6709m\u4e2a\u5143\u7d20\u53ef\u4ee5\u5165\uff0c\u5219\u8fd4\u56de\u6700\u5927\u7684\u5e8f\u5217\u53f7\u3002\u8fd9\u513f\u4e3b\u8981\u5224\u65ad\u662f\u5426\u4f1a\u8986\u76d6\u672a\u8bfb\u7684\u5143\u7d20\uff1b \u82e5\u662f\u8fd4\u56de\u7684\u6b63\u786e\uff0c\u5219\u751f\u4ea7\u8005\u5f00\u59cb\u5199\u5165\u5143\u7d20\u3002 \u56fe5 \u5355\u4e2a\u751f\u4ea7\u8005\u751f\u4ea7\u8fc7\u7a0b\u793a\u610f\u56fe \u591a\u4e2a\u751f\u4ea7\u8005 \u591a\u4e2a\u751f\u4ea7\u8005\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9047\u5230\u201c\u5982\u4f55\u9632\u6b62\u591a\u4e2a\u7ebf\u7a0b\u91cd\u590d\u5199\u540c\u4e00\u4e2a\u5143\u7d20\u201d\u7684\u95ee\u9898\u3002Disruptor\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e0d\u540c\u7684\u4e00\u6bb5\u6570\u7ec4\u7a7a\u95f4\u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u4e2a\u901a\u8fc7CAS\u5f88\u5bb9\u6613\u8fbe\u5230\u3002\u53ea\u9700\u8981\u5728\u5206\u914d\u5143\u7d20\u7684\u65f6\u5019\uff0c\u901a\u8fc7CAS\u5224\u65ad\u4e00\u4e0b\u8fd9\u6bb5\u7a7a\u95f4\u662f\u5426\u5df2\u7ecf\u5206\u914d\u51fa\u53bb\u5373\u53ef\u3002 \u4f46\u662f\u4f1a\u9047\u5230\u4e00\u4e2a\u65b0\u95ee\u9898\uff1a\u5982\u4f55\u9632\u6b62\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u8bfb\u5230\u8fd8\u672a\u5199\u7684\u5143\u7d20\u3002Disruptor\u5728\u591a\u4e2a\u751f\u4ea7\u8005\u7684\u60c5\u51b5\u4e0b\uff0c\u5f15\u5165\u4e86\u4e00\u4e2a\u4e0eRing Buffer\u5927\u5c0f\u76f8\u540c\u7684buffer\uff1aavailable Buffer\u3002\u5f53\u67d0\u4e2a\u4f4d\u7f6e\u5199\u5165\u6210\u529f\u7684\u65f6\u5019\uff0c\u4fbf\u628aavailble Buffer\u76f8\u5e94\u7684\u4f4d\u7f6e\u7f6e\u4f4d\uff0c\u6807\u8bb0\u4e3a\u5199\u5165\u6210\u529f\u3002\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u4f1a\u904d\u5386available Buffer\uff0c\u6765\u5224\u65ad\u5143\u7d20\u662f\u5426\u5df2\u7ecf\u5c31\u7eea\u3002 \u4e0b\u9762\u5206\u8bfb\u6570\u636e\u548c\u5199\u6570\u636e\u4e24\u79cd\u60c5\u51b5\u4ecb\u7ecd\u3002 \u8bfb\u6570\u636e \u751f\u4ea7\u8005\u591a\u7ebf\u7a0b\u5199\u5165\u7684\u60c5\u51b5\u4f1a\u590d\u6742\u5f88\u591a\uff1a \u7533\u8bf7\u8bfb\u53d6\u5230\u5e8f\u53f7n\uff1b \u82e5writer cursor >= n\uff0c\u8fd9\u65f6\u4ecd\u7136\u65e0\u6cd5\u786e\u5b9a\u8fde\u7eed\u53ef\u8bfb\u7684\u6700\u5927\u4e0b\u6807\u3002\u4ecereader cursor\u5f00\u59cb\u8bfb\u53d6available Buffer\uff0c\u4e00\u76f4\u67e5\u5230\u7b2c\u4e00\u4e2a\u4e0d\u53ef\u7528\u7684\u5143\u7d20\uff0c\u7136\u540e\u8fd4\u56de\u6700\u5927\u8fde\u7eed\u53ef\u8bfb\u5143\u7d20\u7684\u4f4d\u7f6e\uff1b \u6d88\u8d39\u8005\u8bfb\u53d6\u5143\u7d20\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8bfb\u7ebf\u7a0b\u8bfb\u5230\u4e0b\u6807\u4e3a2\u7684\u5143\u7d20\uff0c\u4e09\u4e2a\u7ebf\u7a0bWriter1/Writer2/Writer3\u6b63\u5728\u5411RingBuffer\u76f8\u5e94\u4f4d\u7f6e\u5199\u6570\u636e\uff0c\u5199\u7ebf\u7a0b\u88ab\u5206\u914d\u5230\u7684\u6700\u5927\u5143\u7d20\u4e0b\u6807\u662f11\u3002 \u8bfb\u7ebf\u7a0b\u7533\u8bf7\u8bfb\u53d6\u5230\u4e0b\u6807\u4ece3\u523011\u7684\u5143\u7d20\uff0c\u5224\u65adwriter cursor>=11\u3002\u7136\u540e\u5f00\u59cb\u8bfb\u53d6availableBuffer\uff0c\u4ece3\u5f00\u59cb\uff0c\u5f80\u540e\u8bfb\u53d6\uff0c\u53d1\u73b0\u4e0b\u6807\u4e3a7\u7684\u5143\u7d20\u6ca1\u6709\u751f\u4ea7\u6210\u529f\uff0c\u4e8e\u662fWaitFor(11)\u8fd4\u56de6\u3002 \u7136\u540e\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u4e0b\u6807\u4ece3\u52306\u5171\u8ba14\u4e2a\u5143\u7d20\u3002 \u56fe6 \u591a\u4e2a\u751f\u4ea7\u8005\u60c5\u51b5\u4e0b\uff0c\u6d88\u8d39\u8005\u6d88\u8d39\u8fc7\u7a0b\u793a\u610f\u56fe \u5199\u6570\u636e \u591a\u4e2a\u751f\u4ea7\u8005\u5199\u5165\u7684\u65f6\u5019\uff1a \u7533\u8bf7\u5199\u5165m\u4e2a\u5143\u7d20\uff1b \u82e5\u662f\u6709m\u4e2a\u5143\u7d20\u53ef\u4ee5\u5199\u5165\uff0c\u5219\u8fd4\u56de\u6700\u5927\u7684\u5e8f\u5217\u53f7\u3002\u6bcf\u4e2a\u751f\u4ea7\u8005\u4f1a\u88ab\u5206\u914d\u4e00\u6bb5\u72ec\u4eab\u7684\u7a7a\u95f4\uff1b \u751f\u4ea7\u8005\u5199\u5165\u5143\u7d20\uff0c\u5199\u5165\u5143\u7d20\u7684\u540c\u65f6\u8bbe\u7f6eavailable Buffer\u91cc\u9762\u76f8\u5e94\u7684\u4f4d\u7f6e\uff0c\u4ee5\u6807\u8bb0\u81ea\u5df1\u54ea\u4e9b\u4f4d\u7f6e\u662f\u5df2\u7ecf\u5199\u5165\u6210\u529f\u7684\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0cWriter1\u548cWriter2\u4e24\u4e2a\u7ebf\u7a0b\u5199\u5165\u6570\u7ec4\uff0c\u90fd\u7533\u8bf7\u53ef\u5199\u7684\u6570\u7ec4\u7a7a\u95f4\u3002Writer1\u88ab\u5206\u914d\u4e86\u4e0b\u68073\u5230\u4e0b\u88685\u7684\u7a7a\u95f4\uff0cWriter2\u88ab\u5206\u914d\u4e86\u4e0b\u68076\u5230\u4e0b\u68079\u7684\u7a7a\u95f4\u3002 Writer1\u5199\u5165\u4e0b\u68073\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u540c\u65f6\u628aavailable Buffer\u76f8\u5e94\u4f4d\u7f6e\u7f6e\u4f4d\uff0c\u6807\u8bb0\u5df2\u7ecf\u5199\u5165\u6210\u529f\uff0c\u5f80\u540e\u79fb\u4e00\u4f4d\uff0c\u5f00\u59cb\u5199\u4e0b\u68074\u4f4d\u7f6e\u7684\u5143\u7d20\u3002Writer2\u540c\u6837\u7684\u65b9\u5f0f\u3002\u6700\u7ec8\u90fd\u5199\u5165\u5b8c\u6210\u3002 \u56fe7 \u591a\u4e2a\u751f\u4ea7\u8005\u60c5\u51b5\u4e0b\uff0c\u751f\u4ea7\u8005\u751f\u4ea7\u8fc7\u7a0b\u793a\u610f\u56fe \u9632\u6b62\u4e0d\u540c\u751f\u4ea7\u8005\u5bf9\u540c\u4e00\u6bb5\u7a7a\u95f4\u5199\u5165\u7684\u4ee3\u7801\uff0c\u5982\u4e0b\u6240\u793a\uff1a public long tryNext(int n) throws InsufficientCapacityException { if (n < 1) { throw new IllegalArgumentException(\"n must be > 0\"); } long current; long next; do { current = cursor.get(); next = current + n; if (!hasAvailableCapacity(gatingSequences, n, current)) { throw InsufficientCapacityException.INSTANCE; } } while (!cursor.compareAndSet(current, next)); return next; } \u901a\u8fc7do/while\u5faa\u73af\u7684\u6761\u4ef6cursor.compareAndSet(current, next)\uff0c\u6765\u5224\u65ad\u6bcf\u6b21\u7533\u8bf7\u7684\u7a7a\u95f4\u662f\u5426\u5df2\u7ecf\u88ab\u5176\u4ed6\u751f\u4ea7\u8005\u5360\u636e\u3002\u5047\u5982\u5df2\u7ecf\u88ab\u5360\u636e\uff0c\u8be5\u51fd\u6570\u4f1a\u8fd4\u56de\u5931\u8d25\uff0cWhile\u5faa\u73af\u91cd\u65b0\u6267\u884c\uff0c\u7533\u8bf7\u5199\u5165\u7a7a\u95f4\u3002 \u6d88\u8d39\u8005\u7684\u6d41\u7a0b\u4e0e\u751f\u4ea7\u8005\u975e\u5e38\u7c7b\u4f3c\uff0c\u8fd9\u513f\u5c31\u4e0d\u591a\u63cf\u8ff0\u4e86\u3002 \u603b\u7ed3 Disruptor\u901a\u8fc7\u7cbe\u5de7\u7684\u65e0\u9501\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u5728\u9ad8\u5e76\u53d1\u60c5\u5f62\u4e0b\u7684\u9ad8\u6027\u80fd\u3002 \u5728\u7f8e\u56e2\u5185\u90e8\uff0c\u5f88\u591a\u9ad8\u5e76\u53d1\u573a\u666f\u501f\u9274\u4e86Disruptor\u7684\u8bbe\u8ba1\uff0c\u51cf\u5c11\u7ade\u4e89\u7684\u5f3a\u5ea6\u3002\u5176\u8bbe\u8ba1\u601d\u60f3\u53ef\u4ee5\u6269\u5c55\u5230\u5206\u5e03\u5f0f\u573a\u666f\uff0c\u901a\u8fc7\u65e0\u9501\u8bbe\u8ba1\uff0c\u6765\u63d0\u5347\u670d\u52a1\u6027\u80fd\u3002 \u4f7f\u7528Disruptor\u6bd4\u4f7f\u7528ArrayBlockingQueue\u7565\u5fae\u590d\u6742\uff0c\u4e3a\u65b9\u4fbf\u8bfb\u8005\u4e0a\u624b\uff0c\u589e\u52a0\u4ee3\u7801\u6837\u4f8b\u3002 \u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd\uff1a\u6bcf10ms\u5411disruptor\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6253\u5370\u5230\u7ec8\u7aef\u3002\u8be6\u7ec6\u903b\u8f91\u8bf7\u7ec6\u8bfb\u4ee3\u7801\u3002 \u4ee5\u4e0b\u4ee3\u7801\u57fa\u4e8e3.3.4\u7248\u672c\u7684Disruptor\u5305\u3002 package com.meituan.Disruptor; /** * @description disruptor\u4ee3\u7801\u6837\u4f8b\u3002\u6bcf10ms\u5411disruptor\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6253\u5370\u5230\u7ec8\u7aef */ import com.lmax.disruptor.*; import com.lmax.disruptor.dsl.Disruptor; import com.lmax.disruptor.dsl.ProducerType; import java.util.concurrent.ThreadFactory; public class DisruptorMain { public static void main(String[] args) throws Exception { // \u961f\u5217\u4e2d\u7684\u5143\u7d20 class Element { private int value; public int get(){ return value; } public void set(int value){ this.value= value; } } // \u751f\u4ea7\u8005\u7684\u7ebf\u7a0b\u5de5\u5382 ThreadFactory threadFactory = new ThreadFactory(){ @Override public Thread newThread(Runnable r) { return new Thread(r, \"simpleThread\"); } }; // RingBuffer\u751f\u4ea7\u5de5\u5382,\u521d\u59cb\u5316RingBuffer\u7684\u65f6\u5019\u4f7f\u7528 EventFactory<Element> factory = new EventFactory<Element>() { @Override public Element newInstance() { return new Element(); } }; // \u5904\u7406Event\u7684handler EventHandler<Element> handler = new EventHandler<Element>(){ @Override public void onEvent(Element element, long sequence, boolean endOfBatch) { System.out.println(\"Element: \" + element.get()); } }; // \u963b\u585e\u7b56\u7565 BlockingWaitStrategy strategy = new BlockingWaitStrategy(); // \u6307\u5b9aRingBuffer\u7684\u5927\u5c0f int bufferSize = 16; // \u521b\u5efadisruptor\uff0c\u91c7\u7528\u5355\u751f\u4ea7\u8005\u6a21\u5f0f Disruptor<Element> disruptor = new Disruptor(factory, bufferSize, threadFactory, ProducerType.SINGLE, strategy); // \u8bbe\u7f6eEventHandler disruptor.handleEventsWith(handler); // \u542f\u52a8disruptor\u7684\u7ebf\u7a0b disruptor.start(); RingBuffer<Element> ringBuffer = disruptor.getRingBuffer(); for (int l = 0; true; l++) { // \u83b7\u53d6\u4e0b\u4e00\u4e2a\u53ef\u7528\u4f4d\u7f6e\u7684\u4e0b\u6807 long sequence = ringBuffer.next(); try { // \u8fd4\u56de\u53ef\u7528\u4f4d\u7f6e\u7684\u5143\u7d20 Element event = ringBuffer.get(sequence); // \u8bbe\u7f6e\u8be5\u4f4d\u7f6e\u5143\u7d20\u7684\u503c event.set(l); } finally { ringBuffer.publish(sequence); } Thread.sleep(10); } } } \u6027\u80fd \u4ee5\u4e0b\u9762\u8fd9\u4e9b\u6a21\u5f0f\u6d4b\u8bd5\u6027\u80fd: \u541e\u5410\u91cf\u6d4b\u8bd5\u6570\u636e\uff08\u6bcf\u79d2\u7684\u6570\u91cf\uff09\u5982\u4e0b\u3002 \u73af\u5883\uff1a - CPU:Intel Core i7 860 @ 2.8 GHz without HT - JVM:Java 1.6.0_25 64-bit - OS:Windows 7 - ABQ Disruptor Unicast: 1P \u2013 1C 5,339,256 25,998,336 Pipeline: 1P \u2013 3C 2,128,918 16,806,157 Sequencer: 3P \u2013 1C 5,539,531 13,403,268 Multicast: 1P \u2013 3C 1,077,384 9,377,871 Diamond: 1P \u2013 3C 2,113,941 16,143,613 \u73af\u5883\uff1a CPU:Intel Core i7-2720QM JVM:Java 1.6.0_25 64-bit OS:Ubuntu 11.04 - ABQ Disruptor Unicast: 1P \u2013 1C 4,057,453 22,381,378 Pipeline: 1P \u2013 3C 2,006,903 15,857,913 Sequencer: 3P \u2013 1C 2,056,118 14,540,519 Multicast: 1P \u2013 3C 260,733 10,860,121 Diamond: 1P \u2013 3C 2,082,725 15,295,197 \u4f9d\u636e\u5e76\u53d1\u7ade\u4e89\u7684\u6fc0\u70c8\u7a0b\u5ea6\u7684\u4e0d\u540c\uff0cDisruptor\u6bd4ArrayBlockingQueue\u541e\u5410\u91cf\u5feb4~7\u500d\u3002 \u6309\u7167Pipeline: 1P \u2013 3C\u7684\u8fde\u63a5\u6a21\u5f0f\u6d4b\u8bd5\u5ef6\u8fdf\uff0c\u751f\u4ea7\u8005\u4e24\u6b21\u5199\u5165\u4e4b\u95f4\u7684\u5ef6\u8fdf\u4e3a1ms\u3002 \u8fd0\u884c\u73af\u5883\uff1a CPU:2.2GHz Core i7-2720QM Java: 1.6.0_25 64-bit OS:Ubuntu 11.04. - Array Blocking Queue (ns) Disruptor (ns) 99% observations less than 2,097,152 128 99.99% observations less than 4,194,304 8,192 Max Latency 5,069,086 175,567 Mean Latency 32,757 52 Min Latency 145 29 \u53ef\u89c1\uff0c\u5e73\u5747\u5ef6\u8fdf\u5dee\u4e863\u4e2a\u6570\u91cf\u7ea7\u3002 \u7b49\u5f85\u7b56\u7565 \u751f\u4ea7\u8005\u7684\u7b49\u5f85\u7b56\u7565 \u6682\u65f6\u53ea\u6709\u4f11\u77201ns\u3002 LockSupport.parkNanos(1); \u6d88\u8d39\u8005\u7684\u7b49\u5f85\u7b56\u7565 \u540d\u79f0 \u63aa\u65bd \u9002\u7528\u573a\u666f BlockingWaitStrategy \u52a0\u9501 CPU\u8d44\u6e90\u7d27\u7f3a\uff0c\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u5e76\u4e0d\u91cd\u8981\u7684\u573a\u666f BusySpinWaitStrategy \u81ea\u65cb \u901a\u8fc7\u4e0d\u65ad\u91cd\u8bd5\uff0c\u51cf\u5c11\u5207\u6362\u7ebf\u7a0b\u5bfc\u81f4\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u964d\u4f4e\u5ef6\u8fdf\u3002\u63a8\u8350\u5728\u7ebf\u7a0b\u7ed1\u5b9a\u5230\u56fa\u5b9a\u7684CPU\u7684\u573a\u666f\u4e0b\u4f7f\u7528 PhasedBackoffWaitStrategy \u81ea\u65cb + yield + \u81ea\u5b9a\u4e49\u7b56\u7565 CPU\u8d44\u6e90\u7d27\u7f3a\uff0c\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u5e76\u4e0d\u91cd\u8981\u7684\u573a\u666f SleepingWaitStrategy \u81ea\u65cb + yield + sleep \u6027\u80fd\u548cCPU\u8d44\u6e90\u4e4b\u95f4\u6709\u5f88\u597d\u7684\u6298\u4e2d\u3002\u5ef6\u8fdf\u4e0d\u5747\u5300 TimeoutBlockingWaitStrategy \u52a0\u9501\uff0c\u6709\u8d85\u65f6\u9650\u5236 CPU\u8d44\u6e90\u7d27\u7f3a\uff0c\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u5e76\u4e0d\u91cd\u8981\u7684\u573a\u666f YieldingWaitStrategy \u81ea\u65cb + yield + \u81ea\u65cb \u6027\u80fd\u548cCPU\u8d44\u6e90\u4e4b\u95f4\u6709\u5f88\u597d\u7684\u6298\u4e2d\u3002\u5ef6\u8fdf\u6bd4\u8f83\u5747\u5300 Log4j 2\u5e94\u7528\u573a\u666f Log4j 2\u76f8\u5bf9\u4e8eLog4j 1\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u591a\u7ebf\u7a0b\u5e76\u53d1\u573a\u666f\u4e0b\u6027\u80fd\u66f4\u4f18\u3002\u8be5\u7279\u6027\u6e90\u81ea\u4e8eLog4j 2\u7684\u5f02\u6b65\u6a21\u5f0f\u91c7\u7528\u4e86Disruptor\u6765\u5904\u7406\u3002 \u5728Log4j 2\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u914d\u7f6eWaitStrategy\uff0c\u9ed8\u8ba4\u662fTimeout\u7b56\u7565\u3002\u4e0b\u9762\u662fLog4j 2\u4e2d\u5bf9WaitStrategy\u7684\u914d\u7f6e\u5b98\u65b9\u6587\u6863\uff1a System Property Default Value Description AsyncLogger.WaitStrategy Timeout Valid values: Block, Timeout, Sleep, Yield. Block is a strategy that uses a lock and condition variable for the I/O thread waiting for log events. Block can be used when throughput and low-latency are not as important as CPU resource. Recommended for resource constrained/virtualised environments. Timeout is a variation of the Block strategy that will periodically wake up from the lock condition await() call. This ensures that if a notification is missed somehow the consumer thread is not stuck but will recover with a small latency delay (default 10ms). Sleep is a strategy that initially spins, then uses a Thread.yield(), and eventually parks for the minimum number of nanos the OS and JVM will allow while the I/O thread is waiting for log events. Sleep is a good compromise between performance and CPU resource. This strategy has very low impact on the application thread, in exchange for some additional latency for actually getting the message logged. Yield is a strategy that uses a Thread.yield() for waiting for log events after an initially spinning. Yield is a good compromise between performance and CPU resource, but may use more CPU than Sleep in order to get the message logged to disk sooner. \u6027\u80fd\u5dee\u5f02 loggers all async\u91c7\u7528\u7684\u662fDisruptor\uff0c\u800cAsync Appender\u91c7\u7528\u7684\u662fArrayBlockingQueue\u961f\u5217\u3002 \u7531\u56fe\u53ef\u89c1\uff0c\u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0cloggers all async\u4e0eAsync Appender\u541e\u5410\u91cf\u76f8\u5dee\u4e0d\u5927\uff0c\u4f46\u662f\u572864\u4e2a\u7ebf\u7a0b\u7684\u65f6\u5019\uff0cloggers all async\u7684\u541e\u5410\u91cf\u6bd4Async Appender\u589e\u52a0\u4e8612\u500d\uff0c\u662fSync\u6a21\u5f0f\u768468\u500d\u3002 \u56fe8 Log4j 2\u5404\u4e2a\u6a21\u5f0f\u6027\u80fd\u6bd4\u8f83 \u7f8e\u56e2\u5728\u516c\u53f8\u5185\u90e8\u7edf\u4e00\u63a8\u884c\u65e5\u5fd7\u63a5\u5165\u89c4\u8303\uff0c\u8981\u6c42\u5fc5\u987b\u4f7f\u7528Log4j 2\uff0c\u4f7f\u666e\u901a\u5355\u673aQPS\u7684\u4e0a\u9650\u4e0d\u518d\u53ea\u505c\u7559\u5728\u51e0\u5343\uff0c\u6781\u9ad8\u5730\u63d0\u5347\u4e86\u670d\u52a1\u6027\u80fd\u3002","title":"\u9ad8\u6027\u80fd\u961f\u5217\u2014\u2014Disruptor"},{"location":"language/java/disruptor/#_1","text":"Disruptor\u662f\u82f1\u56fd\u5916\u6c47\u4ea4\u6613\u516c\u53f8LMAX\u5f00\u53d1\u7684\u4e00\u4e2a\u9ad8\u6027\u80fd\u961f\u5217\uff0c\u7814\u53d1\u7684\u521d\u8877\u662f\u89e3\u51b3\u5185\u5b58\u961f\u5217\u7684\u5ef6\u8fdf\u95ee\u9898\uff08\u5728\u6027\u80fd\u6d4b\u8bd5\u4e2d\u53d1\u73b0\u7adf\u7136\u4e0eI/O\u64cd\u4f5c\u5904\u4e8e\u540c\u6837\u7684\u6570\u91cf\u7ea7\uff09\u3002\u57fa\u4e8eDisruptor\u5f00\u53d1\u7684\u7cfb\u7edf\u5355\u7ebf\u7a0b\u80fd\u652f\u6491\u6bcf\u79d2600\u4e07\u8ba2\u5355\uff0c2010\u5e74\u5728QCon\u6f14\u8bb2\u540e\uff0c\u83b7\u5f97\u4e86\u4e1a\u754c\u5173\u6ce8\u30022011\u5e74\uff0c\u4f01\u4e1a\u5e94\u7528\u8f6f\u4ef6\u4e13\u5bb6Martin Fowler\u4e13\u95e8\u64b0\u5199\u957f\u6587\u4ecb\u7ecd\u3002\u540c\u5e74\u5b83\u8fd8\u83b7\u5f97\u4e86Oracle\u5b98\u65b9\u7684Duke\u5927\u5956\u3002 \u76ee\u524d\uff0c\u5305\u62ecApache Storm\u3001Camel\u3001Log4j 2\u5728\u5185\u7684\u5f88\u591a\u77e5\u540d\u9879\u76ee\u90fd\u5e94\u7528\u4e86Disruptor\u4ee5\u83b7\u53d6\u9ad8\u6027\u80fd\u3002\u5728\u7f8e\u56e2\u6280\u672f\u56e2\u961f\u5b83\u4e5f\u6709\u4e0d\u5c11\u5e94\u7528\uff0c\u6709\u7684\u9879\u76ee\u67b6\u6784\u501f\u9274\u4e86\u5b83\u7684\u8bbe\u8ba1\u673a\u5236\u3002\u672c\u6587\u4ece\u5b9e\u6218\u89d2\u5ea6\u5256\u6790\u4e86Disruptor\u7684\u5b9e\u73b0\u539f\u7406\u3002 \u9700\u8981\u7279\u522b\u6307\u51fa\u7684\u662f\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u961f\u5217\u662f\u7cfb\u7edf\u5185\u90e8\u7684\u5185\u5b58\u961f\u5217\uff0c\u800c\u4e0d\u662fKafka\u8fd9\u6837\u7684\u5206\u5e03\u5f0f\u961f\u5217\u3002\u53e6\u5916\uff0c\u672c\u6587\u6240\u63cf\u8ff0\u7684Disruptor\u7279\u6027\u9650\u4e8e3.3.4\u3002","title":"\u80cc\u666f"},{"location":"language/java/disruptor/#java","text":"\u4ecb\u7ecdDisruptor\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u770b\u5e38\u7528\u7684\u7ebf\u7a0b\u5b89\u5168\u7684\u5185\u7f6e\u961f\u5217\u6709\u4ec0\u4e48\u95ee\u9898\u3002Java\u7684\u5185\u7f6e\u961f\u5217\u5982\u4e0b\u8868\u6240\u793a\u3002 \u961f\u5217 \u6709\u754c\u6027 \u9501 \u6570\u636e\u7ed3\u6784 ArrayBlockingQueue bounded \u52a0\u9501 arraylist LinkedBlockingQueue optionally-bounded \u52a0\u9501 linkedlist ConcurrentLinkedQueue unbounded \u65e0\u9501 linkedlist LinkedTransferQueue unbounded \u65e0\u9501 linkedlist PriorityBlockingQueue unbounded \u52a0\u9501 heap DelayQueue unbounded \u52a0\u9501 heap \u961f\u5217\u7684\u5e95\u5c42\u4e00\u822c\u5206\u6210\u4e09\u79cd\uff1a\u6570\u7ec4\u3001\u94fe\u8868\u548c\u5806\u3002\u5176\u4e2d\uff0c\u5806\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u4e3a\u4e86\u5b9e\u73b0\u5e26\u6709\u4f18\u5148\u7ea7\u7279\u6027\u7684\u961f\u5217\uff0c\u6682\u4e14\u4e0d\u8003\u8651\u3002 \u6211\u4eec\u5c31\u4ece\u6570\u7ec4\u548c\u94fe\u8868\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u6765\u770b\uff0c\u57fa\u4e8e\u6570\u7ec4\u7ebf\u7a0b\u5b89\u5168\u7684\u961f\u5217\uff0c\u6bd4\u8f83\u5178\u578b\u7684\u662fArrayBlockingQueue\uff0c\u5b83\u4e3b\u8981\u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1b\u57fa\u4e8e\u94fe\u8868\u7684\u7ebf\u7a0b\u5b89\u5168\u961f\u5217\u5206\u6210LinkedBlockingQueue\u548cConcurrentLinkedQueue\u4e24\u5927\u7c7b\uff0c\u524d\u8005\u4e5f\u901a\u8fc7\u9501\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\uff0c\u800c\u540e\u8005\u4ee5\u53ca\u4e0a\u9762\u8868\u683c\u4e2d\u7684LinkedTransferQueue\u90fd\u662f\u901a\u8fc7\u539f\u5b50\u53d8\u91cfcompare and swap\uff08\u4ee5\u4e0b\u7b80\u79f0\u201cCAS\u201d\uff09\u8fd9\u79cd\u4e0d\u52a0\u9501\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684\u3002 \u901a\u8fc7\u4e0d\u52a0\u9501\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u961f\u5217\u90fd\u662f\u65e0\u754c\u7684\uff08\u65e0\u6cd5\u4fdd\u8bc1\u961f\u5217\u7684\u957f\u5ea6\u5728\u786e\u5b9a\u7684\u8303\u56f4\u5185\uff09\uff1b\u800c\u52a0\u9501\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6709\u754c\u961f\u5217\u3002\u5728\u7a33\u5b9a\u6027\u8981\u6c42\u7279\u522b\u9ad8\u7684\u7cfb\u7edf\u4e2d\uff0c\u4e3a\u4e86\u9632\u6b62\u751f\u4ea7\u8005\u901f\u5ea6\u8fc7\u5feb\uff0c\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff0c\u53ea\u80fd\u9009\u62e9\u6709\u754c\u961f\u5217\uff1b\u540c\u65f6\uff0c\u4e3a\u4e86\u51cf\u5c11Java\u7684\u5783\u573e\u56de\u6536\u5bf9\u7cfb\u7edf\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4f1a\u5c3d\u91cf\u9009\u62e9array/heap\u683c\u5f0f\u7684\u6570\u636e\u7ed3\u6784\u3002\u8fd9\u6837\u7b5b\u9009\u4e0b\u6765\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u961f\u5217\u5c31\u53ea\u6709ArrayBlockingQueue\u3002","title":"Java\u5185\u7f6e\u961f\u5217"},{"location":"language/java/disruptor/#arrayblockingqueue","text":"ArrayBlockingQueue\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u56e0\u4e3a\u52a0\u9501\u548c\u4f2a\u5171\u4eab\u7b49\u51fa\u73b0\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898\uff0c\u6211\u4eec\u4e0b\u9762\u6765\u5206\u6790\u4e00\u4e0b\u3002","title":"ArrayBlockingQueue\u7684\u95ee\u9898"},{"location":"language/java/disruptor/#_2","text":"\u73b0\u5b9e\u7f16\u7a0b\u8fc7\u7a0b\u4e2d\uff0c\u52a0\u9501\u901a\u5e38\u4f1a\u4e25\u91cd\u5730\u5f71\u54cd\u6027\u80fd\u3002\u7ebf\u7a0b\u4f1a\u56e0\u4e3a\u7ade\u4e89\u4e0d\u5230\u9501\u800c\u88ab\u6302\u8d77\uff0c\u7b49\u9501\u88ab\u91ca\u653e\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u53c8\u4f1a\u88ab\u6062\u590d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5b58\u5728\u7740\u5f88\u5927\u7684\u5f00\u9500\uff0c\u5e76\u4e14\u901a\u5e38\u4f1a\u6709\u8f83\u957f\u65f6\u95f4\u7684\u4e2d\u65ad\uff0c\u56e0\u4e3a\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u9501\u65f6\uff0c\u5b83\u4e0d\u80fd\u505a\u4efb\u4f55\u5176\u4ed6\u4e8b\u60c5\u3002\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u5728\u6301\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u88ab\u5ef6\u8fdf\u6267\u884c\uff0c\u4f8b\u5982\u53d1\u751f\u4e86\u7f3a\u9875\u9519\u8bef\u3001\u8c03\u5ea6\u5ef6\u8fdf\u6216\u8005\u5176\u5b83\u7c7b\u4f3c\u60c5\u51b5\uff0c\u90a3\u4e48\u6240\u6709\u9700\u8981\u8fd9\u4e2a\u9501\u7684\u7ebf\u7a0b\u90fd\u65e0\u6cd5\u6267\u884c\u4e0b\u53bb\u3002\u5982\u679c\u88ab\u963b\u585e\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u8f83\u9ad8\uff0c\u800c\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u4f18\u5148\u7ea7\u8f83\u4f4e\uff0c\u5c31\u4f1a\u53d1\u751f\u4f18\u5148\u7ea7\u53cd\u8f6c\u3002 Disruptor\u8bba\u6587\u4e2d\u8bb2\u8ff0\u4e86\u4e00\u4e2a\u5b9e\u9a8c\uff1a \u8fd9\u4e2a\u6d4b\u8bd5\u7a0b\u5e8f\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f1a\u5bf9\u4e00\u4e2a64\u4f4d\u7684\u8ba1\u6570\u5668\u5faa\u73af\u81ea\u589e5\u4ebf\u6b21\u3002 \u673a\u5668\u73af\u5883\uff1a2.4G 6\u6838 \u8fd0\u7b97\uff1a 64\u4f4d\u7684\u8ba1\u6570\u5668\u7d2f\u52a05\u4ebf\u6b21 Method Time (ms) \u2014 \u2014 Single thread 300 Single thread with CAS 5,700 Single thread with lock 10,000 Single thread with volatile write 4,700 Two threads with CAS 30,000 Two threads with lock 224,000 CAS\u64cd\u4f5c\u6bd4\u5355\u7ebf\u7a0b\u65e0\u9501\u6162\u4e861\u4e2a\u6570\u91cf\u7ea7\uff1b\u6709\u9501\u4e14\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0c\u901f\u5ea6\u6bd4\u5355\u7ebf\u7a0b\u65e0\u9501\u61623\u4e2a\u6570\u91cf\u7ea7\u3002\u53ef\u89c1\u65e0\u9501\u901f\u5ea6\u6700\u5feb\u3002 \u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u4e0d\u52a0\u9501\u7684\u6027\u80fd > CAS\u64cd\u4f5c\u7684\u6027\u80fd > \u52a0\u9501\u7684\u6027\u80fd\u3002 \u5728\u591a\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u5fc5\u987b\u4f7f\u7528CAS\u6216\u9501\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cCAS\u7684\u6027\u80fd\u8d85\u8fc7\u9501\u7684\u6027\u80fd\uff0c\u524d\u8005\u5927\u7ea6\u662f\u540e\u8005\u76848\u500d\u3002 \u7efc\u4e0a\u53ef\u77e5\uff0c\u52a0\u9501\u7684\u6027\u80fd\u662f\u6700\u5dee\u7684\u3002 \u5173\u4e8e\u9501\u548cCAS \u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u4e00\u822c\u5206\u6210\u4e24\u79cd\u65b9\u5f0f\uff1a\u9501\u548c\u539f\u5b50\u53d8\u91cf\u3002 \u9501 \u56fe1 \u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168 \u91c7\u53d6\u52a0\u9501\u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u7ebf\u7a0b\u4f1a\u51b2\u7a81\uff0c\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u5148\u52a0\u4e0a\u9501\u518d\u8bbf\u95ee\uff0c\u8bbf\u95ee\u4e4b\u540e\u518d\u89e3\u9501\u3002\u901a\u8fc7\u9501\u754c\u5b9a\u4e00\u4e2a\u4e34\u754c\u533a\uff0c\u540c\u65f6\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0cThread2\u8bbf\u95eeEntry\u7684\u65f6\u5019\uff0c\u52a0\u4e86\u9501\uff0cThread1\u5c31\u4e0d\u80fd\u518d\u6267\u884c\u8bbf\u95eeEntry\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002 \u4e0b\u9762\u662fArrayBlockingQueue\u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684offer\u65b9\u6cd5\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002 public boolean offer(E e) { checkNotNull(e); final ReentrantLock lock = this.lock; lock.lock(); try { if (count == items.length) return false; else { insert(e); return true; } } finally { lock.unlock(); } } \u539f\u5b50\u53d8\u91cf \u539f\u5b50\u53d8\u91cf\u80fd\u591f\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\u64cd\u4f5c\uff0c\u610f\u601d\u662f\u67d0\u4e2a\u4efb\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u56de\u6eda\uff0c\u6062\u590d\u5230\u6267\u884c\u4e4b\u524d\u7684\u521d\u6001\uff0c\u4e0d\u5b58\u5728\u521d\u6001\u548c\u6210\u529f\u4e4b\u95f4\u7684\u4e2d\u95f4\u72b6\u6001\u3002\u4f8b\u5982CAS\u64cd\u4f5c\uff0c\u8981\u4e48\u6bd4\u8f83\u5e76\u4ea4\u6362\u6210\u529f\uff0c\u8981\u4e48\u6bd4\u8f83\u5e76\u4ea4\u6362\u5931\u8d25\u3002\u7531CPU\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 \u901a\u8fc7\u539f\u5b50\u53d8\u91cf\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u3002\u6267\u884c\u67d0\u4e2a\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u5148\u5047\u5b9a\u4e0d\u4f1a\u6709\u51b2\u7a81\uff0c\u82e5\u4e0d\u53d1\u751f\u51b2\u7a81\uff0c\u5219\u76f4\u63a5\u6267\u884c\u6210\u529f\uff1b\u5f53\u53d1\u751f\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u5219\u6267\u884c\u5931\u8d25\uff0c\u56de\u6eda\u518d\u91cd\u65b0\u64cd\u4f5c\uff0c\u76f4\u5230\u4e0d\u53d1\u751f\u51b2\u7a81\u3002 \u56fe2 \u901a\u8fc7\u539f\u5b50\u53d8\u91cfCAS\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168 \u5982\u56fe\u6240\u793a\uff0cThread1\u548cThread2\u90fd\u8981\u628aEntry\u52a01\u3002\u82e5\u4e0d\u52a0\u9501\uff0c\u4e5f\u4e0d\u4f7f\u7528CAS\uff0c\u6709\u53ef\u80fdThread1\u53d6\u5230\u4e86myValue=1\uff0cThread2\u4e5f\u53d6\u5230\u4e86myValue=1\uff0c\u7136\u540e\u76f8\u52a0\uff0cEntry\u4e2d\u7684value\u503c\u4e3a2\u3002\u8fd9\u4e0e\u9884\u671f\u4e0d\u76f8\u7b26\uff0c\u6211\u4eec\u9884\u671f\u7684\u662fEntry\u7684\u503c\u7ecf\u8fc7\u4e24\u6b21\u76f8\u52a0\u540e\u7b49\u4e8e3\u3002 CAS\u4f1a\u5148\u628aEntry\u73b0\u5728\u7684value\u8ddf\u7ebf\u7a0b\u5f53\u521d\u8bfb\u51fa\u7684\u503c\u76f8\u6bd4\u8f83\uff0c\u82e5\u76f8\u540c\uff0c\u5219\u8d4b\u503c\uff1b\u82e5\u4e0d\u76f8\u540c\uff0c\u5219\u8d4b\u503c\u6267\u884c\u5931\u8d25\u3002\u4e00\u822c\u4f1a\u901a\u8fc7while/for\u5faa\u73af\u6765\u91cd\u65b0\u6267\u884c\uff0c\u76f4\u5230\u8d4b\u503c\u6210\u529f\u3002 \u4ee3\u7801\u793a\u4f8b\u662fAtomicInteger\u7684getAndAdd\u65b9\u6cd5\u3002CAS\u662fCPU\u7684\u4e00\u4e2a\u6307\u4ee4\uff0c\u7531CPU\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 /** * Atomically adds the given value to the current value. * * @param delta the value to add * @return the previous value */ public final int getAndAdd(int delta) { for (;;) { int current = get(); int next = current + delta; if (compareAndSet(current, next)) return current; } } /** * Atomically sets the value to the given updated value * if the current value {@code ==} the expected value. * * @param expect the expected value * @param update the new value * @return true if successful. False return indicates that * the actual value was not equal to the expected value. */ public final boolean compareAndSet(int expect, int update) { return unsafe.compareAndSwapInt(this, valueOffset, expect, update); } \u5728\u9ad8\u5ea6\u7ade\u4e89\u7684\u60c5\u51b5\u4e0b\uff0c\u9501\u7684\u6027\u80fd\u5c06\u8d85\u8fc7\u539f\u5b50\u53d8\u91cf\u7684\u6027\u80fd\uff0c\u4f46\u662f\u66f4\u771f\u5b9e\u7684\u7ade\u4e89\u60c5\u51b5\u4e0b\uff0c\u539f\u5b50\u53d8\u91cf\u7684\u6027\u80fd\u5c06\u8d85\u8fc7\u9501\u7684\u6027\u80fd\u3002\u540c\u65f6\u539f\u5b50\u53d8\u91cf\u4e0d\u4f1a\u6709\u6b7b\u9501\u7b49\u6d3b\u8dc3\u6027\u95ee\u9898\u3002","title":"\u52a0\u9501"},{"location":"language/java/disruptor/#_3","text":"\u4ec0\u4e48\u662f\u5171\u4eab \u4e0b\u56fe\u662f\u8ba1\u7b97\u7684\u57fa\u672c\u7ed3\u6784\u3002L1\u3001L2\u3001L3\u5206\u522b\u8868\u793a\u4e00\u7ea7\u7f13\u5b58\u3001\u4e8c\u7ea7\u7f13\u5b58\u3001\u4e09\u7ea7\u7f13\u5b58\uff0c\u8d8a\u9760\u8fd1CPU\u7684\u7f13\u5b58\uff0c\u901f\u5ea6\u8d8a\u5feb\uff0c\u5bb9\u91cf\u4e5f\u8d8a\u5c0f\u3002\u6240\u4ee5L1\u7f13\u5b58\u5f88\u5c0f\u4f46\u5f88\u5feb\uff0c\u5e76\u4e14\u7d27\u9760\u7740\u5728\u4f7f\u7528\u5b83\u7684CPU\u5185\u6838\uff1bL2\u5927\u4e00\u4e9b\uff0c\u4e5f\u6162\u4e00\u4e9b\uff0c\u5e76\u4e14\u4ecd\u7136\u53ea\u80fd\u88ab\u4e00\u4e2a\u5355\u72ec\u7684CPU\u6838\u4f7f\u7528\uff1bL3\u66f4\u5927\u3001\u66f4\u6162\uff0c\u5e76\u4e14\u88ab\u5355\u4e2a\u63d2\u69fd\u4e0a\u7684\u6240\u6709CPU\u6838\u5171\u4eab\uff1b\u6700\u540e\u662f\u4e3b\u5b58\uff0c\u7531\u5168\u90e8\u63d2\u69fd\u4e0a\u7684\u6240\u6709CPU\u6838\u5171\u4eab\u3002 \u56fe3 \u8ba1\u7b97\u673aCPU\u4e0e\u7f13\u5b58\u793a\u610f\u56fe \u5f53CPU\u6267\u884c\u8fd0\u7b97\u7684\u65f6\u5019\uff0c\u5b83\u5148\u53bbL1\u67e5\u627e\u6240\u9700\u7684\u6570\u636e\u3001\u518d\u53bbL2\u3001\u7136\u540e\u662fL3\uff0c\u5982\u679c\u6700\u540e\u8fd9\u4e9b\u7f13\u5b58\u4e2d\u90fd\u6ca1\u6709\uff0c\u6240\u9700\u7684\u6570\u636e\u5c31\u8981\u53bb\u4e3b\u5185\u5b58\u62ff\u3002\u8d70\u5f97\u8d8a\u8fdc\uff0c\u8fd0\u7b97\u8017\u8d39\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\u3002\u6240\u4ee5\u5982\u679c\u4f60\u5728\u505a\u4e00\u4e9b\u5f88\u9891\u7e41\u7684\u4e8b\uff0c\u4f60\u8981\u5c3d\u91cf\u786e\u4fdd\u6570\u636e\u5728L1\u7f13\u5b58\u4e2d\u3002 \u53e6\u5916\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u4e00\u4efd\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u4e00\u4e2a\u7ebf\u7a0b\u628a\u6570\u636e\u5199\u56de\u4e3b\u5b58\uff0c\u800c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u4e3b\u5b58\u4e2d\u76f8\u5e94\u7684\u6570\u636e\u3002 \u4e0b\u9762\u662f\u4eceCPU\u8bbf\u95ee\u4e0d\u540c\u5c42\u7ea7\u6570\u636e\u7684\u65f6\u95f4\u6982\u5ff5: \u4eceCPU\u5230 \u5927\u7ea6\u9700\u8981\u7684CPU\u5468\u671f \u5927\u7ea6\u9700\u8981\u7684\u65f6\u95f4 \u4e3b\u5b58 - \u7ea660-80ns QPI \u603b\u7ebf\u4f20\u8f93(between sockets, not drawn) - \u7ea620ns L3 cache \u7ea640-45 cycles \u7ea615ns L2 cache \u7ea610 cycles \u7ea63ns L1 cache \u7ea63-4 cycles \u7ea61ns \u5bc4\u5b58\u5668 1 cycle - \u53ef\u89c1CPU\u8bfb\u53d6\u4e3b\u5b58\u4e2d\u7684\u6570\u636e\u4f1a\u6bd4\u4eceL1\u4e2d\u8bfb\u53d6\u6162\u4e86\u8fd12\u4e2a\u6570\u91cf\u7ea7\u3002 \u7f13\u5b58\u884c Cache\u662f\u7531\u5f88\u591a\u4e2acache line\u7ec4\u6210\u7684\u3002\u6bcf\u4e2acache line\u901a\u5e38\u662f64\u5b57\u8282\uff0c\u5e76\u4e14\u5b83\u6709\u6548\u5730\u5f15\u7528\u4e3b\u5185\u5b58\u4e2d\u7684\u4e00\u5757\u513f\u5730\u5740\u3002\u4e00\u4e2aJava\u7684long\u7c7b\u578b\u53d8\u91cf\u662f8\u5b57\u8282\uff0c\u56e0\u6b64\u5728\u4e00\u4e2a\u7f13\u5b58\u884c\u4e2d\u53ef\u4ee5\u5b588\u4e2along\u7c7b\u578b\u7684\u53d8\u91cf\u3002 CPU\u6bcf\u6b21\u4ece\u4e3b\u5b58\u4e2d\u62c9\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u628a\u76f8\u90bb\u7684\u6570\u636e\u4e5f\u5b58\u5165\u540c\u4e00\u4e2acache line\u3002 \u5728\u8bbf\u95ee\u4e00\u4e2along\u6570\u7ec4\u7684\u65f6\u5019\uff0c\u5982\u679c\u6570\u7ec4\u4e2d\u7684\u4e00\u4e2a\u503c\u88ab\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff0c\u5b83\u4f1a\u81ea\u52a8\u52a0\u8f7d\u53e6\u59167\u4e2a\u3002\u56e0\u6b64\u4f60\u80fd\u975e\u5e38\u5feb\u7684\u904d\u5386\u8fd9\u4e2a\u6570\u7ec4\u3002\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u53ef\u4ee5\u975e\u5e38\u5feb\u901f\u7684\u904d\u5386\u5728\u8fde\u7eed\u5185\u5b58\u5757\u4e2d\u5206\u914d\u7684\u4efb\u610f\u6570\u636e\u7ed3\u6784\u3002 \u4e0b\u9762\u7684\u4f8b\u5b50\u662f\u6d4b\u8bd5\u5229\u7528cache line\u7684\u7279\u6027\u548c\u4e0d\u5229\u7528cache line\u7684\u7279\u6027\u7684\u6548\u679c\u5bf9\u6bd4\u3002 package com.meituan.FalseSharing; /** * @author gongming * @description * @date 16/6/4 */ public class CacheLineEffect { //\u8003\u8651\u4e00\u822c\u7f13\u5b58\u884c\u5927\u5c0f\u662f64\u5b57\u8282\uff0c\u4e00\u4e2a long \u7c7b\u578b\u53608\u5b57\u8282 static long[][] arr; public static void main(String[] args) { arr = new long[1024 * 1024][]; for (int i = 0; i < 1024 * 1024; i++) { arr[i] = new long[8]; for (int j = 0; j < 8; j++) { arr[i][j] = 0L; } } long sum = 0L; long marked = System.currentTimeMillis(); for (int i = 0; i < 1024 * 1024; i+=1) { for(int j =0; j< 8;j++){ sum = arr[i][j]; } } System.out.println(\"Loop times:\" + (System.currentTimeMillis() - marked) + \"ms\"); marked = System.currentTimeMillis(); for (int i = 0; i < 8; i+=1) { for(int j =0; j< 1024 * 1024;j++){ sum = arr[j][i]; } } System.out.println(\"Loop times:\" + (System.currentTimeMillis() - marked) + \"ms\"); } } \u57282G Hz\u30012\u6838\u30018G\u5185\u5b58\u7684\u8fd0\u884c\u73af\u5883\u4e2d\u6d4b\u8bd5\uff0c\u901f\u5ea6\u5dee\u4e00\u500d\u3002 \u7ed3\u679c\uff1a Loop times:30ms Loop times:65ms \u4ec0\u4e48\u662f\u4f2a\u5171\u4eab ArrayBlockingQueue\u6709\u4e09\u4e2a\u6210\u5458\u53d8\u91cf\uff1a - takeIndex\uff1a\u9700\u8981\u88ab\u53d6\u8d70\u7684\u5143\u7d20\u4e0b\u6807 - putIndex\uff1a\u53ef\u88ab\u5143\u7d20\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u6807 - count\uff1a\u961f\u5217\u4e2d\u5143\u7d20\u7684\u6570\u91cf \u8fd9\u4e09\u4e2a\u53d8\u91cf\u5f88\u5bb9\u6613\u653e\u5230\u4e00\u4e2a\u7f13\u5b58\u884c\u4e2d\uff0c\u4f46\u662f\u4e4b\u95f4\u4fee\u6539\u6ca1\u6709\u592a\u591a\u7684\u5173\u8054\u3002\u6240\u4ee5\u6bcf\u6b21\u4fee\u6539\uff0c\u90fd\u4f1a\u4f7f\u4e4b\u524d\u7f13\u5b58\u7684\u6570\u636e\u5931\u6548\uff0c\u4ece\u800c\u4e0d\u80fd\u5b8c\u5168\u8fbe\u5230\u5171\u4eab\u7684\u6548\u679c\u3002 \u56fe4 ArrayBlockingQueue\u4f2a\u5171\u4eab\u793a\u610f\u56fe \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5f53\u751f\u4ea7\u8005\u7ebf\u7a0bput\u4e00\u4e2a\u5143\u7d20\u5230ArrayBlockingQueue\u65f6\uff0cputIndex\u4f1a\u4fee\u6539\uff0c\u4ece\u800c\u5bfc\u81f4\u6d88\u8d39\u8005\u7ebf\u7a0b\u7684\u7f13\u5b58\u4e2d\u7684\u7f13\u5b58\u884c\u65e0\u6548\uff0c\u9700\u8981\u4ece\u4e3b\u5b58\u4e2d\u91cd\u65b0\u8bfb\u53d6\u3002 \u8fd9\u79cd\u65e0\u6cd5\u5145\u5206\u4f7f\u7528\u7f13\u5b58\u884c\u7279\u6027\u7684\u73b0\u8c61\uff0c\u79f0\u4e3a\u4f2a\u5171\u4eab\u3002 \u5bf9\u4e8e\u4f2a\u5171\u4eab\uff0c\u4e00\u822c\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u589e\u5927\u6570\u7ec4\u5143\u7d20\u7684\u95f4\u9694\u4f7f\u5f97\u7531\u4e0d\u540c\u7ebf\u7a0b\u5b58\u53d6\u7684\u5143\u7d20\u4f4d\u4e8e\u4e0d\u540c\u7684\u7f13\u5b58\u884c\u4e0a\uff0c\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u3002 package com.meituan.FalseSharing; public class FalseSharing implements Runnable{ public final static long ITERATIONS = 500L * 1000L * 100L; private int arrayIndex = 0; private static ValuePadding[] longs; public FalseSharing(final int arrayIndex) { this.arrayIndex = arrayIndex; } public static void main(final String[] args) throws Exception { for(int i=1;i<10;i++){ System.gc(); final long start = System.currentTimeMillis(); runTest(i); System.out.println(\"Thread num \"+i+\" duration = \" + (System.currentTimeMillis() - start)); } } private static void runTest(int NUM_THREADS) throws InterruptedException { Thread[] threads = new Thread[NUM_THREADS]; longs = new ValuePadding[NUM_THREADS]; for (int i = 0; i < longs.length; i++) { longs[i] = new ValuePadding(); } for (int i = 0; i < threads.length; i++) { threads[i] = new Thread(new FalseSharing(i)); } for (Thread t : threads) { t.start(); } for (Thread t : threads) { t.join(); } } public void run() { long i = ITERATIONS + 1; while (0 != --i) { longs[arrayIndex].value = 0L; } } public final static class ValuePadding { protected long p1, p2, p3, p4, p5, p6, p7; protected volatile long value = 0L; protected long p9, p10, p11, p12, p13, p14; protected long p15; } public final static class ValueNoPadding { // protected long p1, p2, p3, p4, p5, p6, p7; protected volatile long value = 0L; // protected long p9, p10, p11, p12, p13, p14, p15; } } \u57282G Hz\uff0c2\u6838\uff0c8G\u5185\u5b58, jdk 1.7.0_45 \u7684\u8fd0\u884c\u73af\u5883\u4e0b\uff0c\u4f7f\u7528\u4e86\u5171\u4eab\u673a\u5236\u6bd4\u6ca1\u6709\u4f7f\u7528\u5171\u4eab\u673a\u5236\uff0c\u901f\u5ea6\u5feb\u4e864\u500d\u5de6\u53f3\u3002 \u7ed3\u679c\uff1a Thread num 1 duration = 447 Thread num 2 duration = 463 Thread num 3 duration = 454 Thread num 4 duration = 464 Thread num 5 duration = 561 Thread num 6 duration = 606 Thread num 7 duration = 684 Thread num 8 duration = 870 Thread num 9 duration = 823 \u628a\u4ee3\u7801\u4e2dValuePadding\u90fd\u66ff\u6362\u4e3aValueNoPadding\u540e\u7684\u7ed3\u679c\uff1a Thread num 1 duration = 446 Thread num 2 duration = 2549 Thread num 3 duration = 2898 Thread num 4 duration = 3931 Thread num 5 duration = 4716 Thread num 6 duration = 5424 Thread num 7 duration = 4868 Thread num 8 duration = 4595 Thread num 9 duration = 4540 \u5907\u6ce8\uff1a\u5728jdk1.8\u4e2d\uff0c\u6709\u4e13\u95e8\u7684\u6ce8\u89e3@Contended\u6765\u907f\u514d\u4f2a\u5171\u4eab\uff0c\u66f4\u4f18\u96c5\u5730\u89e3\u51b3\u95ee\u9898\u3002","title":"\u4f2a\u5171\u4eab"},{"location":"language/java/disruptor/#disruptor","text":"Disruptor\u901a\u8fc7\u4ee5\u4e0b\u8bbe\u8ba1\u6765\u89e3\u51b3\u961f\u5217\u901f\u5ea6\u6162\u7684\u95ee\u9898\uff1a \u73af\u5f62\u6570\u7ec4\u7ed3\u6784 \u4e3a\u4e86\u907f\u514d\u5783\u573e\u56de\u6536\uff0c\u91c7\u7528\u6570\u7ec4\u800c\u975e\u94fe\u8868\u3002\u540c\u65f6\uff0c\u6570\u7ec4\u5bf9\u5904\u7406\u5668\u7684\u7f13\u5b58\u673a\u5236\u66f4\u52a0\u53cb\u597d\u3002 \u5143\u7d20\u4f4d\u7f6e\u5b9a\u4f4d \u6570\u7ec4\u957f\u5ea62^n\uff0c\u901a\u8fc7\u4f4d\u8fd0\u7b97\uff0c\u52a0\u5feb\u5b9a\u4f4d\u7684\u901f\u5ea6\u3002\u4e0b\u6807\u91c7\u53d6\u9012\u589e\u7684\u5f62\u5f0f\u3002\u4e0d\u7528\u62c5\u5fc3index\u6ea2\u51fa\u7684\u95ee\u9898\u3002index\u662flong\u7c7b\u578b\uff0c\u5373\u4f7f100\u4e07QPS\u7684\u5904\u7406\u901f\u5ea6\uff0c\u4e5f\u9700\u898130\u4e07\u5e74\u624d\u80fd\u7528\u5b8c\u3002 \u65e0\u9501\u8bbe\u8ba1 \u6bcf\u4e2a\u751f\u4ea7\u8005\u6216\u8005\u6d88\u8d39\u8005\u7ebf\u7a0b\uff0c\u4f1a\u5148\u7533\u8bf7\u53ef\u4ee5\u64cd\u4f5c\u7684\u5143\u7d20\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u7533\u8bf7\u5230\u4e4b\u540e\uff0c\u76f4\u63a5\u5728\u8be5\u4f4d\u7f6e\u5199\u5165\u6216\u8005\u8bfb\u53d6\u6570\u636e\u3002 \u4e0b\u9762\u5ffd\u7565\u6570\u7ec4\u7684\u73af\u5f62\u7ed3\u6784\uff0c\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u5b9e\u73b0\u65e0\u9501\u8bbe\u8ba1\u3002\u6574\u4e2a\u8fc7\u7a0b\u901a\u8fc7\u539f\u5b50\u53d8\u91cfCAS\uff0c\u4fdd\u8bc1\u64cd\u4f5c\u7684\u7ebf\u7a0b\u5b89\u5168\u3002","title":"Disruptor\u7684\u8bbe\u8ba1\u65b9\u6848"},{"location":"language/java/disruptor/#_4","text":"\u5199\u6570\u636e \u751f\u4ea7\u8005\u5355\u7ebf\u7a0b\u5199\u6570\u636e\u7684\u6d41\u7a0b\u6bd4\u8f83\u7b80\u5355\uff1a \u7533\u8bf7\u5199\u5165m\u4e2a\u5143\u7d20\uff1b \u82e5\u662f\u6709m\u4e2a\u5143\u7d20\u53ef\u4ee5\u5165\uff0c\u5219\u8fd4\u56de\u6700\u5927\u7684\u5e8f\u5217\u53f7\u3002\u8fd9\u513f\u4e3b\u8981\u5224\u65ad\u662f\u5426\u4f1a\u8986\u76d6\u672a\u8bfb\u7684\u5143\u7d20\uff1b \u82e5\u662f\u8fd4\u56de\u7684\u6b63\u786e\uff0c\u5219\u751f\u4ea7\u8005\u5f00\u59cb\u5199\u5165\u5143\u7d20\u3002 \u56fe5 \u5355\u4e2a\u751f\u4ea7\u8005\u751f\u4ea7\u8fc7\u7a0b\u793a\u610f\u56fe","title":"\u4e00\u4e2a\u751f\u4ea7\u8005"},{"location":"language/java/disruptor/#_5","text":"\u591a\u4e2a\u751f\u4ea7\u8005\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9047\u5230\u201c\u5982\u4f55\u9632\u6b62\u591a\u4e2a\u7ebf\u7a0b\u91cd\u590d\u5199\u540c\u4e00\u4e2a\u5143\u7d20\u201d\u7684\u95ee\u9898\u3002Disruptor\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e0d\u540c\u7684\u4e00\u6bb5\u6570\u7ec4\u7a7a\u95f4\u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u4e2a\u901a\u8fc7CAS\u5f88\u5bb9\u6613\u8fbe\u5230\u3002\u53ea\u9700\u8981\u5728\u5206\u914d\u5143\u7d20\u7684\u65f6\u5019\uff0c\u901a\u8fc7CAS\u5224\u65ad\u4e00\u4e0b\u8fd9\u6bb5\u7a7a\u95f4\u662f\u5426\u5df2\u7ecf\u5206\u914d\u51fa\u53bb\u5373\u53ef\u3002 \u4f46\u662f\u4f1a\u9047\u5230\u4e00\u4e2a\u65b0\u95ee\u9898\uff1a\u5982\u4f55\u9632\u6b62\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u8bfb\u5230\u8fd8\u672a\u5199\u7684\u5143\u7d20\u3002Disruptor\u5728\u591a\u4e2a\u751f\u4ea7\u8005\u7684\u60c5\u51b5\u4e0b\uff0c\u5f15\u5165\u4e86\u4e00\u4e2a\u4e0eRing Buffer\u5927\u5c0f\u76f8\u540c\u7684buffer\uff1aavailable Buffer\u3002\u5f53\u67d0\u4e2a\u4f4d\u7f6e\u5199\u5165\u6210\u529f\u7684\u65f6\u5019\uff0c\u4fbf\u628aavailble Buffer\u76f8\u5e94\u7684\u4f4d\u7f6e\u7f6e\u4f4d\uff0c\u6807\u8bb0\u4e3a\u5199\u5165\u6210\u529f\u3002\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u4f1a\u904d\u5386available Buffer\uff0c\u6765\u5224\u65ad\u5143\u7d20\u662f\u5426\u5df2\u7ecf\u5c31\u7eea\u3002 \u4e0b\u9762\u5206\u8bfb\u6570\u636e\u548c\u5199\u6570\u636e\u4e24\u79cd\u60c5\u51b5\u4ecb\u7ecd\u3002","title":"\u591a\u4e2a\u751f\u4ea7\u8005"},{"location":"language/java/disruptor/#_6","text":"\u751f\u4ea7\u8005\u591a\u7ebf\u7a0b\u5199\u5165\u7684\u60c5\u51b5\u4f1a\u590d\u6742\u5f88\u591a\uff1a \u7533\u8bf7\u8bfb\u53d6\u5230\u5e8f\u53f7n\uff1b \u82e5writer cursor >= n\uff0c\u8fd9\u65f6\u4ecd\u7136\u65e0\u6cd5\u786e\u5b9a\u8fde\u7eed\u53ef\u8bfb\u7684\u6700\u5927\u4e0b\u6807\u3002\u4ecereader cursor\u5f00\u59cb\u8bfb\u53d6available Buffer\uff0c\u4e00\u76f4\u67e5\u5230\u7b2c\u4e00\u4e2a\u4e0d\u53ef\u7528\u7684\u5143\u7d20\uff0c\u7136\u540e\u8fd4\u56de\u6700\u5927\u8fde\u7eed\u53ef\u8bfb\u5143\u7d20\u7684\u4f4d\u7f6e\uff1b \u6d88\u8d39\u8005\u8bfb\u53d6\u5143\u7d20\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8bfb\u7ebf\u7a0b\u8bfb\u5230\u4e0b\u6807\u4e3a2\u7684\u5143\u7d20\uff0c\u4e09\u4e2a\u7ebf\u7a0bWriter1/Writer2/Writer3\u6b63\u5728\u5411RingBuffer\u76f8\u5e94\u4f4d\u7f6e\u5199\u6570\u636e\uff0c\u5199\u7ebf\u7a0b\u88ab\u5206\u914d\u5230\u7684\u6700\u5927\u5143\u7d20\u4e0b\u6807\u662f11\u3002 \u8bfb\u7ebf\u7a0b\u7533\u8bf7\u8bfb\u53d6\u5230\u4e0b\u6807\u4ece3\u523011\u7684\u5143\u7d20\uff0c\u5224\u65adwriter cursor>=11\u3002\u7136\u540e\u5f00\u59cb\u8bfb\u53d6availableBuffer\uff0c\u4ece3\u5f00\u59cb\uff0c\u5f80\u540e\u8bfb\u53d6\uff0c\u53d1\u73b0\u4e0b\u6807\u4e3a7\u7684\u5143\u7d20\u6ca1\u6709\u751f\u4ea7\u6210\u529f\uff0c\u4e8e\u662fWaitFor(11)\u8fd4\u56de6\u3002 \u7136\u540e\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u4e0b\u6807\u4ece3\u52306\u5171\u8ba14\u4e2a\u5143\u7d20\u3002 \u56fe6 \u591a\u4e2a\u751f\u4ea7\u8005\u60c5\u51b5\u4e0b\uff0c\u6d88\u8d39\u8005\u6d88\u8d39\u8fc7\u7a0b\u793a\u610f\u56fe","title":"\u8bfb\u6570\u636e"},{"location":"language/java/disruptor/#_7","text":"\u591a\u4e2a\u751f\u4ea7\u8005\u5199\u5165\u7684\u65f6\u5019\uff1a \u7533\u8bf7\u5199\u5165m\u4e2a\u5143\u7d20\uff1b \u82e5\u662f\u6709m\u4e2a\u5143\u7d20\u53ef\u4ee5\u5199\u5165\uff0c\u5219\u8fd4\u56de\u6700\u5927\u7684\u5e8f\u5217\u53f7\u3002\u6bcf\u4e2a\u751f\u4ea7\u8005\u4f1a\u88ab\u5206\u914d\u4e00\u6bb5\u72ec\u4eab\u7684\u7a7a\u95f4\uff1b \u751f\u4ea7\u8005\u5199\u5165\u5143\u7d20\uff0c\u5199\u5165\u5143\u7d20\u7684\u540c\u65f6\u8bbe\u7f6eavailable Buffer\u91cc\u9762\u76f8\u5e94\u7684\u4f4d\u7f6e\uff0c\u4ee5\u6807\u8bb0\u81ea\u5df1\u54ea\u4e9b\u4f4d\u7f6e\u662f\u5df2\u7ecf\u5199\u5165\u6210\u529f\u7684\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0cWriter1\u548cWriter2\u4e24\u4e2a\u7ebf\u7a0b\u5199\u5165\u6570\u7ec4\uff0c\u90fd\u7533\u8bf7\u53ef\u5199\u7684\u6570\u7ec4\u7a7a\u95f4\u3002Writer1\u88ab\u5206\u914d\u4e86\u4e0b\u68073\u5230\u4e0b\u88685\u7684\u7a7a\u95f4\uff0cWriter2\u88ab\u5206\u914d\u4e86\u4e0b\u68076\u5230\u4e0b\u68079\u7684\u7a7a\u95f4\u3002 Writer1\u5199\u5165\u4e0b\u68073\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u540c\u65f6\u628aavailable Buffer\u76f8\u5e94\u4f4d\u7f6e\u7f6e\u4f4d\uff0c\u6807\u8bb0\u5df2\u7ecf\u5199\u5165\u6210\u529f\uff0c\u5f80\u540e\u79fb\u4e00\u4f4d\uff0c\u5f00\u59cb\u5199\u4e0b\u68074\u4f4d\u7f6e\u7684\u5143\u7d20\u3002Writer2\u540c\u6837\u7684\u65b9\u5f0f\u3002\u6700\u7ec8\u90fd\u5199\u5165\u5b8c\u6210\u3002 \u56fe7 \u591a\u4e2a\u751f\u4ea7\u8005\u60c5\u51b5\u4e0b\uff0c\u751f\u4ea7\u8005\u751f\u4ea7\u8fc7\u7a0b\u793a\u610f\u56fe \u9632\u6b62\u4e0d\u540c\u751f\u4ea7\u8005\u5bf9\u540c\u4e00\u6bb5\u7a7a\u95f4\u5199\u5165\u7684\u4ee3\u7801\uff0c\u5982\u4e0b\u6240\u793a\uff1a public long tryNext(int n) throws InsufficientCapacityException { if (n < 1) { throw new IllegalArgumentException(\"n must be > 0\"); } long current; long next; do { current = cursor.get(); next = current + n; if (!hasAvailableCapacity(gatingSequences, n, current)) { throw InsufficientCapacityException.INSTANCE; } } while (!cursor.compareAndSet(current, next)); return next; } \u901a\u8fc7do/while\u5faa\u73af\u7684\u6761\u4ef6cursor.compareAndSet(current, next)\uff0c\u6765\u5224\u65ad\u6bcf\u6b21\u7533\u8bf7\u7684\u7a7a\u95f4\u662f\u5426\u5df2\u7ecf\u88ab\u5176\u4ed6\u751f\u4ea7\u8005\u5360\u636e\u3002\u5047\u5982\u5df2\u7ecf\u88ab\u5360\u636e\uff0c\u8be5\u51fd\u6570\u4f1a\u8fd4\u56de\u5931\u8d25\uff0cWhile\u5faa\u73af\u91cd\u65b0\u6267\u884c\uff0c\u7533\u8bf7\u5199\u5165\u7a7a\u95f4\u3002 \u6d88\u8d39\u8005\u7684\u6d41\u7a0b\u4e0e\u751f\u4ea7\u8005\u975e\u5e38\u7c7b\u4f3c\uff0c\u8fd9\u513f\u5c31\u4e0d\u591a\u63cf\u8ff0\u4e86\u3002","title":"\u5199\u6570\u636e"},{"location":"language/java/disruptor/#_8","text":"Disruptor\u901a\u8fc7\u7cbe\u5de7\u7684\u65e0\u9501\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u5728\u9ad8\u5e76\u53d1\u60c5\u5f62\u4e0b\u7684\u9ad8\u6027\u80fd\u3002 \u5728\u7f8e\u56e2\u5185\u90e8\uff0c\u5f88\u591a\u9ad8\u5e76\u53d1\u573a\u666f\u501f\u9274\u4e86Disruptor\u7684\u8bbe\u8ba1\uff0c\u51cf\u5c11\u7ade\u4e89\u7684\u5f3a\u5ea6\u3002\u5176\u8bbe\u8ba1\u601d\u60f3\u53ef\u4ee5\u6269\u5c55\u5230\u5206\u5e03\u5f0f\u573a\u666f\uff0c\u901a\u8fc7\u65e0\u9501\u8bbe\u8ba1\uff0c\u6765\u63d0\u5347\u670d\u52a1\u6027\u80fd\u3002 \u4f7f\u7528Disruptor\u6bd4\u4f7f\u7528ArrayBlockingQueue\u7565\u5fae\u590d\u6742\uff0c\u4e3a\u65b9\u4fbf\u8bfb\u8005\u4e0a\u624b\uff0c\u589e\u52a0\u4ee3\u7801\u6837\u4f8b\u3002 \u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd\uff1a\u6bcf10ms\u5411disruptor\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6253\u5370\u5230\u7ec8\u7aef\u3002\u8be6\u7ec6\u903b\u8f91\u8bf7\u7ec6\u8bfb\u4ee3\u7801\u3002 \u4ee5\u4e0b\u4ee3\u7801\u57fa\u4e8e3.3.4\u7248\u672c\u7684Disruptor\u5305\u3002 package com.meituan.Disruptor; /** * @description disruptor\u4ee3\u7801\u6837\u4f8b\u3002\u6bcf10ms\u5411disruptor\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6253\u5370\u5230\u7ec8\u7aef */ import com.lmax.disruptor.*; import com.lmax.disruptor.dsl.Disruptor; import com.lmax.disruptor.dsl.ProducerType; import java.util.concurrent.ThreadFactory; public class DisruptorMain { public static void main(String[] args) throws Exception { // \u961f\u5217\u4e2d\u7684\u5143\u7d20 class Element { private int value; public int get(){ return value; } public void set(int value){ this.value= value; } } // \u751f\u4ea7\u8005\u7684\u7ebf\u7a0b\u5de5\u5382 ThreadFactory threadFactory = new ThreadFactory(){ @Override public Thread newThread(Runnable r) { return new Thread(r, \"simpleThread\"); } }; // RingBuffer\u751f\u4ea7\u5de5\u5382,\u521d\u59cb\u5316RingBuffer\u7684\u65f6\u5019\u4f7f\u7528 EventFactory<Element> factory = new EventFactory<Element>() { @Override public Element newInstance() { return new Element(); } }; // \u5904\u7406Event\u7684handler EventHandler<Element> handler = new EventHandler<Element>(){ @Override public void onEvent(Element element, long sequence, boolean endOfBatch) { System.out.println(\"Element: \" + element.get()); } }; // \u963b\u585e\u7b56\u7565 BlockingWaitStrategy strategy = new BlockingWaitStrategy(); // \u6307\u5b9aRingBuffer\u7684\u5927\u5c0f int bufferSize = 16; // \u521b\u5efadisruptor\uff0c\u91c7\u7528\u5355\u751f\u4ea7\u8005\u6a21\u5f0f Disruptor<Element> disruptor = new Disruptor(factory, bufferSize, threadFactory, ProducerType.SINGLE, strategy); // \u8bbe\u7f6eEventHandler disruptor.handleEventsWith(handler); // \u542f\u52a8disruptor\u7684\u7ebf\u7a0b disruptor.start(); RingBuffer<Element> ringBuffer = disruptor.getRingBuffer(); for (int l = 0; true; l++) { // \u83b7\u53d6\u4e0b\u4e00\u4e2a\u53ef\u7528\u4f4d\u7f6e\u7684\u4e0b\u6807 long sequence = ringBuffer.next(); try { // \u8fd4\u56de\u53ef\u7528\u4f4d\u7f6e\u7684\u5143\u7d20 Element event = ringBuffer.get(sequence); // \u8bbe\u7f6e\u8be5\u4f4d\u7f6e\u5143\u7d20\u7684\u503c event.set(l); } finally { ringBuffer.publish(sequence); } Thread.sleep(10); } } }","title":"\u603b\u7ed3"},{"location":"language/java/disruptor/#_9","text":"\u4ee5\u4e0b\u9762\u8fd9\u4e9b\u6a21\u5f0f\u6d4b\u8bd5\u6027\u80fd: \u541e\u5410\u91cf\u6d4b\u8bd5\u6570\u636e\uff08\u6bcf\u79d2\u7684\u6570\u91cf\uff09\u5982\u4e0b\u3002 \u73af\u5883\uff1a - CPU:Intel Core i7 860 @ 2.8 GHz without HT - JVM:Java 1.6.0_25 64-bit - OS:Windows 7 - ABQ Disruptor Unicast: 1P \u2013 1C 5,339,256 25,998,336 Pipeline: 1P \u2013 3C 2,128,918 16,806,157 Sequencer: 3P \u2013 1C 5,539,531 13,403,268 Multicast: 1P \u2013 3C 1,077,384 9,377,871 Diamond: 1P \u2013 3C 2,113,941 16,143,613 \u73af\u5883\uff1a CPU:Intel Core i7-2720QM JVM:Java 1.6.0_25 64-bit OS:Ubuntu 11.04 - ABQ Disruptor Unicast: 1P \u2013 1C 4,057,453 22,381,378 Pipeline: 1P \u2013 3C 2,006,903 15,857,913 Sequencer: 3P \u2013 1C 2,056,118 14,540,519 Multicast: 1P \u2013 3C 260,733 10,860,121 Diamond: 1P \u2013 3C 2,082,725 15,295,197 \u4f9d\u636e\u5e76\u53d1\u7ade\u4e89\u7684\u6fc0\u70c8\u7a0b\u5ea6\u7684\u4e0d\u540c\uff0cDisruptor\u6bd4ArrayBlockingQueue\u541e\u5410\u91cf\u5feb4~7\u500d\u3002 \u6309\u7167Pipeline: 1P \u2013 3C\u7684\u8fde\u63a5\u6a21\u5f0f\u6d4b\u8bd5\u5ef6\u8fdf\uff0c\u751f\u4ea7\u8005\u4e24\u6b21\u5199\u5165\u4e4b\u95f4\u7684\u5ef6\u8fdf\u4e3a1ms\u3002 \u8fd0\u884c\u73af\u5883\uff1a CPU:2.2GHz Core i7-2720QM Java: 1.6.0_25 64-bit OS:Ubuntu 11.04. - Array Blocking Queue (ns) Disruptor (ns) 99% observations less than 2,097,152 128 99.99% observations less than 4,194,304 8,192 Max Latency 5,069,086 175,567 Mean Latency 32,757 52 Min Latency 145 29 \u53ef\u89c1\uff0c\u5e73\u5747\u5ef6\u8fdf\u5dee\u4e863\u4e2a\u6570\u91cf\u7ea7\u3002","title":"\u6027\u80fd"},{"location":"language/java/disruptor/#_10","text":"","title":"\u7b49\u5f85\u7b56\u7565"},{"location":"language/java/disruptor/#_11","text":"\u6682\u65f6\u53ea\u6709\u4f11\u77201ns\u3002 LockSupport.parkNanos(1);","title":"\u751f\u4ea7\u8005\u7684\u7b49\u5f85\u7b56\u7565"},{"location":"language/java/disruptor/#_12","text":"\u540d\u79f0 \u63aa\u65bd \u9002\u7528\u573a\u666f BlockingWaitStrategy \u52a0\u9501 CPU\u8d44\u6e90\u7d27\u7f3a\uff0c\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u5e76\u4e0d\u91cd\u8981\u7684\u573a\u666f BusySpinWaitStrategy \u81ea\u65cb \u901a\u8fc7\u4e0d\u65ad\u91cd\u8bd5\uff0c\u51cf\u5c11\u5207\u6362\u7ebf\u7a0b\u5bfc\u81f4\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u964d\u4f4e\u5ef6\u8fdf\u3002\u63a8\u8350\u5728\u7ebf\u7a0b\u7ed1\u5b9a\u5230\u56fa\u5b9a\u7684CPU\u7684\u573a\u666f\u4e0b\u4f7f\u7528 PhasedBackoffWaitStrategy \u81ea\u65cb + yield + \u81ea\u5b9a\u4e49\u7b56\u7565 CPU\u8d44\u6e90\u7d27\u7f3a\uff0c\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u5e76\u4e0d\u91cd\u8981\u7684\u573a\u666f SleepingWaitStrategy \u81ea\u65cb + yield + sleep \u6027\u80fd\u548cCPU\u8d44\u6e90\u4e4b\u95f4\u6709\u5f88\u597d\u7684\u6298\u4e2d\u3002\u5ef6\u8fdf\u4e0d\u5747\u5300 TimeoutBlockingWaitStrategy \u52a0\u9501\uff0c\u6709\u8d85\u65f6\u9650\u5236 CPU\u8d44\u6e90\u7d27\u7f3a\uff0c\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u5e76\u4e0d\u91cd\u8981\u7684\u573a\u666f YieldingWaitStrategy \u81ea\u65cb + yield + \u81ea\u65cb \u6027\u80fd\u548cCPU\u8d44\u6e90\u4e4b\u95f4\u6709\u5f88\u597d\u7684\u6298\u4e2d\u3002\u5ef6\u8fdf\u6bd4\u8f83\u5747\u5300","title":"\u6d88\u8d39\u8005\u7684\u7b49\u5f85\u7b56\u7565"},{"location":"language/java/disruptor/#log4j-2","text":"Log4j 2\u76f8\u5bf9\u4e8eLog4j 1\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u591a\u7ebf\u7a0b\u5e76\u53d1\u573a\u666f\u4e0b\u6027\u80fd\u66f4\u4f18\u3002\u8be5\u7279\u6027\u6e90\u81ea\u4e8eLog4j 2\u7684\u5f02\u6b65\u6a21\u5f0f\u91c7\u7528\u4e86Disruptor\u6765\u5904\u7406\u3002 \u5728Log4j 2\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u914d\u7f6eWaitStrategy\uff0c\u9ed8\u8ba4\u662fTimeout\u7b56\u7565\u3002\u4e0b\u9762\u662fLog4j 2\u4e2d\u5bf9WaitStrategy\u7684\u914d\u7f6e\u5b98\u65b9\u6587\u6863\uff1a System Property Default Value Description AsyncLogger.WaitStrategy Timeout Valid values: Block, Timeout, Sleep, Yield. Block is a strategy that uses a lock and condition variable for the I/O thread waiting for log events. Block can be used when throughput and low-latency are not as important as CPU resource. Recommended for resource constrained/virtualised environments. Timeout is a variation of the Block strategy that will periodically wake up from the lock condition await() call. This ensures that if a notification is missed somehow the consumer thread is not stuck but will recover with a small latency delay (default 10ms). Sleep is a strategy that initially spins, then uses a Thread.yield(), and eventually parks for the minimum number of nanos the OS and JVM will allow while the I/O thread is waiting for log events. Sleep is a good compromise between performance and CPU resource. This strategy has very low impact on the application thread, in exchange for some additional latency for actually getting the message logged. Yield is a strategy that uses a Thread.yield() for waiting for log events after an initially spinning. Yield is a good compromise between performance and CPU resource, but may use more CPU than Sleep in order to get the message logged to disk sooner.","title":"Log4j 2\u5e94\u7528\u573a\u666f"},{"location":"language/java/disruptor/#_13","text":"loggers all async\u91c7\u7528\u7684\u662fDisruptor\uff0c\u800cAsync Appender\u91c7\u7528\u7684\u662fArrayBlockingQueue\u961f\u5217\u3002 \u7531\u56fe\u53ef\u89c1\uff0c\u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0cloggers all async\u4e0eAsync Appender\u541e\u5410\u91cf\u76f8\u5dee\u4e0d\u5927\uff0c\u4f46\u662f\u572864\u4e2a\u7ebf\u7a0b\u7684\u65f6\u5019\uff0cloggers all async\u7684\u541e\u5410\u91cf\u6bd4Async Appender\u589e\u52a0\u4e8612\u500d\uff0c\u662fSync\u6a21\u5f0f\u768468\u500d\u3002 \u56fe8 Log4j 2\u5404\u4e2a\u6a21\u5f0f\u6027\u80fd\u6bd4\u8f83 \u7f8e\u56e2\u5728\u516c\u53f8\u5185\u90e8\u7edf\u4e00\u63a8\u884c\u65e5\u5fd7\u63a5\u5165\u89c4\u8303\uff0c\u8981\u6c42\u5fc5\u987b\u4f7f\u7528Log4j 2\uff0c\u4f7f\u666e\u901a\u5355\u673aQPS\u7684\u4e0a\u9650\u4e0d\u518d\u53ea\u505c\u7559\u5728\u51e0\u5343\uff0c\u6781\u9ad8\u5730\u63d0\u5347\u4e86\u670d\u52a1\u6027\u80fd\u3002","title":"\u6027\u80fd\u5dee\u5f02"},{"location":"language/node/","text":"\u56fd\u5185node\u5404\u79cd\u955c\u50cf\u6e90\u8bbe\u7f6e \u56fd\u5185node\u5404\u79cd\u955c\u50cf\u6e90\u8bbe\u7f6e \u56fd\u5185node\u5404\u79cd\u955c\u50cf\u6e90\u8bbe\u7f6e","title":"Index"},{"location":"language/node/repo/","text":"\u8bbe\u7f6e\u65b9\u5f0f\uff1a 1\u3001 shell npm set -g registry https://registry.npm.taobao.org npm set -g disturl https://npm.taobao.org/dist npm set -g puppeteer_download_host https://npm.taobao.org/mirrors npm set -g electron_mirror https://npm.taobao.org/mirrors/electron/ npm set -g sharp_binary_host https://npm.taobao.org/mirrors/sharp npm set -g sharp_libvips_binary_host https://npm.taobao.org/mirrors/sharp-libvips 2\u3001\u5728 $HOME/.npmrc \u4e2d\u8bbe\u7f6e registry=https://registry.npm.taobao.org disturl=https://npm.taobao.org/dist puppeteer_download_host=https://npm.taobao.org/mirrors electron_mirror=https://npm.taobao.org/mirrors/electron/ sharp_binary_host=https://npm.taobao.org/mirrors/sharp sharp_libvips_binary_host=https://npm.taobao.org/mirrors/sharp-libvips","title":"\u56fd\u5185node\u5404\u79cd\u955c\u50cf\u6e90\u8bbe\u7f6e"},{"location":"language/rust/","text":"Cross compiling Rust from Linux to macOS todo * Cross compiling Rust from Linux to macOS todo Cross compiling Rust from Linux to macOS todo","title":"Index"},{"location":"language/rust/MACOS/","text":"Cross compiling Rust from Linux to macOS February 17, 2019 I\u2019ve recently been working on a Rust project at work which requires compiling for Linux (GNU), Linux (musl - for Alpine Linux) and macOS. I use Linux Mint nearly all the time, so building for macOS targets has required asking very nicely to borrow a spare Macbook Air. This is naturally a bit crap, so I set out to find a Linux-only solution to cross compile for macOS using osxcross . A weekend of pain later, and I have the following post. Hopefully it spares you a weekend of your own pain. Environment This process should work in any modern-ish Debian-based environment. This is the setup I used: Linux Mint 19.1, Dell XPS1 15, Intel i9 x64 Rust 1.32.0 (with Rustup ) Clang 6.0.0 I\u2019ve also tested this process in CircleCI and it seems to be working fine. The only device I have to test on at time of writing is a Macbook Air with macOS Mojave on it. This process should work for other macOS versions, but is untested. Requirements There are a few system dependencies required to work with osxcross. I don\u2019t think the version requirements are too strict for the packages listed below. You may want to check the osxcross requirements as well if you\u2019re having problems. # Install build dependencies apt install \\ clang \\ gcc \\ g++ \\ zlib1g-dev \\ libmpc-dev \\ libmpfr-dev \\ libgmp-dev # Add macOS Rust target rustup target add x86_64-apple-darwin Building osxcross The following process is based on this tutorial on Reddit and some trial and error. I\u2019m using the macOS 10.10 SDK as I had the least problems getting up and running with it. Add the following to a script called osxcross_setup.sh and make it executable. git clone https://github.com/tpoechtrager/osxcross cd osxcross wget -nc https://s3.dockerproject.org/darwin/v2/MacOSX10.10.sdk.tar.xz mv MacOSX10.10.sdk.tar.xz tarballs/ UNATTENDED=yes OSX_VERSION_MIN=10.7 ./build.sh Not a lot to it, thanks to the hard work put in by the osxcross developers. Running ./osxcross_setup.sh should create a folder named osxcross with everything you need in it to cross compile to macOS with Clang. This doesn\u2019t modify $PATH or install any system files, so is useful for CI as well. Append ./build_gcc.sh to osxcross_setup.sh if you want to use GCC to cross compile. Configuring Cargo Cargo needs to be told to use the correct linker for the x86_64-apple-darwin target, so add the following to your project\u2019s .cargo/config file: [target.x86_64-apple-darwin] linker = \"x86_64-apple-darwin14-clang\" ar = \"x86_64-apple-darwin14-ar\" If you\u2019ve used a different macOS SDK version, you might need to replace darwin14 with darwin15 . To check what binary to use, look in osxcross/target/bin . Building the project Because I chose not to install osxcross at the system level, the $PATH variable must be modified for Cargo to pick up the linker binaries specified previously. The build command changes to: # Add --release to build in release mode PATH=\"$(pwd)/osxcross/target/bin:$PATH\" \\ cargo build --target x86_64-apple-darwin This adds [pwd]/osxcross/target/bin to $PATH , which means the linker binaries should get picked up. The path must be absolute to work properly, hence $(pwd) . Now you should have a binary in target/x86_64-apple-darwin/[debug|release] which works on macOS! Building *-sys crates You can stop here if none of your crates require any C bindings to function. Quite a few of them do, so read on if you run into compilation or linking errors. The project I\u2019m cross compiling uses the git2 crate which has libz-sys in its dependency tree. Unfortunately this means digging out a C compiler. The build uses the host system compiler by default, so the architectures for the final binary (target arch) and these linked libraries (host arch) don\u2019t match up. The solution to this is to set the CC and CXX environment variables in our build command: PATH=\"$(pwd)/osxcross/target/bin:$PATH\" \\ CC=o64-clang \\ CXX=o64-clang++ \\ cargo build --target x86_64-apple-darwin This uses o64-clang and o64-clang++ in osxcross/target/bin . Now git2 compiles, but fails to link! This is due to the fact that libz-sys attempts to link to the host system zlib library. Because I\u2019m building on a Linux machine, this is a Linux-native library which won\u2019t work on macOS. Luckily, libz-sys supports building its own statically linked version of zlib. According to libz-sys\u2019 build.rs , if LIBZ_SYS_STATIC=1 is set in the environment a bundled version of zlib will be built. Because we set CC and CXX , this statically linked code will be compiled for a macOS target. The full build command ends up looking like this: PATH=\"$(pwd)/osxcross/target/bin:$PATH\" \\ CC=o64-clang \\ CXX=o64-clang++ \\ LIBZ_SYS_STATIC=1 \\ cargo build --target x86_64-apple-darwin CI I got the above process working in CircleCI, but it should be pretty easy to get any Debian-based CI service to work. It should be possible to cache the osxcross folder so it doesn\u2019t have to be built for every job. The cache should be invalidated when your build script(s) change. For example, I use the cache checksum project-v1- to ensure the osxcross folder is regenerated correctly. Wrapping up The final build command is pretty long, so I\u2019d suggest putting it in a script. In my case, I have a build script containing the following snippet: # ... snip ... MACOS_TARGET=\"x86_64-apple-darwin\" echo \"Building target for platform ${MACOS_TARGET}\" echo # Add osxcross toolchain to path export PATH=\"$(pwd)/osxcross/target/bin:$PATH\" # Make libz-sys (git2-rs -> libgit2-sys -> libz-sys) build as a statically linked lib # This prevents the host zlib from being linked export LIBZ_SYS_STATIC=1 # Use Clang for C/C++ builds export CC=o64-clang export CXX=o64-clang++ cargo build --release --target \"${MACOS_TARGET}\" echo echo Done Now you can just run ./osxcross_setup.sh and ./build_macos.sh in your CI. Comment on The Twittuhs \u2197","title":"Cross compiling Rust from Linux to macOS"},{"location":"language/rust/MACOS/#cross-compiling-rust-from-linux-to-macos","text":"February 17, 2019 I\u2019ve recently been working on a Rust project at work which requires compiling for Linux (GNU), Linux (musl - for Alpine Linux) and macOS. I use Linux Mint nearly all the time, so building for macOS targets has required asking very nicely to borrow a spare Macbook Air. This is naturally a bit crap, so I set out to find a Linux-only solution to cross compile for macOS using osxcross . A weekend of pain later, and I have the following post. Hopefully it spares you a weekend of your own pain.","title":"Cross compiling Rust from Linux to macOS"},{"location":"language/rust/MACOS/#environment","text":"This process should work in any modern-ish Debian-based environment. This is the setup I used: Linux Mint 19.1, Dell XPS1 15, Intel i9 x64 Rust 1.32.0 (with Rustup ) Clang 6.0.0 I\u2019ve also tested this process in CircleCI and it seems to be working fine. The only device I have to test on at time of writing is a Macbook Air with macOS Mojave on it. This process should work for other macOS versions, but is untested.","title":"Environment"},{"location":"language/rust/MACOS/#requirements","text":"There are a few system dependencies required to work with osxcross. I don\u2019t think the version requirements are too strict for the packages listed below. You may want to check the osxcross requirements as well if you\u2019re having problems. # Install build dependencies apt install \\ clang \\ gcc \\ g++ \\ zlib1g-dev \\ libmpc-dev \\ libmpfr-dev \\ libgmp-dev # Add macOS Rust target rustup target add x86_64-apple-darwin","title":"Requirements"},{"location":"language/rust/MACOS/#building-osxcross","text":"The following process is based on this tutorial on Reddit and some trial and error. I\u2019m using the macOS 10.10 SDK as I had the least problems getting up and running with it. Add the following to a script called osxcross_setup.sh and make it executable. git clone https://github.com/tpoechtrager/osxcross cd osxcross wget -nc https://s3.dockerproject.org/darwin/v2/MacOSX10.10.sdk.tar.xz mv MacOSX10.10.sdk.tar.xz tarballs/ UNATTENDED=yes OSX_VERSION_MIN=10.7 ./build.sh Not a lot to it, thanks to the hard work put in by the osxcross developers. Running ./osxcross_setup.sh should create a folder named osxcross with everything you need in it to cross compile to macOS with Clang. This doesn\u2019t modify $PATH or install any system files, so is useful for CI as well. Append ./build_gcc.sh to osxcross_setup.sh if you want to use GCC to cross compile.","title":"Building osxcross"},{"location":"language/rust/MACOS/#configuring-cargo","text":"Cargo needs to be told to use the correct linker for the x86_64-apple-darwin target, so add the following to your project\u2019s .cargo/config file: [target.x86_64-apple-darwin] linker = \"x86_64-apple-darwin14-clang\" ar = \"x86_64-apple-darwin14-ar\" If you\u2019ve used a different macOS SDK version, you might need to replace darwin14 with darwin15 . To check what binary to use, look in osxcross/target/bin .","title":"Configuring Cargo"},{"location":"language/rust/MACOS/#building-the-project","text":"Because I chose not to install osxcross at the system level, the $PATH variable must be modified for Cargo to pick up the linker binaries specified previously. The build command changes to: # Add --release to build in release mode PATH=\"$(pwd)/osxcross/target/bin:$PATH\" \\ cargo build --target x86_64-apple-darwin This adds [pwd]/osxcross/target/bin to $PATH , which means the linker binaries should get picked up. The path must be absolute to work properly, hence $(pwd) . Now you should have a binary in target/x86_64-apple-darwin/[debug|release] which works on macOS!","title":"Building the project"},{"location":"language/rust/MACOS/#building-sys-crates","text":"You can stop here if none of your crates require any C bindings to function. Quite a few of them do, so read on if you run into compilation or linking errors. The project I\u2019m cross compiling uses the git2 crate which has libz-sys in its dependency tree. Unfortunately this means digging out a C compiler. The build uses the host system compiler by default, so the architectures for the final binary (target arch) and these linked libraries (host arch) don\u2019t match up. The solution to this is to set the CC and CXX environment variables in our build command: PATH=\"$(pwd)/osxcross/target/bin:$PATH\" \\ CC=o64-clang \\ CXX=o64-clang++ \\ cargo build --target x86_64-apple-darwin This uses o64-clang and o64-clang++ in osxcross/target/bin . Now git2 compiles, but fails to link! This is due to the fact that libz-sys attempts to link to the host system zlib library. Because I\u2019m building on a Linux machine, this is a Linux-native library which won\u2019t work on macOS. Luckily, libz-sys supports building its own statically linked version of zlib. According to libz-sys\u2019 build.rs , if LIBZ_SYS_STATIC=1 is set in the environment a bundled version of zlib will be built. Because we set CC and CXX , this statically linked code will be compiled for a macOS target. The full build command ends up looking like this: PATH=\"$(pwd)/osxcross/target/bin:$PATH\" \\ CC=o64-clang \\ CXX=o64-clang++ \\ LIBZ_SYS_STATIC=1 \\ cargo build --target x86_64-apple-darwin","title":"Building *-sys crates"},{"location":"language/rust/MACOS/#ci","text":"I got the above process working in CircleCI, but it should be pretty easy to get any Debian-based CI service to work. It should be possible to cache the osxcross folder so it doesn\u2019t have to be built for every job. The cache should be invalidated when your build script(s) change. For example, I use the cache checksum project-v1- to ensure the osxcross folder is regenerated correctly.","title":"CI"},{"location":"language/rust/MACOS/#wrapping-up","text":"The final build command is pretty long, so I\u2019d suggest putting it in a script. In my case, I have a build script containing the following snippet: # ... snip ... MACOS_TARGET=\"x86_64-apple-darwin\" echo \"Building target for platform ${MACOS_TARGET}\" echo # Add osxcross toolchain to path export PATH=\"$(pwd)/osxcross/target/bin:$PATH\" # Make libz-sys (git2-rs -> libgit2-sys -> libz-sys) build as a statically linked lib # This prevents the host zlib from being linked export LIBZ_SYS_STATIC=1 # Use Clang for C/C++ builds export CC=o64-clang export CXX=o64-clang++ cargo build --release --target \"${MACOS_TARGET}\" echo echo Done Now you can just run ./osxcross_setup.sh and ./build_macos.sh in your CI. Comment on The Twittuhs \u2197","title":"Wrapping up"},{"location":"language/rust/todo/","text":"Rust\u65e0\u9501\u7f16\u7a0b :: steven\u7684\u4e2a\u4eba\u535a\u5ba2 (stevenbai.top)","title":"Todo"},{"location":"management/","text":"pstree \u67e5\u770b\u8fdb\u7a0b\u6570 Web \u5e94\u7528APP\u6846\u67b6\u6027\u80fd\u5bf9\u6bd4 git github action \u81ea\u52a8\u53d1\u5e03 release Git\u57fa\u7840\u547d\u4ee4 Git Fetch rebase reset stash \u5de5\u4f5c\u533a\u4fdd\u5b58 pstree \u67e5\u770b\u8fdb\u7a0b\u6570 Web \u5e94\u7528APP\u6846\u67b6\u6027\u80fd\u5bf9\u6bd4 git github action \u81ea\u52a8\u53d1\u5e03 release Git\u57fa\u7840\u547d\u4ee4 Git Fetch rebase reset stash \u5de5\u4f5c\u533a\u4fdd\u5b58","title":"\u7ba1\u7406\u5de5\u5177"},{"location":"management/ptree/","text":"pstree -c -p -A $(pgrep dockerd) The command below will list all the contents of /proc, and store the Redis PID for future use. DBPID=$(pgrep redis-server) echo Redis is $DBPID ls /proc Each process has it's own configuration and security settings defined within different files. ls /proc/$DBPID For example, you can view and update the environment variables defined to that process. cat /proc/$DBPID/environ docker exec -it db env","title":"pstree \u67e5\u770b\u8fdb\u7a0b\u6570"},{"location":"management/web_framework/","text":"Web \u5e94\u7528APP\u6846\u67b6\u6027\u80fd\u5bf9\u6bd4 https://www.techempower.com/benchmarks/#section=data-r20&hw=ph&test=fortune","title":"Web \u5e94\u7528APP\u6846\u67b6\u6027\u80fd\u5bf9\u6bd4"},{"location":"management/web_framework/#web-app","text":"https://www.techempower.com/benchmarks/#section=data-r20&hw=ph&test=fortune","title":"Web \u5e94\u7528APP\u6846\u67b6\u6027\u80fd\u5bf9\u6bd4"},{"location":"management/git/","text":"github action \u81ea\u52a8\u53d1\u5e03 release Git\u57fa\u7840\u547d\u4ee4 Git Fetch rebase reset stash \u5de5\u4f5c\u533a\u4fdd\u5b58 github action \u81ea\u52a8\u53d1\u5e03 release Git\u57fa\u7840\u547d\u4ee4 Git Fetch rebase reset stash \u5de5\u4f5c\u533a\u4fdd\u5b58 github action \u81ea\u52a8\u53d1\u5e03 release Git\u57fa\u7840\u547d\u4ee4 Git Fetch rebase reset stash \u5de5\u4f5c\u533a\u4fdd\u5b58 github action \u81ea\u52a8\u53d1\u5e03 release Git\u57fa\u7840\u547d\u4ee4 Git Fetch rebase reset stash \u5de5\u4f5c\u533a\u4fdd\u5b58","title":"Index"},{"location":"management/git/auto_release/","text":"\u81ea\u52a8\u53d1\u5e03\u529f\u80fd http://goreleaser.com","title":"github action \u81ea\u52a8\u53d1\u5e03 release"},{"location":"management/git/auto_release/#_1","text":"http://goreleaser.com","title":"\u81ea\u52a8\u53d1\u5e03\u529f\u80fd"},{"location":"management/git/base/","text":"\u4e0b\u8f7d\u8fdc\u7a0b\u5206\u652fA\u5230\u672c\u5730A git checkout -b <BranchName> origin/<BranchName> \u514b\u9686\u4e00\u4e2a\u8fdc\u7a0b\u5206\u652f\u672c\u5730\uff0c\u4e14\u672c\u5730\u5206\u652f\u4e0d\u5b58\u5728\uff0c\u5982\u679c\u5206\u652f\u5b58\u5728\u62a5\u9519\uff0c\u5982\u679c\u60f3\u8981\u76f4\u63a5\u5f3a\u5236\u64cd\u4f5c\uff0c\u53ef\u4ee5\u62a5-b\u8be5\u4e3a-f 2\u3001\u540c\u6b65\u8fdc\u7a0b\u5206\u652f\u548cTag git fetch --prune --prune-tags","title":"Git\u57fa\u7840\u547d\u4ee4"},{"location":"management/git/fetch/","text":"Git\u4e2d\u4ece\u8fdc\u7a0b\u7684\u5206\u652f\u83b7\u53d6\u6700\u65b0\u7684\u7248\u672c\u5230\u672c\u5730\u6709\u8fd9\u68372\u4e2a\u547d\u4ee4\uff1a 1\u3001fetch git fetch \u76f8\u5f53\u4e8e\u662f\u4ece\u8fdc\u7a0b\u83b7\u53d6\u6700\u65b0\u7248\u672c\u5230\u672c\u5730\uff0c\u4e0d\u4f1a\u81ea\u52a8merge git fetch origin master # \u9996\u5148\u4ece\u8fdc\u7a0b\u7684origin\u7684master\u4e3b\u5206\u652f\u4e0b\u8f7d\u6700\u65b0\u7684\u7248\u672c\u5230origin/master\u5206\u652f\u4e0a git log -p master..origin/master # \u7136\u540e\u6bd4\u8f83\u672c\u5730\u7684master\u5206\u652f\u548corigin/master\u5206\u652f\u7684\u5dee\u522b git merge origin/master # \u6700\u540e\u8fdb\u884c\u5408\u5e76 \u4e0a\u8ff0\u8fc7\u7a0b\u5176\u5b9e\u53ef\u4ee5\u7528\u4ee5\u4e0b\u66f4\u6e05\u6670\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\uff1a git fetch origin master:tmp git diff tmp git merge tmp \u4ece\u8fdc\u7a0b\u83b7\u53d6\u6700\u65b0\u7684\u7248\u672c\u5230\u672c\u5730\u7684test\u5206\u652f\u4e0a \u4e4b\u540e\u518d\u8fdb\u884c\u6bd4\u8f83\u5408\u5e76 2\u3001pull \u76f8\u5f53\u4e8e\u662f\u4ece\u8fdc\u7a0b\u83b7\u53d6\u6700\u65b0\u7248\u672c\u5e76merge\u5230\u672c\u5730 git pull origin master \u4e0a\u8ff0\u547d\u4ee4\u5176\u5b9e\u76f8\u5f53\u4e8egit fetch \u548c git merge \u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0cgit fetch\u66f4\u5b89\u5168\u4e00\u4e9b \u56e0\u4e3a\u5728merge\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u66f4\u65b0\u60c5\u51b5\uff0c\u7136\u540e\u518d\u51b3\u5b9a\u662f\u5426\u5408\u5e76\u3002","title":"Git Fetch"},{"location":"management/git/rebase/","text":"\u3010Git\u3011rebase \u7528\u6cd5\u5c0f\u7ed3 - \u7b80\u4e66 (jianshu.com) \u4fee\u6b63\u65e5\u5fd7\u4f7f\u7528","title":"Rebase"},{"location":"management/git/reset/","text":"reset\u547d\u4ee4\u67093\u79cd\u65b9\u5f0f\uff1a 1\uff1agit reset \u2013mixed\uff1a\u6b64\u4e3a\u9ed8\u8ba4\u65b9\u5f0f\uff0c\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\u7684git reset\uff0c\u5373\u65f6\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5b83\u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\uff0c\u53ea\u4fdd\u7559\u6e90\u7801\uff0c\u56de\u9000commit\u548cindex\u4fe1\u606f 2\uff1agit reset \u2013soft\uff1a\u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\uff0c\u53ea\u56de\u9000\u4e86commit\u7684\u4fe1\u606f\uff0c\u4e0d\u4f1a\u6062\u590d\u5230index file\u4e00\u7ea7\u3002\u5982\u679c\u8fd8\u8981\u63d0\u4ea4\uff0c\u76f4\u63a5commit\u5373\u53ef 3\uff1agit reset \u2013hard\uff1a\u5f7b\u5e95\u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\uff0c\u672c\u5730\u7684\u6e90\u7801\u4e5f\u4f1a\u53d8\u4e3a\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u5185\u5bb9 git reset\u53ea\u662f\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u56de\u9000\u7248\u672c\uff0c\u800c\u8fdc\u7a0b\u4ed3\u5e93\u7684\u7248\u672c\u4e0d\u4f1a\u53d8\u5316\u3002 \u4ee5\u5220\u9664master\u5206\u652f\u4e3a\u4f8b #\u65b0\u5efa\u4e00\u4e2a\u5907\u4efd\u7684\u5206\u652f\uff0c\u6570\u636e\u65e0\u4ef7 git branch old_master #\u63d0\u4ea4\u672c\u5730\u5f53\u524d\u7684\u6587\u4ef6\u5230\u65b0\u5efa\u7684\u5206\u652f git push origin old_master:old_master #\u672c\u5730\u53ef\u4ee5\u5f7b\u5e95\u6062\u590d\u5230\u4f60\u60f3\u6062\u590d\u5230\u7684\u7248\u672c\u4e86 git reset --hard 58093e1355716f0f861b64f1c3dfe59242be28f7 #\u5728web\u7aefsettings\u9875\u9762\uff0c\u4fee\u6539\u9ed8\u8ba4\u5206\u652f\u4e3a\u65b0\u5efa\u7684\u5206\u652f\uff0c\u53ef\u4ee5\u5220\u9664\u8fdc\u7a0b\u5206\u652f\u4e86 git push origin :master #\u5982\u679c\u51fa\u73b0! [remote rejected] master (deletion of the current branch prohibited)\uff0c\u8bf4\u660e\u6ca1\u6709\u8bbe\u7f6e\u8fdc\u7a0b\u7684\u9ed8\u8ba4\u5206\u652f\uff0c\u6ca1\u6709\u6743\u9650\u5220\u9664\uff0c\u8bf7\u5728web\u7aefsettings\u9875\u9762\uff0c\u4fee\u6539\u9ed8\u8ba4\u5206\u652f\u4e3a\u65b0\u5efa\u7684\u5206\u652f #\u8fdb\u884c\u5230\u8fd9\u91cc\uff0c\u8fdc\u7a0b\u7684master\u5206\u652f\u5df2\u7ecf\u5220\u9664\u6210\u529f #\u91cd\u65b0\u63d0\u4ea4\u672c\u5730\u6587\u4ef6\u5230master\u5206\u652f\uff08\u6b64\u65f6\u4f1a\u81ea\u52a8\u65b0\u5efamaster\u5206\u652f\uff09 git push origin master #\u518d\u4f53\u9a8c\u4e00\u4e0b\u5220\u9664\u5206\u652f git push origin :old_master","title":"Reset"},{"location":"management/git/stash/","text":"\u4fdd\u5b58\u5de5\u4f5c\u533a\u5185\u5bb9 git stash save [message] \u8bf4\u660e\uff1a \u5c06\u5de5\u4f5c\u533a\u672a\u63d0\u4ea4\u7684\u4fee\u6539\u5c01\u5b58\uff0c\u8ba9\u5de5\u4f5c\u533a\u56de\u5230\u4fee\u6539\u524d\u7684\u72b6\u6001 \u67e5\u770b\u5de5\u4f5c\u533a\u5217\u8868 git stash list \u8bf4\u660e\uff1a\u6700\u65b0\u4fdd\u5b58\u7684\u5de5\u4f5c\u533a\u5728\u6700\u4e0a\u9762 \u5e94\u7528\u67d0\u4e2a\u5de5\u4f5c\u533a git stash apply [stash@{n}] \u5220\u9664\u5de5\u4f5c\u533a git stash drop [stash@{n}] # \u5220\u9664\u67d0\u4e00\u4e2a\u5de5\u4f5c\u533a git stash clear # \u5220\u9664\uff08\u6e05\u7a7a\uff09\u6240\u6709\u4fdd\u5b58\u7684\u5de5\u4f5c\u533a","title":"stash \u5de5\u4f5c\u533a\u4fdd\u5b58"},{"location":"tools/","text":"mac\u8f6f\u4ef6\u4fee\u590d Mkdocs shell_record jq JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6 mac\u8f6f\u4ef6\u4fee\u590d Mkdocs shell_record jq JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6","title":"\u5de5\u5177"},{"location":"tools/macsoft/","text":"\u201cMac\u5e94\u7528\u201d\u5df2\u635f\u574f\uff0c\u6253\u4e0d\u5f00\u89e3\u51b3\u529e\u6cd5 for Mac - Mac\u6bd2 (macdo.cn) 2. macOS Catalina 10.15\u7cfb\u7edf\uff1a \u6253\u5f00\u300c\u7ec8\u7aef.app\u300d\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u5e76\u56de\u8f66\uff0c\u8f93\u5165\u5f00\u673a\u5bc6\u7801\u56de\u8f66 sudo xattr -rd com.apple.quarantine \u7a7a\u683c \u8f6f\u4ef6\u7684\u8def\u5f84 \u5982Sketch.app sudo xattr -rd com.apple.quarantine /Applications/Sketch.app \u5982CleanMyMac X.app sudo xattr -rd com.apple.quarantine /Applications/CleanMyMac X.app 3. macOS Catalina 10.15.4 \u7cfb\u7edf\uff1a \u66f4\u65b010.15.4\u7cfb\u7edf\u540e\u8f6f\u4ef6\u51fa\u73b0\u610f\u5916\u9000\u51fa\uff0c\u53ef\u6309\u7167\u4e0b\u9762\u7684\u65b9\u6cd5\u7ed9\u8f6f\u4ef6\u7b7e\u540d 1. \u6253\u5f00\u300c\u7ec8\u7aefapp\u300d\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\uff1a xcode-select --install 2.\u7ed9\u8f6f\u4ef6\u7b7e\u540d \u6253\u5f00\u7ec8\u7aef\u5de5\u5177\u8f93\u5165\u5e76\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a sudo codesign --force --deep --sign - (\u5e94\u7528\u8def\u5f84) 3.\u9519\u8bef\u89e3\u51b3 \u5982\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef\u63d0\u793a\uff1a /\u6587\u4ef6\u4f4d\u7f6e : replacing existing signature /\u6587\u4ef6\u4f4d\u7f6e : resource fork,Finder information,or similar detritus not allowed \u90a3\u4e48\uff0c\u5148\u5728\u7ec8\u7aef\u6267\u884c\uff1a xattr -cr /\u6587\u4ef6\u4f4d\u7f6e\uff08\u76f4\u63a5\u5c06\u5e94\u7528\u62d6\u8fdb\u53bb\u5373\u53ef\uff09 \u7136\u540e\u518d\u6b21\u6267\u884c\u5982\u4e0b\u6307\u4ee4\u5373\u53ef\uff1a codesign --force --deep --sign - /\u6587\u4ef6\u4f4d\u7f6e\uff08\u76f4\u63a5\u5c06\u5e94\u7528\u62d6\u8fdb\u53bb\u5373\u53ef\uff09","title":"mac\u8f6f\u4ef6\u4fee\u590d"},{"location":"tools/macsoft/#2-macos-catalina-1015","text":"\u6253\u5f00\u300c\u7ec8\u7aef.app\u300d\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u5e76\u56de\u8f66\uff0c\u8f93\u5165\u5f00\u673a\u5bc6\u7801\u56de\u8f66 sudo xattr -rd com.apple.quarantine \u7a7a\u683c \u8f6f\u4ef6\u7684\u8def\u5f84 \u5982Sketch.app sudo xattr -rd com.apple.quarantine /Applications/Sketch.app \u5982CleanMyMac X.app sudo xattr -rd com.apple.quarantine /Applications/CleanMyMac X.app","title":"2. macOS Catalina 10.15\u7cfb\u7edf\uff1a"},{"location":"tools/macsoft/#3-macos-catalina-10154","text":"\u66f4\u65b010.15.4\u7cfb\u7edf\u540e\u8f6f\u4ef6\u51fa\u73b0\u610f\u5916\u9000\u51fa\uff0c\u53ef\u6309\u7167\u4e0b\u9762\u7684\u65b9\u6cd5\u7ed9\u8f6f\u4ef6\u7b7e\u540d 1. \u6253\u5f00\u300c\u7ec8\u7aefapp\u300d\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\uff1a xcode-select --install 2.\u7ed9\u8f6f\u4ef6\u7b7e\u540d \u6253\u5f00\u7ec8\u7aef\u5de5\u5177\u8f93\u5165\u5e76\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a sudo codesign --force --deep --sign - (\u5e94\u7528\u8def\u5f84) 3.\u9519\u8bef\u89e3\u51b3 \u5982\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef\u63d0\u793a\uff1a /\u6587\u4ef6\u4f4d\u7f6e : replacing existing signature /\u6587\u4ef6\u4f4d\u7f6e : resource fork,Finder information,or similar detritus not allowed \u90a3\u4e48\uff0c\u5148\u5728\u7ec8\u7aef\u6267\u884c\uff1a xattr -cr /\u6587\u4ef6\u4f4d\u7f6e\uff08\u76f4\u63a5\u5c06\u5e94\u7528\u62d6\u8fdb\u53bb\u5373\u53ef\uff09 \u7136\u540e\u518d\u6b21\u6267\u884c\u5982\u4e0b\u6307\u4ee4\u5373\u53ef\uff1a codesign --force --deep --sign - /\u6587\u4ef6\u4f4d\u7f6e\uff08\u76f4\u63a5\u5c06\u5e94\u7528\u62d6\u8fdb\u53bb\u5373\u53ef\uff09","title":"3. macOS Catalina 10.15.4 \u7cfb\u7edf\uff1a"},{"location":"tools/mkdocs/","text":"MKDocs \u662f\u4e00\u4e2a\u5feb\u901f\u3001\u7b80\u5355\u3001\u534e\u4e3d\u7684\u9759\u6001\u7f51\u7ad9\u751f\u6210\u5668\uff0c\u7528\u4e8e\u6784\u5efa\u9879\u76ee\u6587\u6863\u3002 \u6587\u6863\u6e90\u6587\u4ef6\u662f\u7528Markdown\u7f16\u5199\u7684\uff0c\u5e76\u4f7f\u7528\u5355\u4e2aYAML\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\u3002\u5e76\u6784\u5efa\u7684\u662f\u5b8c\u6574\u9759\u6001\u7684HTML\u7ad9\u70b9\uff0c\u4f60\u53ef\u4ee5\u6258\u7ba1\u9759\u6001\u9875\u9762\u5230GtuhubPages\u3001Amzone S3\u3001AliCloud OSS\u3001Nginx\u9759\u6001\u9875\u3002 \u5b89\u88c5 \u5982\u679c\u4f60\u6709\u548c\u4f7f\u7528\u5305\u7ba1\u7406\u5668(\u5982apt-get,dnf,homebrew,yum,chocolatey\u7b49\u7b49),\u90a3\u4e48\u60a8\u53ef\u80fd\u60f3\u8981\u641c\u7d22\u201cMkDocs\u201d\u5305\u5e76\u5b89\u5b89\u88c5\u3002\u4f8b\u5982\uff1acentos\u4e0a\u4f7f\u7528 yum install mkdocs \u624b\u52a8\u5b89\u88c5\u524d\u68c0\u67e5 \u5982\u679c\u4f60\u7684\u673a\u5668\u4e0a\u672a\u5b89\u88c5\u5305\u7ba1\u7406\u5668\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528 python \u548c pip \u5b89\u88c5. \u4e3a\u4e86\u53ef\u4ee5\u624b\u52a8\u5b89\u88c5 MkDocs \uff0c\u4f60\u9700\u8981\u53bb\u68c0\u67e5 python \u548c\u5305\u7ba1\u7406\u5668 pip \u662f\u5426\u5df2\u7ecf\u5b89\u88c5\u6210\u529f\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e0b\u547d\u4ee4\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u3002 $ python --version Python 3.8.2 $ pip --version pip 20.0.2 from /usr/local/lib/python3.8/site-packages/pip (python 3.8) MkDocs \u652f\u6301 Python \u7248\u672c\u4e3a 3.5, 3.6, 3.7, 3.8, and pypy3. \u624b\u52a8\u5b89\u88c5 \u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5\uff1a pip install mkdocs \u5b89\u88c5\u5b8c\u6210\u540e\u4f7f\u7528\uff1a $ mkdocs --version mkdocs, version 0.15.3 \u5165\u95e8\u6307\u5357 \u521b\u5efa\u4e00\u4e2aMKDocs\u9879\u76ee mkdocs new my-project \u5f53\u6267\u884c\u6210\u529f\u540e\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u9879\u76ee\u6587\u4ef6 my-project docs index.md mkdocs.yml \u6709\u4e00\u4e2a\u540d\u4e3amkdocs\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4ee5\u53ca\u4e00\u4e2a\u540d\u4e3adocs\u7684\u6587\u4ef6\u5939\uff0c\u8be5\u6587\u4ef6\u5939\u5c06\u5305\u542b\u60a8\u7684\u6587\u6863\u6e90\u6587\u4ef6\uff0c \u73b0\u5728docs\u6587\u4ef6\u5939\u53ea\u5305\u542b\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u6863\u9875\u9762\uff0c\u540d\u4e3aindex.md\u3002 \u5f00\u53d1\u5b9e\u65f6\u9884\u89c8 MkDocs\u5e26\u6709\u5185\u7f6e\u7684\u5f00\u53d1\u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u8ba9\u4f60\u5728\u5de5\u4f5c\u65f6\u9884\u89c8\u6587\u6863\u3002\u786e\u4fdd\u60a8\u5728\u4e0emkdocs\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u3002\u7136\u540e\u8fd0\u884cmkdocs serve\u547d\u4ee4\u542f\u52a8\u670d\u52a1\u5668: $ mkdocs serve INFO - Building documentation... INFO - Cleaning site directory [I 160402 15:50:43 server:271] Serving on http://127.0.0.1:8000 [I 160402 15:50:43 handlers:58] Start watching changes [I 160402 15:50:43 handlers:60] Start detecting changes \u6b64\u65f6\u4f60\u5c31\u53ef\u4ee5\u6253\u5f00\u7f51\u9875\u5b9e\u65f6\u67e5\u770b\u7f16\u5199\u7ed3\u679c\u3002 mkdocs.yml \u914d\u7f6e\u6587\u4ef6 site_name: \"\u7f51\u7ad9\u540d\u79f0\" nav: - Home: index.md - About: about.md theme: readthedocs site_name: \u8fd9\u91cc\u914d\u7f6e\u7f51\u7ad9\u540d\u79f0 theme\uff1a \u914d\u7f6e\u6587\u6863\u751f\u6210\u4e3b\u9898 nav: \u914d\u7f6e\u751f\u6210\u6587\u6863\u7684\u5bfc\u822a\u6761 \u5728nav\u4e0b\u9762\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u5bfc\u822a\u3002 \u6784\u5efa \u5728\u9879\u76ee\u6587\u4ef6\u5939\u4e0b\u9762\u76f4\u63a5\u4f7f\u7528 mkdocs build \u6267\u884c\u547d\u4ee4\u540e\uff0c\u6211\u4eec\u5c06\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u9762\u770b\u5230\u751f\u6210\u7684\u9759\u6001\u7f51\u7ad9\u6587\u4ef6\u5939 site . Github Pages \u53d1\u5e03 \u66f4\u591aMKDocs\u4fe1\u606f","title":"Mkdocs"},{"location":"tools/mkdocs/#_1","text":"\u5982\u679c\u4f60\u6709\u548c\u4f7f\u7528\u5305\u7ba1\u7406\u5668(\u5982apt-get,dnf,homebrew,yum,chocolatey\u7b49\u7b49),\u90a3\u4e48\u60a8\u53ef\u80fd\u60f3\u8981\u641c\u7d22\u201cMkDocs\u201d\u5305\u5e76\u5b89\u5b89\u88c5\u3002\u4f8b\u5982\uff1acentos\u4e0a\u4f7f\u7528 yum install mkdocs","title":"\u5b89\u88c5"},{"location":"tools/mkdocs/#_2","text":"\u5982\u679c\u4f60\u7684\u673a\u5668\u4e0a\u672a\u5b89\u88c5\u5305\u7ba1\u7406\u5668\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528 python \u548c pip \u5b89\u88c5. \u4e3a\u4e86\u53ef\u4ee5\u624b\u52a8\u5b89\u88c5 MkDocs \uff0c\u4f60\u9700\u8981\u53bb\u68c0\u67e5 python \u548c\u5305\u7ba1\u7406\u5668 pip \u662f\u5426\u5df2\u7ecf\u5b89\u88c5\u6210\u529f\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e0b\u547d\u4ee4\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u3002 $ python --version Python 3.8.2 $ pip --version pip 20.0.2 from /usr/local/lib/python3.8/site-packages/pip (python 3.8) MkDocs \u652f\u6301 Python \u7248\u672c\u4e3a 3.5, 3.6, 3.7, 3.8, and pypy3.","title":"\u624b\u52a8\u5b89\u88c5\u524d\u68c0\u67e5"},{"location":"tools/mkdocs/#_3","text":"\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5\uff1a pip install mkdocs \u5b89\u88c5\u5b8c\u6210\u540e\u4f7f\u7528\uff1a $ mkdocs --version mkdocs, version 0.15.3","title":"\u624b\u52a8\u5b89\u88c5"},{"location":"tools/mkdocs/#_4","text":"","title":"\u5165\u95e8\u6307\u5357"},{"location":"tools/mkdocs/#mkdocs","text":"mkdocs new my-project \u5f53\u6267\u884c\u6210\u529f\u540e\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u9879\u76ee\u6587\u4ef6 my-project docs index.md mkdocs.yml \u6709\u4e00\u4e2a\u540d\u4e3amkdocs\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4ee5\u53ca\u4e00\u4e2a\u540d\u4e3adocs\u7684\u6587\u4ef6\u5939\uff0c\u8be5\u6587\u4ef6\u5939\u5c06\u5305\u542b\u60a8\u7684\u6587\u6863\u6e90\u6587\u4ef6\uff0c \u73b0\u5728docs\u6587\u4ef6\u5939\u53ea\u5305\u542b\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u6863\u9875\u9762\uff0c\u540d\u4e3aindex.md\u3002","title":"\u521b\u5efa\u4e00\u4e2aMKDocs\u9879\u76ee"},{"location":"tools/mkdocs/#_5","text":"MkDocs\u5e26\u6709\u5185\u7f6e\u7684\u5f00\u53d1\u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u8ba9\u4f60\u5728\u5de5\u4f5c\u65f6\u9884\u89c8\u6587\u6863\u3002\u786e\u4fdd\u60a8\u5728\u4e0emkdocs\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u3002\u7136\u540e\u8fd0\u884cmkdocs serve\u547d\u4ee4\u542f\u52a8\u670d\u52a1\u5668: $ mkdocs serve INFO - Building documentation... INFO - Cleaning site directory [I 160402 15:50:43 server:271] Serving on http://127.0.0.1:8000 [I 160402 15:50:43 handlers:58] Start watching changes [I 160402 15:50:43 handlers:60] Start detecting changes \u6b64\u65f6\u4f60\u5c31\u53ef\u4ee5\u6253\u5f00\u7f51\u9875\u5b9e\u65f6\u67e5\u770b\u7f16\u5199\u7ed3\u679c\u3002","title":"\u5f00\u53d1\u5b9e\u65f6\u9884\u89c8"},{"location":"tools/mkdocs/#mkdocsyml","text":"site_name: \"\u7f51\u7ad9\u540d\u79f0\" nav: - Home: index.md - About: about.md theme: readthedocs site_name: \u8fd9\u91cc\u914d\u7f6e\u7f51\u7ad9\u540d\u79f0 theme\uff1a \u914d\u7f6e\u6587\u6863\u751f\u6210\u4e3b\u9898 nav: \u914d\u7f6e\u751f\u6210\u6587\u6863\u7684\u5bfc\u822a\u6761 \u5728nav\u4e0b\u9762\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u5bfc\u822a\u3002","title":"mkdocs.yml \u914d\u7f6e\u6587\u4ef6"},{"location":"tools/mkdocs/#_6","text":"\u5728\u9879\u76ee\u6587\u4ef6\u5939\u4e0b\u9762\u76f4\u63a5\u4f7f\u7528 mkdocs build \u6267\u884c\u547d\u4ee4\u540e\uff0c\u6211\u4eec\u5c06\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u9762\u770b\u5230\u751f\u6210\u7684\u9759\u6001\u7f51\u7ad9\u6587\u4ef6\u5939 site .","title":"\u6784\u5efa"},{"location":"tools/mkdocs/#github-pages","text":"","title":"Github Pages \u53d1\u5e03"},{"location":"tools/mkdocs/#mkdocs_1","text":"","title":"\u66f4\u591aMKDocs\u4fe1\u606f"},{"location":"tools/shell_record/","text":"","title":"Shell record"},{"location":"tools/jq/","text":"JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6 JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6 JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6 JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6","title":"Index"},{"location":"tools/jq/jq_generator_config/","text":"JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6 \u6709\u4e9b\u65f6\u5019\u6211\u4eec\u9700\u8981\u5feb\u901f\u751f\u6210\u4e00\u4e2aJson\u6587\u4ef6\uff0c\u6b64JSON\u6587\u4ef6\u7684\u90e8\u5206\u5185\u5bb9\u6765\u81eaenv json.template.json \u6587\u4ef6 { \"region\": env.REGSON, \"account\": env.ACCOUNT } \u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684shell: REGION=cn-hangzhou ACCOUNT=demo jq -n -f json.template.json \u540e\u4f1a\u76f4\u63a5\u4fee\u6539\u7f16\u8f91\u5e76\u8f93\u51fa\u7ed3\u679c\u6587\u4ef6: { \"region\": \"cn-zhangzhou\", \"account\": \"demo\" } \u6b64\u6587\u4ef6\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u4e8e\u4f60\u7684\u5b9e\u4f8b\u4e2d\u3002","title":"JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6"},{"location":"tools/jq/jq_generator_config/#jq-json","text":"\u6709\u4e9b\u65f6\u5019\u6211\u4eec\u9700\u8981\u5feb\u901f\u751f\u6210\u4e00\u4e2aJson\u6587\u4ef6\uff0c\u6b64JSON\u6587\u4ef6\u7684\u90e8\u5206\u5185\u5bb9\u6765\u81eaenv json.template.json \u6587\u4ef6 { \"region\": env.REGSON, \"account\": env.ACCOUNT } \u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684shell: REGION=cn-hangzhou ACCOUNT=demo jq -n -f json.template.json \u540e\u4f1a\u76f4\u63a5\u4fee\u6539\u7f16\u8f91\u5e76\u8f93\u51fa\u7ed3\u679c\u6587\u4ef6: { \"region\": \"cn-zhangzhou\", \"account\": \"demo\" } \u6b64\u6587\u4ef6\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u4e8e\u4f60\u7684\u5b9e\u4f8b\u4e2d\u3002","title":"JQ \u5de5\u5177\u5feb\u901f\u751f\u6210JSON\u6587\u4ef6"}]}